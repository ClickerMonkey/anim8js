{"version":3,"sources":["anim8js.min.js"],"names":["root","factory","define","amd","module","exports","global","m8","anim8","anim8js","m8s","anim8s","this","noop","isDefined","x","isFunction","constructor","call","apply","isNumber","isBoolean","isString","isArray","Array","isObject","isEmpty","length","prop","toArray","split","props","push","copy","copied","i","p","extend","out","arguments","o","coalesce","a","b","c","d","constant","variable","resolve","args","Animation","name","input","options","attrimators","Animator","e","reset","Animators","$","fill","Attrimator","AttrimatorMap","Builder","BuilderHelper","oldOptions","newOptions","forObject","prepareSpecifics","Calculator","Defer","methods","$factory","$push","DeferAnimator","animator","previous","eventType","event","$reset","Event","attribute","path","duration","easing","delay","sleep","offset","repeat","scale","scaleBase","parameters","hasInitialState","builder","next","mergeId","$easing","$duration","$sleep","$repeat","$scale","calculator","parse","ZERO","$delay","$offset","Factory","priority","FastMap","map","putMap","put","Oncer","value","applied","Path","Physics","position","velocity","acceleration","terminal","stopTime","$number","Number","POSITIVE_INFINITY","$time","finished","Sequence","animators","Spring","subject","$factoryFor","animatorFor","subjects","animatorsFor","isRunning","running","isLive","live","setLive","newLive","activateAnimator","pushAnimator","activate","active","animating","trigger","requestRun","run","currentTime","now","preupdate","update","filter","handleFinished","pause","attributes","resume","stop","end","finish","nopeat","Color","r","g","computed","funcOrName","func","isRelative","test","isComputed","resolveComputed","attrimator","parser","delegate","functionName","returning","DelegateTypes","THIS","array","RESULTS","results","FIRST","undefined","TRUE","composite","frame","partial","subattribute","spread","eventize","target","Class","defineProperty","on","once","off","addListener","$this","property","events","callback","context","removeListeners","listeners","eventListeners","k","splice","deleteProperty","obj","triggerListeners","argument","clear","max","slice","$on","$once","gcd","temp","choose","n","m","num","den","clamp","v","min","clamper","toDegrees","radians","RADIANS_TO_DEGREES","toRadians","degrees","DEGREES_TO_RADIANS","modder","divisor","param","paramName","paramCalculator","paramDefaultValue","getCalculator","parseValue","$calculator","defaultValue","getAttribute","paramFactory","computer","Parameters","parent","handleCalculation","newCalculator","calc","save","animation","$animation","SaveOptions","cache","qualifiedName","prefix","key","toLowerCase","Animations","saveGroup","prefixOrOptions","animations","previousOptions","parsedOptions","$options","Defaults","noOptions","parsedFactory","animationName","translate","mappings","saveAs","parsed","newAttrimators","fromAttribute","toAttribute","get","rekey","translated","Calculator2d","createConstants","Calculator3d","CalculatorNumber","CalculatorQuaternion","CalculatorRGB","CalculatorRGBA","CalculatorString","FactoryObject","BuilderAnd","BuilderDeltas","BuilderFinal","BuilderInitial","BuilderKeyframe","BuilderMove","BuilderPath","BuilderPhysics","BuilderPoint","BuilderQueue","BuilderSpring","BuilderTravel","BuilderTweenFrom","BuilderTweenTo","PathDelta","points","deltas","set","PathParametric","loop","matrix","weight","invert","PathBasisSpline","PathBezier","weights","PathCatmullRom","PathCombo","paths","uniform","granularity","PathCompiled","pointCount","PathCubic","p0","p1","p2","p3","PathHermite","start","startTangent","endTangent","PathJump","PathKeyframe","easings","PathLinear","PathPoint","point","PathQuadratic","PathQuadraticCorner","midpoint","PathSeries","series","PathSub","PathUniform","Tween","SpringDistance","rest","distance","damping","stiffness","gravity","finishOnRest","SpringLinear","temp0","temp1","Movie","currentTimelines","sequenceDelay","sequenceEasing","Easings","linear","introduce","timelines","autoEnd","MoviePlayer","movie","speed","time","playing","runner","MovieTimeline","hasOptions","merge","$attrimatorsFor","helper","builderName","$builder","saved","cacheIt","animationsQueued","animationsMerged","base","j","animationString","trim","animationSplit","parsedAnimation","additionalOptions","hasAdditionalOptions","parsedAttrimators","queueMap","builderInput","Builders","calculatorInput","Calculators","$deltas","clone","Math","gap","invertGap","returnOnInvalid","result","scaleIndex","indexOf","parseFloat","substring","EasingTypes","pair","t","isFinite","bezier","$easingType","easingType","optional","factoryInput","Factories","highestPriorityFactory","factoryName","is","isNaN","originalInput","cacheOptions","Options","part","first","charAt","paramSplit","paramValue","parseOptionProperty","parseFunction","propertyAdd","propertyScale","$path","pathInput","Paths","type","$spring","springInput","Springs","$transition","transition","Transitions","transitionArray","intro","outro","lookup","transitionTime","transitionOutro","transitionIntro","transitionEasing","transitionGranularity","transitionLookup","cacheTransitions","noTransition","superPrefix","construct","parentConstructor","properties","F","prototype","Object","enumerable","configurable","writable","teasing","frameRate","pauseTime","comboPathUniformGranularity","calculatorNumber","calculator2d","y","calculator3d","z","calculatorQuaternion","angle","calculatorRGB","calculatorRGBA","calculatorString","Date","getTime","String","replace","id","_id","attrimatorMap","attrimatorsAdded","updated","cycleCurrent","cycleNext","cycleEnded","newCycle","applyCycle","cycle","applyCurrentCycle","values","attr","startCycle","endCurrentCycle","restore","applyInitialState","aa","setDefault","cloneDefault","wasFinished","minCycle","setTime","isFinished","placeAttrimator","existing","trimAttrimators","removeAt","deactivate","destroy","spring","play","all","playAttrimators","finishNotPresent","unplay","unplayAttrimators","startings","transitionAttrimators","queue","queueAttrimators","insert","insertAttrimators","insertMap","transitionMap","transitionGetValue","transitionGetValueAt","transitionStopAttrimator","relativeTime","valueAt","getElapsed","stopIn","tweenTo","current","fromOptions","tweenManyTo","targets","tweenFrom","starting","tweenManyFrom","tween","starts","ends","tweenMany","move","amount","relative","moveMany","amounts","ref","request","follow","attrimatorsFor","keys","resulting","remove","unset","timeRemaining","hasAttrimators","size","getSubject","wrapper","invoke","defer","onCycleStart","onCycleEnd","at","index","each","iterator","filterer","alive","getSubjects","reverse","last","mid","floor","e0","e1","sequence","maxRemaining","startTime","elapsed","paused","prestart","prestartNext","overrideNext","totalTime","milliseconds","stopAt","valueAtSearch","attrimatorAt","hasComputed","isInfinite","totalPausedTime","isPaused","getBuilder","nextAt","setGroup","groupId","force","deep","onNewAttribute","hasCallback","mapOffset","timeOffset","unqueueAt","playMapAt","stopNotPresentAt","playAttrimatorAt","getValue","getValueAt","stopAttrimator","hasOverlap","curr","currValue","create","pastLookahead","pastVelocity","sub","pastNegativeVelocity","past","add","outTime","outPoint","outNext","inTime","inPoint","inNext","outVelocity","outPerMillis","inVelocity","inPerMillis","compiled","lastPoint","totalDistance","distances","requiredTime","timeDelta","transitionEvent","has","indices","returnInfinity","Infinity","nextCycle","currentDepth","nextDepth","iterate","depth","nextMergeId","mergeAttrimator","mergeEasing","mergeRepeat","mergeDelay","mergeSleep","mergeDuration","mergeOffset","mergeScale","mergeScaleBase","mergeParameters","submerge","specifics","parseEasing","parseFirst","parseRepeat","parseNumber","parseDelay","parseSleep","parseDuration","parseOffset","parseScale","parseScaleBase","option","parseEvent","parseParameters","parseOptionFunction","optionAdd","optionScale","baseRaw","mergeFirst","mergeNumber","specific","ONE","INFINITY","ignoreRelative","parseArray","output","parsedDefault","zero","convert","converter","adds","amountScale","mul","div","denominator","interpolate","delta","random","sqrt","distanceSq","lengthSq","isValid","isZero","epsilon","isEqual","dot","distSq","setLength","eventable","$eventable","$previous","$eventType","$event","$callback","$calls","$next","$isRoot","$register","$run","methodName","undefer","i2","x2","eq1","eq2","x3","sin","wave","abs","cos","inv","log10","inner","mX1","mY1","mX2","mY2","A","aA1","aA2","B","C","CalcBezier","aT","GetSlope","GetTForX","aX","aGuessT","currentSlope","currentX","EventState","DELAYED","ANIMATING","SLEEPING","FINISHED","computeValue","baseValue","compute","applyValue","newRepeat","ceil","state","replaceComputed","oldState","newState","iteration","sleepTime","animateTime","fromKey","toKey","lastValue","pop","lastKey","deterministic","isDeterministic","examinePoints","examiner","returnOnTrue","returnOnFalse","ps","resolvePoint","dt","isLinear","prev","deltadelta","resolveVelocity","resolveAcceleration","initalPosition","MAX_DT","vel","acc","pos","usePosition","maxDelay","createAttrimators","template","delayOffset","remaining","resolveRest","updateVelocity","EPSILON","vendors","requestor","requestAnimationFrame","setTimeout","lastTime","timeToCall","parsers","color","parseComponent","parseInt","vparsed","names","transparent","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","feldspar","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgrey","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslateblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","violetred","wheat","white","whitesmoke","yellow","yellowgreen","named","regex","matches","exec","cp","format","ca","cr","cg","cb","toString","relativeAmount","mask","relativeFunction","randomSelection","randomFunction","selected","resolvedMin","resolvedMax","numbers","numberCalculator","combinerFunction","combined","PI","valueResolve","scalar","calcScalar","scalarResolve","neg","truncate","calcDenominator","denominatorResolve","mod","calcDivisor","calcClamp","minResolve","maxResolve","round","cosDegrees","sinDegrees","tanDegrees","propertyName","vector","vectorCalculator","yaw","pitch","vectorDegrees","aliases","left","right","middle","center","top","bottom","def","cx","cy","rx","ry","ix","iy","parseString","dx","dy","cz","rz","iz","dz","ab","ra","ia","da","rr","rg","rb","ir","ig","ib","dr","dg","db","$animator","object","calculatorName","and","deltaObject","valueMax","initial","oncer","from","half","to","kframes","keyframe","sort","times","maxTime","order","pathEasings","pathDefinition","parsedPath","physics","physic","springs","travel","traveling","fromParsed","toParsed","pointing","traveler","subtractVelocity","pointingFunction","targetValue","difference","ds","d0","d1","pd","d2","d3","loops","_set","MATRIX","WEIGHT","computeWeights","inverses","w","pathCount","lengthGranularity","lengthTotal","lengths","lengthCurrent","cachedLength","_length","previousDelta","deltaDistance","deltaGap","pathDelta","compile","i1","i3","ea","getTimes","invlength","negmidpoint","halfmidpoint","between","_start","nextTimeline","setAutoEnd","getTimelines","with","additional","getTimeline","timelineId","$timelineId","timeline","seek","by","eachCurrentTimeline","onTimeline","timeGap","backward","forward","applyNow","avoidApplyTrigger","goto","applyTime","evaluatePlaying","player","currentValue","defaultEasing","conversions","inf","infinity","infinite","twice","thrice","dozen","ms","cs","jiffy","third","s","sec","h","hr","unit","fn","factoryFor","number","Aninmation","PathTween"],"mappings":"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","file":"anim8js.min.js","sourcesContent":["/* anim8js 1.1.9 - anim8js - Anim8 Everything by Philip Diffenderfer */\n// UMD (Universal Module Definition)\n(function (root, factory)\n{\n  if (typeof define === 'function' && define.amd) // jshint ignore:line\n  {\n    // AMD. Register as an anonymous module.\n    define('anim8js', [], function() { // jshint ignore:line\n      return factory(root);\n    });\n  }\n  else if (typeof module === 'object' && module.exports)  // jshint ignore:line\n  {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like environments that support module.exports,\n    // like Node.\n    module.exports = factory(global);  // jshint ignore:line\n  }\n  else\n  {\n    // Browser globals (root is window)\n    root.m8 = root.anim8 = root.anim8js = factory(root);\n    root.m8s = root.anim8s = root.anim8.anim8s;\n  }\n}(this, function(global)\n{\n\n\nvar Class =\n{\n  superPrefix: '_',\n\n  extend: function(construct, parentConstructor, properties)\n  {\n    function F() {}\n\n    F.prototype = parentConstructor.prototype;\n\n    construct.prototype = new F();\n\n    if ( isObject( properties ) )\n    {\n      this.define( construct, properties );\n    }\n  },\n\n  define: function(construct, properties)\n  {\n    var target = construct.prototype;\n\n    for (var prop in properties)\n    {\n      if ( prop in target )\n      {\n        this.defineProperty( target, this.superPrefix + prop, target[ prop ] );\n      }\n\n      this.defineProperty( target, prop, properties[ prop ] );\n    }\n  },\n\n  defineProperty: function(target, property, value)\n  {\n    if ( Object.defineProperty )\n    {\n      Object.defineProperty( target, property, {\n        enumerable: false,\n        configurable: true,\n        writable: true,\n        value: value\n      });\n    }\n    else\n    {\n      target[ property ] = value;\n    }\n  }\n};\n\n\n\n/**\n * The default values for anim8js properties.\n *\n * @property {Object} anim8.Defaults\n */\nvar Defaults =\n{\n\n  /**\n   * The default animation duration in milliseconds.\n   *\n   * @property {Number} duration\n   * @for anim8.Defaults\n   * @default 1000\n   */\n  duration: 1000,\n\n  /**\n   * The default easing.\n   *\n   * @property {String|Function|Array} easing\n   * @for anim8.Defaults\n   * @default 'ease'\n   */\n  easing: 'ease',\n\n  /**\n   * The default \"total easing\" which is the overall easing\n   * for an animation which actually has easing values per frame.\n   *\n   * @property {String|Function|Array} teasing\n   * @for anim8.Defaults\n   * @default 'linear'\n   */\n  teasing: 'linear',\n\n  /**\n   * The default animation delay in milliseconds.\n   *\n   * @property {Number} delay\n   * @for anim8.Defaults\n   * @default 0\n   */\n  delay: 0,\n\n  /**\n   * The default animation sleep in milliseconds.\n   *\n   * @property {Number} sleep\n   * @for anim8.Defaults\n   * @default 0\n   */\n  sleep: 0,\n\n  /**\n   * The default number of repeats for an animation.\n   *\n   * @property {Number} repeat\n   * @for anim8.Defaults\n   * @default 1\n   */\n  repeat: 1,\n\n  /**\n   * The default scale for an animation.\n   *\n   * @property scale\n   * @for anim8.Defaults\n   * @default 1.0\n   * @type {Number}\n   */\n  scale: 1.0,\n\n  /**\n   * The default animation offset in milliseconds.\n   *\n   * @property {Number} offset\n   * @for anim8.Defaults\n   * @default 0\n   */\n  offset: 0,\n\n  /**\n   * The default transition time in milliseconds.\n   *\n   * @property {Number} transitionTime\n   * @for anim8.Defaults\n   * @default 500\n   */\n  transitionTime: 500,\n\n  /**\n   * The default transition outroduction time in milliseconds.\n   *\n   * @property {Number} transitionOutro\n   * @for anim8.Defaults\n   * @default 100\n   */\n  transitionOutro: 100,\n\n  /**\n   * The default transition introduction time in milliseconds.\n   *\n   * @property {Number} transitionIntro\n   * @for anim8.Defaults\n   * @default 100\n   */\n  transitionIntro: 100,\n\n  /**\n   * The default transition easing when none is specified.\n   *\n   * @property {String|Function|Array} transitionEasing\n   * @for anim8.Defaults\n   * @default 'linear'\n   */\n  transitionEasing: 'linear',\n\n  /**\n   * The default transition granularity. This is used for smooth transitions to\n   * provide a smooth transition from the outro velocity to the intro velocity,\n   * the cubic or quadratic path between the two is a curve with unknown length\n   * so the length needs to be calculated using a maximum number of points to\n   * calculate along the path - summing the distances between the consecutive points.\n   *\n   * @property {Number} transitionGranularity\n   * @for anim8.Defaults\n   * @default 0\n   */\n  transitionGranularity: 0,\n\n  /**\n   * TODO\n   *\n   * @property {Number} transitionLookup\n   * @for anim8.Defaults\n   * @default 10\n   */\n  transitionLookup: 10,\n\n  /**\n   * Whether animtions are cached whenever possible. Animations that can be\n   * cached are strings with options specified in the string and without an\n   * option object given. For example 'tada ~1s 3s x3' is cacheable.\n   *\n   * **See:** {{#crossLink \"Core/anim8.animation:method\"}}{{/crossLink}}\n   *\n   * @property {Boolean} cache\n   * @for anim8.Defaults\n   * @default false\n   */\n  cache: false,\n\n  /**\n   * Whether parsed options are cached whenever possible. Options that can be\n   * cached must be strings.\n   *\n   * **See:** {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}}\n   *\n   * @property {Boolean} cacheOptions\n   * @for anim8.Defaults\n   * @default false\n   */\n  cacheOptions: false,\n\n  /**\n   * Whether parsed transitions are cached whenever possible. Transitions that can be\n   * cached must be strings.\n   *\n   * **See:** {{#crossLink \"Core/anim8.transition:method\"}}{{/crossLink}}\n   *\n   * @property {Boolean} cacheTransitions\n   * @for anim8.Defaults\n   * @default false\n   */\n  cacheTransitions: false,\n\n  /**\n   * The value to return when options could not be parsed from input.\n   *\n   * @property {Object} noOptions\n   * @for anim8.Defaults\n   * @default {}\n   */\n  noOptions: {},\n\n  /**\n   * The value to return when a transition could not be parsed from input.\n   *\n   * @property {Object} noTransition\n   * @for anim8.Defaults\n   * @default {}\n   */\n  noTransition: {},\n\n  /**\n   * The target number of milliseconds between frames. This only applies if the\n   * browser doesn't support any of the requestAnimationFrame variations.\n   *\n   * @property {Number} frameRate\n   * @for anim8.Defaults\n   * @default 33\n   */\n  frameRate: 16,\n\n  /**\n   * The number of milliseconds to pause between looping to let the UI react\n   * to user events.\n   *\n   * @property {Number} pauseTime\n   * @for anim8.Defaults\n   * @default 5\n   */\n  pauseTime: 5,\n\n  /**\n   * The granularity for uniform combo paths used to calculate path lengths.\n   *\n   * @property {Number} comboPathUniformGranularity\n   * @for anim8.Defaults\n   * @default 100\n   */\n\n  comboPathUniformGranularity: 100,\n\n  calculatorNumber: 0,\n\n  calculator2d: {x: 0, y: 0},\n\n  calculator3d: {x: 0, y: 0, z: 0},\n\n  calculatorQuaternion: {x: 0, y: 0, z: 0, angle: 0},\n\n  calculatorRGB: {r: 0, g: 0, b: 0},\n\n  calculatorRGBA: {r: 0, g: 0, b: 0, a: 1},\n\n  calculatorString: ''\n};\n\n\nvar DelegateTypes =\n{\n\n  /**\n   * this is returned at the end.\n   *\n   * @property THIS\n   * @for DelegateTypes\n   */\n  THIS: 'this',\n\n  /**\n   * An array of results for each method call is returned.\n   *\n   * @property RESULTS\n   * @for DelegateTypes\n   */\n  RESULTS: 'results',\n\n  /**\n   * The result of the first element.\n   *\n   * @property RETURN_FIRST\n   * @for delegate\n   */\n  FIRST: 'first',\n\n  /**\n   * True if any of the methods return true, otherwise false.\n   *\n   * @property RETURN_TRUE\n   * @for delegate\n   */\n  TRUE: 'true'\n\n};\n\n\n\n/**\n * @class Core\n */\n\n/**\n * A function that does nothing.\n *\n * @property anim8.noop\n */\nfunction noop() {}\n\n/**\n * Returns true if the given variable is defined.\n *\n * **Examples:**\n *\n *     anim8.isDefined( 0 );     // true\n *     anim8.isDefined( false ); // true\n *     anim8.isDefined();        // false\n *\n * @method anim8.isDefined\n * @param {Any} x\n * @return {Boolean}\n */\nfunction isDefined(x)\n{\n  return typeof x !== 'undefined';\n}\n\n/**\n * Returns true if the given variable is a function.\n *\n * @method anim8.isFunction\n * @param {Any} x\n * @return {Boolean}\n */\nfunction isFunction(x)\n{\n  return !!(x && x.constructor && x.call && x.apply);\n}\n\n/**\n * Returns true if the given variable is a number.\n *\n * **Examples:**\n *\n *     anim8.isNumber( 0 );     // true\n *     anim8.isNumber( -45.6 ); // true\n *     anim8.isNumber( true );  // false\n *     anim8.isNumber( '1' );   // false\n *     anim8.isNumber();        // false\n *\n * @method anim8.isNumber\n * @param {Any} x\n * @return {Boolean}\n */\nfunction isNumber(x)\n{\n  return typeof x === 'number';\n}\n\n/**\n * Returns true if the given variable is a boolean variable.\n *\n * **Examples:**\n *\n *     anim8.isBoolean( 0 );     // false\n *     anim8.isBoolean( -45.6 ); // false\n *     anim8.isBoolean( true );  // true\n *     anim8.isBoolean( false ); // true\n *     anim8.isBoolean( '1' );   // false\n *     anim8.isBoolean();        // false\n *\n * @method anim8.isBoolean\n * @param {Any} x\n * @return {Boolean}\n */\nfunction isBoolean(x)\n{\n  return typeof x === 'boolean';\n}\n\n/**\n * Returns true if the given variable is a string.\n *\n * **Examples:**\n *\n *     anim8.isString( '' );    // true\n *     anim8.isString( '1' );   // true\n *     anim8.isString( 4.5 );   // false\n *     anim8.isString();        // false\n *\n * @method anim8.isString\n * @param {Any} x\n * @return {Boolean}\n */\nfunction isString(x)\n{\n  return typeof x === 'string';\n}\n\n/**\n * Returns true if the given variable is an array. This should be checked before\n * anim8.isObject since Arrays are objects.\n *\n * **Examples:**\n *\n *     anim8.isArray( [] );     // true\n *     anim8.isArray( [4, 5] ); // true\n *     anim8.isArray( 4.5 );    // false\n *     anim8.isArray();         // false\n *\n * @method anim8.isArray\n * @param {Any} x\n * @return {Boolean}\n */\nfunction isArray(x)\n{\n  return x instanceof Array;\n}\n\n/**\n * Returns true if the given variable is an object. Arrays are considered\n * objects.\n *\n * **Examples:**\n *\n *     anim8.isObject( {} );     // true\n *     anim8.isObject( [] );     // true\n *     anim8.isObject( 4.5 );    // false\n *     anim8.isObject();         // false\n *     anim8.isObject( null );   // false\n *\n * @method anim8.isObject\n * @param {Any} x\n * @return {Boolean}\n */\nfunction isObject(x)\n{\n  return typeof x === 'object' && x !== null;\n}\n\n/**\n * Returns the current time in milliseconds.\n *\n * @method anim8.now\n * @return {Number}\n */\nvar now = (function()\n{\n  return Date.now ? Date.now : function()\n  {\n    return new Date().getTime();\n  };\n\n})();\n\n/**\n * Returns the trimmed version of the given string. A trimmed string has no\n * whitespace in the beginning or end of it.\n *\n * **Examples:**\n *\n *     anim8.trim( 'x' );     // 'x'\n *     anim8.trim( '   x' );  // 'x'\n *     anim8.trim( 'x   ' );  // 'x'\n *     anim8.trim( '  x ' );  // 'x'\n *     anim8.trim( '    ' );  // ''\n *\n * @method anim8.trim\n * @param  {String} x\n * @return {String}\n */\nvar trim = (function()\n{\n  if (String.prototype.trim) {\n    return function(x) {\n      return x.trim();\n    };\n  }\n  return function(x) {\n    return x.replace(/^([\\s]*)|([\\s]*)$/g, '');\n  };\n})();\n\n/**\n * Determines whether the given variable is empty.\n *\n * **Examples:**\n *\n *     anim8.isEmpty( '' );        // true\n *     anim8.isEmpty( 0 );         // true\n *     anim8.isEmpty( [] );        // true\n *     anim8.isEmpty( {} );        // true\n *     anim8.isEmpty( null );      // true\n *     anim8.isEmpty( true );      // true\n *     anim8.isEmpty( false );     // true\n *     anim8.isEmpty( 'x' );       // false\n *     anim8.isEmpty( 0.3 );       // false\n *     anim8.isEmpty( [0] );       // false\n *     anim8.isEmpty( {x:3} );     // false\n *\n * @method anim8.isEmpty\n * @param {Any} x\n * @return {Boolean}\n */\nfunction isEmpty(x)\n{\n  if ( isArray( x ) || isString( x ) )\n  {\n    return x.length === 0;\n  }\n  else if ( x === null )\n  {\n    return true;\n  }\n  else if ( isObject( x ) )\n  {\n    for (var prop in x)\n    {\n      return false;\n    }\n  }\n  else if ( isNumber( x ) )\n  {\n    return x !== 0.0;\n  }\n\n  return true;\n}\n\n/**\n * Parses the given input and returns an array.\n *\n * **Examples:**\n *\n *     anim8.toArray();            // []\n *     anim8.toArray('a b');       // ['a b']\n *     anim8.toArray('a b', ' ');  // ['a', 'b']\n *     anim8.toArray({a:0,b:0});   // ['a', 'b']\n *     anim8.toArray(['a', 'b']);  // ['a', 'b']\n *     anim8.toArray(3.2);         // [3.2]\n *     anim8.toArray(true);        // [true]\n *\n * @param  {Any} x\n * @param  {String} [split]\n * @return {Array}\n */\nfunction toArray( x, split )\n{\n  if ( isString( x ) )\n  {\n    return split ? x.split( split ) : [ x ];\n  }\n  else if ( isArray ( x ) )\n  {\n    return x;\n  }\n  else if ( isObject( x ) )\n  {\n    var props = [];\n\n    for ( var prop in x )\n    {\n      props.push( prop );\n    }\n\n    return props;\n  }\n  else if ( isDefined( x ) )\n  {\n    return [ x ];\n  }\n\n  return [];\n}\n\n/**\n * Performs a deep copy of the given variable. If the variable is an array or\n * object a new instance of that type is created where the values are copied as\n * well. All other types can't be copied (most likely because they're scalar) so\n * they are returned as-is.\n *\n * @method anim8.copy\n * @param {T} x\n * @return {T}\n */\nfunction copy(x)\n{\n  if ( isArray(x) )\n  {\n    var copied = [];\n\n    for (var i = 0; i < x.length; i++)\n    {\n      copied.push( copy( x[i] ) );\n    }\n\n    x = copied;\n  }\n  else if ( isObject(x) )\n  {\n    var copied = {};\n\n    for (var p in x)\n    {\n      copied[p] = copy( x[p] );\n    }\n\n    x = copied;\n  }\n\n  return x;\n}\n\n/**\n * Extends the given object by merging the following objects into it, avoiding\n * overriding any existing properties.\n *\n * @method anim8.extend\n * @param  {Object} out\n * @return {Object}\n */\nfunction extend(out)\n{\n  for (var i = 1; i < arguments.length; i++)\n  {\n    var o = arguments[ i ];\n\n    if ( isObject( o ) )\n    {\n      for (var prop in o)\n      {\n        if ( !(prop in out) )\n        {\n          out[prop] = o[prop];\n        }\n      }\n    }\n  }\n\n  return out;\n}\n\n/**\n * Returns the first defined variable of a possible 4 variables.\n *\n * **Examples:**\n *\n *     anim8.coalesce( 1, 2, 3 );           // 1\n *     anim8.coalesce( undefined, 2, 3 );   // 2\n *     anim8.coalesce();                    // undefined\n *\n * @method anim8.coalesce\n */\nfunction coalesce(a, b, c, d)\n{\n  if (isDefined(a)) {\n    return a;\n  }\n  if (isDefined(b)) {\n    return b;\n  }\n  if (isDefined(c)) {\n    return c;\n  }\n  return d;\n}\n\n/**\n * Provides a way to wrap a variable so calculators don't try copying it on parse.\n *\n * **Examples:**\n *\n *     anim8.constant( 5 );   // function() { return 5; }\n *\n * @method anim8.constant\n * @param {T} variable\n * @return {Function}\n */\nfunction constant(variable)\n{\n  return function()\n  {\n    return variable;\n  };\n}\n\n/**\n * Resolves the given variable. If the variable is a function the result is\n * returned.\n *\n * **Examples:**\n *\n *     anim8.resolve( 5 );                     // 5\n *     anim8.resolve( true );                  // true\n *     anim8.resolve( function(){return 7;} ); // 7\n *\n * @method anim8.resolve\n * @param  {Function|E} variable\n * @param  {Any[]} [args]\n * @return {E}\n */\nfunction resolve(variable, args)\n{\n  return isFunction( variable ) ? ( args ? variable.apply(this, args) : variable() ) : variable;\n}\n\n/**\n * Returns a \"unique\" identifier.\n *\n * @method id\n * @return {Number}\n */\nvar id = (function()\n{\n  var _id = 0;\n  return function() {\n    return ++_id;\n  };\n\n})();\n\n\n/**\n * Instantiates a new Animation given it's name, the input & options passed, and\n * the attrimators that were generated from the input & options. If the name is\n * false this is an anonymous animation. Input & Options are used by builders to\n * generate attrimators, options allow for an animations default properties to\n * be overriden.\n *\n * @param {String|Boolean} name\n * @param {Object} input\n * @param {Object} options\n * @param {AttrimatorMap} attrimators\n * @class Animation\n * @constructor\n */\nfunction Animation(name, input, options, attrimators)\n{\n  /**\n   * The name of the animation, or false if it's an anonymous animation.\n   *\n   * @property {String|False} name\n   */\n  this.name = name;\n\n  /**\n   * The object which created the animation.\n   *\n   * @property {Object} input\n   */\n  this.input = input;\n\n  /**\n   * The options given when the animation was created.\n   *\n   * @property {Object} [options]\n   */\n  this.options = options;\n\n  /**\n   * The name of the animation, or false if it's an anonymous animation.\n   *\n   * @property {AttrimatorMap} name\n   */\n  this.attrimators = attrimators;\n}\n\nClass.define( Animation,\n{\n\n  /**\n   * Generates an map of event instances from the attrimators in this animation.\n   *\n   * @method newAttrimators\n   * @return {AttrimatorMap}\n   */\n  newAttrimators: function()\n  {\n    return this.attrimators.clone();\n  },\n\n  /**\n   * Merges options with the options in this animation and places them in the\n   * events.\n   *\n   * @method merge\n   * @param {Object} [options]\n   * @param {AttrimatorMap} attrimatorMap\n   * @return {AttrimatorMap}\n   */\n  merge: function(options, attrimatorMap)\n  {\n    var helper = new BuilderHelper( this.input, this.options, options );\n\n    for (var builderName in this.input)\n    {\n      var builder = $builder( builderName );\n\n      if ( builder !== false && builder.merge )\n      {\n        builder.merge( this.input, options, this.options, attrimatorMap, helper );\n      }\n    }\n\n    return attrimatorMap;\n  }\n\n});\n\n\n/**\n * Instantiates a new Animator given a subject to animate.\n *\n * @param {Any} e\n * @class Animator\n * @constructor\n * @extends anim8.eventize\n */\nfunction Animator(e)\n{\n  this.reset( e );\n}\n\n/**\n * The event triggered after preupdate is called. Pre-update is used to run any\n * preparations on the subject before updates are made and attributes are\n * applied.\n *\n * @event preupdate\n */\n\n/**\n * The event triggered after all attrimators are updated and any new values\n * have been applied to the current values (frame) on the animator.\n *\n * @event update\n */\n\n/**\n * The event triggered after the current values (frame) on the animator are\n * applied to the subject.\n *\n * @event apply\n */\n\n/**\n * The event triggered when the given animation cycle starts (and initial\n * values are applied) for all attrimators in the cycle.\n *\n * @event cycleStart:#\n * @param {Number} cycleID\n */\n\n/**\n * The event triggered when the given animation cycle ends which occurs when the\n * last attrimator for an animation finishes or is interrupted by commands like\n * play, queue, transition, end, finish, & stop.\n *\n * @event cycleEnd:#\n * @param {Number} cycleID\n */\n\n/**\n * The event triggered when all animations on the animator have finished.\n *\n * @event finished\n * @param {Animator} animator\n */\n\n/**\n * The event triggered when an animator is deactivated which occurs when an\n * animator has finished animating and is being taken off the list of live\n * animators (anim8.animating).\n *\n * @event deactivate\n */\n\n/**\n * The event triggered after the user calls destroy on an animator.\n *\n * @event destroyed\n */\n\nClass.define( Animator,\n{\n\n  /**\n   * Resets the animator given a subject to animate.\n   *\n   * @method reset\n   * @param {Any} subject\n   * @chainable\n   * @protected\n   */\n  reset: function(subject)\n  {\n    /**\n     * The subject which is being animated.\n     *\n     * @property {Any} subject\n     */\n    this.subject = subject;\n\n    /**\n     * The map of attrimators animating the subject.\n     *\n     * @property {AttrimatorMap} attrimators\n     */\n    this.attrimators = new AttrimatorMap();\n\n    /**\n     * The array of attrimators recently added to the animator that\n     * are ready to be started.\n     *\n     * @property {Array} attrimatorsAdded\n     * @protected\n     */\n    this.attrimatorsAdded = [];\n\n    /**\n     * The object which stores the attribute values being animated.\n     *\n     * @property {Object} frame\n     */\n    this.frame = {};\n\n    /**\n     * The object which stores the attributes last updated.\n     *\n     * @property {Object} updated\n     */\n    this.updated = {};\n\n    /**\n     * Whether or not this animator has completely finished animating it's subject.\n     *\n     * @property {Boolean} finished\n     */\n    this.finished = false;\n\n    /**\n     * The factory which created this Animator given a subject.\n     *\n     * @property {Factory} factory\n     */\n    this.factory = null;\n\n    /**\n     * Whether or not this animator is actively being updated.\n     *\n     * @property {Boolean} active\n     */\n    this.active = false;\n\n    /**\n     * The current cycle being animated. Multiple cycles can be animated at once, this is the first one.\n     *\n     * @property {Number} cycleCurrent\n     * @protected\n     */\n    this.cycleCurrent = 0;\n\n    /**\n     * The ID of the next cycle of animations to be added to this Animator.\n     *\n     * @property {Number} cycleNext\n     * @protected\n     */\n    this.cycleNext = 0;\n\n    /**\n     * The last cycle that was ended.\n     *\n     * @property {Number} cycleEnded\n     * @protected\n     */\n    this.cycleEnded = 0;\n\n    return this;\n  },\n\n  /**\n   * Starts a new animation cycle. This is done before events & springs are\n   * placed to group them together so we know when to apply their initial value.\n   *\n   * @method newCycle\n   * @param {Attrimator|AttrimatorMap} attrimators\n   * @chainable\n   * @protected\n   */\n  newCycle: function(attrimators)\n  {\n    this.cycleNext++;\n\n    if ( attrimators instanceof AttrimatorMap )\n    {\n      this.cycleNext = attrimators.applyCycle( this.cycleNext );\n    }\n    else if ( attrimators instanceof Attrimator )\n    {\n      attrimators.cycle = this.cycleNext;\n    }\n\n    return this;\n  },\n\n  /**\n   * Applies the current cycle. This involves finding all attrimators with the\n   * same cycle identifier and applying their initial state.\n   *\n   * @method applyCurrentCycle\n   * @chainable\n   * @protected\n   */\n  applyCurrentCycle: function()\n  {\n    var cycle = this.cycleCurrent;\n    var attrimators = this.attrimators.values;\n\n    for (var i = attrimators.length - 1; i >= 0; i--)\n    {\n      var attrimator = attrimators[ i ];\n      var attr = attrimator.attribute;\n\n      if ( attrimator.cycle === cycle )\n      {\n        this.updated[ attr ] = (attrimator.startCycle( this.frame ) !== false) || this.updated[ attr ];\n      }\n    }\n\n    return this;\n  },\n\n  /**\n   * Ends the current cycle which calls any listening functions.\n   *\n   * @method endCurrentCycle\n   * @chainable\n   * @protected\n   */\n  endCurrentCycle: function()\n  {\n    if ( this.cycleCurrent > this.cycleEnded )\n    {\n      this.cycleEnded = this.cycleCurrent;\n      this.trigger( 'cycleEnd:' + this.cycleCurrent, this.cycleCurrent );\n    }\n  },\n\n  /**\n   * Returns the attribute descriptor given the name of the attribute.\n   *\n   * @method getAttribute\n   * @param  {String} attr\n   * @return {Object}\n   */\n  getAttribute: function(attr)\n  {\n    return this.factory.attribute( attr );\n  },\n\n  /**\n   * Restores any temporary state that may exist on this Animator that\n   * is a result from animations.\n   *\n   * @method restore\n   * @chainable\n   */\n  restore: function()\n  {\n    return this;\n  },\n\n  /**\n   * Applies the initial state of recently added attrimators immediately.\n   *\n   * @method applyInitialState\n   * @chainable\n   */\n  applyInitialState: function()\n  {\n    var currentTime = now();\n\n    this.preupdate( currentTime );\n    this.update( currentTime );\n    this.apply();\n\n    return this;\n  },\n\n  /**\n   * A method thats invoked along with all other animators before updates are\n   * called. This is used to make any necessary preparations before the animator\n   * is updated.\n   *\n   * @method preupdate\n   * @param {Number} now\n   * @chainable\n   */\n  preupdate: function(now)\n  {\n    // If there are attribute placed on the animator since the last preupdate\n    // that has computed values we need to replace the path on the event with\n    // a copy containing the computed values. This is where current value &\n    // relative values are injected from the animator into the attribute.\n    var aa = this.attrimatorsAdded;\n    if ( aa.length )\n    {\n      for (var i = 0; i < aa.length; i++)\n      {\n        var attrimator = aa[ i ];\n        var attr = attrimator.attribute;\n\n        if ( attr in this.subject )\n        {\n          this.frame[ attr ] = this.subject[ attr ];\n        }\n        else\n        {\n          this.setDefault( attr );\n        }\n\n        attrimator.start( now, this );\n      }\n\n      aa.length = 0;\n    }\n\n    this.trigger('preupdate');\n\n    return this;\n  },\n\n  /**\n   * Sets the default value for the given attribute in the frame of this\n   * Animator if there's no value there.\n   *\n   * @method setDefault\n   * @param {String} attr\n   * @protected\n   */\n  setDefault: function(attr)\n  {\n    if ( !(attr in this.frame) )\n    {\n      this.frame[ attr ] = this.getAttribute( attr ).cloneDefault();\n    }\n  },\n\n  /**\n   * Updates all attrimators in this animator with the given time.\n   *\n   * @method update\n   * @param {Number} now\n   * @chainable\n   */\n  update: function(now)\n  {\n    this.wasFinished = this.finished;\n    this.finished = true;\n\n    var attrimators = this.attrimators.values;\n    var minCycle = this.cycleNext;\n\n    for (var i = attrimators.length - 1; i >= 0; i--)\n    {\n      var attrimator = attrimators[ i ];\n      var attr = attrimator.attribute;\n\n      this.updated[ attr ] = attrimator.setTime( now, this.frame );\n\n      this.finished = this.finished && attrimator.isFinished();\n\n      minCycle = Math.min( minCycle, attrimator.cycle );\n    }\n\n    if ( this.cycleCurrent < minCycle )\n    {\n      while ( this.cycleCurrent < minCycle )\n      {\n        this.endCurrentCycle();\n        this.cycleCurrent++;\n      }\n\n      this.cycleCurrent = minCycle;\n      this.applyCurrentCycle();\n      this.trigger( 'cycleStart:' + this.cycleCurrent, this.cycleCurrent );\n    }\n\n    if ( !this.wasFinished && this.finished )\n    {\n      this.endCurrentCycle();\n    }\n\n    this.trigger('update');\n\n    return this;\n  },\n\n  /**\n   * Places the attribute animator in this animator replacing any existing\n   * animator for the same attribute. The next time the animator is updated the\n   * attribute animator will be started. The previous (if any) attrimator is\n   * returned.\n   *\n   * @method placeAttrimator\n   * @param {Attrimator} attrimator\n   * @return {Attrimator}\n   */\n  placeAttrimator: function(attrimator)\n  {\n    var attr = attrimator.attribute;\n    var existing = this.attrimators.get( attr );\n\n    this.attrimators.put( attr, attrimator );\n    this.attrimatorsAdded.push( attrimator );\n\n    this.finished = false;\n\n    return existing;\n  },\n\n  /**\n   * Applies all updated attributes to the subject. This method is invoked with\n   * all of the other animators at the end of the animation cycle.\n   *\n   * @method apply\n   * @chainable\n   */\n  apply: function()\n  {\n    for (var attr in this.frame)\n    {\n      if ( this.updated[ attr ] )\n      {\n        this.subject[ attr ] = this.frame[ attr ];\n        this.updated[ attr ] = false;\n      }\n    }\n\n    this.trigger('apply');\n\n    this.trimAttrimators();\n\n    return this;\n  },\n\n  /**\n   * Removes any finished attrimators and places any queued attrimators. If the\n   * animator previously wasn't finished but now is the 'finished' event will\n   * be triggered.\n   *\n   * @method trimAttrimators\n   * @chainable\n   * @protected\n   */\n  trimAttrimators: function()\n  {\n    var attrimators = this.attrimators.values;\n\n    for (var i = attrimators.length - 1; i >= 0; i--)\n    {\n      var attrimator = attrimators[ i ];\n\n      if ( attrimator.isFinished() )\n      {\n        if ( attrimator.next )\n        {\n          this.placeAttrimator( attrimator.next );\n        }\n        else\n        {\n          this.attrimators.removeAt( i );\n        }\n      }\n    }\n\n    if ( !this.wasFinished && this.finished )\n    {\n      this.trigger( 'finished', this );\n    }\n\n    return this;\n  },\n\n  /**\n   * Returns the current value for the given attribute (or undefined if the\n   * attribute is not or has not animated).\n   *\n   * @method value\n   * @param {String} attr\n   * @return {Any}\n   */\n  value: function(attr)\n  {\n    return this.frame[ attr ];\n  },\n\n  /**\n   * Activates this Animator by adding it to the main loop if it isn't there\n   * already.\n   *\n   * @method activate\n   * @chainable\n   */\n  activate: function()\n  {\n    activateAnimator( this );\n\n    return this;\n  },\n\n  /**\n   * A method that is invoked when an animator is finished and is being removed\n   * from the list of currently animating Animators.\n   *\n   * @method deactivate\n   * @chainable\n   */\n  deactivate: function()\n  {\n    this.trigger('deactivate', this);\n\n    return this;\n  },\n\n  /**\n   * A method that can be invoked to destroy an animator - removing any\n   * relationship between the subject and animator. The next time an animator is\n   * generated for the subject a new animator will be created.\n   *\n   * @method destroy\n   * @chainable\n   */\n  destroy: function()\n  {\n    this.finished = true;\n\n    this.factory.destroy( this );\n\n    this.trigger('destroyed');\n\n    return this;\n  },\n\n  /**\n   * Adds a spring to this animator replacing any existing attrimator for the\n   * same attribute. A spring object can be given, an instance of anim8.Spring,\n   * or a name of a saved Spring. The spring added to the animator is returned.\n   *\n   * @method spring\n   * @param {Spring|String|Object} spring\n   * @return {Spring}\n   */\n  spring: function(spring)\n  {\n    var spring = $spring( spring );\n\n    if ( spring === false )\n    {\n      return false;\n    }\n\n    this.newCycle( spring );\n    this.placeAttrimator( spring );\n\n    this.activate();\n\n    return spring;\n  },\n\n  /**\n   * Plays an animation. Attributes in the animation that are currently being\n   * animated will be stopped and replaced with the new attrimators. If `all` is\n   * true then any attrimators animating not specified in the given animation\n   * will be stopped.\n   *\n   * **See:** {{#crossLink \"Core/anim8.animation:method\"}}{{/crossLink}},\n   *          {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}}\n   *\n   * @method play\n   * @param {Animation|String|Object} animation\n   * @param {String|Object} [options]\n   * @param {Boolean} [all=false]\n   * @param {Boolean} [cache=false]\n   * @chainable\n   */\n  play: function(animation, options, all, cache)\n  {\n    var attrimatorMap = $attrimatorsFor( animation, options, cache, this );\n\n    this.newCycle( attrimatorMap );\n    this.playAttrimators( attrimatorMap, all );\n\n    return this.activate();\n  },\n\n  /**\n   * Plays a map of attrimators. Attributes in the attrimator map that are\n   * currently being animated will be stopped and replaced with the new\n   * attrimators. If \"all\" is true then any attrimators animating not specified\n   * in the given attrimator map will be stopped. This method will not activate\n   * the Animator, that has to be done manually.\n   *\n   * @method playAttrimators\n   * @param {AttrimatorMap} animatorMap\n   * @param {Boolean} [all]\n   * @chainable\n   * @protected\n   */\n  playAttrimators: function(attrimatorMap, all)\n  {\n    if ( all )\n    {\n      this.attrimators.finishNotPresent( attrimatorMap, 0 );\n    }\n\n    var attrimators = attrimatorMap.values;\n\n    for (var i = attrimators.length - 1; i >= 0; i--)\n    {\n      this.placeAttrimator( attrimators[i] );\n    }\n\n    return this;\n  },\n\n  /**\n   * Unplays an animation. Attributes in the animation that are currently being\n   * animated will be transitioned to their starting values. If `all` is true\n   * then any attrimators animating not specified in the given animation will be\n   * stopped.\n   *\n   * **See:** {{#crossLink \"Core/anim8.animation:method\"}}{{/crossLink}},\n   *          {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}}\n   *\n   * @method unplay\n   * @param {Animation|String|Object} animation\n   * @param {String|Array|Object} transition\n   * @param {String|Object} [options]\n   * @param {Boolean} [all=false]\n   * @param {Boolean} [cache=false]\n   * @chainable\n   */\n  unplay: function(animation, transition, options, all, cache)\n  {\n    var transition = $transition( transition );\n    var attrimatorMap = $attrimatorsFor( animation, options, cache, this );\n\n    this.unplayAttrimators( attrimatorMap, transition, all );\n\n    return this.activate();\n  },\n\n  /**\n   * Unplays a map of attrimators. Attributes in the attrimator map that are\n   * currently being animated will be transitioned to their starting values.\n   * If \"all\" is true then any attrimators animating not specified\n   * in the given attrimator map will be stopped. This method will not activate\n   * the Animator, that has to be done manually.\n   *\n   * @method unplayAttrimators\n   * @param {AttrimatorMap} attrimatorMap\n   * @param {Object} transition\n   * @param {Boolean} [all]\n   * @chainable\n   * @protected\n   */\n  unplayAttrimators: function(attrimatorMap, transition, all)\n  {\n    var unplayAttrimators = new AttrimatorMap();\n    var attrimators = attrimatorMap.values;\n    var startings = {};\n\n    for (var i = 0; i < attrimators.length; i++)\n    {\n      var attrimator = attrimators[ i ];\n      var attr = attrimator.attribute;\n\n      if ( attrimator.startCycle( startings ) )\n      {\n        unplayAttrimators.put( attr, new Oncer( attr, startings[ attr ], 0, true ) );\n      }\n    }\n\n    this.newCycle( unplayAttrimators );\n    this.transitionAttrimators( transition, unplayAttrimators, all );\n\n    return this;\n  },\n\n  /**\n   * Queues an animation. The attrimators generated from the given animation\n   * will be started at the same time - as soon as all finite attrimators for\n   * the same attributes are finished. Any infinite attrimators will be\n   * automatically stopped when all queued attrimators are set to start.\n   *\n   * **See:** {{#crossLink \"Core/anim8.animation:method\"}}{{/crossLink}},\n   *          {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}}\n   *\n   * @method queue\n   * @param {Animation|String|Object} animation\n   * @param {String|Object} [options]\n   * @param {Boolean} [cache]\n   * @chainable\n   */\n  queue: function(animation, options, cache)\n  {\n    var attrimatorMap = $attrimatorsFor( animation, options, cache, this );\n\n    this.newCycle( attrimatorMap );\n    this.queueAttrimators( attrimatorMap );\n\n    return this.activate();\n  },\n\n  /**\n   * Queues a map of attrimators. The map of attrimators will be started at the\n   * same time - as soon as all finished attrimators for the same attribute are\n   * finished. Any infinite attrimators will be automatically stopped when all\n   * queued attrimators are set to start.\n   *\n   * @method queueAttrimators\n   * @param {AttrimatorMap} attrimatorMap\n   * @chainable\n   * @protected\n   */\n  queueAttrimators: function(attrimatorMap)\n  {\n    this.attrimators.queueMap( attrimatorMap, 0, this.placeAttrimator, this );\n\n    return this;\n  },\n\n  /**\n   * Inserts an animation. The attrimators generated from the given animation\n   * will play now and any existing attrimators will be queued behind it. If\n   * the given animation has an infinite attrimator for an existing attribute\n   * it will be stopped in time for the current animation to finish playing. If\n   * the given animation has an infinite attrimator for an attribute which is\n   * not animating then the attrimator will continue to play infinitely.\n   *\n   * **See:** {{#crossLink \"Core/anim8.animation:method\"}}{{/crossLink}},\n   *          {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}}\n   *\n   * @method insert\n   * @param {Animation|String|Object} animation\n   * @param {String|Object} [options]\n   * @param {Boolean} [cache]\n   * @chainable\n   */\n  insert: function(animation, options, cache)\n  {\n    var attrimatorMap = $attrimatorsFor( animation, options, cache, this );\n\n    this.newCycle( attrimatorMap );\n    this.insertAttrimators( attrimatorMap );\n\n    return this.activate();\n  },\n\n  /**\n   * Inserts a map of attrimators. The attrimators generated from the given\n   * animation will play now and any existing attrimators will be queued behind\n   * it. If the given animation has an infinite attrimator for an existing\n   * attribute it will be stopped in time for the current animation to finish\n   * playing. If the given animation has an infinite attrimator for an attribute\n   * which is not animating then the attrimator will continue to play\n   * infinitely.\n   *\n   * @method insertAttrimators\n   * @param {AttrimatorMap} attrimatorMap\n   * @chainable\n   * @protected\n   */\n  insertAttrimators: function(attrimatorMap)\n  {\n    this.attrimators.insertMap( attrimatorMap, this.placeAttrimator, this );\n\n    return this;\n  },\n\n  /**\n   * Transitions from the currently playing attrimators into the beginning of a\n   * new animation. Several parameters can be specified in the transition object\n   * which determine how the transition is made. If \"all\" is true then any\n   * attrimators animating not specified in the given animation will be stopped.\n   *\n   * time: the total time to take to transition into a new animation.\n   * outro: time to look into the future for the current attrimator to curve to.\n   * intro: time to look into the future for the next attrimator to curve into.\n   * lookup: time to look into the future to calculate velocity which is used\n   *   for negative intros and maintaing consistent exit & entrance velocity.\n   * granularity: when greater than 2 it activates smooth transitions where the\n   *    velocity of the new & old attrimators is maintained over the transition.\n   *\n   * **See:** {{#crossLink \"Core/anim8.transition:method\"}}{{/crossLink}},\n   *          {{#crossLink \"Core/anim8.animation:method\"}}{{/crossLink}},\n   *          {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}}\n   *\n   * @method transition\n   * @param {String|Array|Object} transition\n   * @param {String|Object|Animation} animation\n   * @param {Object} [options]\n   * @param {Boolean} [all]\n   * @param {Boolean} [cache]\n   * @chainable\n   */\n  transition: function(transition, animation, options, all, cache)\n  {\n    var transition = $transition( transition );\n    var attrimatorMap = $attrimatorsFor( animation, options, cache, this );\n\n    this.newCycle( attrimatorMap );\n    this.transitionAttrimators( transition, attrimatorMap, all );\n\n    return this.activate();\n  },\n\n  /**\n   * Transitions from the currently playing attrimators into the beginning of a\n   * new animation. Several parameters can be specified in the transition object\n   * which determine how the transition is made. If \"all\" is true then any\n   * attrimators animating not specified in the given attrimator map will be\n   * stopped.\n   *\n   * time: the total time to take to transition into a new animation.\n   * outro: time to look into the future for the current attrimator to curve to.\n   * intro: time to look into the future for the next attrimator to curve into.\n   * lookup: time to look into the future to calculate velocity which is used\n   *   for negative intros and maintaing consistent exit & entrance velocity.\n   * granularity: when greater than 2 it activates smooth transitions where the\n   *    velocity of the new & old attrimators is maintained over the transition.\n   *\n   * @method transitionAttrimators\n   * @param {Object} transition\n   * @param {AttrimatorMap} attrimatorMap\n   * @param {Boolean} [all]\n   * @chainable\n   * @protected\n   */\n  transitionAttrimators: function(transition, attrimatorMap, all)\n  {\n    if ( all )\n    {\n      this.attrimators.finishNotPresent( attrimatorMap, transition.time );\n    }\n\n    this.attrimators.transitionMap(\n      transition,\n      attrimatorMap,\n      this.transitionGetValue,\n      this.getAttribute,\n      this.placeAttrimator,\n      this.transitionGetValueAt,\n      this.transitionStopAttrimator,\n      this\n    );\n\n    return this;\n  },\n\n  transitionGetValue: function(attr)\n  {\n    return this.frame[ attr ];\n  },\n\n  transitionGetValueAt: function(attrimator, relativeTime, out)\n  {\n    return attrimator.valueAt( attrimator.getElapsed() + relativeTime, out );\n  },\n\n  transitionStopAttrimator: function(attrimator, relativeTime)\n  {\n    attrimator.stopIn( relativeTime );\n  },\n\n  /**\n   * Tweens a single attribute to a target value.\n   *\n   * **See:** {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}}\n   *\n   * @method tweenTo\n   * @param {String} attr\n   * @param {T} target\n   * @param {String|Array|Object} [options]\n   * @param {Boolean} [cache=false]\n   * @chainable\n   */\n  tweenTo: function(attr, target, options, cache)\n  {\n    var options   = $options( options, cache );\n    var attribute = this.getAttribute( attr );\n    var end       = attribute.parse( target );\n    var path      = new Tween( attr, attribute.calculator, computed.current, end );\n    var event     = Event.fromOptions( attr, path, options );\n\n    this.newCycle( event );\n    this.placeAttrimator( event );\n\n    return this.activate();\n  },\n\n  /**\n   * Tweens multiple attributes to target values.\n   *\n   * **See:** {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}}\n   *\n   * @method tweenManyTo\n   * @param {Object} targets\n   * @param {String|Array|Object} [options]\n   * @param {Boolean} [cache=false]\n   * @chainable\n   */\n  tweenManyTo: function(targets, options, cache)\n  {\n    var options = $options( options, cache );\n\n    this.newCycle();\n\n    for ( var attr in targets )\n    {\n      var attribute = this.getAttribute( attr );\n      var end       = attribute.parse( targets[ attr ] );\n      var path      = new Tween( attr, attribute.calculator, computed.current, end );\n      var event     = Event.fromOptions( attr, path, options );\n\n      event.cycle = this.cycleNext;\n      this.placeAttrimator( event );\n    }\n\n    return this.activate();\n  },\n\n  /**\n   * Tweens a single attribute from a starting value to the current value.\n   *\n   * **See:** {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}}\n   *\n   * @method tweenFrom\n   * @param {String} attr\n   * @param {T} starting\n   * @param {String|Array|Object} [options]\n   * @param {Boolean} [cache=false]\n   * @chainable\n   */\n  tweenFrom: function(attr, starting, options, cache)\n  {\n    var options   = $options( options, cache );\n    var attribute = this.getAttribute( attr );\n    var start     = attribute.parse( starting );\n    var path      = new Tween( attr, attribute.calculator, start, computed.current );\n    var event     = Event.fromOptions( attr, path, options );\n\n    this.newCycle( event );\n    this.placeAttrimator( event );\n\n    return this.activate();\n  },\n\n  /**\n   * Tweens multiple attributes from starting values to the current values.\n   *\n   * **See:** {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}}\n   *\n   * @method tweenManyFrom\n   * @param {Object} startings\n   * @param {String|Array|Object} [options]\n   * @chainable\n   */\n  tweenManyFrom: function(startings, options)\n  {\n    var options = $options( options );\n\n    this.newCycle();\n\n    for ( var attr in startings )\n    {\n      var attribute = this.getAttribute( attr );\n      var start     = attribute.parse( startings[ attr ] );\n      var path      = new Tween( attr, attribute.calculator, start, computed.current );\n      var event     = Event.fromOptions( attr, path, options );\n\n      event.cycle = this.cycleNext;\n      this.placeAttrimator( event );\n    }\n\n    return this.activate();\n  },\n\n  /**\n   * Tweens an attribute from a starting value to an ending value.\n   *\n   * **See:** {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}}\n   *\n   * @method tween\n   * @param {String} attr\n   * @param {T} starts\n   * @param {T} ends\n   * @param {String|Array|Object} [options]\n   * @param {Boolean} [cache=false]\n   * @chainable\n   */\n  tween: function(attr, starts, ends, options, cache)\n  {\n    var options   = $options( options, cache );\n    var attribute = this.getAttribute( attr );\n    var start     = attribute.parse( starts );\n    var end       = attribute.parse( ends );\n    var path      = new Tween( attr, attribute.calculator, start, end );\n    var event     = Event.fromOptions( attr, path, options );\n\n    this.newCycle( event );\n    this.placeAttrimator( event );\n\n    return this.activate();\n  },\n\n  /**\n   * Tweens multiple attributes from starting values to ending values.\n   *\n   * **See:** {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}}\n   *\n   * @method tweenMany\n   * @param {Object} starts\n   * @param {Object} ends\n   * @param {String|Array|Object} [options]\n   * @param {Boolean} [cache=false]\n   * @chainable\n   */\n  tweenMany: function(starts, ends, options, cache)\n  {\n    var options = $options( options, cache );\n\n    this.newCycle();\n\n    for ( var attr in starts )\n    {\n      var attribute = this.getAttribute( attr );\n      var start     = attribute.parse( starts[ attr ] );\n      var end       = attribute.parse( ends[ attr ] );\n      var path      = new Tween( attr, attribute.calculator, start, end );\n      var event     = Event.fromOptions( attr, path, options );\n\n      event.cycle = this.cycleNext;\n      this.placeAttrimator( event );\n    }\n\n    return this.activate();\n  },\n\n  /**\n   * Moves an attribute relative to its current value.\n   *\n   * **See:** {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}}\n   *\n   * @method move\n   * @param {String} attr\n   * @param {T} amount\n   * @param {String|Array|Object} [options]\n   * @param {Boolean} [cache=false]\n   * @chainable\n   */\n  move: function(attr, amount, options, cache)\n  {\n    var options   = $options( options, cache );\n    var attribute = this.getAttribute( attr );\n    var relative  = attribute.parse( amount );\n    var start     = computed.current;\n    var end       = isComputed( relative ) ? relative : computed.relative( relative );\n    var path      = new Tween( attr, attribute.calculator, start, end );\n    var event     = Event.fromOptions( attr, path, options );\n\n    this.newCycle( event );\n    this.placeAttrimator( event );\n\n    return this.activate();\n  },\n\n  /**\n   * Moves multiple attribute relative to their current value.\n   *\n   * **See:** {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}}\n   *\n   * @method moveMany\n   * @param {Object} amounts\n   * @param {String|Array|Object} [options]\n   * @param {Boolean} [cache=false]\n   * @chainable\n   */\n  moveMany: function(amounts, options, cache)\n  {\n    var options = $options( options, cache );\n\n    this.newCycle();\n\n    for ( var attr in amounts )\n    {\n      var attribute = this.getAttribute( attr );\n      var relative  = attribute.parse( amounts[ attr ] );\n      var start     = computed.current;\n      var end       = isComputed( relative ) ? relative : computed.relative( relative );\n      var path      = new Tween( attr, attribute.calculator, start, end );\n      var event     = Event.fromOptions( attr, path, options );\n\n      event.cycle = this.cycleNext;\n      this.placeAttrimator( event );\n    }\n\n    return this.activate();\n  },\n\n  /**\n   * Returns a function that returns the current value for the given attribute\n   * when invoked. The returned function can be given as values for paths &\n   * springs that are evaluated every frame.\n   *\n   * @method ref\n   * @param {String} attr\n   * @return {Function}\n   */\n  ref: function(attr)\n  {\n    var animator = this;\n    var attribute = this.getAttribute( attr );\n    var request = {};\n\n    return function()\n    {\n      if ( attr in animator.frame )\n      {\n        return animator.frame[ attr ];\n      }\n\n      request[ attr ] = true;\n\n      var current = animator.get( request );\n\n      if ( isDefined( current[ attr ] ) )\n      {\n        return current[ attr ];\n      }\n\n      return attribute.defaultValue;\n    };\n  },\n\n  /**\n   * Follows the attribute along the given path definition.\n   *\n   * **See:** {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}}\n   *\n   * @method follow\n   * @param {String} attr\n   * @param {Path|Object|String} path\n   * @param {String|Array|Object} [options]\n   * @param {Boolean} [cache=false]\n   * @chainable\n   */\n  follow: function(attr, path, options, cache)\n  {\n    var options = $options( options, cache );\n    var path    = $path( path );\n    var event   = Event.fromOptions( attr, path, options );\n\n    this.newCycle( event );\n    this.placeAttrimator( event );\n\n    return this.activate();\n  },\n\n  /**\n   * Helper method that iterates over given attributes. If callback is specified\n   * it is invoked for each attrimator in this animator for the given\n   * attributes. If no callback is given an array of anim8.Attrimators is\n   * returned for each attrimator in this animator for the given attributes.\n   *\n   * @method attrimatorsFor\n   * @param {String|Array|Object} attributes\n   * @param {Function} callback\n   * @return {this|Array}\n   */\n  attrimatorsFor: function(attributes, callback)\n  {\n    var attrimatorMap = this.attrimators;\n    var attributes = toArray( coalesce( attributes, attrimatorMap.keys ), ' ' );\n    var resulting = !isFunction( callback );\n    var results = [];\n\n    for (var i = attributes.length - 1; i >= 0; i--)\n    {\n      var attr = attributes[ i ];\n      var attrimator = attrimatorMap.get( attr );\n\n      if ( attrimator )\n      {\n        if ( resulting )\n        {\n          results.push( attrimator );\n        }\n        else\n        {\n          callback.call( this, attrimator, attr );\n        }\n      }\n    }\n\n    return resulting ? results : this;\n  },\n\n  /**\n   * Stops all attributes for the specified attributes. Attribute names can be\n   * given as an array or a space separated string. If no attributes are given\n   * all attributes are assumed.\n   *\n   * @method stop\n   * @param {String|Array|Object} [attributes]\n   * @chainable\n   */\n  stop: function(attributes)\n  {\n    return this.attrimatorsFor( attributes, function(attrimator, attr)\n    {\n      this.attrimators.remove( attr );\n    });\n  },\n\n  /**\n   * Ends all attributes for the specified attributes. If attributes are queued\n   * the last value of the last attribute is applied to this Animator before\n   * being completely removed. Attribute names can be given as an array or a\n   * space separated string. If no attributes are given all attributes are\n   * assumed.\n   *\n   * @method end\n   * @param {String|Array|Object} [attributes]\n   * @chainable\n   */\n  end: function(attributes)\n  {\n    return this.attrimatorsFor( attributes, function(attrimator)\n    {\n      while (attrimator.next)\n      {\n        attrimator = attrimator.next;\n      }\n\n      attrimator.finish( this.frame );\n    });\n  },\n\n  /**\n   * Finishes all current attrimators for the specified attributes. Attribute\n   * names can be given as an array or a space separated string. If no\n   * attributes are given all attributes are assumed.\n   *\n   * @method finish\n   * @param {String|Array|Object} [attributes]\n   * @chainable\n   */\n  finish: function(attributes)\n  {\n    return this.attrimatorsFor( attributes, function(attrimator)\n    {\n      attrimator.finish( this.frame );\n    });\n  },\n\n  /**\n   * Calls nopeat on all current attrimators for the specified attributes.\n   * Attribute names can be given as an array or a space separated string. If\n   * no attributes are given all attributes are assumed.\n   *\n   * **See:** {{#crossLink \"Attrimator/nopeat:method\"}}Attrimator.nopeat{{/crossLink}}\n   *\n   * @method nopeat\n   * @param {String|Array|Object} [attributes]\n   * @chainable\n   */\n  nopeat: function(attributes)\n  {\n    return this.attrimatorsFor( attributes, function(attrimator)\n    {\n      attrimator.nopeat();\n    });\n  },\n\n  /**\n   * Pauses all current attrimators for the specified attributes. Attribute\n   * names can be given as an array or a space separated string. If no\n   * attributes are given all attributes are assumed.\n   *\n   * @method pause\n   * @param {String|Array|Object} [attributes]\n   * @chainable\n   */\n  pause: function(attributes)\n  {\n    return this.attrimatorsFor( attributes, function(attrimator)\n    {\n      attrimator.pause();\n    });\n  },\n\n  /**\n   * Resumes all current attrimators for the specified attributes. Attribute\n   * names can be given as an array or a space separated string. If no\n   * attributes are given all attributes are assumed.\n   *\n   * @method resume\n   * @param {String|Array|Object} [attributes]\n   * @chainable\n   */\n  resume: function(attributes)\n  {\n    return this.attrimatorsFor( attributes, function(attrimator)\n    {\n      attrimator.resume();\n    });\n  },\n\n  /**\n   * Sets the given attributes to this Animator immediately.\n   *\n   * @method set\n   * @param {Object} attributes\n   * @chainable\n   */\n  set: function(attributes)\n  {\n    for (var attr in attributes)\n    {\n      this.frame[ attr ] = attributes[ attr ];\n      this.updated[ attr ] = true;\n    }\n\n    this.apply();\n\n    return this;\n  },\n\n  /**\n   * Unsets the attribute, array of attributes, or object of attributes.\n   * Unsetting involves removing all attrimators and the current value in the\n   * frame,\n   *\n   * @method unset\n   * @param {String|Array|Object} attributes\n   * @chainable\n   */\n  unset: function(attributes)\n  {\n    var attributes = toArray( coalesce( attributes, this.frame ), ' ' );\n\n    for (var i = attributes.length - 1; i >= 0; i--)\n    {\n      var attr = attributes[ i ];\n\n      this.attrimators.remove( attr );\n\n      delete this.frame[ attr ];\n    }\n\n    return this;\n  },\n\n  /**\n   * Gets the current attribute values for all attributes specified. The\n   * argument must be an object where the key is the name of an attribute.\n   *\n   * @method get\n   * @param {Object} attributes\n   * @return {Object}\n   */\n  get: function(attributes)\n  {\n    var out = {};\n\n    for (var attr in attributes)\n    {\n      out[ attr ] = this.frame[ attr ];\n    }\n\n    return out;\n  },\n\n  /**\n   * Returns the amount of finite time remaining before the animator is done\n   * animating. Attrimators that don't have a known end time are not included.\n   * If there are no attrimators with end times then zero is returned.\n   *\n   * @method timeRemaining\n   * @return {Number}\n   */\n  timeRemaining: function()\n  {\n    return this.attrimators.timeRemaining();\n  },\n\n  /**\n   * Returns true if there are any attrimators on this Animator.\n   *\n   * @method hasAttrimators\n   * @return {Boolean}\n   */\n  hasAttrimators: function()\n  {\n    return this.attrimators.size() > 0;\n  },\n\n  /**\n   * Returns the subject of the Animator optionally passing it through a wrapper\n   * function before it's returned.\n   *\n   * @method getSubject\n   * @param {Function} [wrapper]\n   * @return {Any}\n   */\n  getSubject: function(wrapper)\n  {\n    var subject = this.subject;\n\n    if ( isFunction( wrapper ) )\n    {\n      subject = wrapper( subject );\n    }\n\n    return subject;\n  },\n\n  /**\n   * Invokes a function with the given context or the context of this Animator\n   * if none is given. This is particularly useful for having a function be\n   * called on deferred statements.\n   *\n   * @method invoke\n   * @param {Function} func\n   * @param {Object} [context]\n   * @param {Array} [args]\n   * @chainable\n   */\n  invoke: function(func, context, args)\n  {\n    if ( isFunction( func ) )\n    {\n      func.apply( context || this, args || [] );\n    }\n\n    return this;\n  },\n\n  /**\n   * Defers the method calls following this one to when the given event type\n   * (on or once) and event. To return this animator you need to call undefer()\n   * as many times as you called defer().\n   *\n   * @method defer\n   * @param {String} eventType\n   * @param {String} event\n   * @param {Function} [callback]\n   * @return {DeferAnimator}\n   */\n  defer: function(eventType, event, callback)\n  {\n    return new DeferAnimator( this, this, eventType, event, callback );\n  },\n\n  /**\n   * Invokes the given callback when the last animation that was\n   * played/queued/transitioned starts.\n   *\n   * @method onCycleStart\n   * @param {Function} callback\n   * @param {Object} [context]\n   * @chainable\n   */\n  onCycleStart: function(callback, context)\n  {\n    this.once( 'cycleStart:' + this.cycleNext, callback, context );\n\n    return this;\n  },\n\n  /**\n   * Invokes the given callback when the last animation that was\n   * played/queued/transitioned ends.\n   *\n   * @method onCycleEnd\n   * @param {Function} callback\n   * @param {Object} [context]\n   * @chainable\n   */\n  onCycleEnd: function(callback, context)\n  {\n    this.once( 'cycleEnd:' + this.cycleNext, callback, context );\n\n    return this;\n  }\n\n});\n\n/**\n * Adds the following event methods to Animators: on, once, off, trigger.\n */\neventize( Animator.prototype );\n\n\n/**\n * Instantiates an Array of {{#crossLink \"Animator\"}}{{/crossLink}} instances.\n *\n * @param {Array} [input]\n * @class Animators\n * @constructor\n * @extends {Array}\n */\nfunction Animators(input)\n{\n  this.$ = [];\n\n  if ( isArray( input ) )\n  {\n    this.fill( input );\n  }\n}\n\n/**\n * Animators is an instance of Array. All array methods are supported.\n */\nClass.define( Animators,\n{\n\n  /**\n   * Adds an animator to this set of animators.\n   *\n   * @param  {Animator} animator\n   * @chainable\n   */\n  push: function(animator)\n  {\n    this.$.push( animator );\n\n    return this;\n  },\n\n  /**\n   * Returns the number of animators in this set.\n   *\n   * @return {Number}\n   */\n  length: function()\n  {\n    return this.$.length;\n  },\n\n  /**\n   * Returns the animator at the given index.\n   *\n   * @param  {Number} index\n   * @return {Animator}\n   */\n  at: function(index)\n  {\n    return this.$[ index ];\n  },\n\n  /**\n   * Invokes a callback for each element in the array.\n   *\n   * @method each\n   * @param {Function} iterator\n   * @param {Object} context\n   * @chainable\n   */\n  each: function(iterator, context)\n  {\n    var array = this.$;\n\n    for (var i = 0; i < array.length; i++)\n    {\n      if ( iterator.call( context || array[i], array[i], i ) === false )\n      {\n        break;\n      }\n    }\n\n    return this;\n  },\n\n  /**\n   * Appends the array of animators given to the end of this array.\n   *\n   * @method fill\n   * @param {Array} animators\n   * @chainable\n   */\n  fill: function(animators)\n  {\n    for (var i = 0; i < animators.length; i++)\n    {\n      this.push( animators[i] );\n    }\n\n    return this;\n  },\n\n  /**\n   * Invokes a callback for each element in the array and if a true value is\n   * returned  that element is removed from the array.\n   *\n   * @method filter\n   * @param {Function} filterer\n   * @chainable\n   */\n  filter: function(filterer)\n  {\n    var array = this.$;\n    var alive = 0;\n\n    for (var i = 0; i < array.length; i++)\n    {\n      var remove = filterer( array[i] );\n\n      if ( !remove )\n      {\n        array[alive++] = array[i];\n      }\n    }\n\n    array.length = alive;\n\n    return this;\n  },\n\n  /**\n   * Returns the subjects of the Animators optionally passing them through a\n   * wrapper function before it's returned.\n   *\n   * @method getSubjects\n   * @param {Function} [wrapper]\n   * @return {Any}\n   */\n  getSubjects: function(wrapper)\n  {\n    var array = this.$;\n    var subjects = [];\n\n    for (var i = 0; i < array.length; i++)\n    {\n      subjects.push( array[i].subject );\n    }\n\n    if ( isFunction( wrapper ) )\n    {\n      subjects = wrapper( subjects );\n    }\n\n    return subjects;\n  },\n\n  /**\n   * Returns the first animator in the array.\n   *\n   * @method first\n   * @return {Animator}\n   */\n  first: function()\n  {\n    return this.$[0];\n  },\n\n  /**\n   * Reverses the order of animators in the array.\n   *\n   * @method reverse\n   * @chainable\n   */\n  reverse: function()\n  {\n    var array = this.$;\n    var last = array.length - 1;\n    var mid = Math.floor( array.length / 2 );\n\n    for (var i = 0; i < mid; i++)\n    {\n      var e0 = array[ i ];\n      var e1 = array[ last - i ];\n\n      array[ i ] = e1;\n      array[ last - i ] = e0;\n    }\n\n    return this;\n  },\n\n  /**\n   * Activates all Animators in the array if they aren't active already.\n   *\n   * @method activate\n   * @chainable\n   */\n  activate: function()\n  {\n    var array = this.$;\n\n    for (var i = 0; i < array.length; i++)\n    {\n      pushAnimator( array[i] );\n    }\n\n    activate();\n\n    return this;\n  },\n\n  /**\n   * Creates a sequence of events separated by a delay.\n   *\n   * @method sequence\n   * @param {String|Number} delay\n   * @param {String|Array|Function} easing\n   * @return {Sequence}\n   */\n  sequence: function(delay, easing)\n  {\n    return new Sequence( this, delay, easing );\n  },\n\n  /**\n   * Returns the maximum time remaining out of all Animators in the array.\n   *\n   * **See:** {{#crossLink \"Animating/timeRemaining:method\"}}{{/crossLink}}\n   *\n   * @method timeRemaining\n   * @return {Number}\n   */\n  timeRemaining: function()\n  {\n    var array = this.$;\n    var maxRemaining = 0;\n\n    for (var i = 0; i < array.length; i++)\n    {\n      maxRemaining = Math.max( maxRemaining, array[ i ].timeRemaining() );\n    }\n\n    return maxRemaining;\n  },\n\n  /**\n   * Calls {{#crossLink \"Animator/preupdate:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method preupdate\n   * @chainable\n   */\n  preupdate: function(now, max)\n  {\n    var array = this.$;\n    var length = max || array.length;\n\n    for (var i = 0; i < length; i++)\n    {\n      array[ i ].preupdate( now );\n    }\n\n    return this;\n  },\n\n  /**\n   * Calls {{#crossLink \"Animator/update:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method update\n   * @chainable\n   */\n  update: function(now, max)\n  {\n    var array = this.$;\n    var length = max || array.length;\n\n    for (var i = 0; i < length; i++)\n    {\n      array[ i ].update( now );\n    }\n\n    return this;\n  },\n\n  /**\n   * Calls {{#crossLink \"Animator/apply:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method apply\n   * @chainable\n   */\n  apply: function(max)\n  {\n    var array = this.$;\n    var length = max || array.length;\n\n    for (var i = 0; i < length; i++)\n    {\n      array[ i ].apply();\n    }\n\n    return this;\n  },\n\n  /**\n   * Handles an animator if it's finished, and returns false if the animator can\n   * be removed from the set of animators.\n   *\n   * @method handleFinished\n   * @param {Animator} animator\n   * @return {Boolean}\n   */\n  handleFinished: function(animator)\n  {\n    if ( animator.finished )\n    {\n      animator.deactivate();\n      animator.active = false;\n    }\n\n    return animator.finished;\n  },\n\n  /**\n   * Calls {{#crossLink \"Animator/restore:method\"}}{{/crossLink}} on each\n   * animator in the array and returns this.\n   *\n   * @method restore\n   * @chainable\n   */\n  restore               : delegate( 'restore', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/placeAttrimator:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method placeAttrimator\n   * @chainable\n   */\n  placeAttrimator       : delegate( 'placeAttrimator', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/applyInitialState:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method applyInitialState\n   * @chainable\n   */\n  applyInitialState     : delegate( 'applyInitialState', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/trimAttrimators:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method trimAttrimators\n   * @chainable\n   */\n  trimAttrimators       : delegate( 'trimAttrimators', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/deactivate:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method deactivate\n   * @chainable\n   */\n  deactivate            : delegate( 'deactivate', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/destroy:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method destroy\n   * @chainable\n   */\n  destroy               : delegate( 'destroy', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/spring:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method spring\n   * @chainable\n   */\n  spring                : delegate( 'spring', DelegateTypes.RESULTS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/play:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method play\n   * @chainable\n   */\n  play                  : delegate( 'play', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/unplay:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method unplay\n   * @chainable\n   */\n  unplay                : delegate( 'unplay', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/playAttrimators:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method playAttrimators\n   * @chainable\n   * @protected\n   */\n  playAttrimators       : delegate( 'playAttrimators', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/queue:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method queue\n   * @chainable\n   */\n  queue                 : delegate( 'queue', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/queueAttrimators:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method queueAttrimators\n   * @chainable\n   * @protected\n   */\n  queueAttrimators      : delegate( 'queueAttrimators', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/insert:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method insert\n   * @chainable\n   */\n  insert                : delegate( 'insert', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/insertAttrimators:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method insertAttrimators\n   * @chainable\n   * @protected\n   */\n  insertAttrimators     : delegate( 'insertAttrimators', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/transition:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method transition\n   * @chainable\n   */\n  transition            : delegate( 'transition', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/transitionAttrimators:method\"}}{{/crossLink}}\n   * on each animator in the array and returns this.\n   *\n   * @method transitionAttrimators\n   * @chainable\n   * @protected\n   */\n  transitionAttrimators : delegate( 'transitionAttrimators', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/tween:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method tween\n   * @chainable\n   */\n  tween                 : delegate( 'tween', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/tweenTo:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method tweenTo\n   * @chainable\n   */\n  tweenTo               : delegate( 'tweenTo', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/tweenFrom:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method tweenFrom\n   * @chainable\n   */\n  tweenFrom             : delegate( 'tweenFrom', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/tweenMany:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method tweenMany\n   * @chainable\n   */\n  tweenMany             : delegate( 'tweenMany', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/tweenManyTo:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method tweenManyTo\n   * @chainable\n   */\n  tweenManyTo           : delegate( 'tweenManyTo', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/tweenManyFrom:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method tweenManyFrom\n   * @chainable\n   */\n  tweenManyFrom         : delegate( 'tweenManyFrom', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/move:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method move\n   * @chainable\n   */\n  move                  : delegate( 'move', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/moveMany:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method moveMany\n   * @chainable\n   */\n  moveMany              : delegate( 'moveMany', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/follow:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method follow\n   * @chainable\n   */\n  follow                : delegate( 'follow', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/attrimatorsFor:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method attrimatorsFor\n   * @chainable\n   */\n  attrimatorsFor        : delegate( 'attrimatorsFor', DelegateTypes.RESULTS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/stop:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method stop\n   * @chainable\n   */\n  stop                  : delegate( 'stop', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/end:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method end\n   * @chainable\n   */\n  end                   : delegate( 'end', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/finish:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method finish\n   * @chainable\n   */\n  finish                : delegate( 'finish', DelegateTypes.THIS ),\n\n/**\n   * Calls {{#crossLink \"Animator/nopeat:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method nopeat\n   * @chainable\n   */\n  nopeat                : delegate( 'nopeat', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/pause:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method pause\n   * @chainable\n   */\n  pause                 : delegate( 'pause', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/resume:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method resume\n   * @chainable\n   */\n  resume                : delegate( 'resume', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/set:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method set\n   * @chainable\n   */\n  set                   : delegate( 'set', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/unset:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method unset\n   * @chainable\n   */\n  unset                 : delegate( 'unset', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/get:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method get\n   * @chainable\n   */\n  get                   : delegate( 'get', DelegateTypes.FIRST ),\n\n  /**\n   * Calls {{#crossLink \"Animator/hasAttrimators:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method hasAttrimators\n   * @chainable\n   */\n  hasAttrimators        : delegate( 'hasAttrimators', DelegateTypes.TRUE ),\n\n  /**\n   * Calls {{#crossLink \"Animator/invoke:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method invoke\n   * @chainable\n   */\n  invoke                : delegate( 'invoke', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/onCycleStart:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method onCycleStart\n   * @chainable\n   */\n  onCycleStart          : delegate( 'onCycleStart', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/onCycleEnd:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method onCycleEnd\n   * @chainable\n   */\n  onCycleEnd            : delegate( 'onCycleEnd', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/on:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method on\n   * @chainable\n   */\n  on                    : delegate( 'on', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/once:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method once\n   * @chainable\n   */\n  once                  : delegate( 'once', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/off:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method off\n   * @chainable\n   */\n  off                   : delegate( 'off', DelegateTypes.THIS ),\n\n  /**\n   * Calls {{#crossLink \"Animator/trigger:method\"}}{{/crossLink}} on\n   * each animator in the array and returns this.\n   *\n   * @method trigger\n   * @chainable\n   */\n  trigger               : delegate( 'trigger', DelegateTypes.THIS )\n\n});\n\n\n/**\n * Animates a single attribute over any period of time.\n *\n * @class Attrimator\n * @constructor\n */\nfunction Attrimator()\n{\n\n}\n\nClass.define( Attrimator,\n{\n\n  /**\n   * Resets this attrimator for the given attribute created by the given builder.\n   *\n   * @method reset\n   * @param {String} attribute\n   * @param {Builder} builder\n   * @param {Attrimator} [next]\n   */\n  reset: function(attribute, builder, next)\n  {\n    /**\n     * The name of the attribute this attrimator is animating.\n     *\n     * @property {String} attribute\n     */\n    this.attribute = attribute;\n\n    /**\n     * The builder that created this attrimator (if any).\n     *\n     * @property {Builder} builder\n     */\n    this.builder = builder;\n\n    /**\n     * The next attrimator to be played once this one has finished.\n     *\n     * @property {Attrimator} next\n     */\n    this.next = next;\n\n    /**\n     * The time the attrimator was started by the animator.\n     *\n     * @property {Number} startTime\n     */\n    this.startTime = 0;\n\n    /**\n     * The time the attrimator was last paused.\n     *\n     * @property {Number} pauseTime\n     */\n    this.pauseTime = 0;\n\n    /**\n     * The amount of time that has elapsed since the attrimator started.\n     *\n     * @property {Number} elapsed\n     */\n    this.elapsed = 0;\n\n    /**\n     * The time this attrimator should stop itself after it started in milliseconds.\n     *\n     * @property {Number} stopTime\n     */\n    this.stopTime = Number.POSITIVE_INFINITY;\n\n    /**\n     * Whether or not the attrimator is paused.\n     *\n     * @property {Boolean} paused\n     */\n    this.paused = false;\n\n    /**\n     * The cycle this attrimator belongs to.\n     *\n     * @type {Number} cycle\n     */\n    this.cycle = 0;\n\n    /**\n     * The amount of time in milliseconds this attrimator is delayed since start.\n     *\n     * @property {Number} delay\n     */\n    this.delay = 0;\n\n    /**\n     * The initial elapsed time in milliseconds when the attrimator is started.\n     *\n     * @property {Number} offset\n     */\n    this.offset = 0;\n  },\n\n  /**\n   * Prepares this attrimator for animation on the given subject animator. This\n   * is called as early as possible to establish the start time of the\n   * attrimator so when the user isn't on the page time can be kept accurately.\n   *\n   * @param {Number} now\n   * @param {Animator} animator\n   */\n  prestart: function(now)\n  {\n    if ( this.startTime === 0 )\n    {\n      this.startTime = now - this.offset;\n      this.elapsed = this.offset;\n      this.finished = false;\n      this.prestartNext();\n    }\n  },\n\n  /**\n   * Calls {{#crossLink \"Attrimator/prestart:method\"}}{{/crossLink}} on the next\n   * attrimator if it can be called.\n   *\n   * @method prestartNext\n   */\n  prestartNext: function( overrideNext )\n  {\n    // If there is a next attrimator and this attrimator has been prestarted...\n    if ( this.next && this.startTime !== 0 )\n    {\n      // If override next is specified, clear next's startTime\n      if ( overrideNext )\n      {\n        this.next.startTime = 0;\n      }\n\n      // We can only prestart next if it has no startTime.\n      if ( this.next.startTime === 0 )\n      {\n        var totalTime = this.totalTime();\n\n        // If this attrimator has a finite total amount of time, it's end can be calculated.\n        if ( isFinite( totalTime ) )\n        {\n          this.next.prestart( this.startTime + totalTime );\n        }\n      }\n    }\n  },\n\n  /**\n   * Prepares this attrimator for animation on the given subject\n   * animator. This is called once in anim8.Animator.preupdate before the first\n   * time this attrimator is updated.\n   *\n   * @method start\n   * @param {Number} now\n   * @param {Animator} animator\n   */\n  start: function(now, animator)\n  {\n    this.prestart( now );\n  },\n\n  /**\n   * Invoked once when a new animation cycle is started on an Animator. If this\n   * attrimator updated the frame true must be returned.\n   *\n   * @method startCycle\n   * @param {Object} frame\n   * @return {Boolean}\n   */\n  startCycle: function(frame)\n  {\n    return false;\n  },\n\n  /**\n   * Updates this attrimator given a time to animate to and the frame to\n   * provide with a new value. This method will return true if the attribute\n   * this is animating has been updated and needs to be applied to the subject.\n   *\n   * @method setTime\n   * @param {Number} now\n   * @param {Object} frame\n   * @return {Boolean}\n   */\n  setTime: function(now, frame)\n  {\n    if ( this.paused )\n    {\n      return false;\n    }\n\n    var updated = false;\n    var elapsed = now - this.startTime;\n\n    if ( elapsed > this.stopTime )\n    {\n      updated = this.finish( frame );\n    }\n    else if ( elapsed >= this.delay )\n    {\n      updated = this.update( elapsed, frame );\n    }\n\n    this.elapsed = elapsed;\n\n    return updated;\n  },\n\n  /**\n   * Updates the attrimator given elapsed time in milliseconds, the frame to\n   * apply a value to, and returns whether the frame was updated or not.\n   *\n   * @method update\n   * @param {Number} elapsed\n   * @param {Object} frame\n   * @return {Boolean}\n   */\n  update: function(elapsed, frame)\n  {\n    throw 'Attrimator.update not implemented';\n  },\n\n  /**\n   * Returns the amount of time that has elapsed in milliseconds.\n   *\n   * @method getElapsed\n   * @return {Number}\n   */\n  getElapsed: function()\n  {\n    return this.elapsed;\n  },\n\n  /**\n   * Stops this attrimator in the given number of milliseconds.\n   *\n   * @method stopIn\n   * @param {Number} milliseconds\n   * @chainable\n   */\n  stopIn: function(milliseconds)\n  {\n    this.stopTime = this.getElapsed() + milliseconds;\n\n    return this;\n  },\n\n  /**\n   * Stops this attrimator at the given time. If the given time is outside this\n   * attrimator and has a next attrimator that stopAt will be called.\n   *\n   * @method stopAt\n   * @param {Number} time\n   * @chainable\n   */\n  stopAt: function(time)\n  {\n    var totalTime = this.totalTime();\n\n    if ( time > totalTime )\n    {\n      if ( this.next )\n      {\n        this.next.stopAt( time - totalTime );\n      }\n    }\n    else\n    {\n      this.stopTime = time;\n    }\n\n    return this;\n  },\n\n  /**\n   * If this attrimator repeats its animation this method will stop repitition\n   * after the next animation cycle.\n   *\n   * @chainable\n   */\n  nopeat: function()\n  {\n    return this;\n  },\n\n  /**\n   * Returns the value at the given time or returns false if it can't be\n   * calculated.\n   *\n   * @method valueAt\n   * @param {Number} time\n   * @param {Any} out\n   * @return {Any|False}\n   */\n  valueAt: function(time, out)\n  {\n    return false;\n  },\n\n  /**\n   * Returns the value at the given time or returns false if it can't be\n   * calculated. If the time is outside this attrimator, the next attrimator\n   * is checked.\n   *\n   * @method valueAt\n   * @param {Number} time\n   * @param {Any} out\n   * @return {Any|False}\n   */\n  valueAtSearch: function(time, out)\n  {\n    var totalTime = this.totalTime();\n\n    if ( time > totalTime )\n    {\n      return this.next ? this.next.valueAtSearch( time - totalTime, out ) : false;\n    }\n\n    return this.valueAt( time, out );\n  },\n\n  /**\n   * Returns the attrimator at the given time.\n   *\n   * @method attrimatorAt\n   * @param {Number} time\n   * @return {Attrimator}\n   */\n  attrimatorAt: function(time)\n  {\n    var totalTime = this.totalTime();\n\n    if ( time > totalTime )\n    {\n      return this.next ? this.next.attrimatorAt( time - totalTime ) : null;\n    }\n\n    return this;\n  },\n\n  /**\n   * The total amount of time this attrimator will take in milliseconds. This\n   * may be an infinite number.\n   *\n   * @method totalTime\n   * @return {Number}\n   */\n  totalTime: function()\n  {\n    return this.stopTime;\n  },\n\n  /**\n   * The time remaining before this attrimator and any following will be\n   * finished.\n   *\n   * @method timeRemaining\n   * @return {Number}\n   */\n  timeRemaining: function()\n  {\n    return this.totalTime() - this.elapsed + ( this.next ? this.next.timeRemaining() : 0 );\n  },\n\n  /**\n   * Clones this attrimator.\n   *\n   * @method clone\n   * @return {Attrimator}\n   */\n  clone: function()\n  {\n    throw 'AttributeAnimator.clone not implemented';\n  },\n\n  /**\n   * Returns whether this attrimator has computed values which need to be\n   * resolved by the subject animator calling prepare on this attrimator.\n   *\n   * @method hasComputed\n   * @return {Boolean}\n   */\n  hasComputed: function()\n  {\n    return false;\n  },\n\n  /**\n   * Determines whether this attrimator will run infinitely.\n   *\n   * @method isInfinite\n   * @return {Boolean}\n   */\n  isInfinite: function()\n  {\n    return !isFinite( this.stopTime );\n  },\n\n  /**\n   * Pauses this attrimator if it isn't already paused.\n   *\n   * @method pause\n   * @chainable\n   */\n  pause: function()\n  {\n    if ( !this.paused )\n    {\n      this.pauseTime = now();\n      this.paused = true;\n    }\n\n    return this;\n  },\n\n  /**\n   * Resumes this attrimator if it's paused. This involves resetting the start\n   * time of the attrimator.\n   *\n   * @method resume\n   * @chainable\n   */\n  resume: function()\n  {\n    if ( this.paused )\n    {\n      var totalPausedTime = now() - this.pauseTime;\n      var delay = this;\n\n      while ( delay && delay.startTime !== 0 )\n      {\n        delay.startTime += totalPausedTime;\n        delay = delay.next;\n      }\n\n      this.paused = false;\n    }\n\n    return this;\n  },\n\n  /**\n   * Whether this attrimator is paused.\n   *\n   * @method isPaused\n   * @return {Boolean}\n   */\n  isPaused: function()\n  {\n    return this.paused;\n  },\n\n  /**\n   * Sets the final state of the attrimator to the frame if one exists and\n   * returns true, otherwise false is returned and frame remains unchanged.\n   *\n   * @method finish\n   * @param {Object} frame\n   * @return {Boolean}\n   */\n  finish: function(frame)\n  {\n    return false;\n  },\n\n  /**\n   * Whether this attrimator is finished.\n   *\n   * @method isFinished\n   * @return {Boolean}\n   */\n  isFinished: function()\n  {\n    return false;\n  },\n\n  /**\n   * Returns the builder that created this attrimator (if any).\n   *\n   * @method getBuilder\n   * @return {Builder}\n   */\n  getBuilder: function()\n  {\n    return this.builder;\n  },\n\n  /**\n   * Places the given attrimator on the end of the chain of attrimators starting\n   * with this attrimator.\n   *\n   * @method queue\n   * @param {Attrimator} next\n   * @chainable\n   */\n  queue: function(next)\n  {\n    if ( this.next )\n    {\n      this.next.queue( next );\n    }\n    else\n    {\n      this.next = next;\n      this.prestartNext();\n    }\n\n    return this;\n  },\n\n  /**\n   * Places the given attrimator at the given time.\n   */\n  nextAt: function(next, time)\n  {\n    var totalTime = this.totalTime();\n\n    if ( time < totalTime )\n    {\n      this.stopTime = time;\n      this.next = next;\n    }\n    else if ( this.next )\n    {\n      this.next.nextAt( next, time - totalTime );\n    }\n    else\n    {\n      next.delay += time - totalTime;\n      this.next = next;\n    }\n\n    return this;\n  },\n\n  /**\n   * Parses a value with the calculator given a default value to fallback on.\n   *\n   * @method parseValue\n   * @param {Animator} animator\n   * @param {T|Function|True} value\n   * @param {T} defaultValue\n   * @return {T|Function}\n   */\n  parseValue: function(animator, value, defaultValue)\n  {\n    var parsed = this.calculator.parse( value, defaultValue );\n\n    if ( isComputed( parsed ) )\n    {\n       parsed = parsed( this, animator );\n    }\n\n    return parsed;\n  }\n\n});\n\n\n/**\n * A map of attrimators by their attribute name.\n *\n * @class AttrimatorMap\n * @constructor\n * @extends FastMap\n */\nfunction AttrimatorMap()\n{\n  this.reset();\n}\n\nClass.extend( AttrimatorMap, FastMap,\n{\n\n  /**\n   * Sets the group identifier for attrimators in this map. If force is\n   * specified it will overwrite any existing group identifier on attrimators.\n   * If deep is true, then all next attrimators also could have their group\n   * identifiers set.\n   *\n   * @method setGroup\n   * @param {Number} groupId\n   * @param {Boolean} [force=false]\n   * @param {Boolean} [deep=false]\n   */\n  setGroup: function(groupId, force, deep)\n  {\n    var values = this.values;\n\n    for (var i = values.length - 1; i >= 0; i--)\n    {\n      var attrimator = values[ i ];\n\n      do\n      {\n        if ( !attrimator.groupId || force )\n        {\n          attrimator.groupId = groupId;\n        }\n\n        attrimator = attrimator.next;\n\n      } while ( deep && attrimator );\n    }\n  },\n\n  /**\n   * Adds a delay to all attrimators in this map.\n   *\n   * @method delay\n   * @param {Number} time\n   * @return {AttrimatorMap}\n   */\n  delay: function(time)\n  {\n    var attrimators = this.values;\n\n    for (var i = 0; i < attrimators.length; i++)\n    {\n      attrimators[ i ].delay += time;\n    }\n\n    return this;\n  },\n\n  /**\n   * Queues the attrimator on this map. If the attribute is already on this map\n   * this is placed on the end of the Attrimator chain, otherwise the attrimator\n   * is added to the map. If there is an attrimator already on the map it's\n   * returned.\n   *\n   * @method queue\n   * @param {Attrimator} attrimator\n   * @return {Attrimator}\n   */\n  queue: function(attrimator)\n  {\n    var attr = attrimator.attribute;\n    var current = this.get( attr );\n\n    if ( current )\n    {\n      current.queue( attrimator );\n    }\n    else\n    {\n      this.put( attr, attrimator );\n    }\n\n    return current;\n  },\n\n  /**\n   * Queues the given map to this map. The attrimators placed on this map are\n   * queued and delayed in a way that they all start at the same time. If a\n   * function is provided as the second argument it is invoked whenever an\n   * attrimator in the given map is new & added to this map.\n   *\n   * @method queueMap\n   * @param {AttrimatorMap} map\n   * @param {Number} offset\n   * @param {Function} [onNewAttribute]\n   * @param {Object} [context]\n   * @chainable\n   */\n  queueMap: function(map, offset, onNewAttribute, context)\n  {\n    var maxRemaining = this.timeRemaining();\n    var attrimators = map.values;\n    var hasCallback = isFunction( onNewAttribute );\n    var mapOffset = coalesce( offset, 0 );\n    var timeOffset = maxRemaining + mapOffset;\n\n    for (var i = attrimators.length - 1; i >= 0; i--)\n    {\n      var attrimator = attrimators[ i ];\n      var attr = attrimator.attribute;\n      var existing = this.get( attr );\n\n      if ( existing )\n      {\n        if ( existing.isInfinite() )\n        {\n          existing.stopIn( attrimator.delay + timeOffset );\n        }\n        else\n        {\n          attrimator.delay += (timeOffset - existing.timeRemaining());\n        }\n\n        existing.queue( attrimator );\n      }\n      else\n      {\n        attrimator.delay += timeOffset;\n\n        this.put( attr, attrimator );\n\n        if ( hasCallback )\n        {\n          onNewAttribute.call( context || this, attrimator );\n        }\n      }\n    }\n\n    return this;\n  },\n\n  /**\n   * Inserts the given map into the beginning of this map. If a function is\n   * provided as the second argument it is invoked whenever an attrimator in\n   * the given map is new & added to this map.\n   *\n   * @method insertMap\n   * @param {AttrimatorMap} map\n   * @param {Function} [onNewAttribute]\n   * @param {Object} [context]\n   * @chainable\n   */\n  insertMap: function(map, onNewAttribute, context)\n  {\n    var attrimators = map.values;\n    var duration = map.timeRemaining();\n    var hasCallback = isFunction( onNewAttribute );\n\n    for (var i = attrimators.length - 1; i >= 0; i--)\n    {\n      var attrimator = attrimators[ i ];\n      var attr = attrimator.attribute;\n      var existing = this.get( attr );\n\n      this.put( attr, attrimator );\n\n      if ( existing )\n      {\n        if ( attrimator.isInfinite() )\n        {\n          attrimator.stopIn( duration );\n        }\n        else\n        {\n          existing.delay += (duration - attrimator.timeRemaining());\n        }\n\n        attrimator.queue( existing );\n      }\n\n      if ( hasCallback )\n      {\n        onNewAttribute.call( context || this, attrimator );\n      }\n    }\n\n    return this;\n  },\n\n  /**\n   * Removes the attrimator at the given index replacing it with the next\n   * attrimator if one exists.\n   *\n   * @method unqueueAt\n   * @param {Number} index\n   * @chainable\n   */\n  unqueueAt: function(index)\n  {\n    var current = this.values[ index ];\n\n    if ( current.next )\n    {\n      this.values[ index ] = current.next;\n    }\n    else\n    {\n      this.removeAt( index );\n    }\n\n    return this;\n  },\n\n  /**\n   * Plays the given attrimators at the given time. This performs the necessary\n   * stopping, queueing, and delaying of attrimators that may need to be done.\n   *\n   * @method playMapAt\n   * @param {AttrimatorMap} attrimatorMap\n   * @param {Boolean} all\n   * @param {Number} time\n   * @chainable\n   */\n  playMapAt: function(attrimatorMap, all, time)\n  {\n    if ( all )\n    {\n      this.stopNotPresentAt( attrimatorMap, time );\n    }\n\n    var attrimators = attrimatorMap.values;\n\n    for (var i = 0; i < attrimators.length; i++)\n    {\n      this.playAttrimatorAt( attrimators[ i ], time );\n    }\n\n    return this;\n  },\n\n  playAttrimatorAt: function(attrimator, time)\n  {\n    var attr = attrimator.attribute;\n    var existing = this.get( attr );\n\n    if ( existing )\n    {\n      existing.nextAt( attrimator, time );\n    }\n    else\n    {\n      attrimator.delay += time;\n\n      this.put( attr, attrimator );\n    }\n  },\n\n  transitionMap: function(transition, attrimatorMap, getValue, getAttribute, placeAttrimator, getValueAt, stopAttrimator, context)\n  {\n    // TRANSITIONING:\n    // If the animator doesn't have an attrimator for the given attribute just add the attrimator adding the total delay\n    // If the animator has an attrimator currently...\n    //   If the current attrimator or new attrimator don't have values at the desired times...\n    //      Stop the current attrimator after the total delay (adding the delay of the new attrimator as well)\n    //      Queue the new attrimator\n    //   Else\n    //      Create a path using the methods detailed above\n    // If all is true and there's an attrimator left on the animator that isn't being transitioned, stop it after the total delay.\n\n    // CREATING A TRANSITION PATH:\n    // If intro & outro are 0, use Tween\n    // If intro is 0, use Quadratic Path between current value, outro point, and first point on new path.\n    // If outro is 0, use Quadratic Path between current value, first point on new path, and intro point.\n    // If intro & outro are not 0, use Cubic Path between current value, outro point, first point on new path, and intro point.\n    // If granularity is given > 1 then compile the path, compute intro & outro velocities, and compute deltas for new\n    //    compiled path based on interpolated velocity over the path (knowing it's length and transition time)\n\n    var attrimators = attrimatorMap.values;\n\n    if ( this.hasOverlap( attrimatorMap ) )\n    {\n      for (var i = attrimators.length - 1; i >= 0; i--)\n      {\n        var next = attrimators[ i ];\n        var attr = next.attribute;\n        var curr = this.get( attr );\n        var currValue = getValue.call( context, attr );\n\n        if ( curr && isDefined( currValue ) )\n        {\n          var attribute = getAttribute.call( context, attr );\n          var calc = attribute.calculator;\n\n          var p2 = next.valueAt( 0, calc.create() );\n\n          if ( p2 !== false )\n          {\n            var transitionTime = transition.time;\n            var p0 = calc.clone( currValue );\n            var p1 = transition.outro ? getValueAt.call( context, curr, transition.outro, calc.create() ) : false;\n            var p3 = transition.intro ? next.valueAt( transition.intro, calc.create() ) : false;\n            var path = null;\n\n            // If the intro is negative we can look into the past by looking a little bit into\n            // the future and assume the past is going in the same direction (only the opposite).\n            if ( p3 !== false && transition.intro < 0 && transition.lookup > 0 )\n            {\n              var pastLookahead = next.valueAt( transition.lookup, calc.create() );\n              var pastVelocity = calc.sub( pastLookahead, p2 );\n\n              if ( pastVelocity !== false )\n              {\n                var pastNegativeVelocity = calc.scale( pastVelocity, transition.intro / transition.lookup );\n                var past = calc.add( pastNegativeVelocity, p2 );\n\n                p3 = p2;\n                p2 = past;\n              }\n            }\n\n            // Build a path with as many of the points as possible.\n            if ( p1 === false && p3 === false )\n            {\n              path = new Tween( attr, calc, p0, p2 );\n            }\n            else if ( p1 === false )\n            {\n              path = new PathQuadratic( attr, calc, p0, p2, p3 );\n            }\n            else if ( p3 === false )\n            {\n              path = new PathQuadratic( attr, calc, p0, p1, p2 );\n            }\n            else\n            {\n              path = new PathCubic( attr, calc, p0, p1, p2, p3 );\n            }\n\n            // If granularity is specified we will try to make the transition\n            // smooth by maintaining exit (outro) velocity from the current attrimator\n            // and interpolating it to the entrance (intro) velocity for the\n            // attrimator we're transitioning into.\n            if ( transition.granularity > 2 && transition.lookup > 0 )\n            {\n              var outTime  = p1 === false ? 0 : transition.outro;\n              var outPoint = p1 === false ? p0 : p1;\n              var outNext  = getValueAt.call( context, curr, outTime + transition.lookup, calc.create() );\n\n              var inTime   = p3 === false ? 0 : transition.intro;\n              var inPoint  = p3 === false ? p2 : p3;\n              var inNext   = next.valueAt( inTime + transition.lookup, calc.create() );\n\n              // We can only proceed if we have reference points to calculate\n              // exit & entrance velocity.\n              if ( outNext !== false && inNext !== false )\n              {\n                var outVelocity  = calc.sub( calc.clone( outNext ), outPoint );\n                var outPerMillis = calc.length( outVelocity ) / transition.lookup;\n\n                var inVelocity   = calc.sub( calc.clone( inNext ), inPoint );\n                var inPerMillis  = calc.length( inVelocity ) / transition.lookup;\n\n                var compiled = new PathCompiled( attr, path, transition.granularity );\n                var points = compiled.points;\n                var lastPoint = points.length - 1;\n                var totalDistance = 0;\n                var distances = [];\n\n                for (var k = 0; k < lastPoint; k++)\n                {\n                  distances[ k ] = totalDistance;\n                  totalDistance += calc.distance( points[ k ], points[ k + 1 ] );\n                }\n                distances[ lastPoint ] = totalDistance;\n\n                if ( !isNaN( totalDistance ) )\n                {\n                  var requiredTime = 2.0 * totalDistance / (outPerMillis + inPerMillis);\n                  var acceleration = 0.5 * (inPerMillis - outPerMillis) / requiredTime;\n                  var timeDelta = requiredTime / lastPoint;\n                  var deltas = [];\n\n                  for (var k = 0; k < lastPoint; k++)\n                  {\n                    var time = k * timeDelta;\n                    var position = outPerMillis * time + acceleration * time * time;\n\n                    deltas[ k ] = position / totalDistance;\n                  }\n                  deltas[ lastPoint ] = 1.0;\n\n                  path = new PathDelta( attr, calc, points, deltas );\n                  transitionTime = requiredTime;\n                }\n              }\n            }\n\n            var transitionEvent = new Event( attr, path, transitionTime, transition.easing, 0, 0, 0, 1 );\n\n            transitionEvent.next = next;\n            transitionEvent.cycle = next.cycle;\n\n            next.offset = transition.intro;\n\n            placeAttrimator.call( context, transitionEvent );\n          }\n          else\n          {\n            stopAttrimator.call( context, curr, transition.time + next.delay );\n\n            curr.queue( next );\n            next.delay = 0;\n          }\n        }\n        else\n        {\n          next.delay += transition.time;\n\n          placeAttrimator.call( context, next );\n        }\n      }\n    }\n    // We don't need to transition, just play the events\n    else\n    {\n      for (var i = attrimators.length - 1; i >= 0; i--)\n      {\n        placeAttrimator.call( context, attrimators[ i ] );\n      }\n    }\n\n    return this;\n  },\n\n  /**\n   * Finishes any attrimators on this animator that are not present in the given\n   * map of attrimators. Optionally a delay in stopping them can be given.\n   *\n   * @method finishNotPresent\n   * @param {AttrimatorMap} attrimatorMap\n   * @param {Number} [delay=0]\n   * @chainable\n   * @protected\n   */\n  finishNotPresent: function(attrimatorMap, delay)\n  {\n    var attrimators = this.values;\n    var stopIn = delay || 0;\n\n    for (var i = attrimators.length - 1; i >= 0; i--)\n    {\n      var attrimator = attrimators[ i ];\n\n      if ( !attrimatorMap.has( attrimator.attribute ) )\n      {\n        attrimator.stopIn( stopIn );\n      }\n    }\n\n    return this;\n  },\n\n  /**\n   * Finishes any attrimators on this animator that are not present in the given\n   * map of attrimators. Optionally a delay in stopping them can be given.\n   *\n   * @method stopNotPresentAt\n   * @param {AttrimatorMap} attrimatorMap\n   * @param {Number} time\n   * @chainable\n   * @protected\n   */\n  stopNotPresentAt: function(attrimatorMap, time)\n  {\n    var attrimators = this.values;\n\n    for (var i = attrimators.length - 1; i >= 0; i--)\n    {\n      var attrimator = attrimators[ i ];\n\n      if ( !attrimatorMap.has( attrimator.attribute ) )\n      {\n        attrimator.stopAt( time );\n      }\n    }\n\n    return this;\n  },\n\n  /**\n   * Clones this map returning a deep clone where all attrimators are cloned.\n   *\n   * @method clone\n   * @return {AttrimatorMap}\n   */\n  clone: function()\n  {\n    var values = this.values;\n    var keys = this.keys;\n    var clone = new AttrimatorMap();\n\n    for (var i = values.length - 1; i >= 0; i--)\n    {\n      clone.values[i] = values[i].clone();\n      clone.keys[i] = keys[i];\n      clone.indices[ keys[i] ] = i;\n    }\n\n    return clone;\n  },\n\n  /**\n   * Returns the time remaining for all finite attrimators in this map. The time\n   * remaining includes queued attrimators.\n   *\n   * @method timeRemaining\n   * @return {Number}\n   */\n  timeRemaining: function(returnInfinity)\n  {\n    var maxRemaining = 0;\n    var values = this.values;\n\n    for (var i = values.length - 1; i >= 0; i--)\n    {\n      var attrimator = values[i];\n\n      if ( !attrimator.isInfinite() )\n      {\n        maxRemaining = Math.max( maxRemaining, attrimator.timeRemaining() );\n      }\n      else if ( returnInfinity )\n      {\n        return Number.Infinity;\n      }\n    }\n\n    return maxRemaining;\n  },\n\n  /**\n   * Sets the cycle of the attrimators in this map. If there are attrimators\n   * queued the are given the next cycle number. The final cycle number is\n   * returned.\n   *\n   * @method applyCycle\n   * @param {Number} nextCycle\n   * @return {Number}\n   */\n  applyCycle: function(nextCycle)\n  {\n    var currentDepth = this.values;\n    var nextDepth = null;\n\n    while ( currentDepth.length )\n    {\n      nextDepth = [];\n\n      for (var i = currentDepth.length - 1; i >= 0; i--)\n      {\n        var attrimator = currentDepth[ i ];\n\n        attrimator.cycle = nextCycle;\n\n        if ( attrimator.next )\n        {\n          nextDepth.push( attrimator.next );\n        }\n      }\n\n      if ( nextDepth.length )\n      {\n        nextCycle++;\n      }\n\n      currentDepth = nextDepth;\n    }\n\n    return nextCycle;\n  },\n\n  /**\n   * Iterates through all attrimators in this map, at any depth.\n   *\n   * @method iterate\n   * @param  {Function} callback\n   * @param  {Object} [context]\n   * @chainable\n   */\n  iterate: function(callback, context)\n  {\n    var values = this.values;\n\n    for (var i = values.length - 1; i >= 0; i--)\n    {\n      var attrimator = values[i];\n      var previous = null;\n      var depth = 0;\n\n      while ( attrimator )\n      {\n        callback.call( context || this, attrimator, depth++, previous );\n\n        attrimator = (previous = attrimator).next;\n      }\n    }\n\n    return this;\n  }\n\n});\n\n\n/**\n * Instantiates a new Builder. Builders are responsible for taking animation\n * definitions (an Object passed to {{#crossLink \"Core/anim8.animation:method\"}}{{/crossLink}})\n * and generating & placing {{#crossLink \"Attrimator\"}}Attrimators{{/crossLink}}\n * onto an {{#crossLink \"AttrimatorMap\"}}{{/crossLink}}.\n *\n * Builders are added to the {{#crossLink \"anim8.builder\"}}{{/crossLink}} object\n * by a key and when that key exists in an animation definition, the animation\n * definition is passed to the {{#crossLink \"Builder/parse:method\"}}{{/crossLink}}\n * to generate {{#crossLink \"Attrimator\"}}Attrimators{{/crossLink}}.\n *\n * @class Builder\n * @constructor\n */\nfunction Builder()\n{\n\n}\n\n/**\n * Returns the next merge ID. Merge IDs are used when merging options into\n * attrimators to perform an optimal merge.\n *\n * @method nextMergeId\n * @static\n */\nBuilder.nextMergeId = (function()\n{\n  var id = 0;\n  return function() {\n    return id++;\n  };\n})();\n\nClass.define( Builder,\n{\n\n  /**\n   * Parses the animation object (and optionally an option object) and pushes\n   * all generated attrimatorMap to the given array.\n   *\n   * @method parse\n   * @param {Object} animation\n   * @param {Object} options\n   * @param {AttrimatorMap} attrimatorMap\n   * @param {BuilderHelper} helper\n   */\n  parse: function( animation, options, attrimatorMap, helper )\n  {\n    throw 'Builder.parse not implemented';\n  },\n\n  /**\n   * Merges the options with the given event instances. This is when an existing\n   * animation is provided but the user wants to override the animation's options.\n   *\n   * Because event properties can be specified in several places there's a priority\n   * to which one takes precedence. The properties specified in the animation object\n   * itself are highest priority, followed by the new options, then by the old\n   * options, and finally by the existing property on the event instance.\n   *\n   * @method merge\n   * @param {Object} animation\n   * @param {Object} newOptions\n   * @param {Object} oldOptions\n   * @param {AttrimatorMap} attrimatorMap\n   * @param {BuilderHelper} helper\n   */\n  merge: function( animation, newOptions, oldOptions, attrimatorMap, helper )\n  {\n    var builder = this;\n    var factory = $factory( animation.factory, helper.forObject );\n\n    attrimatorMap.iterate(function(e)\n    {\n      if ( e.getBuilder() === builder )\n      {\n        builder.mergeAttrimator( e, e.attribute, helper, factory );\n      }\n    });\n  },\n\n  /**\n   * Merges new options contained in the helper into the given attrimator.\n   *\n   * @method mergeAttrimator\n   * @param {Attrimator} e\n   * @param {String} attr\n   * @param {BuilderHelper} helper\n   * @param {Factory} factory\n   */\n  mergeAttrimator: function( e, attr, helper, factory )\n  {\n    e.easing      = helper.mergeEasing( attr, e.easing );\n    e.repeat      = helper.mergeRepeat( attr, e.repeat );\n    e.delay       = helper.mergeDelay( attr, e.delay );\n    e.sleep       = helper.mergeSleep( attr, e.sleep );\n    e.duration    = helper.mergeDuration( attr, e.duration );\n    e.offset      = helper.mergeOffset( attr, e.offset );\n    e.scale       = helper.mergeScale( attr, e.scale );\n    e.scaleBase   = helper.mergeScaleBase( attr, e.scaleBase, factory );\n    e.parameters  = helper.mergeParameters( e.parameters );\n  },\n\n  /**\n   * Calls merge on all builders specified in the given animation definition.\n   *\n   * @method submerge\n   * @protected\n   * @param {Object} animation\n   * @param {Object} newOptions\n   * @param {Object} oldOptions\n   * @param {AttrimatorMap} attrimatorMap\n   */\n  submerge: function( animation, newOptions, oldOptions, attrimatorMap )\n  {\n    var helper = new BuilderHelper( animation, oldOptions, newOptions, this.forObject );\n\n    for (var builderName in animation)\n    {\n      var builder = $builder( builderName );\n\n      if ( builder !== false && builder.merge )\n      {\n        builder.merge( animation, newOptions, oldOptions, attrimatorMap, helper );\n      }\n    }\n  }\n});\n\n\n/**\n * Instantiates a new instance of Builder Helper.\n *\n * @param {Object} input\n * @param {Object} oldOptions\n * @param {Object} newOptions\n * @class BuilderHelper\n * @constructor\n */\nfunction BuilderHelper( input, oldOptions, newOptions, forObject )\n{\n  this.input = input;\n  this.oldOptions = oldOptions || {};\n  this.newOptions = newOptions || {};\n  this.forObject = forObject;\n\n  this.prepareSpecifics( 'easings' );\n  this.prepareSpecifics( 'repeats' );\n  this.prepareSpecifics( 'delays' );\n  this.prepareSpecifics( 'sleeps' );\n  this.prepareSpecifics( 'durations' );\n  this.prepareSpecifics( 'offsets' );\n  this.prepareSpecifics( 'scales' );\n  this.prepareSpecifics( 'scaleBases' );\n  this.prepareSpecifics( 'parameters' );\n}\n\nClass.define( BuilderHelper,\n{\n\n  /**\n   * If an object with the given name doesn't exist on the input it's created.\n   *\n   * @method prepareSpecifics\n   * @param {String} specifics\n   */\n  prepareSpecifics: function(specifics)\n  {\n    if ( !isObject( this.input[ specifics ] ) )\n    {\n      this.input[ specifics ] = {};\n    }\n  },\n\n  /* PARSING */\n\n  /**\n   * Parses an easing from the input.\n   *\n   * @method parseEasing\n   * @param  {String} attr\n   * @return {String|Function|Array}\n   */\n  parseEasing: function(attr)\n  {\n    return this.parseFirst( attr, 'easing', 'easings' );\n  },\n\n  /**\n   * Parses repeats from the input.\n   *\n   * @method parseRepeat\n   * @param  {String} attr\n   * @return {Number}\n   */\n  parseRepeat: function(attr)\n  {\n    return this.parseNumber( attr, $repeat, $repeat, 'repeat', 'repeatAdd', 'repeatScale', 'repeats' );\n  },\n\n  /**\n   * Parses delay from the input.\n   *\n   * @method parseDelay\n   * @param  {String} attr\n   * @return {Number}\n   */\n  parseDelay: function(attr)\n  {\n    return this.parseNumber( attr, $delay, $time, 'delay', 'delayAdd', 'delayScale', 'delays' );\n  },\n\n  /**\n   * Parses sleep from the input.\n   *\n   * @method parseSleep\n   * @param  {String} attr\n   * @return {Number}\n   */\n  parseSleep: function(attr)\n  {\n    return this.parseNumber( attr, $sleep, $time, 'sleep', 'sleepAdd', 'sleepScale', 'sleeps' );\n  },\n\n  /**\n   * Parses duration from the input.\n   *\n   * @method parseDuration\n   * @param  {String} attr\n   * @return {Number}\n   */\n  parseDuration: function(attr)\n  {\n    return this.parseNumber( attr, $duration, $time, 'duration', 'durationAdd', 'durationScale', 'durations' );\n  },\n\n  /**\n   * Parses offset from the input.\n   *\n   * @method parseOffset\n   * @param  {String} attr\n   * @return {Number}\n   */\n  parseOffset: function(attr)\n  {\n    return this.parseNumber( attr, $offset, $time, 'offset', 'offsetAdd', 'offsetScale', 'offsets' );\n  },\n\n  /**\n   * Parses scale from the input.\n   *\n   * @method parseScale\n   * @param  {String} attr\n   * @return {Number}\n   */\n  parseScale: function(attr)\n  {\n    return this.parseNumber( attr, $scale, $number, 'scale', 'scaleAdd', 'scaleScale', 'scales' );\n  },\n\n  /**\n   * Parses scale base from the input.\n   *\n   * @method parseScaleBase\n   * @param  {String} attr\n   * @return {Any}\n   */\n  parseScaleBase: function(attr)\n  {\n    return this.parseFirst( attr, 'scaleBase', 'scaleBases' );\n  },\n\n  /**\n   * Parses a value from the input given the attribute, option, and specific.\n   *\n   * @method parseFirst\n   * @param {String} attr\n   * @param {String} option\n   * @param {String} specifics\n   * @return {Any}\n   */\n  parseFirst: function(attr, option, specifics)\n  {\n    return coalesce( this.input[ specifics ][ attr ], this.oldOptions[ option ] );\n  },\n\n  /**\n   * Parses an event from the input given a path & builder for the event.\n   *\n   * @method parseEvent\n   * @param {String} attr\n   * @param {Path} path\n   * @param {Builder} builder\n   * @param {Boolean} hasInitialState\n   * @return {Event}\n   */\n  parseEvent: function(attr, path, builder, hasInitialState, mergeId)\n  {\n    var duration   = this.parseDuration( attr );\n    var easing     = this.parseEasing( attr );\n    var delay      = this.parseDelay( attr );\n    var sleep      = this.parseSleep( attr );\n    var repeat     = this.parseRepeat( attr );\n    var offset     = this.parseOffset( attr );\n    var scale      = this.parseScale( attr );\n    var scaleBase  = this.parseScaleBase( attr );\n    var parameters = this.parseParameters();\n    var event      = new Event( attr, path, duration, easing, delay, sleep, offset, repeat, scale, scaleBase, parameters, hasInitialState, builder, null, this.input );\n\n    return event;\n  },\n\n  /**\n   * Parses a number from the input given parse functions.\n   *\n   * @method parseNumber\n   * @param {String} attr\n   * @param {Function} parseFunction\n   * @param {Function} parseOptionFunction\n   * @param {String} option\n   * @param {String} optionAdd\n   * @param {String} optionScale\n   * @param {String} specifics\n   * @return {Number}\n   */\n  parseNumber: function(attr, parseFunction, parseOptionFunction, option, optionAdd, optionScale, specifics)\n  {\n    var baseRaw = coalesce( this.input[ specifics ][ attr ], this.oldOptions[ option ] );\n    var base = parseFunction( baseRaw );\n    var add = parseOptionFunction( this.oldOptions[ optionAdd ], 0 );\n    var scale = coalesce( this.oldOptions[ optionScale ], 1 );\n\n    return (add === 0 && scale === 1) ? baseRaw : (base + add) * scale;\n  },\n\n  /**\n   * Parses parameters from input and the given options.\n   *\n   * @method parseParameters\n   * @return {Object}\n   */\n  parseParameters: function()\n  {\n    return extend( {}, this.input.parameters, this.oldOptions );\n  },\n\n  /* MERGING */\n\n  /**\n   * Merges easing based on the input, new options, and the current easing.\n   *\n   * @method mergeEasing\n   * @param {String} attr\n   * @param {Function} current\n   * @return {Function}\n   */\n  mergeEasing: function(attr, current)\n  {\n    return this.mergeFirst( attr, current, $easing, 'easing', 'easings' );\n  },\n\n  /**\n   * Merges repeats based on the input, new options, and the current repeat.\n   *\n   * @method mergeRepeat\n   * @param {String} attr\n   * @param {Number} current\n   * @return {Number}\n   */\n  mergeRepeat: function(attr, current)\n  {\n    return this.mergeNumber( attr, current, $repeat, 'repeat', 'repeatAdd', 'repeatScale', 'repeats' );\n  },\n\n  /**\n   * Merges delay based on the input, new options, and the current delay.\n   *\n   * @method mergeDelay\n   * @param {String} attr\n   * @param {Number} current\n   * @return {Number}\n   */\n  mergeDelay: function(attr, current)\n  {\n    return this.mergeNumber( attr, current, $time, 'delay', 'delayAdd', 'delayScale', 'delays' );\n  },\n\n  /**\n   * Merges sleep based on the input, new options, and the current sleep.\n   *\n   * @method mergeSleep\n   * @param {String} attr\n   * @param {Number} current\n   * @return {Number}\n   */\n  mergeSleep: function(attr, current)\n  {\n    return this.mergeNumber( attr, current, $time, 'sleep', 'sleepAdd', 'sleepScale', 'scales' );\n  },\n\n  /**\n   * Merges duration based on the input, new options, and the current duration.\n   *\n   * @method mergeDuration\n   * @param {String} attr\n   * @param {Number} current\n   * @return {Number}\n   */\n  mergeDuration: function(attr, current)\n  {\n    return this.mergeNumber( attr, current, $time, 'duration', 'durationAdd', 'durationScale', 'durations' );\n  },\n\n  /**\n   * Merges offset based on the input, new options, and the current offset.\n   *\n   * @method mergeOffset\n   * @param {String} attr\n   * @param {Number} current\n   * @return {Number}\n   */\n  mergeOffset: function(attr, current)\n  {\n    return this.mergeNumber( attr, current, $time, 'offset', 'offsetAdd', 'offsetScale', 'offsets' );\n  },\n\n  /**\n   * Merges scale based on the input, new options, and the current scale.\n   *\n   * @method mergeScale\n   * @param {String} attr\n   * @param {Number} current\n   * @return {Number}\n   */\n  mergeScale: function(attr, current)\n  {\n    return this.mergeNumber( attr, current, $number, 'scale', 'scaleAdd', 'scaleScale', 'scales' );\n  },\n\n  /**\n   * Merges scale base based on the input, new options, and the current scale\n   * base.\n   *\n   * @method mergeScaleBase\n   * @param {String} attr\n   * @param {T} current\n   * @param {Factory} factory\n   * @return {T}\n   */\n  mergeScaleBase: function(attr, current, factory)\n  {\n    var calc = factory.attribute( attr ).calculator;\n\n    var parseFunction = function(value, defaultValue) {\n      return calc.parse( value, defaultValue );\n    };\n\n    return this.mergeFirst( attr, current, parseFunction, 'scaleBase', 'scaleBases' );\n  },\n\n  /**\n   * Merges parameters from across the input and options.\n   *\n   * @method mergeParameters\n   * @param {Object} current\n   * @return {Object}\n   */\n  mergeParameters: function(current)\n  {\n    return extend( {}, this.newOptions.parameters, current );\n  },\n\n  /**\n   * Returns the first available option from input, new options, old options,\n   * and the current value.\n   *\n   * @method mergeFirst\n   * @param {String} attr\n   * @param {T} current\n   * @param {Function} parseOptionFunction\n   * @param {String} option\n   * @param {String} specifics\n   * @return {T}\n   */\n  mergeFirst: function(attr, current, parseOptionFunction, option, specifics)\n  {\n    var specific = this.input[ specifics ][ attr ];\n    var value = coalesce( specific, this.newOptions[ option ], this.oldOptions[ option ] );\n\n    return parseOptionFunction( value, current );\n  },\n\n  /**\n   * Merges a number by returning the first occurrence from input, new options,\n   * old options, and the current value.\n   *\n   * @method mergeNumber\n   * @param {String} attr\n   * @param {Number} current\n   * @param {Function} parseOptionFunction\n   * @param {String} option\n   * @param {String} optionAdd\n   * @param {String} optionScale\n   * @param {String} specifics\n   * @return {Number}\n   */\n  mergeNumber: function(attr, current, parseOptionFunction, option, optionAdd, optionScale, specifics)\n  {\n    var baseRaw = coalesce( this.input[ specifics ][ attr ], this.newOptions[ option ], this.oldOptions[ option ] );\n    var base = parseOptionFunction( baseRaw, current );\n    var add = parseOptionFunction( coalesce( this.newOptions[ optionAdd ], this.oldOptions[ optionAdd ] ), 0 );\n    var scale = coalesce( this.newOptions[ optionScale ], this.oldOptions[ optionScale ], 1 );\n\n    return (base + add) * scale;\n  }\n\n});\n\n\n\n\n/**\n * Instantiates a new Calculator instance.\n *\n * @class Calculator\n * @constructor\n */\nfunction Calculator()\n{\n\n}\n\nClass.define( Calculator,\n{\n\n  /**\n   * Creates the constants for this calculator.\n   *\n   * @method createConstants\n   */\n  createConstants: function()\n  {\n    this.ZERO = this.create();\n    this.ONE = this.parse( 1.0, this.ZERO );\n    this.INFINITY = this.parse( Number.POSITIVE_INFINITY, this.ZERO );\n  },\n\n  /**\n   * Parses the given input for a value this calculator understands.\n   *\n   * @method parse\n   * @param {T} x\n   * @param {T} defaultValue\n   * @param {Boolean} ignoreRelative\n   * @return {T|Function|False}\n   */\n  parse: function(x, defaultValue, ignoreRelative)\n  {\n    throw 'Calculator.parse not implemented';\n  },\n\n  /**\n   * Parses the given input for a value this calculator understands.\n   *\n   * @method parse\n   * @param  {T} x\n   * @param  {T} defaultValue\n   * @return {T|Function|False}\n   */\n  parseArray: function(input, output, defaultValue)\n  {\n    if (input.length !== output.length)\n    {\n      output.length = input.length;\n    }\n\n    var parsedDefault = this.parse( defaultValue, this.ZERO );\n\n    for (var i = 0; i < input.length; i++)\n    {\n      output[ i ] = this.parse( input[ i ], parsedDefault );\n    }\n\n    return output;\n  },\n\n  /**\n   * Copies a value and places it in out and returns out.\n   *\n   * @method copy\n   * @param {T} out\n   * @param {T} copy\n   * @return {T}\n   */\n  copy: function(out, copy)\n  {\n    throw 'Calculator.copy not implemented';\n  },\n\n  /**\n   * Zeros out and returns it.\n   *\n   * @method zero\n   * @param {T} out\n   * @return {T}\n   */\n  zero: function(out)\n  {\n    throw 'Calculator.zero not implemented';\n  },\n\n  /**\n   * Converts each component in the given value using a converter function and\n   * returns the result.\n   */\n  convert: function(out, converter)\n  {\n    throw 'Calculator.convert not implemented';\n  },\n\n  /**\n   * Clones the value and returns the clone.\n   *\n   * @method clone\n   * @param {T} clone\n   * @return {T}\n   */\n  clone: function(clone)\n  {\n    return this.copy( this.create(), clone );\n  },\n\n  /**\n   * Creates an empty value equivalent to zero.\n   *\n   * @method create\n   * @return {T}\n   */\n  create: function()\n  {\n    throw 'Calculator.create not implemented';\n  },\n\n  /**\n   * Scales out by the given scalar value and returns out.\n   *\n   * @method scale\n   * @param {T} out\n   * @param {Number} scale\n   * @return {T}\n   */\n  scale: function(out, scale)\n  {\n    return this.adds( out, out, scale - 1 );\n  },\n\n  /**\n   * Adds an amount to out and returns out.\n   *\n   * @method add\n   * @param {T} out\n   * @param {T} amount\n   * @return {T}\n   */\n  add: function(out, amount)\n  {\n    return this.adds( out, amount, 1 );\n  },\n\n  /**\n   * Adds an amount scaled by a scalar value to out and returns out.\n   *\n   * @method adds\n   * @param {T} out\n   * @param {T} amount\n   * @param {Number} amountScale\n   * @return {T}\n   */\n  adds: function(out, amount, amountScale)\n  {\n    throw 'Calculator.adds not implemented';\n  },\n\n  /**\n   * Subtracts an amount from out and returns out.\n   *\n   * @method sub\n   * @param {T} out\n   * @param {T} amount\n   * @return {T}\n   */\n  sub: function(out, amount)\n  {\n    return this.adds( out, amount, -1 );\n  },\n\n  /**\n   * Multiplies out by some amount and returns out.\n   *\n   * @method mul\n   * @param {T} out\n   * @param {T} scale\n   * @return {T}\n   */\n  mul: function(out, scale)\n  {\n    throw 'Calculator.mul not implemented';\n  },\n\n  /**\n   * Divides out by some amount and returns out.\n   *\n   * @method div\n   * @param {T} out\n   * @param {T} denominator\n   * @return {T}\n   */\n  div: function(out, denominator)\n  {\n    throw 'Calculator.div not implemented';\n  },\n\n  /**\n   * Interpolates out between start & end given a delta value and returns out.\n   * A delta value typically lies between 0 and 1 inclusively.\n   *\n   * @method interpolate\n   * @param {T} out\n   * @param {T} start\n   * @param {T} end\n   * @param {Number} delta\n   * @return {T}\n   */\n  interpolate: function(out, start, end, delta)\n  {\n    out = this.zero( out );\n    out = this.adds( out, start, 1 - delta );\n    out = this.adds( out, end, delta );\n\n    return out;\n  },\n\n  /**\n   * Returns a random value between the given min and max.\n   *\n   * @method random\n   * @param {T} out\n   * @param {T} min\n   * @param {T} max\n   * @return {T}\n   */\n  random: function(out, min, max)\n  {\n    return this.interpolate( out, min, max, Math.random() );\n  },\n\n  /**\n   * Calculates the distance between the two values.\n   *\n   * @method distance\n   * @param {T} a\n   * @param {T} b\n   * @return {Number}\n   */\n  distance: function(a, b)\n  {\n    return Math.sqrt( this.distanceSq( a, b ) );\n  },\n\n  /**\n   * Calculates the squared distance between the two values.\n   *\n   * @method distanceSq\n   * @param {T} a\n   * @param {T} b\n   * @return {Number}\n   */\n  distanceSq: function(a, b)\n  {\n    throw 'Calculator.distanceSq not implemented';\n  },\n\n  /**\n   * Returns the distance the given value is from zero.\n   *\n   * @method length\n   * @param {T} a\n   * @return {Number}\n   */\n  length: function(a)\n  {\n    return this.distance( a, this.ZERO );\n  },\n\n  /**\n   * Returns the squared distance the given value is from zero.\n   *\n   * @method lengthSq\n   * @param {T} a\n   * @return {Number}\n   */\n  lengthSq: function(a)\n  {\n    return this.distanceSq( a, this.ZERO );\n  },\n\n  /**\n   * Determines whether the given value is valid for this calculator.\n   *\n   * @method isValid\n   * @param {any} a\n   * @return {Boolean}\n   */\n  isValid: function(a)\n  {\n    throw 'Calculator.isValid not implemented';\n  },\n\n  /**\n   * Returns whether the given value is not a number or has a component which is\n   * not a number.\n   *\n   * @method isNaN\n   * @param {T} a\n   * @return {Boolean}\n   */\n  isNaN: function(a)\n  {\n    throw 'Calculator.isNaN not implemented';\n  },\n\n  /**\n   * Determines whether the given value is equivalent to zero given an\n   * acceptable distance from zero (epsilon).\n   *\n   * @method isZero\n   * @param {T} a\n   * @param {Number} epsilon\n   * @return {Boolean}\n   */\n  isZero: function(a, epsilon)\n  {\n    throw 'Calculator.isZero not implemented';\n  },\n\n  /**\n   * Determines whether the given values are equivalent up to an acceptable\n   * distance apart.\n   *\n   * @method isEqual\n   * @param {T} a\n   * @param {T} b\n   * @param {Number} epsilon\n   * @return {Boolean}\n   */\n  isEqual: function(a, b, epsilon)\n  {\n    throw 'Calculator.isEqual not implemented';\n  },\n\n  /**\n   * Sets out to the minimum value between the two values and returns out.\n   *\n   * @method min\n   * @param {T} out\n   * @param {T} a\n   * @param {T} b\n   * @return {T}\n   */\n  min: function(out, a, b)\n  {\n    throw 'Calculator.min not implemented';\n  },\n\n  /**\n   * Sets out to the maximum value between two values and returns out.\n   *\n   * @method max\n   * @param {T} out\n   * @param {T} a\n   * @param {T} b\n   * @return {T}\n   */\n  max: function(out, a, b)\n  {\n    throw 'Calculator.max not implemented';\n  },\n\n  /**\n   * Performs the dot product between two values.\n   *\n   * @param {T} a\n   * @param {T} b\n   * @return {Number}\n   */\n  dot: function(a, b)\n  {\n    throw 'Calculator.dot not implemented';\n  },\n\n  /**\n   * Clamps out between the given minimum and maximum values and returns out.\n   *\n   * @method clamp\n   * @param {T} out\n   * @param {T} min\n   * @param {T} max\n   * @return {T}\n   */\n  clamp: function(out, min, max)\n  {\n    var distSq = this.distanceSq( out, this.ZERO );\n\n    if ( distSq < min * min )\n    {\n      return this.scale( out, min / Math.sqrt( distSq ) );\n    }\n    else if ( distSq > max * max )\n    {\n      return this.scale( out, max / Math.sqrt( distSq ) );\n    }\n\n    return out;\n  },\n\n  /**\n   * Sets the length of the given value and returns the new value.\n   *\n   * @param {T} out\n   * @param {Number} length\n   * @return {T}\n   */\n  setLength: function(out, length)\n  {\n    var lengthSq = this.lengthSq( out );\n\n    if ( lengthSq !== 0 )\n    {\n      return this.scale( out, length / Math.sqrt( lengthSq ) );\n    }\n\n    return out;\n  }\n\n});\n\n\n/**\n * Instantiates a Defer instance. Defer instances keep track of method calls\n * to call at a later time - after an event occurs. The first argument needs\n * to be a function which returns an instance of anim8.Defer when it's invoked.\n * The second argument is an array of methods that can be deferred.\n *\n * @param {Function} factory\n * @param {Array} methods\n * @class Defer\n * @constructor\n */\nfunction Defer(factory, methods)\n{\n  this.$factory = factory;\n\n  for (var i = 0; i < methods.length; i++)\n  {\n    this[ methods[i] ] = this.$push( methods[i] );\n  }\n}\n\nClass.define( Defer,\n{\n  /**\n   * Resets the defer instance.\n   *\n   * @method $reset\n   * @param {Object} eventable\n   * @param {Any} previous\n   * @param {String} eventType\n   * @param {String} event\n   * @param {Function} callback\n   */\n  $reset: function(eventable, previous, eventType, event, callback)\n  {\n    this.$eventable = eventable;\n    this.$previous = previous;\n    this.$eventType = eventType;\n    this.$event = event;\n    this.$callback = callback;\n    this.$calls = [];\n    this.$next = [];\n\n    if ( this.$isRoot() )\n    {\n      this.$register();\n    }\n  },\n\n  /**\n   * Determines whether this Defer instance is at the root.\n   *\n   * @method $isRoot\n   * @return {Boolean}\n   */\n  $isRoot: function()\n  {\n    return this.$eventable === this.$previous;\n  },\n\n  /**\n   * Registers this Defer instance with the eventable.\n   *\n   * @method $register\n   */\n  $register: function()\n  {\n    this.$eventable[ this.$eventType ]( this.$event, this.$run, this );\n  },\n\n  /**\n   * Creates a defered function which passes the method and arguments for\n   * any method call into an array of calls on this Defer instance.\n   *\n   * @method $push\n   * @param {String} methodName\n   * @return {Function}\n   */\n  $push: function(methodName)\n  {\n    return function()\n    {\n      this.$calls.push( [methodName, arguments] );\n\n      return this;\n    };\n  },\n\n  /**\n   * Executes all defered method calls and starts any child Defer instances.\n   *\n   * @method $run\n   */\n  $run: function()\n  {\n    // Invoke the callback if one was given.\n    if ( isFunction( this.$callback ) )\n    {\n      this.$callback.call( this.$eventable, this );\n    }\n\n    for (var i = 0; i < this.$calls.length; i++)\n    {\n      var call = this.$calls[ i ];\n\n      this.$eventable[ call[0] ].apply( this.$eventable, call[1] );\n    }\n\n    for (var k = 0; k < this.$next.length; k++)\n    {\n      this.$next[ k ].$register();\n    }\n  },\n\n  /**\n   * Returns the object before the defer statement.\n   *\n   * @method undefer\n   * @return {Any}\n   */\n  undefer: function()\n  {\n    return this.$previous;\n  },\n\n  /**\n   * Defers any following method calls to after the given event is triggered. A\n   * callback can be specified which is a function invoked after the event is\n   * triggered.\n   *\n   * @method defer\n   * @param {String} eventType\n   * @param {String} event\n   * @param {Function} callback\n   * @return {Defer}\n   */\n  defer: function(eventType, event, callback)\n  {\n    var next = new this.$factory( this.$eventable, this, eventType, event, callback );\n\n    this.$next.push( next );\n\n    return next;\n  }\n\n});\n\n\n/**\n * Provides the ability to defer method calls until certain events are triggered.\n *\n * @class DeferAnimator\n * @constructor\n * @extends Defer\n */\nfunction DeferAnimator(animator, previous, eventType, event)\n{\n  this.$reset( animator, previous, eventType, event );\n}\n\n/**\n * Creates the Defer prototype for the following Animator methods.\n */\nDeferAnimator.prototype = new Defer( DeferAnimator,\n[\n  /**\n   * Defers the {{#crossLink \"Animator/restore:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method restore\n   */\n  'restore',\n\n  /**\n   * Defers the {{#crossLink \"Animator/placeAttrimator:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method placeAttrimator\n   */\n  'placeAttrimator',\n\n  /**\n   * Defers the {{#crossLink \"Animator/applyInitialState:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method applyInitialState\n   */\n  'applyInitialState',\n\n  /**\n   * Defers the {{#crossLink \"Animator/preupdate:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method preupdate\n   */\n  'preupdate',\n\n  /**\n   * Defers the {{#crossLink \"Animator/update:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method update\n   */\n  'update',\n\n  /**\n   * Defers the {{#crossLink \"Animator/apply:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method apply\n   */\n  'apply',\n\n  /**\n   * Defers the {{#crossLink \"Animator/trimAttrimators:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method restore\n   * @protected\n   */\n  'trimAttrimators',\n\n  /**\n   * Defers the {{#crossLink \"Animator/activate:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method restore\n   */\n  'activate',\n\n  /**\n   * Defers the {{#crossLink \"Animator/deactivate:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method restore\n   */\n  'deactivate',\n\n  /**\n   * Defers the {{#crossLink \"Animator/destroy:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method restore\n   */\n  'destroy',\n\n  /**\n   * Defers the {{#crossLink \"Animator/spring:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method restore\n   */\n  'spring',\n\n  /**\n   * Defers the {{#crossLink \"Animator/play:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method restore\n   */\n  'play',\n\n  /**\n   * Defers the {{#crossLink \"Animator/playAttrimators:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method restore\n   * @protected\n   */\n  'playAttrimators',\n\n  /**\n   * Defers the {{#crossLink \"Animator/queue:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method queue\n   */\n  'queue',\n\n  /**\n   * Defers the {{#crossLink \"Animator/queueAttrimators:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method queueAttrimators\n   * @protected\n   */\n  'queueAttrimators',\n\n  /**\n   * Defers the {{#crossLink \"Animator/insert:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method insert\n   */\n  'insert',\n\n  /**\n   * Defers the {{#crossLink \"Animator/insertAttrimators:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method insertAttrimators\n   * @protected\n   */\n  'insertAttrimators',\n\n  /**\n   * Defers the {{#crossLink \"Animator/transition:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method transition\n   */\n  'transition',\n\n  /**\n   * Defers the {{#crossLink \"Animator/transitionAttrimators:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method transitionAttrimators\n   * @protected\n   */\n  'transitionAttrimators',\n\n  /**\n   * Defers the {{#crossLink \"Animator/tween:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method tween\n   */\n  'tween',\n\n  /**\n   * Defers the {{#crossLink \"Animator/tweenTo:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method tweenTo\n   */\n  'tweenTo',\n\n  /**\n   * Defers the {{#crossLink \"Animator/tweenMany:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method tweenMany\n   */\n  'tweenMany',\n\n  /**\n   * Defers the {{#crossLink \"Animator/tweenManyTo:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method tweenManyTo\n   */\n  'tweenManyTo',\n\n  /**\n   * Defers the {{#crossLink \"Animator/tweenFrom:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method tweenFrom\n   */\n  'tweenFrom',\n\n  /**\n   * Defers the {{#crossLink \"Animator/tweenManyFrom:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method tweenManyFrom\n   */\n  'tweenManyFrom',\n\n  /**\n   * Defers the {{#crossLink \"Animator/move:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method move\n   */\n  'move',\n\n  /**\n   * Defers the {{#crossLink \"Animator/moveMany:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method moveMany\n   */\n  'moveMany',\n\n  /**\n   * Defers the {{#crossLink \"Animator/follow:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method follow\n   */\n  'follow',\n\n  /**\n   * Defers the {{#crossLink \"Animator/stop:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method stop\n   */\n  'stop',\n\n  /**\n   * Defers the {{#crossLink \"Animator/end:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method end\n   */\n  'end',\n\n  /**\n   * Defers the {{#crossLink \"Animator/finish:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method finish\n   */\n  'finish',\n\n  /**\n   * Defers the {{#crossLink \"Animator/nopeat:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method nopeat\n   */\n  'nopeat',\n\n  /**\n   * Defers the {{#crossLink \"Animator/pause:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method pause\n   */\n  'pause',\n\n  /**\n   * Defers the {{#crossLink \"Animator/resume:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method resume\n   */\n  'resume',\n\n  /**\n   * Defers the {{#crossLink \"Animator/set:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method set\n   */\n  'set',\n\n  /**\n   * Defers the {{#crossLink \"Animator/unset:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method unset\n   */\n  'unset',\n\n  /**\n   * Defers the {{#crossLink \"Animator/get:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method get\n   */\n  'get',\n\n  /**\n   * Defers the {{#crossLink \"Animator/invoke:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method invoke\n   */\n  'invoke',\n\n  /**\n   * Defers the {{#crossLink \"Animator/onCycleStart:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method onCycleStart\n   */\n  'onCycleStart',\n\n  /**\n   * Defers the {{#crossLink \"Animator/onCycleEnd:method\"}}{{/crossLink}} method until the deferred event has occurred.\n   *\n   * @method onCycleEnd\n   */\n  'onCycleEnd'\n]);\n\n\nvar EasingTypes = {};\n\n/**\n * A collection of easing type functions. An easing type functions takes an\n * easing function as an argument and modifies it's input and output values.\n *\n * **See:** {{#crossLink \"Core/anim8.easing\"}}{{/crossLink}}\n *\n * @class anim8.easingType\n */\n\n/**\n * Plays the animation forward normally.\n *\n * @method in\n * @for anim8.easingType\n * @param {Function} easing\n * @return {Function}\n */\nEasingTypes['in'] = function(easing)\n{\n  return function(x)\n  {\n    return easing( x );\n  };\n};\n\n/**\n * Plays the animation forward by flipping the easings momentum.\n *\n * @method out\n * @for anim8.easingType\n * @param {Function} easing\n * @return {Function}\n */\nEasingTypes['out'] = function(easing)\n{\n  return function(x)\n  {\n    return 1.0 - easing( 1.0 - x );\n  };\n};\n\n/**\n * Plays the animation forward by flipping the easings momentum halfway.\n *\n * @method inout\n * @for anim8.easingType\n * @param {Function} easing\n * @return {Function}\n */\nEasingTypes['inout'] = function(easing)\n{\n  return function(x)\n  {\n    if ( x < 0.5 )\n    {\n      return easing( 2.0 * x ) * 0.5;\n    }\n    else\n    {\n      return 1.0 - (easing( 2.0 - 2.0 * x ) * 0.5);\n    }\n  };\n};\n\n/**\n * Plays the aninmation forwards with the given easing, and backwards with the same easing momentum.\n *\n * @method yoyo\n * @for anim8.easingType\n * @param {Function} easing\n * @return {Function}\n */\nEasingTypes['yoyo'] = function(easing)\n{\n  return function(x)\n  {\n    if ( x < 0.5 )\n    {\n      return easing( 2.0 * x );\n    }\n    else\n    {\n      return easing( 2.0 - 2.0 * x );\n    }\n  };\n};\n\n/**\n * Plays the animation forwards with the given easing, and backwards reflecting the easing's momentum.\n *\n * @method mirror\n * @for anim8.easingType\n * @param {Function} easing\n * @return {Function}\n */\nEasingTypes['mirror'] = function(easing)\n{\n  return function(x)\n  {\n    if ( x < 0.5 )\n    {\n      return easing( 2.0 * x );\n    }\n    else\n    {\n      return 1.0 - easing( 2.0 - 2.0 * x );\n    }\n  };\n};\n\n/**\n * Plays the animation backwards with using the same easing momentum.\n *\n * @method reverse\n * @for anim8.easingType\n * @param {Function} easing\n * @return {Function}\n */\nEasingTypes['reverse'] = function(easing)\n{\n  return function(x)\n  {\n    return easing( 1.0 - x );\n  };\n};\n\n/**\n * Plays the animation backwards by flipping the easing's momentum.\n *\n * @method flip\n * @for anim8.easingType\n * @param {Function} easing\n * @return {Function}\n */\nEasingTypes['flip'] = function(easing)\n{\n  return function(x)\n  {\n    return 1.0 - easing( x );\n  };\n};\n\n\n/**\n * A collection of easing functions. An easing functions takes a single number\n * as input that's between 0 and 1 inclusively and returns a number that\n * progresses from 0 to 1 but in-between values may return a number that's less\n * than 0 or greater than 1.\n *\n * **See:** {{#crossLink \"Core/anim8.easing\"}}{{/crossLink}}\n *\n * @class anim8.Easings\n */\nvar Easings = {};\n\n\n/**\n * Returns true if the given string would result in returning an easing.\n *\n * **See:** {{#crossLink \"Core/anim8.easing\"}}{{/crossLink}}\n *\n * @method anim8.isEasingName\n * @for Core\n * @param {String} easing\n * @return {Boolean}\n */\nfunction isEasingName(easing)\n{\n  if ( easing in Easings )\n  {\n    return true;\n  }\n\n  var pair = easing.split('-');\n  var e = pair[0];\n  var t = pair[1];\n\n  if ( pair.length >= 2 && e in Easings && t in EasingTypes )\n  {\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiJ4IiwiY29sb3IiOiIjMDAwMDAwIn0seyJ0eXBlIjoxMDAwLCJ3aW5kb3ciOlsiLTAuMTkyNTAwMDAwMDAwMDAwMjUiLCIxLjQzMjQ5OTk5OTk5OTk5OTkiLCIwLjAxNzQ5OTk5OTk5OTk5OTg3NyIsIjEuMDE3NDk5OTk5OTk5OTk5OCJdfV0-)\n *\n * @method linear\n * @for anim8.easing\n */\nEasings['linear'] = function(x)\n{\n  return x;\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiJ4KngiLCJjb2xvciI6IiMwMDAwMDAifSx7InR5cGUiOjEwMDAsIndpbmRvdyI6WyItMC4xOTI1MDAwMDAwMDAwMDAyNSIsIjEuNDMyNDk5OTk5OTk5OTk5OSIsIjAuMDE3NDk5OTk5OTk5OTk5ODc3IiwiMS4wMTc0OTk5OTk5OTk5OTk4Il19XQ--)\n *\n * @method quad\n * @for anim8.easing\n */\nEasings['quad'] = function(x)\n{\n  return x * x;\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiIoKDAuMyooMS14KSooMS14KSp4KSsoMy4wKigxLXgpKngqeCkrKHgqeCp4KSkqKDEteCkreCooMS0oMS14KSooMS14KSooMS14KSooMS14KSkiLCJjb2xvciI6IiMwMDAwMDAifSx7InR5cGUiOjEwMDAsIndpbmRvdyI6WyItMC4xOTI1MDAwMDAwMDAwMDAyNSIsIjEuNDMyNDk5OTk5OTk5OTk5OSIsIjAuMDE3NDk5OTk5OTk5OTk5ODc3IiwiMS4wMTc0OTk5OTk5OTk5OTk4Il19XQ--)\n *\n * @method quad\n * @for anim8.easing\n */\nEasings['ease'] = function(x)\n{\n  var i = (1.0 - x);\n  var i2 = i * i;\n  var x2 = x * x;\n  var eq1 = (0.3 * i2 * x) + (3.0 * i * x2) + (x2 * x);\n  var eq2 = 1.0 - i2 * i2;\n\n  return eq1 * i + eq2 * x;\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiJ4KngqeCIsImNvbG9yIjoiIzAwMDAwMCJ9LHsidHlwZSI6MTAwMCwid2luZG93IjpbIi0wLjE5MjUwMDAwMDAwMDAwMDI1IiwiMS40MzI0OTk5OTk5OTk5OTk5IiwiMC4wMTc0OTk5OTk5OTk5OTk4NzciLCIxLjAxNzQ5OTk5OTk5OTk5OTgiXX1d)\n *\n * @method cubic\n * @for anim8.easing\n */\nEasings['cubic'] = function(x)\n{\n  return x * x * x;\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiJ4KngqeCp4IiwiY29sb3IiOiIjMDAwMDAwIn0seyJ0eXBlIjoxMDAwLCJ3aW5kb3ciOlsiLTAuMTkyNTAwMDAwMDAwMDAwMjUiLCIxLjQzMjQ5OTk5OTk5OTk5OTkiLCIwLjAxNzQ5OTk5OTk5OTk5OTg3NyIsIjEuMDE3NDk5OTk5OTk5OTk5OCJdfV0-)\n *\n * @method quartic\n * @for anim8.easing\n */\nEasings['quartic'] = function(x)\n{\n  var x2 = x * x;\n  return x2 * x2;\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiJ4KngqeCp4KngiLCJjb2xvciI6IiMwMDAwMDAifSx7InR5cGUiOjEwMDAsIndpbmRvdyI6WyItMC4xOTI1MDAwMDAwMDAwMDAyNSIsIjEuNDMyNDk5OTk5OTk5OTk5OSIsIjAuMDE3NDk5OTk5OTk5OTk5ODc3IiwiMS4wMTc0OTk5OTk5OTk5OTk4Il19XQ--)\n *\n * @method quintic\n * @for anim8.easing\n */\nEasings['quintic'] = function(x)\n{\n  var x2 = x * x;\n  return x2 * x2 * x;\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiIoeCp4KngpKyh4KngpLXgiLCJjb2xvciI6IiMwMDAwMDAifSx7InR5cGUiOjEwMDAsIndpbmRvdyI6WyItMC4xOTI1MDAwMDAwMDAwMDAyNSIsIjEuNDMyNDk5OTk5OTk5OTk5OSIsIjAuMDE3NDk5OTk5OTk5OTk5ODc3IiwiMS4wMTc0OTk5OTk5OTk5OTk4Il19XQ--)\n *\n * @method back\n * @for anim8.easing\n */\nEasings['back'] = function(x)\n{\n  var x2 = x * x;\n  var x3 = x2 * x;\n  return x3 + x2 - x;\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiJzaW4oeCoxLjU3MDc5NjMyNjc5KSIsImNvbG9yIjoiIzAwMDAwMCJ9LHsidHlwZSI6MTAwMCwid2luZG93IjpbIi0wLjE5MjUwMDAwMDAwMDAwMDI1IiwiMS40MzI0OTk5OTk5OTk5OTk5IiwiMC4wMTc0OTk5OTk5OTk5OTk4NzciLCIxLjAxNzQ5OTk5OTk5OTk5OTgiXX1d)\n *\n * @method sine\n * @for anim8.easing\n */\nEasings['sine'] = function(x)\n{\n  return Math.sin( x * 1.57079632679 );\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiIoMS4wLXgqKDcuMC8xMCkpKngqKDEwLjAvMy4wKSIsImNvbG9yIjoiIzAwMDAwMCJ9LHsidHlwZSI6MTAwMCwid2luZG93IjpbIi0wLjE5MjUwMDAwMDAwMDAwMDI1IiwiMS40MzI0OTk5OTk5OTk5OTk5IiwiMC4wMTc0OTk5OTk5OTk5OTk4NzciLCIxLjAxNzQ5OTk5OTk5OTk5OTgiXX1d)\n *\n * @method overshot\n * @for anim8.easing\n */\nEasings['overshot'] = function(x)\n{\n  return (1.0 - x * (7.0 / 10)) * x * (10.0 / 3.0);\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiIoeCp4KigoMi4wKngqeCp4KSt4KngtKDQuMCp4KSsyLjApKSotc2luKHgqMTAuOTk1NTc0Mjg3NikiLCJjb2xvciI6IiMwMDAwMDAifSx7InR5cGUiOjEwMDAsIndpbmRvdyI6WyItMC4xOTI1MDAwMDAwMDAwMDAyNSIsIjEuNDMyNDk5OTk5OTk5OTk5OSIsIjAuMDE3NDk5OTk5OTk5OTk5ODc3IiwiMS4wMTc0OTk5OTk5OTk5OTk4Il19XQ--)\n *\n * @method elastic\n * @for anim8.easing\n */\nEasings['elastic'] = function(x)\n{\n  var x2 = x * x;\n  var x3 = x2 * x;\n  var scale = x2 * ((2.0 * x3) + x2 - (4.0 * x) + 2.0);\n  var wave = -Math.sin(x * 10.9955742876);\n  return scale * wave;\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiJhYnMoeC1zaW4oeCozLjE0MTU5MjY1MzU5KSkiLCJjb2xvciI6IiMwMDAwMDAifSx7InR5cGUiOjEwMDAsIndpbmRvdyI6WyItMC4xOTI1MDAwMDAwMDAwMDAyNSIsIjEuNDMyNDk5OTk5OTk5OTk5OSIsIjAuMDE3NDk5OTk5OTk5OTk5ODc3IiwiMS4wMTc0OTk5OTk5OTk5OTk4Il19XQ--)\n *\n * @method revisit\n * @for anim8.easing\n */\nEasings['revisit'] = function(x)\n{\n  return Math.abs( x - Math.sin(x * 3.14159265359) );\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiIoMS4wLWNvcyh4KngqeCozNi4wKSooMS4wLXgpKSIsImNvbG9yIjoiIzAwMDAwMCJ9LHsidHlwZSI6MTAwMCwid2luZG93IjpbIi0wLjE5MjUwMDAwMDAwMDAwMDI1IiwiMS40MzI0OTk5OTk5OTk5OTk5IiwiMC4wMTc0OTk5OTk5OTk5OTk4NzciLCIxLjAxNzQ5OTk5OTk5OTk5OTgiXX1d)\n *\n * @method lasso\n * @for anim8.easing\n */\nEasings['lasso'] = function(x)\n{\n  return (1.0 - Math.cos(x * x * x * 36.0) * (1.0 - x));\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiIoMS4wLWFicygoMS4wLXgqeCkqY29zKHgqeCp4KjE0LjgwNDQwNjYwMTYpKSkiLCJjb2xvciI6IiMwMDAwMDAifSx7InR5cGUiOjEwMDAsIndpbmRvdyI6WyItMC4xOTI1MDAwMDAwMDAwMDAyNSIsIjEuNDMyNDk5OTk5OTk5OTk5OSIsIjAuMDE3NDk5OTk5OTk5OTk5ODc3IiwiMS4wMTc0OTk5OTk5OTk5OTk4Il19XQ--)\n *\n * @method slowbounce\n * @for anim8.easing\n */\nEasings['slowbounce'] = function(x)\n{\n  var x2 = x * x;\n  return (1.0 - Math.abs((1.0 - x2) * Math.cos(x2 * x * 14.8044066016)));\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiIoMS4wLWFicygoMS4wLXgpKmNvcyh4KngqMTQuODA0NDA2NjAxNikpKSIsImNvbG9yIjoiIzAwMDAwMCJ9LHsidHlwZSI6MTAwMCwid2luZG93IjpbIi0wLjE5MjUwMDAwMDAwMDAwMDI1IiwiMS40MzI0OTk5OTk5OTk5OTk5IiwiMC4wMTc0OTk5OTk5OTk5OTk4NzciLCIxLjAxNzQ5OTk5OTk5OTk5OTgiXX1d)\n *\n * @method bounce\n * @for anim8.easing\n */\nEasings['bounce'] = function(x)\n{\n  return (1.0 - Math.abs((1.0 - x) * Math.cos(x * x * 14.8044066016)));\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiIoMS4wLWFicygoMS14KSooMS14KSpjb3MoeCp4KjE0LjgwNDQwNjYwMTYpKSkiLCJjb2xvciI6IiMwMDAwMDAifSx7InR5cGUiOjEwMDAsIndpbmRvdyI6WyItMC4xOTI1MDAwMDAwMDAwMDAyNSIsIjEuNDMyNDk5OTk5OTk5OTk5OSIsIjAuMDE3NDk5OTk5OTk5OTk5ODc3IiwiMS4wMTc0OTk5OTk5OTk5OTk4Il19XQ--)\n *\n * @method smallbounce\n * @for anim8.easing\n */\nEasings['smallbounce'] = function(x)\n{\n  var inv = 1.0 - x;\n  return (1.0 - Math.abs(inv * inv * Math.cos(x * x * 14.8044066016)));\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiIoMS4wLWFicygoMS14KSooMS14KSpjb3MoeCp4KjcpKSkiLCJjb2xvciI6IiMwMDAwMDAifSx7InR5cGUiOjEwMDAsIndpbmRvdyI6WyItMC4xOTI1MDAwMDAwMDAwMDAyNSIsIjEuNDMyNDk5OTk5OTk5OTk5OSIsIjAuMDE3NDk5OTk5OTk5OTk5ODc3IiwiMS4wMTc0OTk5OTk5OTk5OTk4Il19XQ--)\n *\n * @method tinybounce\n * @for anim8.easing\n */\nEasings['tinybounce'] = function(x)\n{\n  var inv = 1.0 - x;\n  return (1.0 - Math.abs(inv * inv * Math.cos(x * x * 7.0)));\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiIoY29zKHgqeCoxMi4wKSp4KigxLjAteCkreCkiLCJjb2xvciI6IiMwMDAwMDAifSx7InR5cGUiOjEwMDAsIndpbmRvdyI6WyItMC4xOTI1MDAwMDAwMDAwMDAyNSIsIjEuNDMyNDk5OTk5OTk5OTk5OSIsIjAuMDE3NDk5OTk5OTk5OTk5ODc3IiwiMS4wMTc0OTk5OTk5OTk5OTk4Il19XQ--)\n *\n * @method hesitant\n * @for anim8.easing\n */\nEasings['hesitant'] = function(x)\n{\n  return (Math.cos(x * x * 12.0) * x * (1.0 - x) + x);\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiJzcXJ0KHgpIiwiY29sb3IiOiIjMDAwMDAwIn0seyJ0eXBlIjoxMDAwLCJ3aW5kb3ciOlsiLTAuMTkyNTAwMDAwMDAwMDAwMjUiLCIxLjQzMjQ5OTk5OTk5OTk5OTkiLCIwLjAxNzQ5OTk5OTk5OTk5OTg3NyIsIjEuMDE3NDk5OTk5OTk5OTk5OCJdfV0-)\n *\n * @method sqrt\n * @for anim8.easing\n */\nEasings['sqrt'] = function(x)\n{\n  return Math.sqrt( x );\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiIoKDEuMC0oMS14KSooMS14KSooMS14KSooMS14KSkreCkqMC41IiwiY29sb3IiOiIjMDAwMDAwIn0seyJ0eXBlIjoxMDAwLCJ3aW5kb3ciOlsiLTAuMTkyNTAwMDAwMDAwMDAwMjUiLCIxLjQzMjQ5OTk5OTk5OTk5OTkiLCIwLjAxNzQ5OTk5OTk5OTk5OTg3NyIsIjEuMDE3NDk5OTk5OTk5OTk5OCJdfV0-)\n *\n * @method sqrtf\n * @for anim8.easing\n */\nEasings['sqrtf'] = function(x)\n{\n  var i = (1.0 - x);\n  var i2 = i * i;\n  return ((1.0 - i2 * i2) + x) * 0.5;\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiIobG9nKHgpKzIuMCkqMC41IiwiY29sb3IiOiIjMDAwMDAwIn0seyJ0eXBlIjoxMDAwLCJ3aW5kb3ciOlsiLTAuMTkyNTAwMDAwMDAwMDAwMjUiLCIxLjQzMjQ5OTk5OTk5OTk5OTkiLCIwLjAxNzQ5OTk5OTk5OTk5OTg3NyIsIjEuMDE3NDk5OTk5OTk5OTk5OCJdfV0-)\n *\n * @method log10\n * @for anim8.easing\n */\nEasings['log10'] = function(x)\n{\n  return (Math.log10(x + 0.01) + 2.0) * 0.5 / 1.0021606868913213;\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiIoeDwwLjc_KHgqLTAuMzU3KTooKCh4LTAuNykqKHgtMC43KSoyNy41LTAuNSkqMC41KSkiLCJjb2xvciI6IiMwMDAwMDAifSx7InR5cGUiOjEwMDAsIndpbmRvdyI6WyItMC4xOTI1MDAwMDAwMDAwMDAyNSIsIjEuNDMyNDk5OTk5OTk5OTk5OSIsIjAuMDE3NDk5OTk5OTk5OTk5ODc3IiwiMS4wMTc0OTk5OTk5OTk5OTk4Il19XQ--)\n *\n * @method slingshot\n * @for anim8.easing\n */\nEasings['slingshot'] = function(x)\n{\n  if (x < 0.7) {\n    return (x * -0.357);\n  } else {\n    var d = x - 0.7;\n    return ((d * d * 27.5 - 0.5) * 0.5);\n  }\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiIxLXNxcnQoMS14KngpIiwiY29sb3IiOiIjMDAwMDAwIn0seyJ0eXBlIjoxMDAwLCJ3aW5kb3ciOlsiLTAuMTkyNTAwMDAwMDAwMDAwMjUiLCIxLjQzMjQ5OTk5OTk5OTk5OTkiLCIwLjAxNzQ5OTk5OTk5OTk5OTg3NyIsIjEuMDE3NDk5OTk5OTk5OTk5OCJdfV0-)\n *\n * @method circular\n * @for anim8.easing\n */\nEasings['circular'] = function(x)\n{\n  return 1.0 - Math.sqrt( 1 - x * x );\n};\n\n/**\n * [View Easing Function](http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiIoMy4wKigxLjAteCkqeCp4KSsoeCp4KngpIiwiY29sb3IiOiIjMDAwMDAwIn0seyJ0eXBlIjoxMDAwLCJ3aW5kb3ciOlsiLTAuMTkyNTAwMDAwMDAwMDAwMjUiLCIxLjQzMjQ5OTk5OTk5OTk5OTkiLCIwLjAxNzQ5OTk5OTk5OTk5OTg3NyIsIjEuMDE3NDk5OTk5OTk5OTk5OCJdfV0-)\n *\n * @method gentle\n * @for anim8.easing\n */\nEasings['gentle'] = function(x)\n{\n  return (3.0 * (1.0 - x) * x * x) + (x * x * x);\n};\n\n/**\n * Scales an existing easing by a given factor\n *\n * @method scale\n * @for anim8.easing\n */\nEasings['scale'] = function(scale, easing)\n{\n  var inner = $easing( easing );\n\n  return function (x)\n  {\n    var i = inner( x );\n    return scale * i + (1 - scale) * x;\n  };\n};\n\n/**\n * Generates a bezier easing function given the two middle control points. The\n * first point is {0,0} and the last point is {1, 1}.\n *\n * @method bezier\n * @for anim8.easing\n * @param {Number} mX1\n * @param {Number} mY1\n * @param {Number} mX2\n * @param {Number} mY2\n * @return {Function}\n */\nEasings['bezier'] = function(mX1, mY1, mX2, mY2)\n{\n  // https://gist.githubusercontent.com/gre/1926947/raw/KeySpline.js\n  function A(aA1, aA2) { return 1.0 - 3.0 * aA2 + 3.0 * aA1; }\n  function B(aA1, aA2) { return 3.0 * aA2 - 6.0 * aA1; }\n  function C(aA1)      { return 3.0 * aA1; }\n\n  // Returns x(t) given t, x1, and x2, or y(t) given t, y1, and y2.\n  function CalcBezier(aT, aA1, aA2) {\n    return ((A(aA1, aA2)*aT + B(aA1, aA2))*aT + C(aA1))*aT;\n  }\n\n  // Returns dx/dt given t, x1, and x2, or dy/dt given t, y1, and y2.\n  function GetSlope(aT, aA1, aA2) {\n    return 3.0 * A(aA1, aA2)*aT*aT + 2.0 * B(aA1, aA2) * aT + C(aA1);\n  }\n\n  function GetTForX(aX) {\n    // Newton raphson iteration\n    var aGuessT = aX;\n    for (var i = 0; i < 4; ++i) {\n      var currentSlope = GetSlope(aGuessT, mX1, mX2);\n      if (currentSlope === 0.0) {\n        return aGuessT;\n      }\n      var currentX = CalcBezier(aGuessT, mX1, mX2) - aX;\n      aGuessT -= currentX / currentSlope;\n    }\n    return aGuessT;\n  }\n\n  return function(x) {\n    return CalcBezier( GetTForX( x ), mY1, mY2 );\n  };\n};\n\n\n/**\n * Possible states an event can be in.\n *\n * @type {Object}\n */\nvar EventState =\n{\n  DELAYED: 1,\n  ANIMATING: 2,\n  SLEEPING: 4,\n  FINISHED: 8\n};\n\n/**\n * Instantiates a new Event which extends Attrimator.\n *\n * @param {String} attribute\n * @param {Path} path\n * @param {String|Number} duration\n * @param {String|Function|Array} easing\n * @param {String|Number} delay\n * @param {String|Number} sleep\n * @param {String|Number} offset\n * @param {String|Number} repeat\n * @param {Number} scale\n * @param {T|Number} scaleBase\n * @param {Boolean} hasInitialState\n * @param {Builder} builder\n * @param {Attrimator} next\n * @param {Object} input\n * @param {Number} mergeId\n * @class Event\n * @constructor\n * @extends Attrimator\n */\nfunction Event(attribute, path, duration, easing, delay, sleep, offset, repeat, scale, scaleBase, parameters, hasInitialState, builder, next, input, mergeId)\n{\n  this.reset( attribute, builder, next );\n\n  /**\n   * The path the attribute will be animated along.\n   *\n   * @property {Path} path\n   */\n  this.path             = path;\n\n  /**\n   * The easing used to modify the delta value passed to the path.\n   *\n   * **See:** {{#crossLink \"Core/anim8.easing:method\"}}{{/crossLink}}\n   *\n   * @property {Function} easing\n   */\n  this.easing           = $easing( easing );\n\n  /**\n   * The amount of time in milliseconds to animate an attribute over the path.\n   *\n   * **See:** {{#crossLink \"Core/anim8.duration:method\"}}{{/crossLink}}\n   *\n   * @property {Number} duration\n   */\n  this.duration         = $duration( duration );\n\n  /**\n   * If this event repeats more than once, this is a pause between animations.\n   *\n   * **See:** {{#crossLink \"Core/anim8.sleep:method\"}}{{/crossLink}}\n   *\n   * @property {Number} sleep\n   */\n  this.sleep            = $sleep( sleep );\n\n  /**\n   * The number of times to repeat the animation.\n   *\n   * **See:** {{#crossLink \"Core/anim8.repeat:method\"}}{{/crossLink}}\n   *\n   * @property {Number} repeat\n   */\n  this.repeat           = $repeat( repeat );\n\n  /**\n   * The amount to scale the value computed from the path.\n   *\n   * **See:** {{#crossLink \"Core/anim8.scale:method\"}}{{/crossLink}}\n   *\n   * @property {T} scale\n   */\n  this.scale            = $scale( scale );\n\n  /**\n   * The base value from which to scale from. This is essentially this data\n   * types default value.\n   *\n   * @property {T} scaleBase\n   */\n  this.scaleBase        = path.calculator.parse( scaleBase, path.calculator.ZERO );\n\n  /**\n   * The properties on the attrimator.\n   *\n   * @property {Object} parameters\n   */\n  this.parameters       = parameters;\n\n  /**\n   * Whether or not this event has an initial value which can be applied at the\n   * start of the animation (or when\n   * {{#crossLink \"Animator/applyInitialState:method\"}}{{/crossLink}} is invoked).\n   *\n   * @property {Boolean} hasInitialState\n   */\n  this.hasInitialState  = coalesce( hasInitialState, true );\n\n  this.delay            = $delay( delay );\n  this.offset           = $offset( offset );\n\n  this.input            = input;\n  this.mergeId          = mergeId;\n}\n\nClass.extend( Event, Attrimator,\n{\n  /**\n   * Returns the computed value given a base value and a delta along the path.\n   *\n   * @method computeValue\n   * @param {T} baseValue\n   * @param {Number} delta\n   * @return {T}\n   */\n  computeValue: function(baseValue, delta)\n  {\n    var value = this.path.compute( baseValue, this.easing( delta ) );\n\n    if ( value !== false && this.scale !== 1.0 )\n    {\n      var calc = this.path.calculator;\n      var baseValue = calc.clone( this.scaleBase );\n      var distance = calc.sub( baseValue, value );\n\n      value = calc.adds( value, distance, -this.scale );\n    }\n\n    return value;\n  },\n\n  /**\n   * Applies the value to the frame and returns true, otherwise returns false.\n   *\n   * @method applyValue\n   * @param {Object} frame\n   * @param {T} baseValue\n   * @param {Number} delta\n   * @return {T}\n   */\n  applyValue: function(frame, baseValue, delta)\n  {\n    var value = baseValue;\n\n    // TODO pull defaultValue from attribute\n    if (!this.path.calculator.isValid( baseValue ))\n    {\n      value = this.path.calculator.create();\n    }\n\n    value = this.computeValue( value, delta );\n\n    if ( value !== false )\n    {\n      frame[ this.attribute ] = value;\n    }\n\n    return value;\n  },\n\n  nopeat: function()\n  {\n    var newRepeat = clamp( Math.ceil( ( this.elapsed - this.delay ) / ( this.duration + this.sleep ) ), 0, this.repeat );\n\n    if ( newRepeat !== this.repeat )\n    {\n      this.repeat = newRepeat;\n      this.prestartNext( true );\n    }\n\n    return this;\n  },\n  finish: function(frame)\n  {\n    this.applyValue( frame, this.path.calculator.create(), 1.0 );\n    this.state = EventState.FINISHED;\n  },\n  start: function(now, animator)\n  {\n    this.prestart( now );\n\n    this.state = this.delay ? EventState.DELAYED : EventState.ANIMATING;\n\n    if ( this.hasComputed() )\n    {\n      this.path = this.path.replaceComputed( this, animator );\n    }\n  },\n  startCycle: function(frame)\n  {\n    if ( this.hasInitialState )\n    {\n      this.applyValue( frame, frame[ this.attribute ], 0 );\n\n      return true;\n    }\n\n    return false;\n  },\n  update: function(elapsed, frame)\n  {\n    var updated = false;\n    var delay = this.delay;\n    var duration = this.duration;\n    var sleep = this.sleep;\n    var repeat = this.repeat;\n    var oldState = this.state;\n    var newState = this.state;\n    var delta = 0;\n\n    elapsed -= delay;\n\n    var cycle = duration + sleep;\n    var iteration = Math.floor( elapsed / cycle );\n\n    if ( iteration >= repeat )\n    {\n      newState = EventState.FINISHED;\n      delta = 1;\n    }\n    else\n    {\n      elapsed -= iteration * cycle;\n\n      if ( elapsed > duration )\n      {\n        newState = EventState.SLEEPING;\n        delta = 1;\n      }\n      else\n      {\n        newState = EventState.ANIMATING;\n        delta = elapsed / duration;\n      }\n    }\n\n    if ( newState === EventState.ANIMATING ||\n       ( newState !== EventState.ANIMATING && oldState === EventState.ANIMATING ) )\n    {\n      this.applyValue( frame, frame[ this.attribute ], delta );\n      updated = true;\n    }\n\n    this.state = newState;\n\n    return updated;\n  },\n  valueAt: function(time, out)\n  {\n    time += this.offset;\n\n    if ( time < this.delay && !this.hasInitialState )\n    {\n      return false;\n    }\n\n    var delta = 0;\n\n    if ( time >= this.delay )\n    {\n      var cycle = (this.duration + this.sleep);\n      var elapsed = (time - this.delay);\n      var iteration = Math.floor( elapsed / cycle );\n\n      if ( iteration >= this.repeat )\n      {\n        delta = 1.0;\n      }\n      else\n      {\n        delta = Math.min( 1.0, (elapsed % cycle) / this.duration );\n      }\n    }\n\n    return this.computeValue( out, delta );\n  },\n  totalTime: function()\n  {\n    var sleepTime = this.sleep ? ((this.repeat - 1) * this.sleep) : 0;\n    var animateTime = (this.repeat * this.duration);\n\n    return Math.min( this.stopTime, this.delay + animateTime + sleepTime - this.offset );\n  },\n  clone: function()\n  {\n    return new Event( this.attribute, this.path, this.duration, this.easing, this.delay, this.sleep, this.offset, this.repeat, this.scale, this.scaleBase, this.parameters, this.hasInitialState, this.builder, this.next ? this.next.clone() : null, this.input );\n  },\n  hasComputed: function()\n  {\n    return this.path.computed;\n  },\n  isInfinite: function()\n  {\n    return !isFinite( this.repeat ) && !isFinite( this.stopTime );\n  },\n  isFinished: function()\n  {\n    return (this.state === EventState.FINISHED);\n  }\n\n});\n\n/**\n * Returns an Event given the attribute, the path, and a parsed options object.\n *\n * **See:** {{#crossLink \"Core/anim8.options:method\"}}anim8.options{{/crossLink}}\n *\n * @method fromOptions\n * @for Event\n * @param  {String} attr\n * @param  {Path} path\n * @param  {Object} options\n * @return {Event}\n */\nEvent.fromOptions = function(attr, path, options)\n{\n  return new Event( attr, path, options.duration, options.easing, options.delay, options.sleep, options.offset, options.repeat, options.scale, options.scaleBase, options.parameters );\n};\n\n\n/**\n * A factory creates Animator instances for subjects.\n *\n * @class Factory\n * @constructor\n */\nfunction Factory()\n{\n  this.priority = 0;\n}\n\nClass.define( Factory,\n{\n\n  /**\n   * Determines whether the given subject is valid for this factory to create Animators for.\n   *\n   * @method is\n   * @param  {Any} subject\n   * @return {Boolean}\n   */\n  is: function(subject)\n  {\n    throw 'Factory.is not implemented';\n  },\n\n  /**\n   * Returns an animator given a subject.\n   *\n   * @method animatorFor\n   * @param  {Any} subject\n   * @return {Animator}\n   */\n  animatorFor: function(subject)\n  {\n    throw 'Factory.animatorFor not implemented';\n  },\n\n  /**\n   * Explodes the given subject to an array of Animators and adds them to the given array.\n   *\n   * @method animatorsFor\n   * @param {Any} subject\n   * @param {Array} animators\n   */\n  animatorsFor: function(subject, animators)\n  {\n    animators.push( this.animatorFor( subject ) );\n  },\n\n  /**\n   * Destroys the animator by unlinking the animator from the subject.\n   *\n   * @method destroy\n   * @param {Animator} animator\n   */\n  destroy: function(animator)\n  {\n\n  },\n\n  /**\n   * Returns the attribute descriptor for the given attribute. An attribute\n   * descriptor is an object with at least the following properties:\n   *\n   * - `name` = the name of the attribute (same as `attr`)\n   * - `calculatorName` = the name of the calculator for the attribute\n   * - `calculator` = the calculator for the attribute\n   * - `defaultValue` = the default value for the attribute\n   * - `parse` = a method to pass a value and have the calculator parse it and\n   *             return the defaultValue if it was invalid\n   * - `cloneDefault` = a method which returns a clone of the default value\n   *\n   * @method attribute\n   * @param {String} attr\n   * @return {Object}\n   */\n  attribute: function(attr)\n  {\n    throw 'Factory.attribute not implemented';\n  }\n\n});\n\n\n/**\n * A FastMap has the key-to-value benefits of a map and iteration benefits of an\n * array. This is especially beneficial when most of the time the contents of\n * the structure need to be iterated and order doesn't matter (since removal\n * performs a swap which breaks insertion order).\n *\n * @param {FastMap|Object} map\n * @class FastMap\n * @constructor\n */\nfunction FastMap(map)\n{\n  this.reset();\n\n  if ( map instanceof FastMap )\n  {\n    this.putMap( map );\n  }\n  else if ( isObject( map ) )\n  {\n    for (var prop in map)\n    {\n      this.put( prop, map[ prop ] );\n    }\n  }\n}\n\nClass.define( FastMap,\n{\n\n  /**\n   * Resets the map by initializing the values, keys, and indexes.\n   *\n   * @method reset\n   * @chainable\n   */\n  reset: function()\n  {\n    /**\n     * An array of the values in this map.\n     *\n     * @property {Array} values\n     */\n    this.values = [];\n\n    /**\n     * An array of the keys in this map.\n     *\n     * @property {Array} keys\n     */\n    this.keys = [];\n\n    /**\n     * An object of key to index mappings.\n     *\n     * @property {Object} indices\n     */\n    this.indices = {};\n\n    return this;\n  },\n\n  /**\n   * Puts the value in the map by the given key.\n   *\n   * @method put\n   * @param {String} key\n   * @param {V} value\n   * @chainable\n   */\n  put: function(key, value)\n  {\n    if ( key in this.indices )\n    {\n      this.values[ this.indices[ key ] ] = value;\n    }\n    else\n    {\n      this.indices[ key ] = this.values.length;\n      this.values.push( value );\n      this.keys.push( key );\n    }\n\n    return this;\n  },\n\n  /**\n   * Changes the given key to another.\n   *\n   * @method rekey\n   * @param {String} fromKey\n   * @param {String} toKey\n   * @chainable\n   */\n  rekey: function(fromKey, toKey)\n  {\n    if ( fromKey in this.indices )\n    {\n      var index = this.indices[ fromKey ];\n      this.keys[ index ] = toKey;\n      this.indices[ toKey ] = index;\n      delete this.indices[ fromKey ];\n    }\n\n    return this;\n  },\n\n  /**\n   * Puts all keys & values on the given map into this map overwriting any existing values mapped by similar keys.\n   *\n   * @method putMap\n   * @param {FastMap} map\n   * @chainable\n   */\n  putMap: function(map)\n  {\n    var keys = map.keys;\n    var values = map.values;\n\n    for (var i = 0; i < keys.length; i++)\n    {\n      this.put( keys[ i ], values[ i ] );\n    }\n\n    return this;\n  },\n\n  /**\n   * Returns the value mapped by the given key.\n   *\n   * @method get\n   * @param {String} key\n   * @return {V}\n   */\n  get: function(key)\n  {\n    return this.values[ this.indices[ key ] ];\n  },\n\n  /**\n   * Removes the value by a given key\n   *\n   * @method remove\n   * @param {String} key\n   * @chainable\n   */\n  remove: function(key)\n  {\n    var index = this.indices[ key ];\n\n    if ( isNumber( index ) )\n    {\n      this.removeAt( index );\n    }\n\n    return this;\n  },\n\n  /**\n   * Removes the value & key at the given index.\n   *\n   * @method removeAt\n   * @param {Number} index\n   * @chainable\n   */\n  removeAt: function(index)\n  {\n    var key = this.keys[ index ];\n    var lastValue = this.values.pop();\n    var lastKey = this.keys.pop();\n\n    if ( index < this.values.length )\n    {\n      this.values[ index ] = lastValue;\n      this.keys[ index ] = lastKey;\n      this.indices[ lastKey ] = index;\n    }\n\n    delete this.indices[ key ];\n\n    return this;\n  },\n\n  /**\n   * Returns the index of the value in the array given a key.\n   *\n   * @method indexOf\n   * @param {String} key\n   * @return {Number}\n   */\n  indexOf: function(key)\n  {\n    return coalesce( this.indices[ key ], -1 );\n  },\n\n  /**\n   * Returns whether this map has a value for the given key.\n   *\n   * @method has\n   * @param {String} key\n   * @return {Boolean}\n   */\n  has: function(key)\n  {\n    return key in this.indices;\n  },\n\n  /**\n   * Returns whether the given input has overlap with keys in this map.\n   *\n   * @method hasOverlap\n   * @param {FastMap|Object} map\n   * @return {Boolean}\n   */\n  hasOverlap: function(map)\n  {\n    var keys = this.keys;\n    var indices = map.indices;\n\n    for (var i = 0; i < keys.length; i++)\n    {\n      if ( keys[i] in indices )\n      {\n        return true;\n      }\n    }\n\n    return false;\n  },\n\n  /**\n   * Returns the number of elements in the map.\n   *\n   * @method size\n   * @return {Number}\n   */\n  size: function()\n  {\n    return this.values.length;\n  },\n\n  /**\n   * Clears all keys & values from the map.\n   *\n   * @method clear\n   * @chainable\n   */\n  clear: function()\n  {\n    this.values.length = 0;\n    this.keys.length = 0;\n    this.indices = {};\n\n    return this;\n  }\n\n});\n\n\n/**\n * Instantiates a new Oncer which extends Attrimator.\n *\n * @param {String} attribute\n * @param {T} value\n * @param {String|Number} delay\n * @param {Boolean} hasInitialState\n * @param {Builder} builder\n * @param {Attrimator} next\n * @class Oncer\n * @constructor\n * @extends Attrimator\n */\nfunction Oncer( attribute, value, delay, hasInitialState, builder, next, input )\n{\n  this.reset( attribute, builder, next );\n\n  /**\n   * The value that's set to the animator once.\n   *\n   * @property {T} value\n   */\n  this.value = value;\n\n  /**\n   * Whether or not this event has an initial value which can be applied at the\n   * start of the animation (or when\n   * {{#crossLink \"Animator/applyInitialState:method\"}}{{/crossLink}} is invoked).\n   *\n   * @property {Boolean} hasInitialState\n   */\n  this.hasInitialState  = coalesce( hasInitialState, true );\n\n  this.delay            = $delay( delay );\n  this.applied          = false;\n  this.input            = input;\n}\n\nClass.extend( Oncer, Attrimator,\n{\n  /**\n   * Computes the value of this Oncer.\n   *\n   * @method getValue\n   * @return {T}\n   */\n  getValue: function()\n  {\n    return isFunction( this.value ) ? this.value() : this.value;\n  },\n\n  finish: function(frame)\n  {\n    var update = !this.applied;\n\n    if ( update )\n    {\n      frame[ this.attribute ] = this.getValue();\n\n      this.applied = true;\n    }\n\n    return update;\n  },\n\n  start: function(now, animator)\n  {\n    this.prestart( now );\n\n    this.value = animator.getAttribute( this.attribute ).parse( this.value );\n\n    if ( isComputed( this.value ) )\n    {\n      this.value = this.value( this, animator );\n    }\n\n    this.applied = false;\n  },\n\n  startCycle: function(frame)\n  {\n    return this.hasInitialState && this.finish( frame );\n  },\n\n  update: function(elapsed, frame)\n  {\n    return elapsed >= this.delay && this.finish( frame );\n  },\n\n  valueAt: function(time, out)\n  {\n    if ( time < this.delay )\n    {\n      return false;\n    }\n\n    return this.getValue();\n  },\n\n  totalTime: function()\n  {\n    return Math.min( this.stopTime, this.delay );\n  },\n\n  clone: function()\n  {\n    return new Oncer( this.attribute, this.value, this.delay, this.hasInitialState, this.builder, this.next ? this.next.clone() : null );\n  },\n\n  hasComputed: function()\n  {\n    return isComputed( this.value );\n  },\n\n  isInfinite: function()\n  {\n    return false;\n  },\n\n  isFinished: function()\n  {\n    return this.applied;\n  }\n  \n});\n\n\n/**\n * Path class computes a value given a delta value [0, 1].\n *\n * @class Path\n * @constructor\n */\nfunction Path()\n{\n}\n\nClass.define( Path,\n{\n\n  /**\n   * Resets the path with the given name, calculator, and points.\n   *\n   * @method reset\n   * @param {String|false} name\n   * @param {anim8.Calculator} calculator\n   * @param {Array} points\n   */\n  reset: function(calculator, points)\n  {\n    this.calculator = $calculator( calculator );\n    this.points = points;\n    this.computed = this.hasComputed();\n    this.deterministic = this.isDeterministic();\n  },\n\n  /**\n   * Computes a value at the given delta setting and returning out.\n   *\n   * @method compute\n   * @param {T} out\n   * @param {Number} delta\n   * @return {T}\n   */\n  compute: function(out, delta)\n  {\n    throw 'Path.compute not implemented';\n  },\n\n  /**\n   * Determines if this path has at least one computed value.\n   *\n   * **See:** {{#crossLink \"anim8.computed\"}}{{/crossLink}}\n   *\n   * @method hasComputed\n   * @return {Boolean}\n   */\n  hasComputed: function()\n  {\n    return this.examinePoints( isComputed, true, false );\n  },\n\n  /**\n   * Determines if this path has at least one computed value.\n   *\n   * **See:** {{#crossLink \"anim8.computed\"}}{{/crossLink}}\n   *\n   * @method isDeterministic\n   * @return {Boolean}\n   */\n  isDeterministic: function()\n  {\n    return this.examinePoints( isFunction, false, true );\n  },\n\n  /**\n   * Examines the points in the path by passing each point to the examiner\n   * function. If the examiner function returns true then `returnOnTrue` true\n   * is returned immediately, otherwise `returnOnFalse` is returned.\n   *\n   * @method examinePoints\n   * @param {Function} examiner\n   * @param {Any} returnOnTrue\n   * @param {Any} returnOnFalse\n   * @return {Any}\n   */\n  examinePoints: function(examiner, returnOnTrue, returnOnFalse)\n  {\n    var ps = this.points;\n\n    for (var i = 0; i < ps.length; i++)\n    {\n      if ( examiner( ps[ i ] ) )\n      {\n        return returnOnTrue;\n      }\n    }\n\n    return returnOnFalse;\n  },\n\n  /**\n   * Replaces any computed values in this path with the result from invoking\n   * the function and returns a clone of this path.\n   *\n   * @method replaceComputed\n   * @return {anim8.Path}\n   */\n  replaceComputed: function(event, animator)\n  {\n    var clone = this.copy();\n    var ps = clone.points;\n\n    for (var i = 0; i < ps.length; i++)\n    {\n      if ( isComputed( ps[i] ) )\n      {\n        ps[i] = ps[i]( event, animator );\n      }\n    }\n\n    return clone;\n  },\n\n  /**\n   * Resolves and returns the point at the given index.\n   *\n   * @method resolvePoint\n   * @param {Number} i\n   * @return {T}\n   */\n  resolvePoint: function(i, dt)\n  {\n    return resolve( this.points[ i ], arguments );\n  },\n\n  /**\n   * Returns whether the path is linear. Linear paths go directly from point to\n   * point where curved paths do not. Linear paths can have their length\n   * calculated fairly easily however curves you must compute length with a\n   * given granularity.\n   *\n   * @method isLinear\n   * @return {Boolean}\n   */\n  isLinear: function()\n  {\n    return true;\n  },\n\n  /**\n   * Computes the length of the Path with a given granularity. Granularity is\n   * used for non-linear paths - it's the number of segments are calculated on\n   * the path where the length of the segments are summed and returned as the\n   * length.\n   *\n   * @method length\n   * @param {Number} granularity\n   * @return {Number}\n   */\n  length: function(granularity)\n  {\n    var distance = 0;\n    var calc = this.calculator;\n\n    if ( this.isLinear() )\n    {\n      var prev = this.resolvePoint( 0, 0 );\n      var n = this.points.length - 1;\n\n      for (var i = 1; i <= n; i++)\n      {\n        var next = this.resolvePoint( i, i / n );\n\n        distance += calc.distance( prev, next );\n\n        prev = next;\n      }\n    }\n    else\n    {\n      var deltadelta = 1.0 / granularity;\n      var delta = deltadelta;\n      var prev = calc.clone( this.resolvePoint( 0, 0 ) );\n      var temp = calc.create();\n\n      for (var i = 1; i <= granularity; i++)\n      {\n        var next = this.compute( temp, delta );\n\n        distance += calc.distance( prev, next );\n        delta += deltadelta;\n\n        temp = prev;\n        prev = next;\n      }\n    }\n\n    return distance;\n  }\n\n});\n\n\n/**\n * Animates a single attribute with a velocity and acceleration.\n *\n * @param {String} attribute\n * @param {Builder} builder\n * @param {Calculator} calculator\n * @param {T} position\n * @param {T} velocity\n * @param {T} acceleration\n * @param {Number} terminal\n * @param {Number} stopTime\n * @class Physics\n * @constructor\n * @extends Attrimator\n */\nfunction Physics( attribute, builder, calculator, position, velocity, acceleration, terminal, stopTime )\n{\n  this.reset( attribute, builder, null );\n\n  this.calculator   = calculator;\n  this.position     = position;\n  this.velocity     = velocity;\n  this.acceleration = acceleration;\n  this.terminal     = $number( terminal, Number.POSITIVE_INFINITY );\n  this.stopTime     = $time( stopTime, Number.POSITIVE_INFINITY );\n  this.finished     = false;\n}\n\nClass.extend( Physics, Attrimator,\n{\n  /**\n   * Parses a value for the animator given a default value.\n   *\n   * @method parseValue\n   * @param {anim8.Animator} animator.\n   * @param {T} value\n   * @param {T} defaultValue\n   * @return {T}\n   */\n  parseValue: function(animator, value, defaultValue)\n  {\n    var parsed = this.calculator.parse( value, defaultValue );\n\n    if ( isComputed( parsed ) )\n    {\n       parsed = parsed( this, animator );\n    }\n\n    return parsed;\n  },\n\n  /**\n   * Resolves the velocity to a value.\n   *\n   * @method resolveVelocity\n   * @return {T}\n   */\n  resolveVelocity: function()\n  {\n    return resolve( this.velocity );\n  },\n\n  /**\n   * Resolves the acceleration to a value.\n   *\n   * @method resolveAcceleration\n   * @return {T}\n   */\n  resolveAcceleration: function()\n  {\n    return resolve( this.acceleration );\n  },\n\n  start: function(now, animator)\n  {\n    this.prestart( now );\n\n    var attribute = animator.getAttribute( this.attribute );\n    var calc = $calculator( coalesce( this.calculator, attribute.calculator ) );\n\n    this.calculator     = calc;\n    this.position       = this.parseValue( animator, this.position, attribute.defaultValue );\n    this.initalPosition = calc.clone( this.position );\n    this.velocity       = this.parseValue( animator, this.velocity, calc.ZERO );\n    this.acceleration   = this.parseValue( animator, this.acceleration, calc.ZERO );\n    this.temp           = calc.create();\n  },\n\n  hasComputed: function()\n  {\n    return isComputed( this.position ) ||\n           isComputed( this.velocity ) ||\n           isComputed( this.acceleration );\n  },\n\n  update: function(elapsed, frame)\n  {\n    var value = this.valueAt( elapsed, this.temp, true );\n\n    if ( value !== false )\n    {\n      frame[ this.attribute ] = this.position = value;\n\n      return true;\n    }\n\n    var calc = this.calculator;\n    var dt = Math.min( (elapsed - this.elapsed) * 0.001, Physics.MAX_DT );\n    var vel = calc.copy( this.temp, this.resolveVelocity() );\n    var acc = this.resolveAcceleration();\n    var pos = this.position;\n\n    vel = calc.adds( vel, acc, dt );\n\n    if ( isFinite( this.terminal ) )\n    {\n      vel = calc.clamp( vel, 0, this.terminal );\n    }\n\n    pos = calc.adds( pos, vel, dt );\n\n    this.position = pos;\n\n    if ( !isFunction( this.velocity ) )\n    {\n      this.velocity = calc.copy( this.velocity, vel );\n    }\n\n    frame[ this.attribute ] = pos;\n\n    return true;\n  },\n\n  valueAt: function(time, out, usePosition)\n  {\n    if ( isFunction( this.velocity ) || isFunction( this.acceleration ) || this.terminal !== Number.POSITIVE_INFINITY )\n    {\n      return false;\n    }\n\n    time -= this.delay;\n    time *= 0.001;\n\n    var calc = this.calculator;\n    var value = usePosition ? calc.copy( this.position, this.initalPosition ) : calc.copy( out, this.initalPosition );\n    value = calc.adds( value, this.velocity, time );\n    value = calc.adds( value, this.acceleration, time * time );\n\n    return value;\n  },\n\n  clone: function()\n  {\n    return new Physics( this.attribute, this.builder, this.calculator, this.position, this.velocity, this.acceleration, this.terminal, this.stopTime );\n  },\n\n  finish: function(frame)\n  {\n    this.finished = true;\n\n    return true;\n  },\n\n  isFinished: function()\n  {\n    return this.finished;\n  }\n\n});\n\n/**\n * The maximum elapsed time that should be used for the spring simulation. If you allow the elapsed time\n * to get to high the spring will overreact and produce undesirable results.\n */\nPhysics.MAX_DT = 0.1;\n\n\n/**\n * Creates a seqeuence for the given animators offseting animations be the given\n * delay and easing.\n *\n * @param {Animators} animators\n * @param {String|Number} delay\n * @param {String|Array|Function} easing\n * @class Sequence\n * @constructor\n */\nfunction Sequence(animators, delay, easing)\n{\n  /**\n   * The animators to play a sequence of animations against.\n   *\n   * @property {Animators} animators\n   */\n  this.animators = animators;\n\n  /**\n   * The delay in milliseconds between animations.\n   *\n   * @property {Number} delay\n   */\n  this.delay = $delay( delay );\n\n  /**\n   * The easing function to use to calculate the delay offset for an animation.\n   *\n   * @property {Function} easing\n   */\n  this.easing = $easing( easing );\n}\n\nClass.define( Sequence,\n{\n  /**\n   * Returns the maximum delay for delaying generated attrimators.\n   *\n   * @method maxDelay\n   * @return {Number}\n   */\n  maxDelay: function()\n  {\n    return this.delay * (this.animators.length() - 1);\n  },\n\n  /**\n   * Creates an AttrimatorMap with the given options for the animator at the\n   * given index.\n   *\n   * @method createAttrimators\n   * @param {Animation} animation\n   * @param {Object} options\n   * @param {Number} i\n   * @return {AttrimatorMap}\n   */\n  createAttrimators: function(template, i)\n  {\n    var attrimatorMap = template.clone();\n    var attrimators = attrimatorMap.values;\n    var delta = i / (this.animators.length() - 1);\n    var delayOffset = this.easing( delta ) * this.maxDelay();\n\n    for (var k = attrimators.length - 1; k >= 0; k--)\n    {\n      attrimators[ k ].delay += delayOffset;\n    }\n\n    return attrimatorMap;\n  },\n\n  /**\n   * Reverses the sequence by reversing the underlying array of animators.\n   *\n   * @method reverse\n   * @chainable\n   */\n  reverse: function()\n  {\n    this.animators.reverse();\n\n    return this;\n  },\n\n  /**\n   * Plays the animation across the animators in this sequence.\n   *\n   * **See:** {{#crossLink \"Core/anim8.animation:method\"}}{{/crossLink}},\n   *          {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}},\n   *          {{#crossLink \"Animator/play:method\"}}Animator.play{{/crossLink}}\n   *\n   * @method play\n   * @param {Animation|String|Object} animation\n   * @param {String|Array|Object} [options]\n   * @param {Boolean} [all=false]\n   * @param {Boolean} [cache=false]\n   * @chainable\n   */\n  play: function(animation, options, all, cache)\n  {\n    var template = $attrimatorsFor( animation, options, cache, this );\n    var sequence = this;\n\n    this.animators.each(function(animator, i)\n    {\n      var attrimators = sequence.createAttrimators( template, i );\n\n      animator.newCycle( attrimators );\n      animator.playAttrimators( attrimators, all );\n    });\n\n    return this.add();\n  },\n\n  /**\n   * Queues the animation across the animators in this sequence.\n   *\n   * **See:** {{#crossLink \"Core/anim8.animation:method\"}}{{/crossLink}},\n   *          {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}},\n   *          {{#crossLink \"Animator/queue:method\"}}Animator.queue{{/crossLink}}\n   *\n   * @method queue\n   * @param {Animation|String|Object} animation\n   * @param {String|Array|Object} [options]\n   * @param {Boolean} [cache=false]\n   * @chainable\n   */\n  queue: function(animation, options, cache)\n  {\n    var template = $attrimatorsFor( animation, options, cache, this );\n    var sequence = this;\n    var maxRemaining = 0;\n    var remaining = [];\n\n    this.animators.each(function(animator, i)\n    {\n      remaining[i] = animator.timeRemaining();\n      maxRemaining = Math.max( maxRemaining, remaining[i] );\n    });\n\n    this.animators.each(function(animator, i)\n    {\n      var delayOffset = maxRemaining - remaining[i];\n      var attrimatorMap = sequence.createAttrimators( template, i );\n      var attrimators = attrimatorMap.values;\n\n      for (var k = attrimators.length - 1; k >= 0; k--)\n      {\n        attrimators[ k ].delay += delayOffset;\n      }\n\n      animator.newCycle( attrimatorMap );\n      animator.queueAttrimators( attrimatorMap );\n    });\n\n    return this.add();\n  },\n\n  /**\n   * Inserts the animation across the animators in this sequence.\n   *\n   * **See:** {{#crossLink \"Core/anim8.animation:method\"}}{{/crossLink}},\n   *          {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}},\n   *          {{#crossLink \"Animator/insert:method\"}}Animator.insert{{/crossLink}}\n   *\n   * @method insert\n   * @param {Animation|String|Object} animation\n   * @param {String|Array|Object} [options]\n   * @param {Boolean} [cache=false]\n   * @chainable\n   */\n  insert: function(animation, options, cache)\n  {\n    var template = $attrimatorsFor( animation, options, cache, this );\n    var sequence = this;\n\n    this.animators.each(function(animator, i)\n    {\n      var attrimators = sequence.createAttrimators( template, i );\n\n      animator.newCycle( attrimators );\n      animator.insertAttrimators( attrimators );\n    });\n\n    return this.add();\n  },\n\n  /**\n   * Transitions into the animation across the animators in this sequence.\n   *\n   * **See:** {{#crossLink \"Core/anim8.transition:method\"}}{{/crossLink}},\n   *          {{#crossLink \"Core/anim8.animation:method\"}}{{/crossLink}},\n   *          {{#crossLink \"Core/anim8.options:method\"}}{{/crossLink}},\n   *          {{#crossLink \"Animator/transition:method\"}}Animator.transition{{/crossLink}}\n   *\n   * @method transition\n   * @param {String|Array|Object} transition\n   * @param {Animation|String|Object} animation\n   * @param {String|Array|Object} [options]\n   * @param {Boolean} [all=false]\n   * @param {Boolean} [cache=false]\n   * @chainable\n   */\n  transition: function(transition, animation, options, all, cache)\n  {\n    var transition = $transition( transition );\n    var template = $attrimatorsFor( animation, options, cache, this );\n    var sequence = this;\n\n    this.animators.each(function(animator, i)\n    {\n      var attrimators = sequence.createAttrimators( template, i );\n\n      animator.newCycle( attrimators );\n      animator.transitionAttrimators( transition, attrimators, all );\n    });\n\n    return this.add();\n  },\n\n  /**\n   * Activates all animators in this sequence and returns this.\n   *\n   * **See:** {{#crossLink \"Animator/activate:method\"}}Animator.activate{{/crossLink}}\n   *\n   * @method add\n   * @chainable\n   */\n  add: function()\n  {\n    this.animators.activate();\n\n    return this;\n  }\n\n});\n\n\n/**\n * A spring has a resting point, a current position, and the velocity currently\n * enacting on the position based on the implementing classes logic.\n *\n * @class Spring\n * @constructor\n * @extends Attrimator\n */\nfunction Spring()\n{\n}\n\nClass.extend( Spring, Attrimator,\n{\n\n  /**\n   * Resets the spring's properties.\n   *\n   * @method set\n   * @param {String} attribute\n   * @param {Calculator|String} calculator\n   * @param {T|Function|true} rest\n   * @param {T|Function|true} position\n   * @param {T|Function|true} velocity\n   * @param {T|Function|true} gravity\n   * @param {Boolean} finishOnRest\n   */\n  set: function(attribute, calculator, rest, position, velocity, gravity, finishOnRest)\n  {\n    this.reset( attribute, null, null );\n\n    this.calculator   = calculator;\n    this.rest         = rest;\n    this.position     = position;\n    this.gravity      = gravity;\n    this.velocity     = velocity;\n    this.finishOnRest = finishOnRest;\n  },\n\n  /**\n   * Resolves the rest to the expected format.\n   *\n   * @method resolveRest\n   * @return {T}\n   */\n  resolveRest: function()\n  {\n    return resolve( this.rest );\n  },\n\n  /**\n   * Method that's invoked on each spring update.\n   *\n   * @method updateVelocity\n   * @param {Number} dt\n   */\n  updateVelocity: function(dt)\n  {\n    throw 'Spring.updateVelocity not implemented';\n  },\n\n  start: function(now, animator)\n  {\n    this.prestart( now );\n\n    var attribute = animator.getAttribute( this.attribute );\n    var calc = $calculator( coalesce( this.calculator, attribute.calculator ) );\n\n    this.calculator = calc;\n    this.rest       = this.parseValue( animator, this.rest, attribute.defaultValue );\n    this.position   = this.parseValue( animator, this.position, attribute.defaultValue );\n    this.gravity    = this.parseValue( animator, this.gravity, calc.ZERO );\n    this.velocity   = this.parseValue( animator, this.velocity, calc.ZERO );\n  },\n\n  hasComputed: function()\n  {\n    return isComputed( this.rest ) ||\n           isComputed( this.position ) ||\n           isComputed( this.gravity ) ||\n           isComputed( this.velocity );\n  },\n\n  update: function(elapsed, frame)\n  {\n    var calc = this.calculator;\n\n    // the number of elapsed seconds (maxed to avoid crazy behavior with low FPS)\n    var dt = Math.min( (elapsed - this.elapsed) * 0.001, Spring.MAX_DT );\n\n    // keep track of the starting position to determine whether the position has updated.\n    var starting = calc.clone( this.position );\n\n    // call the update method which should update the position\n    this.updateVelocity( dt );\n    this.velocity = calc.adds( this.velocity, this.gravity, dt );\n    this.position = calc.adds( this.position, this.velocity, dt );\n\n    // track whether the attribute has updated so the animator knows if it needs to apply the attribute to the subject.\n    var updated = !calc.isEqual( starting, this.position, Spring.EPSILON );\n\n    if ( updated )\n    {\n      frame[ this.attribute ] = this.position;\n    }\n    else if ( this.finishOnRest && calc.isZero( this.velocity ) )\n    {\n      this.finished = true;\n    }\n\n    return updated;\n  },\n\n  finish: function(frame)\n  {\n    this.finished = true;\n\n    return true;\n  },\n\n  isFinished: function()\n  {\n    return this.finished;\n  }\n});\n\n/**\n * The maximum elapsed time that should be used for the spring simulation. If you allow the elapsed time\n * to get to high the spring will overreact and produce undesirable results.\n */\nSpring.MAX_DT = 0.1;\n\n/**\n * The value used to determine whether two positions in a spring are different.\n */\nSpring.EPSILON = 0.0001;\n\n\n/**\n * @module anim8\n * @class Core\n */\n\n/**\n * Converts a subject into an animator and returns it. If the subject\n * is already an animator it's returned immediately. If the subject can't be\n * animated then false is returned.\n *\n * **See:** {{#crossLink \"Core/anim8.factoryFor:method\"}}{{/crossLink}}\n *\n * @param {Any} subject\n * @return {Animator|false}\n * @method anim8\n */\nfunction anim8(subject)\n{\n  if ( subject instanceof Animator )\n  {\n    return subject;\n  }\n\n  var factory = $factoryFor( subject, true );\n\n  if ( factory === false )\n  {\n    return false;\n  }\n\n  return factory.animatorFor( subject );\n}\n\n/**\n * Add events to the animation cycle: begin, end, finished, starting\n */\neventize( anim8 );\n\n/**\n * Converts an array of subjects into an array of Animators.\n *\n * @param {Array} subject\n * @return {Animators}\n * @method anim8s\n */\nfunction anim8s(subjects)\n{\n  var factory = $factoryFor( subjects, true );\n  var animators = [];\n\n  if ( factory !== false )\n  {\n    factory.animatorsFor( subjects, animators );\n\n    return new Animators( animators );\n  }\n\n  if ( !isArray( subjects ) )\n  {\n    subjects = [ subjects ];\n  }\n\n  var animators = [];\n\n  for (var i = 0; i < subjects.length; i++)\n  {\n    var animator = anim8( subjects[i] );\n\n    if ( animator !== false )\n    {\n      animators.push( animator );\n    }\n  }\n\n  return new Animators( animators );\n}\n\n/**\n * Whether the animation cycle is currently running. This is true\n * when where are active animators and anim8.run is being called\n * and false otherwise.\n *\n * @property {Boolean} anim8.running\n * @readOnly\n */\nvar running = false;\n\n/**\n * Live Mode keeps the animation cycles running even when there aren't\n * Animators. For highly interactive applications enabling this may\n * take up more resources but it will result in smoother animations. When\n * the animation cycle goes from stopped to running it takes a few frames\n * to smooth out when this is false.\n *\n * @property {Boolean} anim8.live\n */\nvar live = false;\n\n/**\n * The anim8 instance for all active animators.\n *\n * @property {Animators} anim8.animating\n * @readOnly\n */\nvar animating = new Animators();\n\n\nfunction isRunning()\n{\n  return running;\n}\n\nfunction isLive()\n{\n  return live;\n}\n\nfunction setLive(newLive)\n{\n  live = newLive;\n}\n\n/**\n * Adds an animator to the list of animating if it isn't there already. If the\n * animation loop isn't currently running it's started.\n *\n * @method anim8.add\n * @param {Animator} animator\n */\nfunction activateAnimator(animator)\n{\n  pushAnimator( animator );\n\n  activate();\n}\n\nfunction pushAnimator(animator)\n{\n  if ( !animator.active )\n  {\n    animator.active = true;\n    animating.push( animator );\n  }\n}\n\nfunction activate()\n{\n  if ( !running )\n  {\n    running = true;\n\n    anim8.trigger('starting');\n\n    requestRun( run );\n  }\n}\n\n/**\n * The function to call if animations need to be done.\n *\n * @method anim8.requestRun\n * @param {Function} callback\n */\nvar requestRun = (function()\n{\n  var vendors = ['ms', 'moz', 'webkit', 'o'];\n  var requestor = this.requestAnimationFrame || global.requestAnimationFrame;\n  var setTimeout = this.setTimeout || global.setTimeout || setTimeout;\n\n  for (var x = 0; x < vendors.length && !requestor; ++x)\n  {\n    requestor = global[ vendors[x] + 'RequestAnimationFrame' ];\n  }\n\n  if (!requestor)\n  {\n    var lastTime = 0;\n\n    return function(callback)\n    {\n      var currentTime = now();\n      var timeToCall = Math.max( Defaults.pauseTime, Defaults.frameRate - (currentTime - lastTime) );\n      var id = setTimeout( function() { callback( currentTime + timeToCall ); }, timeToCall );\n      lastTime = currentTime + timeToCall;\n      return id;\n    };\n  }\n\n  return function(callback)\n  {\n    requestor( callback );\n  };\n\n})();\n\n/**\n * Executes an animation loop cycle which consists of four operations:\n *\n * 1. Call preupdate on all Animators\n * 2. Call update on all Animators\n * 3. Call apply on all Animators\n * 4. Remove finished Animators\n *\n * When there are no more animating the loop cycle is stopped.\n *\n * @method anim8.run\n */\nfunction run()\n{\n  anim8.trigger('begin');\n\n  var currentTime = now();\n  var active = animating.length();\n\n  // notify animators that we're about to update\n  animating.preupdate( currentTime, active );\n\n  // update animating based on the current time\n  animating.update( currentTime, active );\n\n  // apply the attributes calculated\n  animating.apply( active );\n\n  // if the animator is done remove it\n  animating.filter( animating.handleFinished );\n\n  // The loop has ended!\n  anim8.trigger('end');\n\n  // if there are animators still remaining call me again!\n  if ( animating.length() || live )\n  {\n    requestRun( run );\n  }\n  else\n  {\n    running = false;\n\n    anim8.trigger('finished');\n  }\n}\n\n/**\n * Pauses all animators.\n *\n * **See:** {{#crossLink \"Animator/pause:method\"}}{{/crossLink}}\n *\n * @method anim8.pause\n * @param {String|Array} attributes\n * @return {anim8}\n */\nfunction pause(attributes)\n{\n  animating.pause( attributes );\n\n  return anim8;\n}\n\n/**\n * Resumes all animators.\n *\n * **See:** {{#crossLink \"Animator/resume:method\"}}{{/crossLink}}\n *\n * @method anim8.resume\n * @param {String|Array} attributes\n * @return {anim8}\n */\nfunction resume(attributes)\n{\n  animating.resume( attributes );\n\n  return anim8;\n}\n\n/**\n * Stops all animators.\n *\n * **See:** {{#crossLink \"Animator/stop:method\"}}{{/crossLink}}\n *\n * @method anim8.stop\n * @param {String|Array} attributes\n * @return {anim8}\n */\nfunction stop(attributes)\n{\n  animating.stop( attributes );\n\n  return anim8;\n}\n\n/**\n * Ends all animators.\n *\n * **See:** {{#crossLink \"Animator/end:method\"}}{{/crossLink}}\n *\n * @method anim8.end\n * @param {String|Array} attributes\n * @return {anim8}\n */\nfunction end(attributes)\n{\n  animating.end( attributes );\n\n  return anim8;\n}\n\n/**\n * Finishes all animators.\n *\n * **See:** {{#crossLink \"Animator/finish:method\"}}{{/crossLink}}\n *\n * @method anim8.finish\n * @param {String|Array} attributes\n * @return {anim8}\n */\nfunction finish(attributes)\n{\n  animating.finish( attributes );\n\n  return anim8;\n}\n\n/**\n * Interrupts all animators from repeating currently running animations.\n *\n * **See:** {{#crossLink \"Animator/nopeat:method\"}}{{/crossLink}}\n *\n * @method anim8.nopeat\n * @param {String|Array} attributes\n * @return {anim8}\n */\nfunction nopeat(attributes)\n{\n  animating.nopeat( attributes );\n\n  return anim8;\n}\n\n\n/**\n * Instantiates a new color given red, green, blue, and white components.\n * If a component is missed it's default value is either 255 (white) or\n * 1.0 (opaque).\n *\n * @method anim8.color\n * @for Core\n * @param {Number} [r=255]\n * @param {Number} [g=255]\n * @param {Number} [b=255]\n * @param {Number} [a=1]\n * @return {Object}\n */\nfunction Color(r, g, b, a)\n{\n  return {\n    r: coalesce( r, 255 ),\n    g: coalesce( g, 255 ),\n    b: coalesce( b, 255 ),\n    a: coalesce( a, 1.0 )\n  };\n}\n\n/**\n * The array of parsing methods to execute sequentally until a color is returned.\n */\nColor.parsers =\n[\n  { /* already parsed color */\n    parse: function(input) {\n      if (typeof input === 'object') {\n        var color = {\n          r: this.parseComponent(input.r, parseInt, 255),\n          g: this.parseComponent(input.g, parseInt, 255),\n          b: this.parseComponent(input.b, parseInt, 255),\n          a: this.parseComponent(input.a, parseFloat, 1.0)\n        };\n        return color;\n      }\n      return false;\n    },\n    parseComponent: function(c, parseFunction, max) {\n      var t = typeof c;\n      var v = max;\n      if (t === 'string') {\n        var vparsed = parseFunction(t, 10);\n        if (!isNaN(vparsed)) {\n          v = vparsed;\n        }\n      }\n      else if (t === 'number') {\n        v = c;\n      }\n      if (v > max) {\n        v = max;\n      }\n      if (v < 0) {\n        v = 0;\n      }\n      return v;\n    }\n  },\n  { /* colorname */\n    names: {\n      transparent:{r:255,g:255,b:255,a:0.0},\n      aliceblue:{r:240,g:248,b:255,a:1.0},\n      antiquewhite:{r:250,g:235,b:215,a:1.0},\n      aqua:{r:0,g:255,b:255,a:1.0},\n      aquamarine:{r:127,g:255,b:212,a:1.0},\n      azure:{r:240,g:255,b:255,a:1.0},\n      beige:{r:245,g:245,b:220,a:1.0},\n      bisque:{r:255,g:228,b:196,a:1.0},\n      black:{r:0,g:0,b:0,a:1.0},\n      blanchedalmond:{r:255,g:235,b:205,a:1.0},\n      blue:{r:0,g:0,b:255,a:1.0},\n      blueviolet:{r:138,g:43,b:226,a:1.0},\n      brown:{r:165,g:42,b:42,a:1.0},\n      burlywood:{r:222,g:184,b:135,a:1.0},\n      cadetblue:{r:95,g:158,b:160,a:1.0},\n      chartreuse:{r:127,g:255,b:0,a:1.0},\n      chocolate:{r:210,g:105,b:30,a:1.0},\n      coral:{r:255,g:127,b:80,a:1.0},\n      cornflowerblue:{r:100,g:149,b:237,a:1.0},\n      cornsilk:{r:255,g:248,b:220,a:1.0},\n      crimson:{r:220,g:20,b:60,a:1.0},\n      cyan:{r:0,g:255,b:255,a:1.0},\n      darkblue:{r:0,g:0,b:139,a:1.0},\n      darkcyan:{r:0,g:139,b:139,a:1.0},\n      darkgoldenrod:{r:184,g:134,b:11,a:1.0},\n      darkgray:{r:169,g:169,b:169,a:1.0},\n      darkgreen:{r:0,g:100,b:0,a:1.0},\n      darkkhaki:{r:189,g:183,b:107,a:1.0},\n      darkmagenta:{r:139,g:0,b:139,a:1.0},\n      darkolivegreen:{r:85,g:107,b:47,a:1.0},\n      darkorange:{r:255,g:140,b:0,a:1.0},\n      darkorchid:{r:153,g:50,b:204,a:1.0},\n      darkred:{r:139,g:0,b:0,a:1.0},\n      darksalmon:{r:233,g:150,b:122,a:1.0},\n      darkseagreen:{r:143,g:188,b:143,a:1.0},\n      darkslateblue:{r:72,g:61,b:139,a:1.0},\n      darkslategray:{r:47,g:79,b:79,a:1.0},\n      darkturquoise:{r:0,g:206,b:209,a:1.0},\n      darkviolet:{r:148,g:0,b:211,a:1.0},\n      deeppink:{r:255,g:20,b:147,a:1.0},\n      deepskyblue:{r:0,g:191,b:255,a:1.0},\n      dimgray:{r:105,g:105,b:105,a:1.0},\n      dodgerblue:{r:30,g:144,b:255,a:1.0},\n      feldspar:{r:209,g:146,b:117,a:1.0},\n      firebrick:{r:178,g:34,b:34,a:1.0},\n      floralwhite:{r:255,g:250,b:240,a:1.0},\n      forestgreen:{r:34,g:139,b:34,a:1.0},\n      fuchsia:{r:255,g:0,b:255,a:1.0},\n      gainsboro:{r:220,g:220,b:220,a:1.0},\n      ghostwhite:{r:248,g:248,b:255,a:1.0},\n      gold:{r:255,g:215,b:0,a:1.0},\n      goldenrod:{r:218,g:165,b:32,a:1.0},\n      gray:{r:128,g:128,b:128,a:1.0},\n      green:{r:0,g:128,b:0,a:1.0},\n      greenyellow:{r:173,g:255,b:47,a:1.0},\n      honeydew:{r:240,g:255,b:240,a:1.0},\n      hotpink:{r:255,g:105,b:180,a:1.0},\n      indianred:{r:205,g:92,b:92,a:1.0},\n      indigo:{r:75,g:0,b:130,a:1.0},\n      ivory:{r:255,g:255,b:240,a:1.0},\n      khaki:{r:240,g:230,b:140,a:1.0},\n      lavender:{r:230,g:230,b:250,a:1.0},\n      lavenderblush:{r:255,g:240,b:245,a:1.0},\n      lawngreen:{r:124,g:252,b:0,a:1.0},\n      lemonchiffon:{r:255,g:250,b:205,a:1.0},\n      lightblue:{r:173,g:216,b:230,a:1.0},\n      lightcoral:{r:240,g:128,b:128,a:1.0},\n      lightcyan:{r:224,g:255,b:255,a:1.0},\n      lightgoldenrodyellow:{r:250,g:250,b:210,a:1.0},\n      lightgrey:{r:211,g:211,b:211,a:1.0},\n      lightgreen:{r:144,g:238,b:144,a:1.0},\n      lightpink:{r:255,g:182,b:193,a:1.0},\n      lightsalmon:{r:255,g:160,b:122,a:1.0},\n      lightseagreen:{r:32,g:178,b:170,a:1.0},\n      lightskyblue:{r:135,g:206,b:250,a:1.0},\n      lightslateblue:{r:132,g:112,b:255,a:1.0},\n      lightslategray:{r:119,g:136,b:153,a:1.0},\n      lightsteelblue:{r:176,g:196,b:222,a:1.0},\n      lightyellow:{r:255,g:255,b:224,a:1.0},\n      lime:{r:0,g:255,b:0,a:1.0},\n      limegreen:{r:50,g:205,b:50,a:1.0},\n      linen:{r:250,g:240,b:230,a:1.0},\n      magenta:{r:255,g:0,b:255,a:1.0},\n      maroon:{r:128,g:0,b:0,a:1.0},\n      mediumaquamarine:{r:102,g:205,b:170,a:1.0},\n      mediumblue:{r:0,g:0,b:205,a:1.0},\n      mediumorchid:{r:186,g:85,b:211,a:1.0},\n      mediumpurple:{r:147,g:112,b:216,a:1.0},\n      mediumseagreen:{r:60,g:179,b:113,a:1.0},\n      mediumslateblue:{r:123,g:104,b:238,a:1.0},\n      mediumspringgreen:{r:0,g:250,b:154,a:1.0},\n      mediumturquoise:{r:72,g:209,b:204,a:1.0},\n      mediumvioletred:{r:199,g:21,b:133,a:1.0},\n      midnightblue:{r:25,g:25,b:112,a:1.0},\n      mintcream:{r:245,g:255,b:250,a:1.0},\n      mistyrose:{r:255,g:228,b:225,a:1.0},\n      moccasin:{r:255,g:228,b:181,a:1.0},\n      navajowhite:{r:255,g:222,b:173,a:1.0},\n      navy:{r:0,g:0,b:128,a:1.0},\n      oldlace:{r:253,g:245,b:230,a:1.0},\n      olive:{r:128,g:128,b:0,a:1.0},\n      olivedrab:{r:107,g:142,b:35,a:1.0},\n      orange:{r:255,g:165,b:0,a:1.0},\n      orangered:{r:255,g:69,b:0,a:1.0},\n      orchid:{r:218,g:112,b:214,a:1.0},\n      palegoldenrod:{r:238,g:232,b:170,a:1.0},\n      palegreen:{r:152,g:251,b:152,a:1.0},\n      paleturquoise:{r:175,g:238,b:238,a:1.0},\n      palevioletred:{r:216,g:112,b:147,a:1.0},\n      papayawhip:{r:255,g:239,b:213,a:1.0},\n      peachpuff:{r:255,g:218,b:185,a:1.0},\n      peru:{r:205,g:133,b:63,a:1.0},\n      pink:{r:255,g:192,b:203,a:1.0},\n      plum:{r:221,g:160,b:221,a:1.0},\n      powderblue:{r:176,g:224,b:230,a:1.0},\n      purple:{r:128,g:0,b:128,a:1.0},\n      red:{r:255,g:0,b:0,a:1.0},\n      rosybrown:{r:188,g:143,b:143,a:1.0},\n      royalblue:{r:65,g:105,b:225,a:1.0},\n      saddlebrown:{r:139,g:69,b:19,a:1.0},\n      salmon:{r:250,g:128,b:114,a:1.0},\n      sandybrown:{r:244,g:164,b:96,a:1.0},\n      seagreen:{r:46,g:139,b:87,a:1.0},\n      seashell:{r:255,g:245,b:238,a:1.0},\n      sienna:{r:160,g:82,b:45,a:1.0},\n      silver:{r:192,g:192,b:192,a:1.0},\n      skyblue:{r:135,g:206,b:235,a:1.0},\n      slateblue:{r:106,g:90,b:205,a:1.0},\n      slategray:{r:112,g:128,b:144,a:1.0},\n      snow:{r:255,g:250,b:250,a:1.0},\n      springgreen:{r:0,g:255,b:127,a:1.0},\n      steelblue:{r:70,g:130,b:180,a:1.0},\n      tan:{r:210,g:180,b:140,a:1.0},\n      teal:{r:0,g:128,b:128,a:1.0},\n      thistle:{r:216,g:191,b:216,a:1.0},\n      tomato:{r:255,g:99,b:71,a:1.0},\n      turquoise:{r:64,g:224,b:208,a:1.0},\n      violet:{r:238,g:130,b:238,a:1.0},\n      violetred:{r:208,g:32,b:144,a:1.0},\n      wheat:{r:245,g:222,b:179,a:1.0},\n      white:{r:255,g:255,b:255,a:1.0},\n      whitesmoke:{r:245,g:245,b:245,a:1.0},\n      yellow:{r:255,g:255,b:0,a:1.0},\n      yellowgreen:{r:154,g:205,b:50,a:1.0}\n    },\n    parse: function(input) {\n      if (typeof input === 'string') {\n        input = input.toLowerCase();\n        if (input in this.names) {\n          var named = this.names[input];\n          return {\n            r: named.r,\n            g: named.g,\n            b: named.b,\n            a: named.a\n          };\n        }\n      }\n      return false;\n    }\n  },\n  { /* #rgb */\n    regex: /^#?([0-9A-F])([0-9A-F])([0-9A-F])$/i,\n    parse: function(input) {\n      var matches = this.regex.exec(input);\n      if (matches !== null) {\n        return {\n          r: parseInt(matches[1] + matches[1], 16),\n          g: parseInt(matches[2] + matches[2], 16),\n          b: parseInt(matches[3] + matches[3], 16),\n          a: 1.0\n        };\n      }\n      return false;\n    }\n  },\n  { /* #rrggbb */\n    regex: /^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,\n    parse: function(input) {\n      var matches = this.regex.exec(input);\n      if (matches !== null) {\n        return {\n          r: parseInt(matches[1], 16),\n          g: parseInt(matches[2], 16),\n          b: parseInt(matches[3], 16),\n          a: 1.0\n        };\n      }\n      return false;\n    }\n  },\n  { /* RGB(r,g,b) */\n    regex: /^rgb\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*\\)$/i,\n    parse: function(input) {\n      var matches = this.regex.exec(input);\n      if (matches !== null) {\n        return {\n          r: Math.min(255, parseInt(matches[1], 10)),\n          g: Math.min(255, parseInt(matches[2], 10)),\n          b: Math.min(255, parseInt(matches[3], 10)),\n          a: 1.0\n        };\n      }\n      return false;\n    }\n  },\n  { /* RGBA(r,g,b,a) */\n    regex: /^rgba\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*([01]?\\.\\d+|[01])\\)$/i,\n    parse: function(input) {\n      var matches = this.regex.exec(input);\n      if (matches !== null) {\n        return {\n          r: Math.min(255, parseInt(matches[1], 10)),\n          g: Math.min(255, parseInt(matches[2], 10)),\n          b: Math.min(255, parseInt(matches[3], 10)),\n          a: Math.min(1.0, parseFloat(matches[4]))\n        };\n      }\n      return false;\n    }\n  }\n];\n\n/**\n * Parses a color from a string.\n *\n * @method anim8.color.parse\n * @for Core\n * @param {String} input\n * @return {Object|False}\n */\nColor.parse = function(input)\n{\n  var cp = Color.parsers;\n\n  for (var i = 0; i < cp.length; i++)\n  {\n    var parsed = cp[ i ].parse( input );\n\n    if (parsed !== false)\n    {\n      return parsed;\n    }\n  }\n\n  return false;\n};\n\n/**\n * Formats a color to a string.\n *\n * @method anim8.color.format\n * @for Core\n * @param {Object} color\n * @return {String}\n */\nColor.format = function(color)\n{\n  var ca = clamp( coalesce( color.a, 1.0 ), 0, 1 );\n  var cr = Math.floor( clamp( coalesce( color.r, 255 ), 0, 255 ) );\n  var cg = Math.floor( clamp( coalesce( color.g, 255 ), 0, 255 ) );\n  var cb = Math.floor( clamp( coalesce( color.b, 255 ), 0, 255 ) );\n\n  if (ca === 1.0)\n  {\n    var r = cr.toString( 16 );\n    var g = cg.toString( 16 );\n    var b = cb.toString( 16 );\n\n    if (r.length === 1) {\n      r = '0' + r;\n    }\n    if (g.length === 1) {\n      g = '0' + g;\n    }\n    if (b.length === 1) {\n      b = '0' + b;\n    }\n\n    return '#' + r + g + b;\n  }\n  else\n  {\n    return 'rgba(' + cr + ',' + cg + ',' + cb + ',' + ca + ')';\n  }\n};\n\n\n\n/**\n * A collection of computed functions. Computed functions are functions that\n * are invoked once at the start of an animation given the\n * {{#crossLink \"Attrimator\"}}{{/crossLink}} and\n * {{#crossLink \"Animator\"}}{{/crossLink}} and the result replaces the function.\n *\n * **See:** {{#crossLink \"anim8.computed/current:method\"}}{{/crossLink}},\n *          {{#crossLink \"anim8.computed/relative:method\"}}{{/crossLink}},\n *          {{#crossLink \"anim8.computed/random:method\"}}{{/crossLink}}\n *\n * @class anim8.computed\n */\nfunction computed(funcOrName, func)\n{\n  if ( isString( funcOrName ) && isFunction( func ) )\n  {\n    func.computed = true;\n\n    computed[ funcOrName ] = func;\n\n    return func;\n  }\n  else if ( isFunction( funcOrName ) )\n  {\n    funcOrName.computed = true;\n\n    return funcOrName;\n  }\n\n  throw funcOrName + ' and ' + func + ' are not valid parameters for creating a computed function.';\n}\n\n/**\n * Calculates and returns the current value for an\n * {{#crossLink \"Animator\"}}{{/crossLink}}. If the animator doesn't have a\n * current value the default value for the attribute is returned.\n *\n * @method current\n * @param {Attrimator} attrimator\n * @param {Animator} animator\n * @return {T}\n */\ncomputed('current', function(attrimator, animator)\n{\n  var attr = attrimator.attribute;\n  var attribute = animator.getAttribute( attr );\n\n  if ( attr in animator.frame )\n  {\n    return attribute.calculator.clone( animator.frame[ attr ] );\n  }\n  else\n  {\n    return attribute.cloneDefault();\n  }\n});\n\n/**\n * Calculates a value relative to the attribute value currently in the animator.\n * A mask can be used for mixed relative & absolute values in a single value\n * where 1 makes it relative and 0 makes it absolute.\n *\n * **Examples:**\n *\n *     anim8.computed.relative( 40 ); // returns function which adds 40 to current value\n *     anim8.computed.relative( 40, 0.5 ); // returns function which adds 40 to half of the current value\n *     anim8.computed.relative( {x: 20, y: 10}, {x: 1, y: 0} ); // returns function which adds 20 to the x of the current value and sets the y of the current value to 10\n *\n * @method relative\n * @param {T} relativeAmount\n * @param {T} mask\n * @return {Function}\n */\ncomputed('relative', function(relativeAmount, mask)\n{\n  // If the relativeAmount is already a computed value, return it.\n  if ( isComputed( relativeAmount ) )\n  {\n    return relativeAmount;\n  }\n\n  var relativeFunction = function(attrimator, animator)\n  {\n    var attr = attrimator.attribute;\n    var attribute = animator.getAttribute( attr );\n    var calc = attribute.calculator;\n    var current = null;\n\n    if ( attr in animator.frame )\n    {\n      current = calc.clone( animator.frame[ attr ] );\n    }\n    else\n    {\n      current = attribute.cloneDefault();\n    }\n\n    if ( mask )\n    {\n      current = calc.mul( current, mask );\n    }\n\n    return calc.add( current, relativeAmount );\n  };\n\n  // Marks the function as computed which is a signal to paths & events.\n  relativeFunction.computed = true;\n\n  // Place the input on the function if the user wants to modify it live\n  relativeFunction.relativeAmount = relativeAmount;\n  relativeFunction.mask = mask;\n\n  return relativeFunction;\n});\n\nfunction isRelative(x)\n{\n  return isString( x ) && /^[+-]\\d*\\.?\\d+$/.test( x );\n}\n\n/**\n * Returns a random value based on the given random selection.\n *\n * 1. If an array is given an item is randomly chosen from that array.\n * 2. If an instance of {{#crossLink \"Path\"}}{{/crossLink}} is given a point is randomly computed and returned.\n * 3. If an object with min & max values is given a random value between them is returned.\n *\n * **Examples:**\n *\n *     anim8.computed.random( [1, 2, 3] ); // returns function which returns a 1, 2, or 3\n *     anim8.computed.random( {min: 1, max: 5} ); // returns function which returns a value between 1 and 5\n *     anim8.computed.random( {min: {x: 0, y: 0}, max: {x: 100, y: 200}} ); // returns function which returns a point in the rectangle {0,0,100,200}\n *     anim8.computed.random( path ); // returns function which returns a value anywhere along the given path\n *\n * @method random\n * @param  {Array|Object|Path} randomSelection\n * @return {Function}\n */\ncomputed('random', function(randomSelection)\n{\n  var randomFunction = null;\n\n  if ( isArray( randomSelection ) )\n  {\n    randomFunction = function(attrimator, animator)\n    {\n      var attr = attrimator.attribute;\n      var attribute = animator.getAttribute( attr );\n      var calc = attribute.calculator;\n      var selected = randomSelection[ Math.floor( Math.random() * randomSelection.length ) ];\n\n      return calc.parse( selected, calc.ZERO );\n    };\n  }\n  else if ( randomSelection instanceof Path )\n  {\n    randomFunction = function(attrimator, animator)\n    {\n      var attr = attrimator.attribute;\n      var attribute = animator.getAttribute( attr );\n      var calc = attribute.calculator;\n\n      return randomSelection.compute( calc.create(), Math.random() );\n    };\n  }\n  else if ( isObject( randomSelection ) && isDefined( randomSelection.min ) && isDefined( randomSelection.max ) )\n  {\n    randomFunction = function(attrimator, animator)\n    {\n      var attr = attrimator.attribute;\n      var attribute = animator.getAttribute( attr );\n      var calc = attribute.calculator;\n      var resolvedMin = resolve( randomSelection.min );\n      var resolvedMax = resolve( randomSelection.max );\n      var min = calc.parse( resolvedMin, calc.ZERO );\n      var max = calc.parse( resolvedMax, calc.ZERO );\n\n      return calc.random( calc.create(), min, max );\n    };\n  }\n  else\n  {\n    throw 'Invalid random input: ' + randomSelection;\n  }\n\n  // Place the input on the function if the user wants to modify it live\n  randomFunction.randomSelection = randomSelection;\n\n  return computed( randomFunction );\n});\n\n/**\n * Returns a computed function which builds a value for the given calculator\n * given an array of data points.\n *\n * **Examples:**\n *\n *     anim8.computed.combined( [1, 2, 3] ); // returns function which returns a 1, 2, or 3\n *\n * @method combined\n * @param  {Array} numbers\n * @return {Function}\n */\ncomputed('combined', function(numbers)\n{\n  var numberCalculator = $calculator('number');\n\n  var combinerFunction = function(attrimator, animator)\n  {\n    var attribute = animator.getAttribute( attrimator.attribute );\n    var combined = [];\n\n    for (var i = 0; i < numbers.length; i++)\n    {\n      combined.push( resolveComputed( attrimator, animator, numbers[ i ], numberCalculator ) );\n    }\n\n    return attribute.parse( combined );\n  };\n\n  // Place the input on the function if the user wants to modify it live\n  combinerFunction.numbers = numbers;\n\n  return computed( combinerFunction );\n});\n\n/**\n * Determines whether the given value is a computed value. A computed value is\n * function with a variable 'computed' set to a true value.\n *\n * @param  {any} x\n * @return {Boolean}\n */\nfunction isComputed(x)\n{\n  return isFunction( x ) && x.computed;\n}\n\nfunction resolveComputed(attrimator, animator, value, parser)\n{\n  if ( parser instanceof Calculator )\n  {\n    value = parser.parse( value );\n  }\n  else if ( isFunction( parser ) )\n  {\n    value = parser( attrimator, animator, value );\n  }\n\n  if ( isComputed( value ) )\n  {\n    return value( attrimator, animator );\n  }\n\n  return resolve( value );\n}\n\n\n/**\n * Creates a function which calls a method on all elements in the array or on\n * the first element.\n *\n * @method delegate\n * @param {String} functionName\n * @param {String} returning\n */\nfunction delegate(functionName, returning)\n{\n  switch (returning)\n  {\n  case DelegateTypes.THIS:\n    return function()\n    {\n      var array = this.$ || this;\n\n      for (var i = 0; i < array.length; i++)\n      {\n        array[i][functionName].apply( array[i], arguments );\n      }\n\n      return this;\n    };\n\n  case DelegateTypes.RESULTS:\n    return function()\n    {\n      var array = this.$ || this;\n      var results = [];\n\n      for (var i = 0; i < array.length; i++)\n      {\n        results.push( array[i][functionName].apply( array[i], arguments ) );\n      }\n\n      return results;\n    };\n\n  case DelegateTypes.FIRST:\n    return function()\n    {\n      var array = this.$ || this;\n\n      return array.length === 0 ? undefined : array[0][functionName].apply( array[0], arguments );\n    };\n\n  case DelegateTypes.TRUE:\n    return function()\n    {\n      var array = this.$ || this;\n\n      for (var i = 0; i < array.length; i++)\n      {\n        if ( array[i][functionName].apply( array[i], arguments ) )\n        {\n          return true;\n        }\n      }\n\n      return false;\n    };\n\n  }\n\n  return noop;\n}\n\n\n/**\n * Creates a composite dyanmic attribute which is an object of existing\n * attributes which takes advantage of an object based calculator.\n *\n * **Example:**\n *\n *     anim8.object.attribute.topLeft = {\n *       dynamic: anim8.composite({x:'left', y:'top'}),\n *       calculator:'2d',\n *       defaultValue: {x: 0, y: 0},\n *       defaultUnit: 'px'\n *     };\n *\n * Which results in the values in 'topLeft' being placed in left and top.\n *\n * @method anim8.composite\n * @param  {Object} map\n * @for Core\n * @return {Function}\n */\nfunction composite( map )\n{\n  return function( value, frame )\n  {\n    for ( var prop in map )\n    {\n      frame[ map[ prop ] ] = value[ prop ];\n    }\n  };\n}\n\n/**\n * Creates a partial dynamic attribute which is a value that's placed in a\n * sub-property of an attribute.\n *\n * **Example:**\n *\n *     anim8.object.attribute.x = {\n *       dynamic: anim8.partial( 'position', 'x' ),\n *       calculator: 'number',\n *       defaultValue: 0,\n *       defaultUnit: 'px'\n *     };\n *\n * Which results in the values in 'x' being placed in position.x\n *\n * @method anim8.partial\n * @param {String} attribute\n * @param {String} subattribute\n * @for Core\n * @return {Function}\n */\nfunction partial( attribute, subattribute )\n{\n  return function( value, frame )\n  {\n    if ( !isObject( frame[ attribute ] ) )\n    {\n      frame[ attribute ] = {};\n    }\n\n    frame[ attribute ][ subattribute ] = value;\n  };\n}\n\n/**\n * Creates a dynamic attribute which spreads its value over several attributes.\n *\n * **Example:**\n *\n *     anim8.dom.attribute.padding = {\n *       dynamic: anim8.spread( ['paddingLeft', 'paddingTop', 'paddingRight', 'paddingBottom' ] ),\n *       calculator: 'number',\n *       defaultValue: 0,\n *       defaultUnit: 'px'\n *     };\n *\n * Which results in the value in 'padding' being placed in paddingLeft, paddingTop,\n * paddingRight, and paddingBottom.\n *\n * @param  {Array} attributes\n * @return {Function}\n */\nfunction spread( attributes )\n{\n  return function( value, frame )\n  {\n    for ( var i = 0; i < attributes.length; i++ )\n    {\n      frame[ attributes[ i ] ] = value;\n    }\n  };\n}\n\n\n\n\n/**\n * Adds functions to the given object (or prototype) so you can listen for any\n * number of events on the given object, optionally once. Listeners can be\n * removed later.\n *\n * The following methods will be added to the given target:\n *\n *     target.on( events, callback, [context] )\n *     target.once( events, callback, [context] )\n *     target.off( events, callback )\n *     target.trigger( event, [argument] )\n *\n * Where...\n * - `events` is a string of space delimited events.\n * - `callback` is a function to invoke when the event is triggered.\n * - `context` is an object that should be the `this` when the callback is\n *   invoked. If no context is given the default value is the object which has\n *   the trigger function that was invoked.\n *\n * @method eventize\n * @for Core\n * @param {Object} target The object to add `on`, `once`, `off`, and `trigger`\n *    functions to.\n */\nfunction eventize(target)\n{\n  Class.defineProperty( target, 'on', on );\n  Class.defineProperty( target, 'once', once );\n  Class.defineProperty( target, 'off', off );\n  Class.defineProperty( target, 'trigger', trigger );\n}\n\n  // Adds a listener to $this\nfunction addListener($this, property, events, callback, context)\n{\n  var events = toArray( events, ' ' );\n\n  if ( !isDefined( $this[ property ] ) )\n  {\n    Class.defineProperty( $this, property, {} );\n  }\n\n  for (var i = 0; i < events.length; i++)\n  {\n    if ( !isDefined( $this[ property ][ events[i] ] ) )\n    {\n      $this[ property ][ events[i] ] = [];\n    }\n\n    $this[ property ][ events[i] ].push( [ callback, context || $this ] );\n  }\n}\n\n// Removes a listener from an array of listeners.\nfunction removeListeners(listeners, event, callback)\n{\n  if (listeners && event in listeners)\n  {\n    var eventListeners = listeners[ event ];\n\n    for (var k = eventListeners.length - 1; k >= 0; k--)\n    {\n      if (eventListeners[ k ][0] === callback)\n      {\n        eventListeners.splice( k, 1 );\n      }\n    }\n  }\n}\n\n// Deletes a property from the given object if it exists\nfunction deleteProperty(obj, prop)\n{\n  if ( obj && prop in obj )\n  {\n    delete obj[ prop ];\n  }\n}\n\n// Triggers listeneers for the given event\nfunction triggerListeners(listeners, event, argument, clear)\n{\n  if (listeners && event in listeners)\n  {\n    var eventListeners = listeners[ event ];\n    var max = eventListeners.length;\n\n    for (var i = 0; i < max; i++)\n    {\n      var callback = eventListeners[ i ];\n\n      callback[0].call( callback[1], argument );\n    }\n\n    if ( clear )\n    {\n      if ( eventListeners.length !== max )\n      {\n        listeners[ event ] = eventListeners.slice( max );\n      }\n      else\n      {\n        delete listeners[ event ];\n      }\n    }\n  }\n}\n\n/**\n * Listens for every occurrence of the given events and invokes the callback\n * each time any of them are triggered.\n *\n * @method on\n * @for eventize\n * @param {String|Array|Object} events\n * @param {Function} callback\n * @param {Object} [context]\n * @chainable\n */\nfunction on(events, callback, context)\n{\n  addListener( this, '$on', events, callback, context );\n\n  return this;\n}\n\n/**\n * Listens for the next occurrence for each of the given events and invokes\n * the callback when any of the events are triggered.\n *\n * @method once\n * @for eventize\n * @param {String|Array|Object} events\n * @param {Function} callback\n * @param {Object} [context]\n * @chainable\n */\nfunction once(events, callback, context)\n{\n  addListener( this, '$once', events, callback, context );\n\n  return this;\n}\n\n/**\n * Stops listening for a given callback for a given set of events.\n *\n * **Examples:**\n *\n *     target.off();           // remove all listeners\n *     target.off('a b');      // remove all listeners on events a & b\n *     target.off(['a', 'b']); // remove all listeners on events a & b\n *     target.off('a', x);     // remove listener x from event a\n *\n * @method off\n * @for eventize\n * @param {String|Array|Object} [events]\n * @param {Function} [callback]\n * @chainable\n */\nfunction off(events, callback)\n{\n  // Remove ALL listeners\n  if ( !isDefined( events ) )\n  {\n    delete this.$on;\n    delete this.$once;\n  }\n  else\n  {\n    var events = toArray( events, ' ' );\n\n    // Remove listeners for given events\n    if ( !isFunction( callback ) )\n    {\n      for (var i = 0; i < events.length; i++)\n      {\n        deleteProperty( this.$on, events[i] );\n        deleteProperty( this.$once, events[i] );\n      }\n    }\n    // Remove specific listener\n    else\n    {\n      for (var i = 0; i < events.length; i++)\n      {\n        removeListeners( this.$on, events[i], callback );\n        removeListeners( this.$once, events[i], callback );\n      }\n    }\n  }\n\n  return this;\n}\n\n/**\n * Triggers a single event optionally passing an argument to any listeners.\n *\n * @method trigger\n * @for eventize\n * @param {String} event\n * @param {Any} argument\n * @chainable\n */\nfunction trigger(event, argument)\n{\n  triggerListeners( this.$on, event, argument, false );\n  triggerListeners( this.$once, event, argument, true );\n\n  return this;\n}\n\n\nfunction gcd(a,b)\n{\n  if (a < 0)\n  {\n    a = -a;\n  }\n  if (b < 0)\n  {\n    b = -b;\n  }\n  if (b > a)\n  {\n    var temp = a;\n    a = b;\n    b = temp;\n  }\n\n  while (true)\n  {\n    if (b === 0)\n    {\n      return a;\n    }\n\n    a %= b;\n\n    if (a === 0)\n    {\n      return b;\n    }\n\n    b %= a;\n  }\n}\n\nfunction choose(n, m)\n{\n  var num = 1, den = 1, g;\n\n  if ( m > (n / 2) )\n  {\n    m = n - m;\n  }\n\n  while ( m >= 1 )\n  {\n    num *= n--;\n    den *= m--;\n    g = gcd( num, den );\n    num /= g;\n    den /= g;\n  }\n\n  return num;\n}\n\n/**\n * Returns a value between the given minimum and maximum.\n *\n * **Examples:**\n *\n *     anim8.clamp( 5, 1, 6 );   // 5\n *     anim8.clamp( 0, 1, 6 );   // 1\n *     anim8.clamp( 7, 1, 6 );   // 6\n *\n * @method anim8.clamp\n * @param  {Number} v\n * @param  {Number} min\n * @param  {Number} max\n * @return {Number}\n */\nfunction clamp(v, min, max)\n{\n  return (v < min) ? min : (v > max ? max : v);\n}\n\nfunction clamper(min, max)\n{\n  return function(v)\n  {\n    return clamp( v, min, max );\n  };\n}\n\nvar RADIANS_TO_DEGREES = 180 / Math.PI;\nvar DEGREES_TO_RADIANS = Math.PI / 180;\n\nfunction toDegrees(radians)\n{\n  return radians * RADIANS_TO_DEGREES;\n}\n\nfunction toRadians(degrees)\n{\n  return degrees * DEGREES_TO_RADIANS;\n}\n\nfunction modder(divisor)\n{\n  return function(v)\n  {\n    return v % divisor;\n  };\n}\n\n\nfunction param(paramName, paramCalculator, paramDefaultValue)\n{\n  var getCalculator, parseValue;\n\n  if ( paramCalculator )\n  {\n    var calculator = $calculator( paramCalculator );\n    var defaultValue = calculator.parse( paramDefaultValue );\n\n    getCalculator = function(attrimator, animator)\n    {\n      return calculator;\n    };\n    parseValue = function(attrimator, animator, value)\n    {\n      return calculator.parse( value, defaultValue, true );\n    };\n  }\n  else\n  {\n    getCalculator = function(attrimator, animator)\n    {\n      return animator.getAttribute( attrimator.attribute ).calculator;\n    };\n    parseValue = function(attrimator, animator, value)\n    {\n      return animator.getAttribute( attrimator.attribute ).parse( value, true );\n    };\n  }\n\n  return paramFactory(getCalculator, parseValue, function(attrimator, animator)\n  {\n    return resolveComputed( attrimator, animator, attrimator.parameters[ paramName ], parseValue );\n  });\n}\n\nfunction paramFactory(getCalculator, parseValue, computer)\n{\n  extend( computer, Parameters );\n\n  computer.getCalculator = getCalculator;\n  computer.parseValue = parseValue;\n\n  return computed( computer );\n}\n\nfunction paramCalculator(parent, handleCalculation, newCalculator)\n{\n  var getCalculator = parent.getCalculator;\n  var parseValue = parent.parseValue;\n\n  if ( newCalculator )\n  {\n    newCalculator = $calculator( newCalculator );\n\n    getCalculator = function(attrimator, animator)\n    {\n      return newCalculator;\n    };\n\n    parseValue = function(attrimator, animator, value)\n    {\n      return newCalculator.parse( value, undefined, true );\n    };\n  }\n\n  return paramFactory(getCalculator, parseValue, function(attrimator, animator)\n  {\n    var calc = getCalculator( attrimator, animator );\n\n    return handleCalculation( attrimator, animator, parent, calc );\n  });\n}\n\nvar Parameters =\n{\n  add: function(value)\n  {\n    var handleCalculation = function(attrimator, animator, parent, calc)\n    {\n      var out = parent( attrimator, animator );\n      var valueResolve = resolveComputed( attrimator, animator, value, parent.parseValue );\n\n      return calc.add( out, valueResolve );\n    };\n\n    return paramCalculator( this, handleCalculation );\n  },\n\n  sub: function(value)\n  {\n    var handleCalculation = function(attrimator, animator, parent, calc)\n    {\n      var out = parent( attrimator, animator );\n      var valueResolve = resolveComputed( attrimator, animator, value, parent.parseValue );\n\n      return calc.sub( out, valueResolve );\n    };\n\n    return paramCalculator( this, handleCalculation );\n  },\n\n  mul: function(value)\n  {\n    var handleCalculation = function(attrimator, animator, parent, calc)\n    {\n      var out = parent( attrimator, animator );\n      var valueResolve = resolveComputed( attrimator, animator, value, parent.parseValue );\n\n      return calc.mul( out, valueResolve );\n    };\n\n    return paramCalculator( this, handleCalculation );\n  },\n\n  div: function(value)\n  {\n    var handleCalculation = function(attrimator, animator, parent, calc)\n    {\n      var out = parent( attrimator, animator );\n      var valueResolve = resolveComputed( attrimator, animator, value, parent.parseValue );\n\n      return calc.div( out, valueResolve );\n    };\n\n    return paramCalculator( this, handleCalculation );\n  },\n\n  scale: function(scalar)\n  {\n    var calcScalar = $calculator('number');\n\n    var handleCalculation = function(attrimator, animator, parent, calc)\n    {\n      var out = parent( attrimator, animator );\n      var scalarResolve = resolveComputed( attrimator, animator, scalar, calcScalar );\n\n      return calc.scale( out, scalarResolve );\n    };\n\n    return paramCalculator( this, handleCalculation );\n  },\n\n  adds: function(value, scalar)\n  {\n    var calcScalar = $calculator('number');\n\n    var handleCalculation = function(attrimator, animator, parent, calc)\n    {\n      var out = parent( attrimator, animator );\n      var valueResolve = resolveComputed( attrimator, animator, value, parent.parseValue );\n      var scalarResolve = resolveComputed( attrimator, animator, scalar, calcScalar );\n\n      return calc.adds( out, valueResolve, scalarResolve );\n    };\n\n    return paramCalculator( this, handleCalculation );\n  },\n\n  neg: function()\n  {\n    var handleCalculation = function(attrimator, animator, parent, calc)\n    {\n      var out = parent( attrimator, animator );\n\n      return calc.scale( out, -1 );\n    };\n\n    return paramCalculator( this, handleCalculation );\n  },\n\n  min: function(value)\n  {\n    var handleCalculation = function(attrimator, animator, parent, calc)\n    {\n      var out = parent( attrimator, animator );\n      var valueResolve = resolveComputed( attrimator, animator, value, parent.parseValue );\n\n      return calc.min( out, out, valueResolve );\n    };\n\n    return paramCalculator( this, handleCalculation );\n  },\n\n  max: function(value)\n  {\n    var handleCalculation = function(attrimator, animator, parent, calc)\n    {\n      var out = parent( attrimator, animator );\n      var valueResolve = resolveComputed( attrimator, animator, value, parent.parseValue );\n\n      return calc.max( out, out, valueResolve );\n    };\n\n    return paramCalculator( this, handleCalculation );\n  },\n\n  truncate: function(denominator)\n  {\n    var calcDenominator = $calculator('number');\n\n    var handleCalculation = function(attrimator, animator, parent, calc)\n    {\n      var out = parent( attrimator, animator );\n      var denominatorResolve = resolveComputed( attrimator, animator, denominator, calcDenominator );\n\n      return Math.floor( out * denominatorResolve ) / denominatorResolve;\n    };\n\n    return paramCalculator( this, handleCalculation );\n  },\n\n  mod: function(divisor)\n  {\n    var calcDivisor = $calculator('number');\n\n    var handleCalculation = function(attrimator, animator, parent, calc)\n    {\n      var out = parent( attrimator, animator );\n      var divisorResolve = resolveComputed( attrimator, animator, divisor, calcDivisor );\n\n      return calc.convert( out, modder( divisor ) );\n    };\n\n    return paramCalculator( this, handleCalculation );\n  },\n\n  clamp: function(min, max)\n  {\n    var calcClamp = $calculator('number');\n\n    var handleCalculation = function(attrimator, animator, parent, calc)\n    {\n      var out = parent( attrimator, animator );\n      var minResolve = resolveComputed( attrimator, animator, min, calcClamp );\n      var maxResolve = resolveComputed( attrimator, animator, max, calcClamp );\n\n      return calc.convert( out, clamper( minResolve, maxResolve ) );\n    };\n\n    return paramCalculator( this, handleCalculation );\n  },\n\n  convert: function(converter)\n  {\n    var handleCalculation = function(attrimator, animator, parent, calc)\n    {\n      var out = parent( attrimator, animator );\n\n      return calc.convert( out, converter );\n    };\n\n    return paramCalculator( this, handleCalculation );\n  },\n\n  abs: function()\n  {\n    return this.convert( Math.abs );\n  },\n\n  sqrt: function()\n  {\n    return this.convert( Math.sqrt );\n  },\n\n  floor: function()\n  {\n    return this.convert( Math.floor );\n  },\n\n  ceil: function()\n  {\n    return this.convert( Math.ceil );\n  },\n\n  round: function()\n  {\n    return this.convert( Math.round );\n  },\n\n  toDegrees: function()\n  {\n    return this.convert( toDegrees );\n  },\n\n  toRadians: function()\n  {\n    return this.convert( toRadians );\n  },\n\n  cos: function()\n  {\n    return this.convert( Math.cos );\n  },\n\n  sin: function()\n  {\n    return this.convert( Math.sin );\n  },\n\n  tan: function()\n  {\n    return this.convert( Math.tan );\n  },\n\n  cosDegrees: function()\n  {\n    return this.toRadians().cos();\n  },\n\n  sinDegrees: function()\n  {\n    return this.toRadians().sin();\n  },\n\n  tanDegrees: function()\n  {\n    return this.toRadians().tan();\n  },\n\n  distance: function(value)\n  {\n    var handleCalculation = function(attrimator, animator, parent, calc)\n    {\n      var out = parent( attrimator, animator );\n      var valueResolve = resolveComputed( attrimator, animator, value, parent.parseValue );\n\n      return calc.distance( out, valueResolve );\n    };\n\n    return paramCalculator( this, handleCalculation, 'number' );\n  },\n\n  property: function(propertyName, defaultValue)\n  {\n    var handleCalculation = function(attrimator, animator, parent, calc)\n    {\n      var out = parent( attrimator, animator );\n\n      return isObject( out ) ? out[ propertyName ] : defaultValue;\n    };\n\n    return paramCalculator( this, handleCalculation, 'number' );\n  },\n\n  vector: function(calculator)\n  {\n    var vectorCalculator = coalesce( calculator, '2d' );\n\n    var handleCalculation = function(attrimator, animator, parent, calc)\n    {\n      var angle = parent( attrimator, animator );\n\n      switch (vectorCalculator) {\n        case '2d':\n          return {\n            x: Math.cos( angle ),\n            y: Math.sin( angle )\n          };\n        case '3d':\n          var yaw = angle.x;\n          var pitch = angle.y;\n          return {\n            x: Math.cos( yaw ) * Math.cos( pitch ),\n            y: Math.sin( yaw ) * Math.cos( pitch ),\n            z: Math.sin( pitch )\n          };\n      }\n\n      return angle;\n    };\n\n    return paramCalculator( this, handleCalculation, vectorCalculator );\n  },\n\n  vectorDegrees: function(type)\n  {\n    return this.toRadians().vector( type );\n  },\n\n  relative: function(mask)\n  {\n    var handleCalculation = function(attrimator, animator, parent, calc)\n    {\n      var out = parent( attrimator, animator );\n\n      return computed.relative( out, mask )( attrimator, animator );\n    };\n\n    return paramCalculator( this, handleCalculation );\n  }\n\n};\n\n\nvar Animations = {};\n\n/**\n * Options to modify the properties of the animations being saved.\n */\nvar SaveOptions =\n{\n  prefix: '',\n  options: {},\n  cache: false,\n  forObject: null\n};\n\n/**\n * Saves an animation under the given name. It can be played, queued, and\n * transitioned into at a later time providing the name and optionally options\n * to override with.\n *\n * **See:** {{#crossLink \"Core/anim8.animation:method\"}}anim8.animation{{/crossLink}},\n *          {{#crossLink \"Core/anim8.options:method\"}}anim8.options{{/crossLink}}\n *\n * @method anim8.save\n * @for Core\n * @param {String} name\n * @param {Animation|String|Object} animation\n * @param {String|Object} [options]\n */\nfunction save( name, animation, options )\n{\n  var animation = $animation( animation, coalesce( options, SaveOptions.options ), SaveOptions.cache, SaveOptions.forObject );\n  var qualifiedName = SaveOptions.prefix + name;\n  var key = qualifiedName.toLowerCase();\n\n  animation.name = qualifiedName;\n\n  Animations[ key ] = animation;\n}\n\n/**\n * Starts a save group with a prefix or an object containing a prefix and/or\n * default options to pass to the animations. The animations passed can be\n * an object or a function to call which contains save calls.\n *\n * @method anim8.saveGroup\n * @param {String|Object} prefixOrOptions\n * @param {Function|Object} animations\n */\nfunction saveGroup( prefixOrOptions, animations )\n{\n  var previousOptions = copy( SaveOptions );\n\n  if ( isString( prefixOrOptions ) )\n  {\n    SaveOptions.prefix += prefixOrOptions;\n  }\n  else if ( isObject( prefixOrOptions ) )\n  {\n    if ( isString( prefixOrOptions.prefix ) )\n    {\n      SaveOptions.prefix += prefixOrOptions.prefix;\n    }\n    if ( isDefined( prefixOrOptions.cache ) )\n    {\n      SaveOptions.cache = prefixOrOptions.cache;\n    }\n    if ( isDefined( prefixOrOptions.options ) )\n    {\n      var parsedOptions = $options( prefixOrOptions.options, SaveOptions.cache );\n\n      if ( parsedOptions !== Defaults.noOptions )\n      {\n        extend( SaveOptions.options, parsedOptions );\n      }\n    }\n    if ( isDefined( prefixOrOptions.forObject ) )\n    {\n      SaveOptions.forObject = prefixOrOptions.forObject;\n    }\n    if ( isDefined( prefixOrOptions.factory ) )\n    {\n      var parsedFactory = $factory( prefixOrOptions.factory );\n\n      if ( parsedFactory )\n      {\n        SaveOptions.forObject = parsedFactory;\n      }\n    }\n  }\n\n  if ( isObject( animations ) )\n  {\n    for (var animationName in animations)\n    {\n      save( animationName, animations[ animationName ] );\n    }\n  }\n  else if ( isFunction( animations ) )\n  {\n    animations();\n  }\n\n  SaveOptions = previousOptions;\n}\n\n\nfunction translate(animation, mappings, saveAs, options, cache)\n{\n  var parsed = $animation(animation, options, cache);\n  var attrimators = parsed.newAttrimators();\n\n  for (var fromAttribute in mappings)\n  {\n    var toAttribute = mappings[ fromAttribute ];\n\n    attrimators.get( fromAttribute ).attribute = toAttribute;\n    attrimators.rekey( fromAttribute, toAttribute );\n  }\n\n  var translated = new Animation( saveAs, parsed.input, parsed.options, attrimators );\n\n  if ( isString( saveAs ) )\n  {\n    save( saveAs, translated );\n  }\n\n  return translated;\n}\n\n\n/*\n * A calculator for objects with an x and y component (number)\n *\n * @class Calculator2d\n * @constructor\n * @extends Calculator\n */\nfunction Calculator2d()\n{\n  this.createConstants();\n}\n\nClass.extend( Calculator2d, Calculator,\n{\n  aliases: {\n    'left':   0,\n    'right':  100,\n    'middle': 50,\n    'center': 50,\n    'top':    0,\n    'bottom': 100\n  },\n  parse: function(x, defaultValue, ignoreRelative)\n  {\n    // Values computed live.\n    if ( isFunction( x ) )\n    {\n      return x;\n    }\n\n    // Value computed from current value on animator.\n    if ( x === true )\n    {\n      return computed.current;\n    }\n\n    // When a number is given a uniform point is returned.\n    if ( isNumber( x ) )\n    {\n      return {\n        x: x,\n        y: x\n      };\n    }\n\n    // When an array is given, assume [x, y]\n    if ( isArray( x ) )\n    {\n      x = { x: x[0], y: x[1] };\n    }\n\n    // Default when there is none given\n    var def = coalesce( defaultValue, Defaults.calculator2d );\n\n    // When an object is given, check for relative values.\n    if ( isObject( x ) )\n    {\n      var cx = coalesce( x.x, def.x );\n      var cy = coalesce( x.y, def.y );\n      var rx = $number( cx, false );\n      var ry = $number( cy, false );\n\n      if ( rx !== false && ry !== false )\n      {\n        var parsed = { x: rx, y: ry };\n        var ix = isRelative( cx );\n        var iy = isRelative( cy );\n\n        if ( !ignoreRelative && (ix || iy) )\n        {\n          var mask = {\n            x: ix ? 1 : 0,\n            y: iy ? 1 : 0\n          };\n\n          return computed.relative( parsed, mask );\n        }\n\n        return parsed;\n      }\n    }\n\n    // Relative values & left/right/middle/center/top/bottom aliases.\n    if ( isString( x ) )\n    {\n      // If only a relative value is given it will modify the X & Y components evenly.\n      if ( !ignoreRelative && isRelative( x ) )\n      {\n        var rx = $number( x, false );\n\n        if ( rx !== false )\n        {\n          return computed.relative( { x: rx, y: rx } );\n        }\n      }\n\n      var pair = x.split(/[\\s,|]/);\n\n      return {\n        x: this.parseString( pair[0], def.x ),\n        y: this.parseString( coalesce(pair[1], pair[0]), def.y )\n      };\n    }\n\n    // If no value was given but the default value was given, clone it.\n    return this.clone( def );\n  },\n  parseString: function(x, defaultValue)\n  {\n    return x in this.aliases ? this.aliases[ x ] : $number( x, defaultValue );\n  },\n  copy: function(out, copy)\n  {\n    out.x = copy.x;\n    out.y = copy.y;\n    return out;\n  },\n  create: function()\n  {\n    return {x: 0.0, y: 0.0};\n  },\n  zero: function(out)\n  {\n    out.x = 0.0;\n    out.y = 0.0;\n    return out;\n  },\n  convert: function(out, converter)\n  {\n    out.x = converter( out.x );\n    out.y = converter( out.y );\n    return out;\n  },\n  adds: function(out, amount, amountScale)\n  {\n    out.x += amount.x * amountScale;\n    out.y += amount.y * amountScale;\n    return out;\n  },\n  mul: function(out, scale)\n  {\n    out.x *= scale.x;\n    out.y *= scale.y;\n    return out;\n  },\n  div: function(out, denominator)\n  {\n    out.x = denominator.x ? out.x / denominator.x : 0;\n    out.y = denominator.y ? out.y / denominator.y : 0;\n    return out;\n  },\n  interpolate: function(out, start, end, delta)\n  {\n    out.x = (end.x - start.x) * delta + start.x;\n    out.y = (end.y - start.y) * delta + start.y;\n    return out;\n  },\n  distanceSq: function(a, b)\n  {\n    var dx = a.x - b.x;\n    var dy = a.y - b.y;\n    return dx * dx + dy * dy;\n  },\n  isValid: function(a)\n  {\n    return typeof a === 'object' && 'x' in a && 'y' in a;\n  },\n  isNaN: function(a)\n  {\n    return isNaN(a.x) || isNaN(a.y);\n  },\n  isZero: function(a, epsilon)\n  {\n    return Math.abs(a.x) < epsilon &&\n           Math.abs(a.y) < epsilon;\n  },\n  isEqual: function(a, b, epsilon)\n  {\n    return Math.abs(a.x - b.x) < epsilon &&\n           Math.abs(a.y - b.y) < epsilon;\n  },\n  min: function(out, a, b)\n  {\n    out.x = Math.min(a.x, b.x);\n    out.y = Math.min(a.y, b.y);\n    return out;\n  },\n  max: function(out, a, b)\n  {\n    out.x = Math.max(a.x, b.x);\n    out.y = Math.max(a.y, b.y);\n    return out;\n  },\n  dot: function(a, b)\n  {\n    return a.x * b.x + a.y * b.y;\n  },\n  random: function(out, min, max)\n  {\n    out.x = (max.x - min.x) * Math.random() + min.x;\n    out.y = (max.y - min.y) * Math.random() + min.y;\n    return out;\n  }\n});\n\n\n/**\n * A calculator for objects with an x, y, and z component (number)\n *\n * @class Calculator3d\n * @constructor\n * @extends Calculator\n */\nfunction Calculator3d()\n{\n  this.createConstants();\n}\n\nClass.extend( Calculator3d, Calculator,\n{\n  parse: function(x, defaultValue, ignoreRelative)\n  {\n    // Values computed live.\n    if ( isFunction( x ) )\n    {\n      return x;\n    }\n\n    // Value computed from current value on animator.\n    if ( x === true )\n    {\n      return computed.current;\n    }\n\n    // When a number is given a uniform point is returned.\n    if ( isNumber( x ) )\n    {\n      return {\n        x: x,\n        y: x,\n        z: x\n      };\n    }\n\n    // When an array is given, assume [x, y, z]\n    if ( isArray( x ) )\n    {\n      x = { x: x[0], y: x[1], z: x[2] };\n    }\n\n    // Default when there is none given\n    var def = coalesce( defaultValue, Defaults.calculator3d );\n\n    // When an object is given, check for relative values.\n    if ( isObject( x ) )\n    {\n      var cx = coalesce( x.x, def.x );\n      var cy = coalesce( x.y, def.y );\n      var cz = coalesce( x.z, def.z );\n      var rx = $number( cx, false );\n      var ry = $number( cy, false );\n      var rz = $number( cz, false );\n\n      if ( rx !== false && ry !== false && rz !== false )\n      {\n        var parsed = { x: rx, y: ry, z: rz };\n        var ix = isRelative( cx );\n        var iy = isRelative( cy );\n        var iz = isRelative( cz );\n\n        if ( !ignoreRelative && (ix || iy || iz) )\n        {\n          var mask = {\n            x: ix ? 1 : 0,\n            y: iy ? 1 : 0,\n            z: iz ? 1 : 0\n          };\n\n          return computed.relative( parsed, mask );\n        }\n\n        return parsed;\n      }\n    }\n\n    if ( isString( x ) )\n    {\n      // If only a relative value is given it will modify the X, Y, & Z components evenly.\n      if ( !ignoreRelative && isRelative( x ) )\n      {\n        var rx = $number( x, false );\n\n        if ( rx !== false )\n        {\n          return computed.relative( { x: rx, y: rx, z: rx } );\n        }\n      }\n\n      var pair = x.split(/[\\s,|]/);\n\n      return {\n        x: $number( pair[0], def.x ),\n        y: $number( pair[1], def.y ),\n        z: $number( pair[2], def.z )\n      };\n    }\n\n    // If no value was given but the default value was given, clone it.\n    return this.clone( def );\n  },\n  copy: function(out, copy)\n  {\n    out.x = copy.x;\n    out.y = copy.y;\n    out.z = copy.z;\n    return out;\n  },\n  create: function()\n  {\n    return {x: 0.0, y:0.0, z:0.0};\n  },\n  zero: function(out)\n  {\n    out.x = 0.0;\n    out.y = 0.0;\n    out.z = 0.0;\n    return out;\n  },\n  convert: function(out, converter)\n  {\n    out.x = converter( out.x );\n    out.y = converter( out.y );\n    out.z = converter( out.z );\n    return out;\n  },\n  adds: function(out, amount, amountScale)\n  {\n    out.x += amount.x * amountScale;\n    out.y += amount.y * amountScale;\n    out.z += amount.z * amountScale;\n    return out;\n  },\n  mul: function(out, scale)\n  {\n    out.x *= scale.x;\n    out.y *= scale.y;\n    out.z *= scale.z;\n    return out;\n  },\n  div: function(out, denominator)\n  {\n    out.x = denominator.x ? out.x / denominator.x : 0;\n    out.y = denominator.y ? out.y / denominator.y : 0;\n    out.z = denominator.z ? out.z / denominator.z : 0;\n    return out;\n  },\n  interpolate: function(out, start, end, delta)\n  {\n    out.x = (end.x - start.x) * delta + start.x;\n    out.y = (end.y - start.y) * delta + start.y;\n    out.z = (end.z - start.z) * delta + start.z;\n    return out;\n  },\n  distanceSq: function(a, b)\n  {\n    var dx = a.x - b.x;\n    var dy = a.y - b.y;\n    var dz = a.z - b.z;\n    return dx * dx + dy * dy + dz * dz;\n  },\n  isValid: function(a)\n  {\n    return typeof a === 'object' && 'x' in a && 'y' in a && 'z' in a;\n  },\n  isNaN: function(a)\n  {\n    return isNaN(a.x) || isNaN(a.y) || isNaN(a.z);\n  },\n  isZero: function(a, epsilon)\n  {\n    return Math.abs(a.x) < epsilon &&\n           Math.abs(a.y) < epsilon && Math.abs(a.z) < epsilon;\n  },\n  isEqual: function(a, b, epsilon)\n  {\n    return Math.abs(a.x - b.x) < epsilon &&\n           Math.abs(a.y - b.y) < epsilon &&\n           Math.abs(a.z - b.z) < epsilon;\n  },\n  min: function(out, a, b)\n  {\n    out.x = Math.min(a.x, b.x);\n    out.y = Math.min(a.y, b.y);\n    out.z = Math.min(a.z, b.z);\n    return out;\n  },\n  max: function(out, a, b)\n  {\n    out.x = Math.max(a.x, b.x);\n    out.y = Math.max(a.y, b.y);\n    out.z = Math.max(a.z, b.z);\n    return out;\n  },\n  dot: function(a, b)\n  {\n    return a.x * b.x + a.y * b.y + a.z * b.z;\n  },\n  random: function(out, min, max)\n  {\n    out.x = (max.x - min.x) * Math.random() + min.x;\n    out.y = (max.y - min.y) * Math.random() + min.y;\n    out.z = (max.z - min.z) * Math.random() + min.z;\n    return out;\n  }\n});\n\n\n\n/**\n * A calculator for number primitives.\n *\n * @class CalculatorNumber\n * @constructor\n * @extends Calculator\n */\nfunction CalculatorNumber()\n{\n  this.createConstants();\n}\n\nClass.extend( CalculatorNumber, Calculator,\n{\n  parse: function(x, defaultValue, ignoreRelative)\n  {\n    // Values computed live.\n    if ( isFunction( x ) )\n    {\n      return x;\n    }\n\n    // Value computed from current value on animator.\n    if ( x === true )\n    {\n      return computed.current;\n    }\n\n    // An array\n    if ( isArray( x ) )\n    {\n      x = x[ 0 ];\n    }\n\n    // A raw number\n    if ( isNumber( x ) )\n    {\n      return x;\n    }\n\n    // A number in a string or a relative number.\n    if ( isString( x ) )\n    {\n      var amount = $number( x, false );\n\n      if ( amount !== false )\n      {\n        if ( !ignoreRelative && isRelative( x ) )\n        {\n          return computed.relative( amount );\n        }\n        else\n        {\n          return amount;\n        }\n      }\n    }\n\n    return $number( defaultValue, Defaults.calculatorNumber );\n  },\n  copy: function(out, copy)\n  {\n    return copy;\n  },\n  create: function()\n  {\n    return 0.0;\n  },\n  zero: function(out)\n  {\n    return 0.0;\n  },\n  convert: function(out, converter)\n  {\n    return converter( out );\n  },\n  adds: function(out, amount, amountScale)\n  {\n    return out += amount * amountScale;\n  },\n  mul: function(out, scale)\n  {\n    return out *= scale;\n  },\n  div: function(out, denominator)\n  {\n    return denominator ? out / denominator : 0;\n  },\n  interpolate: function(out, start, end, delta)\n  {\n    return (end - start) * delta + start;\n  },\n  distanceSq: function(a, b)\n  {\n    var ab = a - b;\n    return ab * ab;\n  },\n  distance: function(a, b)\n  {\n    return Math.abs( a - b );\n  },\n  length: function(a)\n  {\n    return Math.abs( a );\n  },\n  lengthSq: function(a)\n  {\n    return a * a;\n  },\n  isValid: function(a)\n  {\n    return typeof a === 'number';\n  },\n  isNaN: function(a)\n  {\n    return isNaN(a);\n  },\n  isZero: function(a, epsilon)\n  {\n    return Math.abs(a) < epsilon;\n  },\n  isEqual: function(a, b, epsilon)\n  {\n    return Math.abs(a - b) < epsilon;\n  },\n  min: function(out, a, b)\n  {\n    return Math.min( a, b );\n  },\n  max: function(out, a, b)\n  {\n    return Math.max( a, b );\n  },\n  dot: function(a, b)\n  {\n    return a * b;\n  }\n});\n\n\n/**\n * A calculator for objects with an x, y, z, and angle components.\n *\n * @class CalculatorQuaternion\n * @constructor\n * @extends Calculator\n */\nfunction CalculatorQuaternion()\n{\n  this.createConstants();\n}\n\nClass.extend( CalculatorQuaternion, Calculator,\n{\n  parse: function(x, defaultValue, ignoreRelative)\n  {\n    // Values computed live.\n    if ( isFunction( x ) )\n    {\n      return x;\n    }\n\n    // Value computed from current value on animator.\n    if ( x === true )\n    {\n      return computed.current;\n    }\n\n    // When only a number is given assume it's an angle around the Z-axis.\n    if ( isNumber( x ) )\n    {\n      return {\n        x: 0,\n        y: 0,\n        z: 1,\n        angle: x\n      };\n    }\n\n    // When an array is given, assume [x, y, z, angle]\n    if ( isArray( x ) )\n    {\n      x = { x: x[0], y: x[1], z: x[2], angle: x[3] };\n    }\n\n    // Default when there is none given\n    var def = coalesce( defaultValue, Defaults.calculatorQuaternion );\n\n    // When an object is given, check for relative values.\n    if ( isObject( x ) )\n    {\n      var cx = coalesce( x.x, def.x );\n      var cy = coalesce( x.y, def.y );\n      var cz = coalesce( x.z, def.z );\n      var ca = coalesce( x.angle, def.angle );\n      var rx = $number( cx, false );\n      var ry = $number( cy, false );\n      var rz = $number( cz, false );\n      var ra = $number( ca, false );\n\n      if ( rx !== false && ry !== false && rz !== false && ra !== false )\n      {\n        var parsed = { x: rx, y: ry, z: rz, angle: ra };\n        var ix = isRelative( cx );\n        var iy = isRelative( cy );\n        var iz = isRelative( cz );\n        var ia = isRelative( ca );\n\n        if ( !ignoreRelative && (ix || iy || iz || ia) )\n        {\n          var mask = {\n            x: ix ? 1 : 0,\n            y: iy ? 1 : 0,\n            z: iz ? 1 : 0,\n            angle: ia ? 1 : 0\n          };\n\n          return computed.relative( parsed );\n        }\n\n        return parsed;\n      }\n    }\n\n    // When a relative value is given, assume it's for an angle around the Z-axis.\n    if ( isString( x ) )\n    {\n      if ( isRelative( x ) )\n      {\n        var rx = $number( x, false );\n\n        if ( !ignoreRelative && rx !== false )\n        {\n          return computed.relative( { x:0, y:0, z:1, angle: rx }, { x:0, y:0, z:0, angle:1 } );\n        }\n      }\n\n      var pair = x.split(/[\\s,|]/);\n\n      return {\n        x:      $number( pair[0], def.x ),\n        y:      $number( pair[1], def.y ),\n        z:      $number( pair[2], def.z ),\n        angle:  $number( pair[3], def.angle )\n      };\n    }\n\n    // If no value was given but the default value was given, clone it.\n    return this.clone( def );\n  },\n  copy: function(out, copy)\n  {\n    out.x = copy.x;\n    out.y = copy.y;\n    out.z = copy.z;\n    out.angle = copy.angle;\n    return out;\n  },\n  create: function()\n  {\n    return {x: 0.0, y:0.0, z:0.0, angle:0.0};\n  },\n  zero: function(out)\n  {\n    out.x = 0.0;\n    out.y = 0.0;\n    out.z = 0.0;\n    out.angle = 0.0;\n    return out;\n  },\n  convert: function(out, converter)\n  {\n    out.x = converter( out.x );\n    out.y = converter( out.y );\n    out.z = converter( out.z );\n    out.angle = converter( out.angle );\n    return out;\n  },\n  adds: function(out, amount, amountScale)\n  {\n    out.x += amount.x * amountScale;\n    out.y += amount.y * amountScale;\n    out.z += amount.z * amountScale;\n    out.angle += amount.angle * amountScale;\n    return out;\n  },\n  mul: function(out, scale)\n  {\n    out.x *= scale.x;\n    out.y *= scale.y;\n    out.z *= scale.z;\n    out.angle *= scale.angle;\n    return out;\n  },\n  div: function(out, denominator)\n  {\n    out.x = denominator.x ? out.x / denominator.x : 0;\n    out.y = denominator.y ? out.y / denominator.y : 0;\n    out.z = denominator.z ? out.z / denominator.z : 0;\n    out.angle = denominator.angle ? out.angle / denominator.angle : 0;\n    return out;\n  },\n  interpolate: function(out, start, end, delta)\n  {\n    out.x = (end.x - start.x) * delta + start.x;\n    out.y = (end.y - start.y) * delta + start.y;\n    out.z = (end.z - start.z) * delta + start.z;\n    out.angle = (end.angle - start.angle) * delta + start.angle;\n    return out;\n  },\n  distanceSq: function(a, b)\n  {\n    var dx = a.x - b.x;\n    var dy = a.y - b.y;\n    var dz = a.z - b.z;\n    var da = a.angle - b.angle;\n    return dx * dx + dy * dy + dz * dz + da * da;\n  },\n  isValid: function(a)\n  {\n    return typeof a === 'object' && 'x' in a && 'y' in a && 'z' in a && 'angle' in a;\n  },\n  isNaN: function(a)\n  {\n    return isNaN(a.x) || isNaN(a.y) || isNaN(a.z) || isNaN(a.angle);\n  },\n  isZero: function(a, epsilon)\n  {\n    return Math.abs(a.x) < epsilon &&\n           Math.abs(a.y) < epsilon &&\n           Math.abs(a.z) < epsilon &&\n           Math.abs(a.angle) < epsilon;\n  },\n  isEqual: function(a, b, epsilon)\n  {\n    return Math.abs(a.x - b.x) < epsilon &&\n           Math.abs(a.y - b.y) < epsilon &&\n           Math.abs(a.z - b.z) < epsilon &&\n           Math.abs(a.angle - b.angle) < epsilon;\n  },\n  min: function(out, a, b)\n  {\n    out.x = Math.min(a.x, b.x);\n    out.y = Math.min(a.y, b.y);\n    out.z = Math.min(a.z, b.z);\n    out.angle = Math.min(a.angle, b.angle);\n    return out;\n  },\n  max: function(out, a, b)\n  {\n    out.x = Math.max(a.x, b.x);\n    out.y = Math.max(a.y, b.y);\n    out.z = Math.max(a.z, b.z);\n    out.angle = Math.max(a.angle, b.angle);\n    return out;\n  },\n  dot: function(a, b)\n  {\n    return a.x * b.x + a.y * b.y + a.z * b.z + a.angle * b.angle;\n  },\n  random: function(out, min, max)\n  {\n    out.x = (max.x - min.x) * Math.random() + min.x;\n    out.y = (max.y - min.y) * Math.random() + min.y;\n    out.z = (max.z - min.z) * Math.random() + min.z;\n    out.angle = (max.angle - min.angle) * Math.random() + min.angle;\n    return out;\n  }\n});\n\n\n\n/**\n * A calculator for objects with r, g, & b components (numbers 0 -> 255)\n *\n * @class CalculatorRGB\n * @constructor\n * @extends Calculator\n */\nfunction CalculatorRGB()\n{\n  this.createConstants();\n}\n\nClass.extend( CalculatorRGB, Calculator,\n{\n  parse: function(x, defaultValue, ignoreRelative)\n  {\n    // Values computed live.\n    if ( isFunction( x ) )\n    {\n      return x;\n    }\n\n    // Value computed from current value on animator.\n    if ( x === true )\n    {\n      return computed.current;\n    }\n\n    // When a number is given a grayscale color is returned.\n    if ( isNumber( x ) )\n    {\n      return {\n        r: x,\n        g: x,\n        b: x\n      };\n    }\n\n    // When an array is given, assume [r, g, b]\n    if ( isArray( x ) )\n    {\n      x = { r: x[0], g: x[1], b: x[2] };\n    }\n\n    // Default when there is none given\n    var def = coalesce( defaultValue, Defaults.calculatorRGB );\n\n    // When an object is given, check for relative values.\n    if ( isObject( x ) )\n    {\n      var cr = coalesce( x.r, def.r );\n      var cg = coalesce( x.g, def.g );\n      var cb = coalesce( x.b, def.b );\n      var rr = $number( cr, false );\n      var rg = $number( cg, false );\n      var rb = $number( cb, false );\n\n      if ( rr !== false && rg !== false && rb !== false )\n      {\n        var parsed = { r: rr, g: rg, b: rb };\n        var ir = isRelative( cr );\n        var ig = isRelative( cg );\n        var ib = isRelative( cb );\n\n        if ( !ignoreRelative && (ir || ig || ib) )\n        {\n          var mask = {\n            r: ir ? 1 : 0,\n            g: ig ? 1 : 0,\n            b: ib ? 1 : 0\n          };\n\n          return computed.relative( parsed, mask );\n        }\n\n        return parsed;\n      }\n    }\n\n    // Try to parse the color.\n    var parsed = Color.parse( x );\n\n    if ( parsed !== false )\n    {\n      return parsed;\n    }\n\n    if ( isString( x ) )\n    {\n      // If only a relative value is given it will modify the R, G, & B components.\n      if ( isRelative( x ) )\n      {\n        var rx = $number( x, false );\n\n        if ( !ignoreRelative && rx !== false )\n        {\n          return computed.relative( { r: rx, g: rx, b: rx } );\n        }\n      }\n\n      var pair = x.split(/[\\s,|]/);\n\n      return {\n        r: $number( pair[0], def.r ),\n        g: $number( pair[1], def.g ),\n        b: $number( pair[2], def.b )\n      };\n    }\n\n    // If no value was given but the default value was given, clone it.\n    return this.clone( def );\n  },\n  copy: function(out, copy)\n  {\n    out.r = copy.r;\n    out.g = copy.g;\n    out.b = copy.b;\n    return out;\n  },\n  create: function()\n  {\n    return {r: 0, g:0, b:0};\n  },\n  zero: function(out)\n  {\n    out.r = 0;\n    out.g = 0;\n    out.b = 0;\n    return out;\n  },\n  convert: function(out, converter)\n  {\n    out.r = converter( out.r );\n    out.g = converter( out.g );\n    out.b = converter( out.b );\n    return out;\n  },\n  adds: function(out, amount, amountScale)\n  {\n    out.r += amount.r * amountScale;\n    out.g += amount.g * amountScale;\n    out.b += amount.b * amountScale;\n    return out;\n  },\n  mul: function(out, scale)\n  {\n    out.r *= scale.r;\n    out.g *= scale.g;\n    out.b *= scale.b;\n    return out;\n  },\n  div: function(out, denominator)\n  {\n    out.r = denominator.r ? out.r / denominator.r : 0;\n    out.g = denominator.g ? out.g / denominator.g : 0;\n    out.b = denominator.b ? out.b / denominator.b : 0;\n    return out;\n  },\n  interpolate: function(out, start, end, delta)\n  {\n    out.r = (end.r - start.r) * delta + start.r;\n    out.g = (end.g - start.g) * delta + start.g;\n    out.b = (end.b - start.b) * delta + start.b;\n    return out;\n  },\n  distanceSq: function(a, b)\n  {\n    var dr = a.r - b.r;\n    var dg = a.g - b.g;\n    var db = a.b - b.b;\n    return dr * dr + dg * dg + db * db;\n  },\n  isValid: function(a)\n  {\n    return isObject( a ) && 'r' in a && 'g' in a && 'b' in a;\n  },\n  isNaN: function(a)\n  {\n    return isNaN(a.r) || isNaN(a.g) || isNaN(a.b);\n  },\n  isZero: function(a, epsilon)\n  {\n    return Math.abs(a.r) < epsilon &&\n           Math.abs(a.g) < epsilon &&\n           Math.abs(a.b) < epsilon;\n  },\n  isEqual: function(a, b, epsilon)\n  {\n    return Math.abs(a.r - b.r) < epsilon &&\n           Math.abs(a.g - b.g) < epsilon &&\n           Math.abs(a.b - b.b) < epsilon;\n  },\n  min: function(out, a, b)\n  {\n    out.r = Math.min(a.r, b.r);\n    out.g = Math.min(a.g, b.g);\n    out.b = Math.min(a.b, b.b);\n    return out;\n  },\n  max: function(out, a, b)\n  {\n    out.r = Math.max(a.r, b.r);\n    out.g = Math.max(a.g, b.g);\n    out.b = Math.max(a.b, b.b);\n    return out;\n  },\n  dot: function(a, b)\n  {\n    return a.r * b.r + a.g * b.g + a.b * b.b;\n  },\n  random: function(out, min, max)\n  {\n    out.r = (max.r - min.r) * Math.random() + min.r;\n    out.g = (max.g - min.g) * Math.random() + min.g;\n    out.b = (max.b - min.b) * Math.random() + min.b;\n    return out;\n  }\n});\n\n\n/**\n * A calculator for objects with r, g, & b components\n * (numbers 0 -> 255) and an a (alpha) component (0.0 -> 1.0).\n *\n * @class CalculatorRGBA\n * @constructor\n * @extends Calculator\n */\nfunction CalculatorRGBA()\n{\n  this.createConstants();\n}\n\nClass.extend( CalculatorRGBA, Calculator,\n{\n  parse: function(x, defaultValue, ignoreRelative)\n  {\n    // Values computed live.\n    if ( isFunction( x ) )\n    {\n      return x;\n    }\n\n    // Value computed from current value on animator.\n    if ( x === true )\n    {\n      return computed.current;\n    }\n\n    // When a number is given an opaque grayscale color is returned.\n    if ( isNumber( x ) )\n    {\n      return {\n        r: x,\n        g: x,\n        b: x,\n        a: 1.0\n      };\n    }\n\n    // When an array is given, assume [r, g, b, a]\n    if ( isArray( x ) )\n    {\n      x = { r: x[0], g: x[1], b: x[2], a: x[3] };\n    }\n\n    // Default when there is none given\n    var def = coalesce( defaultValue, Defaults.calculatorRGBA );\n\n    // When an object is given, check for relative values.\n    if ( isObject( x ) )\n    {\n      var cr = coalesce( x.r, def.r );\n      var cg = coalesce( x.g, def.g );\n      var cb = coalesce( x.b, def.b );\n      var ca = coalesce( x.a, def.a );\n      var rr = $number( cr, false );\n      var rg = $number( cg, false );\n      var rb = $number( cb, false );\n      var ra = $number( ca, false );\n\n      if ( rr !== false && rg !== false && rb !== false && ra !== false )\n      {\n        var parsed = { r: rr, g: rg, b: rb, a: ra };\n        var ir = isRelative( cr );\n        var ig = isRelative( cg );\n        var ib = isRelative( cb );\n        var ia = isRelative( ca );\n\n        if ( !ignoreRelative && (ir || ig || ib || ia) )\n        {\n          var mask = {\n            r: ir ? 1 : 0,\n            g: ig ? 1 : 0,\n            b: ib ? 1 : 0,\n            a: ia ? 1 : 0\n          };\n\n          return computed.relative( parsed, mask );\n        }\n\n        return parsed;\n      }\n    }\n\n    // Try to parse the color.\n    var parsed = Color.parse( x );\n\n    if ( parsed !== false )\n    {\n      return parsed;\n    }\n\n    if ( isString( x ) )\n    {\n      // If only a relative value is given it will modify the R, G, & B components.\n      if ( isRelative( x ) )\n      {\n        var rx = $number( x, false );\n\n        if ( !ignoreRelative && rx !== false )\n        {\n          return computed.relative( { r: rx, g: rx, b: rx, a: 0 } );\n        }\n      }\n\n      var pair = x.split(/[\\s,|]/);\n\n      return {\n        r: $number( pair[0], def.r ),\n        g: $number( pair[1], def.g ),\n        b: $number( pair[2], def.b ),\n        a: $number( pair[3], def.a )\n      };\n    }\n\n    // If no value was given but the default value was given, clone it.\n    return this.clone( def );\n  },\n  copy: function(out, copy)\n  {\n    out.r = copy.r;\n    out.g = copy.g;\n    out.b = copy.b;\n    out.a = copy.a;\n    return out;\n  },\n  create: function()\n  {\n    return {r: 0, g:0, b:0, a:0};\n  },\n  zero: function(out)\n  {\n    out.r = 0;\n    out.g = 0;\n    out.b = 0;\n    out.a = 0;\n    return out;\n  },\n  convert: function(out, converter)\n  {\n    out.r = converter( out.r );\n    out.g = converter( out.g );\n    out.b = converter( out.b );\n    out.a = converter( out.a );\n    return out;\n  },\n  adds: function(out, amount, amountScale)\n  {\n    out.r += amount.r * amountScale;\n    out.g += amount.g * amountScale;\n    out.b += amount.b * amountScale;\n    out.a += amount.a * amountScale;\n    return out;\n  },\n  mul: function(out, scale)\n  {\n    out.r *= scale.r;\n    out.g *= scale.g;\n    out.b *= scale.b;\n    out.a *= scale.a;\n    return out;\n  },\n  div: function(out, denominator)\n  {\n    out.r = denominator.r ? out.r / denominator.r : 0;\n    out.g = denominator.g ? out.g / denominator.g : 0;\n    out.b = denominator.b ? out.b / denominator.b : 0;\n    out.a = denominator.a ? out.a / denominator.a : 0;\n    return out;\n  },\n  interpolate: function(out, start, end, delta)\n  {\n    out.r = (end.r - start.r) * delta + start.r;\n    out.g = (end.g - start.g) * delta + start.g;\n    out.b = (end.b - start.b) * delta + start.b;\n    out.a = (end.a - start.a) * delta + start.a;\n    return out;\n  },\n  distanceSq: function(a, b)\n  {\n    var dr = a.r - b.r;\n    var dg = a.g - b.g;\n    var db = a.b - b.b;\n    var da = a.a - b.a;\n    return dr * dr + dg * dg + db * db + da * da;\n  },\n  isValid: function(a)\n  {\n    return isObject( a ) && 'r' in a && 'g' in a && 'b' in a && 'a' in a;\n  },\n  isNaN: function(a)\n  {\n    return isNaN(a.r) || isNaN(a.g) || isNaN(a.b) || isNaN(a.a);\n  },\n  isZero: function(a, epsilon)\n  {\n    return Math.abs(a.r) < epsilon &&\n           Math.abs(a.g) < epsilon &&\n           Math.abs(a.b) < epsilon &&\n           Math.abs(a.a) < epsilon;\n  },\n  isEqual: function(a, b, epsilon)\n  {\n    return Math.abs(a.r - b.r) < epsilon &&\n           Math.abs(a.g - b.g) < epsilon &&\n           Math.abs(a.b - b.b) < epsilon &&\n           Math.abs(a.a - b.a) < epsilon;\n  },\n  min: function(out, a, b)\n  {\n    out.r = Math.min(a.r, b.r);\n    out.g = Math.min(a.g, b.g);\n    out.b = Math.min(a.b, b.b);\n    out.a = Math.min(a.a, b.a);\n    return out;\n  },\n  max: function(out, a, b)\n  {\n    out.r = Math.max(a.r, b.r);\n    out.g = Math.max(a.g, b.g);\n    out.b = Math.max(a.b, b.b);\n    out.a = Math.max(a.a, b.a);\n    return out;\n  },\n  dot: function(a, b)\n  {\n    return a.r * b.r + a.g * b.g + a.b * b.b + a.a * b.a;\n  },\n  random: function(out, min, max)\n  {\n    out.r = (max.r - min.r) * Math.random() + min.r;\n    out.g = (max.g - min.g) * Math.random() + min.g;\n    out.b = (max.b - min.b) * Math.random() + min.b;\n    out.a = (max.a - min.a) * Math.random() + min.a;\n    return out;\n  }\n});\n\n\n/**\n * A calculator for strings.\n *\n * @class CalculatorString\n * @constructor\n * @extends Calculator\n */\nfunction CalculatorString()\n{\n  this.createConstants();\n}\n\nClass.extend( CalculatorString, Calculator,\n{\n  parse: function(x, defaultValue, ignoreRelative)\n  {\n    // Values computed live.\n    if ( isFunction( x ) )\n    {\n      return x;\n    }\n\n    // Value computed from current value on animator.\n    if ( x === true )\n    {\n      return computed.current;\n    }\n\n    // An array\n    if ( isArray( x ) )\n    {\n      x = x[ 0 ];\n    }\n\n    // A raw string\n    if ( isString( x ) )\n    {\n      return x;\n    }\n\n    return coalesce( defaultValue, Defaults.calculatorString );\n  },\n  copy: function(out, copy)\n  {\n    return copy;\n  },\n  create: function()\n  {\n    return '';\n  },\n  zero: function(out)\n  {\n    return '';\n  },\n  convert: function(out, converter)\n  {\n    return converter( out );\n  },\n  adds: function(out, amount, amountScale)\n  {\n    return amount;\n  },\n  mul: function(out, scale)\n  {\n    return scale;\n  },\n  div: function(out, denominator)\n  {\n    return out;\n  },\n  interpolate: function(out, start, end, delta)\n  {\n    return delta < 0.5 ? start : end;\n  },\n  distanceSq: function(a, b)\n  {\n    var d = Math.abs( a.length - b.length );\n    return d * d;\n  },\n  distance: function(a, b)\n  {\n    return Math.abs( a.length - b.length );\n  },\n  length: function(a)\n  {\n    return a.length;\n  },\n  lengthSq: function(a)\n  {\n    return a.length * a.length;\n  },\n  isValid: function(a)\n  {\n    return typeof a === 'string';\n  },\n  isNaN: function(a)\n  {\n    return false;\n  },\n  isZero: function(a, epsilon)\n  {\n    return a.length <= epsilon;\n  },\n  isEqual: function(a, b, epsilon)\n  {\n    return a === b;\n  },\n  min: function(out, a, b)\n  {\n    return a < b ? a : b;\n  },\n  max: function(out, a, b)\n  {\n    return a > b ? a : b;\n  },\n  dot: function(a, b)\n  {\n    return a.length * b.length;\n  }\n});\n\n\n/**\n * A factory for plain objects.\n *\n * @class FactoryObject\n * @constructor\n * @extends Factory\n */\nfunction FactoryObject()\n{\n  this.priority = 0;\n  this.attributes = {};\n}\n\nClass.extend( FactoryObject, Factory,\n{\n  is: function(subject)\n  {\n    return isObject( subject ) && !isArray( subject ); /* !isElement( subject ) && */\n  },\n  animatorFor: function(subject)\n  {\n    var animator = subject.$animator;\n\n    if ( !animator )\n    {\n      animator = new Animator( subject );\n      animator.factory = this;\n\n      subject.$animator = animator;\n    }\n\n    return animator;\n  },\n  destroy: function(animator)\n  {\n    delete animator.subject.$animator;\n  },\n  attribute: function(attr)\n  {\n    var attribute = this.attributes[ attr ];\n\n    if ( !attribute )\n    {\n      attribute = this.attributes[ attr ] = object.attribute( attr );\n\n      var calculatorName = attribute.calculator;\n      var calculator = $calculator( calculatorName );\n      var defaultValue = calculator.parse( attribute.defaultValue, calculator.ZERO );\n\n      attribute.calculatorName = calculatorName;\n      attribute.calculator = calculator;\n      attribute.defaultValue = defaultValue;\n      attribute.name = attr;\n      attribute.parse = function(value, ignoreRelative) {\n        return this.calculator.parse( value, this.defaultValue, ignoreRelative );\n      };\n      attribute.cloneDefault = function() {\n        return this.calculator.clone( this.defaultValue );\n      };\n    }\n\n    return attribute;\n  }\n});\n\n/**\n * The Object namespace.\n *\n * @type {Object}\n */\nvar object = {};\n\n/**\n * Returns an attribute based on the given input. If the input is an object it's assumed to be an attribute and it's\n * returned immediately. If the input is a string the attribute with the given name is returned. Otherwise\n * the default attribute is returned.\n *\n * @param {Object|String} attr\n * @return {Object}\n */\nobject.attribute = function(attr)\n{\n  if ( isObject( attr ) && isDefined( attr.defaultValue ) )\n  {\n    return attr;\n  }\n  if ( isString( attr ) && attr in object.attribute )\n  {\n    return object.attribute[ attr ];\n  }\n\n  return object.attribute['default'];\n};\n\n/**\n * The default attribute.\n */\nobject.attribute['default']                 = {defaultValue: 0};\n\n\n/**\n * Instantiates a new parser for the 'and' animation type.\n *\n * @class BuilderAnd\n * @constructor\n * @extends Builder\n */\nfunction BuilderAnd()\n{\n\n}\n\nClass.extend( BuilderAnd, Builder,\n{\n  parse: function( animation, options, attrimatorMap, helper )\n  {\n    var and = animation.and;\n\n    and.factory = coalesce( and.factory, animation.factory );\n\n    attrimatorMap.putMap( $attrimatorsFor( and, options, false, helper.forObject ) );\n  },\n\n  merge: function( input, newOptions, oldOptions, attrimatorMap, helper )\n  {\n    this.submerge( input.and, newOptions, oldOptions, attrimatorMap );\n  }\n});\n\n\n/**\n * Instantiates a new parser for the 'deltas' & 'values' animation type.\n *\n * @class BuilderDeltas\n * @constructor\n * @extends Builder\n */\nfunction BuilderDeltas()\n{\n\n}\n\nClass.extend( BuilderDeltas, Builder,\n{\n  parse: function( animation, options, attrimatorMap, helper )\n  {\n    // 1. If deltas wasn't specified, assume a uniform distribution of points\n    // 2. If deltas was an array, expand out into an object where the keys are attributes and the value is the delta array\n    // 3. Generate the attrimators\n\n    var mergeId = Builder.nextMergeId();\n    var factory = $factory( animation.factory, helper.forObject );\n    var deltas = animation.deltas;\n    var values = animation.values;\n\n    if ( !isDefined( deltas ) )\n    {\n      deltas = {};\n    }\n    else if ( isArray( deltas ) )\n    {\n      var deltaObject = {};\n\n      for (var attr in values)\n      {\n        deltaObject[attr] = deltas;\n      }\n\n      deltas = deltaObject;\n    }\n\n    for (var attr in values)\n    {\n      var value = values[ attr ];\n      var valueMax = value.length - 1;\n      var delta = deltas[ attr ];\n      var attribute = factory.attribute( attr );\n\n      for (var k = 0; k <= valueMax; k++)\n      {\n        value[k] = attribute.parse( value[k] );\n      }\n\n      if ( !isArray( delta ) )\n      {\n        delta = [];\n\n        for (var i = 0; i <= valueMax; i++)\n        {\n          delta[i] = i / valueMax;\n        }\n      }\n\n      var path      = new PathDelta( attr, attribute.calculator, value, delta );\n      var event     = helper.parseEvent( attr, path, this, true );\n\n      event.mergeId = mergeId;\n\n      attrimatorMap.put( attr, event );\n    }\n  }\n});\n\n\n/**\n * Instantiates a new builder for the 'final' animation type.\n *\n * @class BuilderFinal\n * @constructor\n * @extends Builder\n */\nfunction BuilderFinal()\n{\n\n}\n\nClass.extend( BuilderFinal, Builder,\n{\n  parse: function( animation, options, attrimatorMap, helper )\n  {\n    // 1. Generate the attrimators, only caring about the delays and durations\n\n    var factory = $factory( animation.factory, helper.forObject );\n    var values = animation.final;\n\n    for (var attr in values)\n    {\n      var attribute  = factory.attribute( attr );\n      var value      = attribute.parse( values[ attr ] );\n      var delay      = $delay( helper.parseDelay( attr ) );\n      var duration   = $duration( helper.parseDuration( attr ) );\n      var event      = new Oncer( attr, value, delay + duration, false, this, null, animation );\n\n      attrimatorMap.put( attr, event );\n    }\n  },\n  mergeAttrimator: function( e, attr, helper, factory )\n  {\n    e.delay = helper.mergeDelay( attr, e.delay ) +\n              helper.mergeDuration( attr, e.duration );\n  }\n});\n\n\n/**\n * Instantiates a new parser for the 'initial' animation type.\n *\n * @class BuilderInitial\n * @constructor\n * @extends Builder\n */\nfunction BuilderInitial()\n{\n\n}\n\nClass.extend( BuilderInitial, Builder,\n{\n  parse: function( animation, options, attrimatorMap, helper )\n  {\n    // 1. Generate the attrimators, only caring about the delays & scales\n\n    var factory    = $factory( animation.factory, helper.forObject );\n    var values     = animation.initial;\n\n    for (var attr in values)\n    {\n      var attribute  = factory.attribute( attr );\n      var value      = attribute.parse( values[ attr ] );\n      var delay      = helper.parseDelay( attr );\n      var oncer      = new Oncer( attr, value, delay, true, this, null, animation );\n\n      attrimatorMap.put( attr, oncer );\n    }\n  },\n  mergeAttrimator: function( e, attr, helper, factory )\n  {\n    e.delay = helper.mergeDelay( attr, e.delay );\n  }\n});\n\n\n/**\n * Instantiates a new parser for the 'keyframe' animation type.\n *\n * @class BuilderKeyframe\n * @constructor\n * @extends Builder\n */\nfunction BuilderKeyframe()\n{\n\n}\n\nClass.extend( BuilderKeyframe, Builder,\n{\n  aliases: {\n    from:     '0',\n    start:    '0',\n    initial:  '0',\n    first:    '0',\n    half:     '50',\n    middle:   '50',\n    to:       '100',\n    end:      '100',\n    last:     '100'\n  },\n\n  parse: function( animation, options, attrimatorMap, helper )\n  {\n    // 1. Normalize keys by converting aliases to the actual value\n    // 2. Split up keys that have commas into multiple entries\n    // 3. Validate keys and remove invalid ones - also calculate max key value\n    // 4. Sort frames by the key\n    // 5. Expand frames to generate delta arrays, value arrays, and easing arrays\n    // 6. Generate the attrimators\n\n    var factory = $factory( animation.factory, helper.forObject );\n    var kframes = animation.keyframe;\n    var easings = animation.easings || {};\n    var teasing = $easing( coalesce( options.teasing, Defaults.teasing ) );\n\n    var sort = false;\n\n    // split up comma delimited times\n    for (var time in kframes)\n    {\n      if ( time in this.aliases )\n      {\n        kframes[ this.aliases[time] ] = kframes[ time ];\n\n        delete kframes[ time ];\n      }\n      else if ( time.indexOf(',') !== -1 )\n      {\n        var times = time.split(',');\n\n        for (var i = 0; i < times.length; i++)\n        {\n          kframes[times[i]] = kframes[time];\n        }\n\n        delete kframes[time];\n\n        sort = true;\n      }\n    }\n\n    var times = [];\n\n    // validate times\n    var lastTime = 0.0;\n    var maxTime = 0.0;\n\n    for (var time in kframes)\n    {\n      var t = parseFloat(time);\n\n      if (isNaN(t))\n      {\n        delete kframes[time];\n      }\n      else\n      {\n        if (t < lastTime)\n        {\n          sort = true;\n        }\n\n        times.push({\n          order: t,\n          key: time,\n          value: kframes[time]\n        });\n\n        lastTime = t;\n\n        maxTime = Math.max( maxTime, t );\n      }\n    }\n\n    // sort if necessary\n    if (sort)\n    {\n      times.sort(function(a, b)\n      {\n        return a.order - b.order;\n      });\n\n      kframes = {};\n\n      for (var i = 0; i < times.length; i++)\n      {\n        kframes[times[i].key] = times[i].value;\n      }\n    }\n\n    // split up into deltas and values\n    var deltas = {};\n    var values = {};\n    var pathEasings = {};\n    var attributes = {};\n\n    for (var i = 0; i < times.length; i++)\n    {\n      var frame = times[i];\n      var easing = coalesce( frame.value.easing, options.easing );\n\n      delete frame.value.easing;\n\n      for (var attr in frame.value)\n      {\n        if ( !(attr in deltas) )\n        {\n          deltas[attr] = [];\n          values[attr] = [];\n          pathEasings[attr] = [];\n          attributes[attr] = factory.attribute( attr );\n        }\n\n        deltas[attr].push( frame.order / maxTime );\n        values[attr].push( attributes[ attr ].parse( frame.value[ attr ] ) );\n        pathEasings[attr].push( $easing( coalesce( easings[ attr ], easing ) ) );\n      }\n    }\n\n    // create events & paths\n    for (var attr in deltas)\n    {\n      var duration    = helper.parseDuration( attr );\n      var delay       = helper.parseDelay( attr );\n      var sleep       = helper.parseSleep( attr );\n      var offset      = helper.parseOffset( attr );\n      var repeat      = helper.parseRepeat( attr );\n      var scale       = helper.parseScale( attr );\n      var scaleBase   = helper.parseScaleBase( attr );\n      var parameters  = helper.parseParameters();\n      var path        = new PathKeyframe( attr, attributes[attr].calculator, values[attr], deltas[attr], pathEasings[attr] );\n      var event       = new Event( attr, path, duration, teasing, delay, sleep, offset, repeat, scale, scaleBase, parameters, true, this, null, animation );\n\n      attrimatorMap.put( attr, event );\n    }\n  }\n});\n\n\n/**\n * Instantiates a new parser for the 'move' animation type.\n *\n * @class BuilderMove\n * @constructor\n * @extends Builder\n */\nfunction BuilderMove()\n{\n\n}\n\nClass.extend( BuilderMove, Builder,\n{\n  parse: function( animation, options, attrimatorMap, helper )\n  {\n    // 1. Starting values are all true which signals to Animator to replace those points with the animator's current values.\n\n    var factory    = $factory( animation.factory, helper.forObject );\n    var move       = animation.move;\n\n    for (var attr in move)\n    {\n      var attribute  = factory.attribute( attr );\n      var value      = attribute.parse( move[ attr ] );\n      var path       = new Tween( attr, attribute.calculator, computed.current, computed.relative( value ) );\n      var event      = helper.parseEvent( attr, path, this, true );\n\n      attrimatorMap.put( attr, event );\n    }\n  }\n});\n\n\n/**\n * Instantiates a new parser for the 'path' animation type.\n *\n * @class BuilderPath\n * @constructor\n * @extends Builder\n */\nfunction BuilderPath()\n{\n\n}\n\nClass.extend( BuilderPath, Builder,\n{\n  parse: function( animation, options, attrimatorMap, helper )\n  {\n    var factory = $factory( animation.factory, helper.forObject );\n    var path    = animation.path;\n\n    for (var attr in path)\n    {\n      var attribute  = factory.attribute( attr );\n      var pathDefinition = path[ attr ];\n\n      if ( !( pathDefinition instanceof Path ) )\n      {\n        pathDefinition.name = attr;\n        pathDefinition.calculator = attribute.calculator;\n      }\n\n      var parsedPath = $path( pathDefinition );\n      var event      = helper.parseEvent( attr, parsedPath, this, true );\n\n      attrimatorMap.put( attr, event );\n    }\n  }\n});\n\n\n/**\n * Instantiates a new builder for the 'physics' animation type.\n *\n * @class BuilderPhysics\n * @constructor\n * @extends Builder\n */\nfunction BuilderPhysics()\n{\n\n}\n\nClass.extend( BuilderPhysics, Builder,\n{\n  parse: function( animation, options, attrimatorMap, helper )\n  {\n    var factory    = $factory( animation.factory, helper.forObject );\n    var physics    = animation.physics;\n\n    for (var attr in physics)\n    {\n      var physic    = physics[ attr ];\n\n      var attrimator = new Physics(\n        attr,\n        this,\n        physic.calculator,\n        coalesce( physic.position, true ),\n        physic.velocity,\n        physic.acceleration,\n        physic.terminal,\n        physic.stopAt\n      );\n\n      attrimatorMap.put( attr, attrimator );\n    }\n  },\n\n  merge: false\n});\n\n\n/**\n * Instantiates a new parser for the 'point' animation type.\n *\n * @class BuilderPoint\n * @constructor\n * @extends Builder\n */\nfunction BuilderPoint()\n{\n\n}\n\nClass.extend( BuilderPoint, Builder,\n{\n  parse: function( animation, options, attrimatorMap, helper )\n  {\n    var factory    = $factory( animation.factory, helper.forObject );\n    var values     = animation.point;\n\n    for (var attr in values)\n    {\n      var attribute  = factory.attribute( attr );\n      var value      = attribute.parse( values[ attr ] );\n      var path       = new PathPoint( attr, attribute.calculator, value );\n      var event      = helper.parseEvent( attr, path, this, true );\n\n      attrimatorMap.put( attr, event );\n    }\n  }\n});\n\n\n/**\n * Instantiates a new parser for the 'and' animation type.\n *\n * @class BuilderQueue\n * @constructor\n * @extends Builder\n */\nfunction BuilderQueue()\n{\n\n}\n\nClass.extend( BuilderQueue, Builder,\n{\n  parse: function( animation, options, attrimatorMap, helper )\n  {\n    var queue = animation.queue;\n\n    queue.factory = coalesce( queue.factory, animation.factory );\n\n    attrimatorMap.queueMap( $attrimatorsFor( queue, options, false, helper.forObject ) );\n  },\n\n  merge: function( input, newOptions, oldOptions, attrimatorMap, helper )\n  {\n    this.submerge( input.queue, newOptions, oldOptions, attrimatorMap );\n  }\n});\n\n\n/**\n * Instantiates a new parser for the 'springs' animation type.\n *\n * @class BuilderSpring\n * @constructor\n * @extends Builder\n */\nfunction BuilderSpring()\n{\n\n}\n\nClass.extend( BuilderSpring, Builder,\n{\n  parse: function( animation, options, attrimatorMap, helper )\n  {\n    var factory    = $factory( animation.factory, helper.forObject );\n    var springs    = animation.springs;\n\n    for (var attr in springs)\n    {\n      var spring     = springs[ attr ];\n\n      if ( !isDefined( spring.attribute ) )\n      {\n        spring.attribute = attr;\n      }\n\n      var parsed = $spring( spring );\n\n      if ( parsed !== false )\n      {\n        parsed.parser = this;\n\n        attrimatorMap.put( attr, parsed );\n      }\n    }\n  },\n\n  merge: false\n});\n\n\n/**\n * Instantiates a new parser for the 'travel' animation type.\n *\n * @class BuilderTravel\n * @constructor\n * @extends Builder\n */\nfunction BuilderTravel()\n{\n\n}\n\nClass.extend( BuilderTravel, Builder,\n{\n  parse: function( animation, options, attrimatorMap, helper )\n  {\n    // 1. Starting values are all true which signals to Animator to replace those points with the animator's current values.\n\n    var factory    = $factory( animation.factory, helper.forObject );\n    var travel     = animation.travel;\n\n    for (var attr in travel)\n    {\n      var traveling     = travel[ attr ];\n      var attribute     = factory.attribute( attr );\n      var fromParsed    = attribute.parse( coalesce( traveling.from, true ) );\n      var toParsed      = attribute.parse( coalesce( traveling.to, true ) );\n      var velocity      = $number( traveling.velocity, 0 );\n      var acceleration  = $number( traveling.acceleration, 0 );\n      var terminal      = $number( coalesce( traveling.terminal, traveling.velocity ), Number.POSITIVE_INFINITY );\n      var epsilon       = $number( traveling.epsilon, 0.001 );\n\n      if ( acceleration !== 0 )\n      {\n        acceleration = computed.pointing( acceleration, toParsed, epsilon, true );\n      }\n\n      if ( velocity !== 0 )\n      {\n        velocity = computed.pointing( velocity, toParsed, epsilon, false );\n      }\n\n      var traveler = new Physics(\n        attr,\n        this,\n        attribute.calculator,\n        fromParsed,\n        velocity,\n        acceleration,\n        terminal\n      );\n\n      attrimatorMap.put( attr, traveler );\n    }\n  },\n\n  merge: false\n});\n\n/**\n * The computed function which returns a function which returns a value pointing\n * to a given target given the current position of the animator.\n *\n * @param  {Number}\n * @param  {any}\n * @param  {Number}\n * @return {Function}\n */\ncomputed('pointing', function(amount, target, epsilon, subtractVelocity)\n{\n  function pointingFunction(attrimator, animator)\n  {\n    var attribute = animator.getAttribute( attrimator.attribute );\n    var calc = attribute.calculator;\n    var targetValue = isComputed( target ) ? target( attrimator, animator ) : target;\n    var temp = calc.create();\n\n    return function()\n    {\n      var position   = attrimator.position;\n      var current    = calc.copy( temp, resolve( targetValue ) );\n      var difference = calc.sub( current, position );\n      var distance   = calc.distance( difference, calc.ZERO );\n\n      if ( distance < epsilon )\n      {\n        attrimator.stopIn( 0 );\n      }\n      else\n      {\n        difference = calc.scale( difference, amount / distance );\n      }\n\n      if ( subtractVelocity )\n      {\n        difference = calc.sub( difference, attrimator.resolveVelocity() );\n      }\n\n      return difference;\n    };\n  }\n\n  return computed( pointingFunction );\n});\n\n\n/**\n * Instantiates a new builder for the 'tweenFrom' animation type.\n *\n * @class BuilderTweenFrom\n * @constructor\n * @extends Builder\n */\nfunction BuilderTweenFrom()\n{\n\n}\n\nClass.extend( BuilderTweenFrom, Builder,\n{\n  parse: function( animation, options, attrimatorMap, helper )\n  {\n    // 1. Starting values are all true which signals to Animator to replace those points with the animator's current values.\n\n    var factory    = $factory( animation.factory, helper.forObject );\n    var tweenFrom  = animation.tweenFrom;\n\n    for (var attr in tweenFrom)\n    {\n      var attribute  = factory.attribute( attr );\n      var value      = attribute.parse( tweenFrom[ attr ] );\n      var path       = new Tween( attr, attribute.calculator, value, computed.current );\n      var event      = helper.parseEvent( attr, path, this, true );\n\n      attrimatorMap.put( attr, event );\n    }\n  }\n});\n\n\n/**\n * Instantiates a new parser for the 'tweenTo' animation type.\n *\n * @class BuilderTweenTo\n * @constructor\n * @extends Builder\n */\nfunction BuilderTweenTo()\n{\n\n}\n\nClass.extend( BuilderTweenTo, Builder,\n{\n  parse: function( animation, options, attrimatorMap, helper )\n  {\n    // 1. Starting values are all true which signals to Animator to replace those points with the animator's current values.\n\n    var factory    = $factory( animation.factory, helper.forObject );\n    var tweenTo    = animation.tweenTo;\n\n    for (var attr in tweenTo)\n    {\n      var attribute  = factory.attribute( attr );\n      var value      = attribute.parse( tweenTo[ attr ] );\n      var path       = new Tween( attr, attribute.calculator, computed.current, value );\n      var event      = helper.parseEvent( attr, path, this, true );\n\n      attrimatorMap.put( attr, event );\n    }\n  }\n});\n\n\n/**\n * Instantiates a new PathDelta.\n *\n * @param {String|false} name\n * @param {Calculator} calculator\n * @param {Array} points\n * @param {Array} deltas\n * @class PathDelta\n * @constructor\n * @extends Path\n */\nfunction PathDelta(name, calculator, points, deltas)\n{\n  this.name = name;\n  this.set( calculator, points, deltas );\n}\n\nClass.extend( PathDelta, Path,\n{\n  set: function(calculator, points, deltas)\n  {\n    this.reset( calculator, points );\n    this.deltas = $deltas( deltas );\n  },\n\n  compute: function(out, delta)\n  {\n    var ds = this.deltas;\n    var end = ds.length - 2;\n    var i = 0;\n    while (ds[i + 1] < delta && i < end) {\n      i++;\n    }\n    var d0 = ds[i];\n    var d1 = ds[i + 1];\n    var pd = (delta - d0) / (d1 - d0);\n    var p0 = this.resolvePoint( i, delta );\n    var p1 = this.resolvePoint( i + 1, delta );\n\n    return this.calculator.interpolate( out, p0, p1, pd );\n  },\n\n  copy: function()\n  {\n    return new PathDelta( this.name, this.calculator, copy(this.points), copy(this.deltas) );\n  }\n});\n\n\n/**\n * Instantiates a new PathParametric.\n *\n * @param {String|false} name\n * @param {Calculator} calculator\n * @param {Array} points\n * @param {Boolean} loop\n * @param {Array} matrix\n * @param {Number} weight\n * @class PathParametric\n * @constructor\n * @extends Path\n */\nfunction PathParametric(name, calculator, points, loop, matrix, weight, invert)\n{\n  this.name = name;\n  this.set( calculator, points, loop, matrix, weight, invert );\n}\n\nClass.extend( PathParametric, Path,\n{\n  set: function(calculator, points, loop, matrix, weight, invert)\n  {\n    this.reset( calculator, points );\n    this.loop = loop;\n    this.matrix = matrix;\n    this.weight = weight;\n    this.invert = invert;\n    this.temp = calculator.create();\n  },\n\n  compute: function(out, delta)\n  {\n    var calc = this.calculator;\n    var temp = this.temp;\n    var matrix = this.matrix;\n    var n = this.points.length - 1;\n    var a = delta * n;\n    var i = clamp( Math.floor( a ), 0, n - 1 );\n    var d = a - i;\n\n    var p0 = this.resolvePoint( i - 1, delta );\n    var p1 = this.resolvePoint( i, delta );\n    var p2 = this.resolvePoint( i + 1, delta );\n    var p3 = this.resolvePoint( i + 2, delta );\n\n    var d0, d1, d2, d3;\n    if (this.invert) {\n      d3 = 1;\n      d2 = d;\n      d1 = d * d2;\n      d0 = d * d1;\n    } else {\n      d0 = 1;\n      d1 = d;\n      d2 = d * d1;\n      d3 = d * d2;\n    }\n\n    out = calc.zero( out );\n\n    temp = calc.zero( temp );\n    temp = calc.adds( temp, p0, matrix[0][0] );\n    temp = calc.adds( temp, p1, matrix[0][1] );\n    temp = calc.adds( temp, p2, matrix[0][2] );\n    temp = calc.adds( temp, p3, matrix[0][3] );\n    out = calc.adds( out, temp, d0 );\n\n    temp = calc.zero( temp );\n    temp = calc.adds( temp, p0, matrix[1][0] );\n    temp = calc.adds( temp, p1, matrix[1][1] );\n    temp = calc.adds( temp, p2, matrix[1][2] );\n    temp = calc.adds( temp, p3, matrix[1][3] );\n    out = calc.adds( out, temp, d1 );\n\n    temp = calc.zero( temp );\n    temp = calc.adds( temp, p0, matrix[2][0] );\n    temp = calc.adds( temp, p1, matrix[2][1] );\n    temp = calc.adds( temp, p2, matrix[2][2] );\n    temp = calc.adds( temp, p3, matrix[2][3] );\n    out = calc.adds( out, temp, d2 );\n\n    temp = calc.zero( temp );\n    temp = calc.adds( temp, p0, matrix[3][0] );\n    temp = calc.adds( temp, p1, matrix[3][1] );\n    temp = calc.adds( temp, p2, matrix[3][2] );\n    temp = calc.adds( temp, p3, matrix[3][3] );\n    out = calc.adds( out, temp, d3 );\n\n    out = calc.scale( out, this.weight );\n\n    return out;\n  },\n\n  resolvePoint: function(i)\n  {\n    var points = this.points;\n    var n = points.length;\n    var k = (this.loops ? (i + n) % n : clamp( i, 0, n - 1 ));\n\n    return resolve( points[ k ] );\n  },\n\n  copy: function()\n  {\n    return new PathParametric( this.name, this.calculator, copy(this.points), this.loop, this.matrix, this.weight );\n  },\n\n  isLinear: function()\n  {\n    return false;\n  }\n});\n\n\n/**\n * Instantiates a new PathBasisSpline.\n *\n * @param {String|false} name\n * @param {Calculator} calculator\n * @param {Array} points\n * @param {Boolean} loop\n * @class PathBasisSpline\n * @constructor\n * @extends PathParametric\n */\nfunction PathBasisSpline(name, calculator, points, loop)\n{\n  this.name = name;\n  this.set( calculator, points, loop );\n}\n\nClass.extend( PathBasisSpline, PathParametric,\n{\n  set: function(calculator, points, loop)\n  {\n    this._set( calculator, points, loop, PathBasisSpline.MATRIX, PathBasisSpline.WEIGHT, true );\n  },\n\n  copy: function()\n  {\n    return new PathBasisSpline( this.name, this.calculator, copy(this.points), this.loop );\n  }\n});\n\n/** http://www.cs.cornell.edu/Courses/cs4620/2013fa/lectures/16spline-curves.pdf\n *\n *                                 [-1, 3,-3, 1]   [p-1]\n * f(t) = [t^3, t^2, t, 1] * 1/6 * [ 3,-6, 3, 0] * [ p ]\n *                                 [-3, 0, 3, 0]   [p+1]\n *                                 [ 1, 4, 1, 0]   [p+2]\n */\n\nPathBasisSpline.WEIGHT = 1.0 / 6.0;\nPathBasisSpline.MATRIX = [\n  [-1, 3,-3, 1],\n  [ 3,-6, 3, 0],\n  [-3, 0, 3, 0],\n  [ 1, 4, 1, 0]\n];\n\n\n/**\n * Instantiates a new PathBezier.\n *\n * @param {String|false} name\n * @param {Calculator} calculator\n * @param {Array} points\n * @class PathBezier\n * @constructor\n * @extends Path\n */\nfunction PathBezier(name, calculator, points, weights)\n{\n  this.name = name;\n  this.set( calculator, points, weights );\n}\n\nClass.extend( PathBezier, Path,\n{\n  set: function(calculator, points, weights)\n  {\n    this.reset( calculator, points );\n    this.weights = weights || PathBezier.computeWeights( points.length );\n    this.inverses = new Array( points.length );\n  },\n\n  compute: function(out, delta)\n  {\n    var calc = this.calculator;\n    var inverses = this.inverses;\n    var weights = this.weights;\n    var n = this.points.length;\n    var x = 1;\n\n    inverses[n - 1] = 1;\n\n    for (var i = n - 2; i >= 0; i--)\n    {\n      inverses[i] = inverses[i + 1] * (1 - delta);\n    }\n\n    out = calc.zero( out );\n\n    for (var i = 0; i < n; i++)\n    {\n      out = calc.adds( out, this.resolvePoint( i, delta ), weights[ i ] * inverses[ i ] * x );\n\n      x *= delta;\n    }\n\n    return out;\n  },\n\n  copy: function()\n  {\n    return new PathBezier( this.name, this.calculator, copy(this.points), this.weights );\n  },\n\n  isLinear: function()\n  {\n    return false;\n  }\n});\n\nPathBezier.computeWeights = function(n)\n{\n  var w = new Array( n-- );\n\n  for (var i = 0; i <= n; i++)\n  {\n    w[ i ] = choose( n, i );\n  }\n\n  return w;\n};\n\n\n/**\n * Instantiates a new PathCatmullRom.\n *\n * @param {String|false} name\n * @param {Calculator} calculator\n * @param {Array} points\n * @param {Boolean} loop\n * @class PathCatmullRom\n * @constructor\n * @extends PathParametric\n */\nfunction PathCatmullRom(name, calculator, points, loop)\n{\n  this.name = name;\n  this.set( calculator, points, loop );\n}\n\nClass.extend( PathCatmullRom, PathParametric,\n{\n  set: function(calculator, points, loop)\n  {\n    this._set( calculator, points, loop, PathCatmullRom.MATRIX, PathCatmullRom.WEIGHT, false );\n  },\n\n  copy: function()\n  {\n    return new PathCatmullRom( this.name, this.calculator, copy(this.points), this.loop );\n  }\n});\n\n/** http://www.cs.cornell.edu/Courses/cs4620/2013fa/lectures/16spline-curves.pdf\n *\n *                                 [-1, 3,-3, 1]   [p-1]\n * f(t) = [1, t, t^2, t^3] * 1/2 * [ 3,-6, 3, 0] * [ p ]\n *                                 [-3, 0, 3, 0]   [p+1]\n *                                 [ 1, 4, 1, 0]   [p+2]\n */\n\nPathCatmullRom.WEIGHT = 0.5;\nPathCatmullRom.MATRIX = [\n  [ 0, 2, 0, 0],\n\t[-1, 0, 1, 0],\n\t[ 2,-5, 4,-1],\n\t[-1, 3,-3, 1]\n];\n\n\n/**\n * Instantiates a new PathCombo.\n *\n * @param {String|false} name\n * @param {Path[]} paths\n * @param {Boolean} [uniform]\n * @param {Number} [granularity]\n * @class PathCombo\n * @constructor\n * @extends Path\n */\nfunction PathCombo(name, paths, uniform, granularity)\n{\n  this.name = name;\n  this.set( paths, uniform, granularity );\n}\n\nClass.extend( PathCombo, Path,\n{\n  set: function(paths, uniform, granularity)\n  {\n    var pathCount = paths.length;\n    var calc = paths[0].calculator;\n    var points = [];\n    var deltas = [];\n    var linear = true;\n    var length = false;\n\n    for (var i = 0; i < pathCount; i++)\n    {\n      points.push.apply( points, paths[ i ].points );\n\n      deltas[ i ] = ( i + 1 ) / pathCount;\n\n      if ( !paths[ i ].isLinear() )\n      {\n        linear = false;\n      }\n    }\n\n    if ( uniform )\n    {\n      var lengthGranularity = coalesce( granularity, Defaults.comboPathUniformGranularity );\n      var lengthTotal = 0;\n      var lengths = [];\n\n      for (var i = 0; i < pathCount; i++)\n      {\n        lengths[ i ] = paths[ i ].length( lengthGranularity );\n        lengthTotal += lengths[ i ];\n      }\n\n      var lengthCurrent = 0;\n\n      for (var i = 0; i < pathCount; i++)\n      {\n        lengthCurrent += lengths[ i ];\n        deltas[ i ] = lengthCurrent / lengthTotal;\n      }\n\n      length = lengthTotal;\n    }\n\n    this.reset( calc, points );\n    this.paths = paths;\n    this.deltas = deltas;\n    this.uniform = uniform;\n    this.granularity = granularity;\n    this.linear = linear;\n    this.cachedLength = length;\n  },\n\n  isLinear: function()\n  {\n    return this.linear;\n  },\n\n  length: function(granularity)\n  {\n    return this.cachedLength !== false ? this.cachedLength : this._length( granularity );\n  },\n\n  compute: function(out, delta)\n  {\n    var paths = this.paths;\n    var deltas = this.deltas;\n    var previousDelta = 0;\n    var i = 0;\n\n    while ( i < paths.length - 1 && deltas[ i ] < delta )\n    {\n      previousDelta = deltas[ i ];\n      i++;\n    }\n\n    var deltaDistance = delta - previousDelta;\n    var deltaGap = deltas[ i ] - previousDelta;\n    var pathDelta = deltaDistance / deltaGap;\n\n    return paths[ i ].compute( out, pathDelta );\n  },\n\n  copy: function()\n  {\n    return new PathCombo( this.name, this.paths, this.uniform, this.granularity );\n  }\n});\n\n\n/**\n * Instantiates a new PathCompiled.\n *\n * @param {String|false} name\n * @param {Path} path\n * @param {Number} pointCount\n * @class PathCompiled\n * @constructor\n * @extends Path\n */\nfunction PathCompiled(name, path, pointCount)\n{\n  this.name = name;\n  this.set( path, pointCount );\n}\n\nClass.extend( PathCompiled, Path,\n{\n  set: function(path, pointCount)\n  {\n    var calc = path.calculator;\n    var compiled = PathCompiled.compile( calc, path, pointCount );\n\n    this.reset( calc, compiled );\n    this.path = path;\n    this.pointCount = pointCount;\n  },\n\n  compute: function(out, delta)\n  {\n    var n = this.points.length;\n    var a = Math.floor( delta * n );\n    var index = clamp( a, 0, n - 1 );\n\n    return this.calculator.copy( out, this.resolvePoint( index, delta ) );\n  },\n\n  copy: function()\n  {\n    return new PathCompiled( this.name, this, this.points.length );\n  }\n});\n\nPathCompiled.compile = function(calc, path, pointCount)\n{\n  if (path.points.length === pointCount)\n  {\n    return copy( path.points );\n  }\n\n  var points = [];\n\n  for (var i = 0; i < pointCount; i++)\n  {\n    points.push( path.compute( calc.create(), i / (pointCount - 1) ) );\n  }\n\n  return points;\n};\n\n\n/**\n * Instantiates a new PathCubic.\n *\n * @param {String|false} name\n * @param {Calculator} calculator\n * @param {T} p0\n * @param {T} p1\n * @param {T} p2\n * @param {T} p3\n * @class PathCubic\n * @constructor\n * @extends Path\n */\nfunction PathCubic(name, calculator, p0, p1, p2, p3)\n{\n  this.name = name;\n  this.set( calculator, p0, p1, p2, p3 );\n}\n\nClass.extend( PathCubic, Path,\n{\n  set: function(calculator, p0, p1, p2, p3)\n  {\n    this.reset( calculator, [p0, p1, p2, p3] );\n  },\n\n  compute: function(out, d1)\n  {\n    var calc = this.calculator;\n    var d2 = d1 * d1;\n    var d3 = d1 * d2;\n    var i1 = 1 - d1;\n    var i2 = i1 * i1;\n    var i3 = i1 * i2;\n\n    out = calc.copy( out, this.resolvePoint( 0, d1 ) );\n    out = calc.scale( out, i3 );\n    out = calc.adds( out, this.resolvePoint( 1, d1 ), 3 * i2 * d1 );\n    out = calc.adds( out, this.resolvePoint( 2, d1 ), 3 * i1 * d2 );\n    out = calc.adds( out, this.resolvePoint( 3, d1 ), d3 );\n\n    return out;\n  },\n\n  copy: function()\n  {\n    return new PathCubic( this.name, this.calculator, this.points[0], this.points[1], this.points[2], this.points[3] );\n  },\n\n  isLinear: function()\n  {\n    return false;\n  }\n});\n\n\n/**\n * Instantiates a new PathHermite.\n *\n * @param {String|false} name\n * @param {Calculator} calculator\n * @param {T} start\n * @param {T} startTangent\n * @param {T} end\n * @param {T} endTangent\n * @class PathHermite\n * @constructor\n * @extends Path\n */\nfunction PathHermite(name, calculator, start, startTangent, end, endTangent)\n{\n  this.name = name;\n  this.set( calculator, start, startTangent, end, endTangent );\n}\n\nClass.extend( PathHermite, Path,\n{\n  set: function(calculator, start, startTangent, end, endTangent)\n  {\n    this.reset( calculator, [start, end] );\n    this.startTangent = startTangent;\n    this.endTangent = endTangent;\n  },\n\n  compute: function(out, d)\n  {\n    var calc = this.calculator;\n    var d2 = d * d;\n    var d3 = d2 * d;\n\n    out = calc.zero( out );\n    out = calc.adds( out, this.resolvePoint( 0, d ), 2 * d3 - 3 * d2 + 1 );\n    out = calc.adds( out, this.resolvePoint( 1, d ), -2 * d3 + 3 * d2 );\n    out = calc.adds( out, resolve( this.startTangent ), d3 - 2 * d2 + d );\n    out = calc.adds( out, resolve( this.endTangent ), d3 - d2 );\n\n    return out;\n  },\n\n  copy: function()\n  {\n    return new PathHermite( this.name, this.calculator, this.points[0], this.startTangent, this.points[1], this.endTangent );\n  },\n\n  isLinear: function()\n  {\n    return false;\n  }\n});\n\n\n/**\n * Instantiates a new PathJump.\n *\n * @param {String|false} name\n * @param {Calculator} calculator\n * @param {Array} points\n * @class PathJump\n * @constructor\n * @extends Path\n */\nfunction PathJump(name, calculator, points)\n{\n  this.name = name;\n  this.set( calculator, points );\n}\n\nClass.extend( PathJump, Path,\n{\n  set: function(calculator, points)\n  {\n    this.reset( calculator, points );\n  },\n\n  compute: function(out, delta)\n  {\n    var a = Math.floor( delta * this.points.length );\n    var index = Math.min( a, this.points.length - 1 );\n\n    return this.calculator.copy( out, this.resolvePoint( index, delta ) );\n  },\n\n  copy: function()\n  {\n    return new PathJump( this.name, this.calculator, copy(this.points) );\n  }\n});\n\n\n/**\n * Instantiates a new PathKeyframe.\n *\n * @param {String|false} name\n * @param {Calculator} calculator\n * @param {Array} points\n * @param {Array} deltas\n * @param {Array} easings\n * @class PathKeyframe\n * @constructor\n * @extends Path\n */\nfunction PathKeyframe(name, calculator, points, deltas, easings)\n{\n  this.name = name;\n  this.set( calculator, points, deltas, easings );\n}\n\nClass.extend( PathKeyframe, Path,\n{\n  set: function(calculator, points, deltas, easings)\n  {\n    this.reset( calculator, points );\n    this.deltas = $deltas( deltas );\n    this.easings = easings;\n  },\n\n  compute: function(out, delta)\n  {\n    var ds = this.deltas;\n    var end = ds.length - 2;\n\n    if ( delta < ds[0] ) {\n      return false;\n    }\n\n    if ( delta > ds[ds.length - 1] ) {\n      return this.points[ds.length - 1];\n    }\n\n    var i = 0;\n    while (ds[i + 1] < delta && i < end) {\n      i++;\n    }\n    var d0 = ds[i];\n    var d1 = ds[i + 1];\n    var pd = (delta - d0) / (d1 - d0);\n    var p0 = this.resolvePoint( i, delta );\n    var p1 = this.resolvePoint( i + 1, delta );\n    var ea = this.easings[i];\n\n    return this.calculator.interpolate( out, p0, p1, ea( pd ) );\n  },\n  copy: function()\n  {\n    return new PathKeyframe( this.name, this.calculator, copy(this.points), copy(this.deltas), copy(this.easings) );\n  }\n});\n\n\n/**\n * Instantiates a new PathLinear.\n *\n * @param {String|false} name\n * @param {Calculator} calculator\n * @param {Array} points\n * @class PathLinear\n * @constructor\n * @extends PathDelta\n */\nfunction PathLinear(name, calculator, points)\n{\n  this.name = name;\n  this.set( calculator, points );\n}\n\nClass.extend( PathLinear, PathDelta,\n{\n  set: function(calculator, points)\n  {\n    var deltas = PathLinear.getTimes( calculator, points );\n\n    this._set( calculator, points, deltas );\n  },\n\n  copy: function()\n  {\n    return new PathLinear( this.name, this.calculator, copy(this.points) );\n  }\n});\n\nPathLinear.getTimes = function(calc, points)\n{\n  var n = points.length - 1;\n\tvar distances = [];\n\n\tdistances[ 0 ] = 0;\n\n\tfor (var i = 1; i <= n; i++)\n\t{\n\t\tdistances[ i ] = distances[ i - 1 ] + calc.distance( points[ i - 1 ], points[ i ] );\n\t}\n\n\tvar invlength = 1.0 / distances[ n ];\n\n\tfor (var i = 1; i < n; i++)\n\t{\n\t\tdistances[ i ] *= invlength;\n\t}\n\n  distances[ n ] = 1;\n\n\treturn distances;\n};\n\n\n/**\n * Instantiates a new PathPoint.\n *\n * @param {String|false} name\n * @param {Calculator} calculator\n * @param {T} point\n * @class PathPoint\n * @constructor\n * @extends Path\n */\nfunction PathPoint(name, calculator, point)\n{\n  this.name = name;\n  this.set( calculator, point );\n}\n\nClass.extend( PathPoint, Path,\n{\n  set: function(calculator, point)\n  {\n    this.reset( calculator, [point] );\n  },\n\n  compute: function(out, delta)\n  {\n    return this.calculator.copy( out, this.resolvePoint( 0, delta ) );\n  },\n\n  copy: function()\n  {\n    return new PathPoint( this.name, this.calculator, this.points[0] );\n  }\n});\n\n\n/**\n * Instantiates a new PathQuadratic.\n *\n * @param {String|false} name\n * @param {Calculator} calculator\n * @param {T} p0\n * @param {T} p1\n * @param {T} p2\n * @class PathQuadratic\n * @constructor\n * @extends Path\n */\nfunction PathQuadratic(name, calculator, p0, p1, p2)\n{\n  this.name = name;\n  this.set( calculator, p0, p1, p2 );\n}\n\nClass.extend( PathQuadratic, Path,\n{\n  set: function(calculator, p0, p1, p2)\n  {\n    this.reset( calculator, [p0, p1, p2] );\n  },\n\n  compute: function(out, d1)\n  {\n    var calc = this.calculator;\n    var d2 = d1 * d1;\n    var i1 = 1 - d1;\n    var i2 = i1 * i1;\n\n    out = calc.copy( out, this.resolvePoint( 0, d1 ) );\n    out = calc.scale( out, i2 );\n    out = calc.adds( out, this.resolvePoint( 1, d1 ), 2 * i1 * d1 );\n    out = calc.adds( out, this.resolvePoint( 2, d1 ), d2 );\n\n    return out;\n  },\n\n  copy: function()\n  {\n    return new PathQuadratic( this.name, this.calculator, this.points[0], this.points[1], this.points[2] );\n  },\n\n  isLinear: function()\n  {\n    return false;\n  }\n});\n\n\n/**\n * Instantiates a new PathQuadraticCorner.\n *\n * @param {String|false} name\n * @param {Calculator} calculator\n * @param {Array} points\n * @param {Number} midpoint\n * @param {Boolean} loop\n * @class PathQuadraticCorner\n * @constructor\n * @extends Path\n */\nfunction PathQuadraticCorner(name, calculator, points, midpoint, loop)\n{\n  this.name = name;\n  this.set( calculator, points, midpoint, loop );\n}\n\nClass.extend( PathQuadraticCorner, Path,\n{\n  set: function(calculator, points, midpoint, loop)\n  {\n    this.reset( calculator, points );\n    this.midpoint = midpoint;\n    this.loop = loop;\n    this.temp0 = calculator.create();\n    this.temp1 = calculator.create();\n  },\n\n  compute: function(out, delta)\n  {\n    var calc = this.calculator;\n    var temp0 = this.temp0;\n    var temp1 = this.temp1;\n    var midpoint = this.midpoint;\n    var negmidpoint = 1.0 - midpoint;\n    var halfmidpoint = midpoint * 0.5;\n    var n = this.points.length - (this.loops ? 0 : 1);\n    var a = delta * n;\n    var i = clamp( Math.floor( a ), 0, n - 1 );\n    var d = a - i;\n\n    var p0 = this.resolvePoint( i - 1, delta );\n    var p1 = this.resolvePoint( i, delta );\n    var p2 = this.resolvePoint( i + 1, delta );\n    var p3 = this.resolvePoint( i + 2, delta );\n\n    if ( d < midpoint )\n    {\n      d = (d / midpoint);\n      temp0 = calc.interpolate( temp0, p0, p1, d * halfmidpoint + negmidpoint + halfmidpoint );\n      temp1 = calc.interpolate( temp1, p1, p2, d * halfmidpoint + halfmidpoint );\n      p1 = temp0;\n      p2 = temp1;\n      d = d * 0.5 + 0.5;\n    }\n    else if ( d > negmidpoint )\n    {\n      d = (d - negmidpoint) / midpoint;\n      temp0 = calc.interpolate( temp0, p1, p2, d * halfmidpoint + negmidpoint );\n      temp1 = calc.interpolate( temp1, p2, p3, d * halfmidpoint );\n      p1 = temp0;\n      p2 = temp1;\n      d = d * 0.5;\n    }\n\n    out = calc.interpolate( out, p1, p2, d );\n\n    return out;\n  },\n\n  resolvePoint: function(i)\n  {\n    var points = this.points;\n    var n = points.length;\n    var k = (this.loops ? (i + n) % n : clamp( i, 0, n - 1 ));\n\n    return resolve( points[ k ] );\n  },\n\n  copy: function()\n  {\n    return new PathQuadraticCorner( this.name, this.calculator, copy(this.points), this.midpoint, this.loop );\n  },\n\n  isLinear: function()\n  {\n    return false;\n  }\n});\n\n\n/**\n * Instantiates a new PathSeries.\n *\n * @param {String|false} name\n * @param {Calculator} calculator\n * @param {Array} points\n * @param {Array} series\n * @class PathSeries\n * @constructor\n * @extends Path\n */\nfunction PathSeries(name, calculator, points, series)\n{\n  this.name = name;\n  this.set( calculator, points, series );\n}\n\nClass.extend( PathSeries, Path,\n{\n  set: function(calculator, points, series)\n  {\n    this.reset( calculator, points );\n    this.series = series;\n  },\n\n  between: function(i, delta)\n  {\n    var d0 = this.series[i];\n    var d1 = this.series[i + 1];\n    return delta >= Math.min(d0, d1) && delta <= Math.max(d0, d1);\n  },\n\n  compute: function(out, delta)\n  {\n    var ds = this.series;\n    var end = ds.length - 2;\n    var i = 0;\n    while (!this.between(i, delta) && i < end) {\n      i++;\n    }\n\n    if (!this.between(i, delta)) {\n      return out;\n    }\n\n    var d0 = ds[i];\n    var d1 = ds[i + 1];\n    var pd = (delta - d0) / (d1 - d0);\n    var p0 = this.resolvePoint( i, delta );\n    var p1 = this.resolvePoint( i + 1, delta );\n\n    return this.calculator.interpolate( out, p0, p1, pd );\n  },\n\n  copy: function()\n  {\n    return new PathSeries( this.name, this.calculator, copy(this.points), copy(this.series) );\n  }\n});\n\n\n/**\n * Instantiates a new PathSub.\n *\n * @param {String|false} name\n * @param {Path} path\n * @param {Number} start\n * @param {Number} end\n * @class PathSub\n * @constructor\n * @extends Path\n */\nfunction PathSub(name, path, start, end)\n{\n  this.name = name;\n  this.set( path, start, end );\n}\n\nClass.extend( PathSub, Path,\n{\n  set: function(path, start, end)\n  {\n    this.reset( path.calculator, path.points );\n    this.path = path;\n    this.start = start;\n    this.end = end;\n  },\n\n  compute: function(out, delta)\n  {\n    return this.path.compute( out, (this.end - this.start) * delta + this.start );\n  },\n\n  copy: function()\n  {\n    return new PathSub( this.name, this.path, this.start, this.end );\n  }\n});\n\n\n/**\n * Instantiates a new PathLinear.\n *\n * @param {String|false} name\n * @param {Calculator} calculator\n * @param {Array} points\n * @class PathLinear\n * @constructor\n * @extends PathDelta\n */\nfunction PathUniform(name, path, pointCount)\n{\n  this.name = name;\n  this.set( path, pointCount );\n}\n\nClass.extend( PathUniform, PathDelta,\n{\n  set: function(path, pointCount)\n  {\n    var calc = path.calculator;\n    var points = PathCompiled.compile( calc, path, pointCount );\n    var deltas = PathLinear.getTimes( calc, points );\n\n    this._set( calc, points, deltas );\n    this.path = path;\n    this.pointCount = pointCount;\n  },\n\n  copy: function()\n  {\n    return new PathUniform( this.name, this.path, this.pointCount );\n  }\n});\n\n\n/**\n * Instantiates a new Tween.\n *\n * @param {String|false} name\n * @param {Calculator} calculator\n * @param {T} start\n * @param {T} end\n * @class Tween\n * @constructor\n * @extends Path\n */\nfunction Tween(name, calculator, start, end)\n{\n  this.name = name;\n  this.set( calculator, start, end );\n}\n\nClass.extend( Tween, Path,\n{\n  set: function(calculator, start, end)\n  {\n    this.reset( calculator, [ start, end ] );\n  },\n\n  compute: function(out, delta)\n  {\n    return this.calculator.interpolate( out, this.resolvePoint( 0, delta ), this.resolvePoint( 1, delta ), delta );\n  },\n\n  copy: function()\n  {\n    return new Tween( this.name, this.calculator, this.points[0], this.points[1] );\n  }\n});\n\n\n/**\n * Instantiates a new SpringDistance.\n *\n * @param {String|false} attribute\n * @param {anim8.Calculator} calculator\n * @param {T} position\n * @param {T} rest\n * @param {Number} distance\n * @param {Number} damping\n * @param {Number} stiffness\n * @param {T} velocity\n * @param {T} gravity\n * @param {Boolean} finishOnRest\n * @class SpringDistance\n * @constructor\n * @extends Spring\n */\nfunction SpringDistance(attribute, calculator, position, rest, distance, damping, stiffness, velocity, gravity, finishOnRest)\n{\n  this.set( attribute, calculator, rest, position, velocity, gravity, finishOnRest );\n\n  this.distance   = distance;\n  this.damping    = damping;\n  this.stiffness  = stiffness;\n  this.temp       = null;\n}\n\nClass.extend( SpringDistance, Spring,\n{\n\n  start: function(now, animator)\n  {\n    this._start( now, animator );\n\n    this.temp = this.calculator.create();\n  },\n\n  clone: function()\n  {\n    return new SpringDistance( this.attribute, this.calculator, this.position, this.rest, this.distance, this.damping, this.stiffness, this.velocity, this.gravity, this.finishOnRest );\n  },\n\n  updateVelocity: function(dt)\n  {\n    // d = DISTANCE( position, rest )\n    // velocity += ((position - rest) / d * stiffness * |distance - d| - (damping * velocity)) * elapsed.seconds;\n    // position += velocity * elapsed.seconds;\n\n    var calc = this.calculator;\n    var rest = this.resolveRest();\n\n    var d = calc.distance( this.position, rest );\n\n    this.temp = calc.copy( this.temp, this.position );\n    this.temp = calc.sub( this.temp, rest );\n\n    if ( d !== 0 )\n    {\n      this.temp = calc.scale( this.temp, 1.0 / d );\n      this.temp = calc.scale( this.temp, (d - this.distance) * this.stiffness );\n    }\n\n    this.temp = calc.adds( this.temp, this.velocity, -this.damping );\n\n    this.velocity = calc.adds( this.velocity, this.temp, dt );\n  }\n\n});\n\n\n/**\n * Instantiates a new SpringLinear.\n *\n * @param {String|false} attribute\n * @param {Calculator} calculator\n * @param {T} position\n * @param {T} rest\n * @param {T} damping\n * @param {T} stiffness\n * @param {T} velocity\n * @param {T} gravity\n * @param {Boolean} finishOnRest\n * @class SpringLinear\n * @constructor\n * @extends Spring\n */\nfunction SpringLinear(attribute, calculator, position, rest, damping, stiffness, velocity, gravity, finishOnRest)\n{\n  this.set( attribute, calculator, rest, position, velocity, gravity, finishOnRest );\n\n  this.damping      = damping;\n  this.stiffness    = stiffness;\n  this.temp0        = null;\n  this.temp1        = null;\n}\n\nClass.extend( SpringLinear, Spring,\n{\n\n  start: function(now, animator)\n  {\n    this._start( now, animator );\n\n    var attribute = animator.getAttribute( this.attribute );\n    var calc = this.calculator;\n\n    this.damping      = this.parseValue( animator, this.damping, attribute.defaultValue );\n    this.stiffness    = this.parseValue( animator, this.stiffness, attribute.defaultValue );\n    this.temp0        = calc.create();\n    this.temp1        = calc.create();\n  },\n\n  clone: function()\n  {\n    return new SpringLinear( this.attribute, this.calculator, this.position, this.rest, this.damping, this.stiffness, this.velocity, this.gravity, this.finishOnRest );\n  },\n\n  hasComputed: function()\n  {\n    return isComputed( this.rest ) ||\n           isComputed( this.position ) ||\n           isComputed( this.gravity ) ||\n           isComputed( this.velocity ) ||\n           isComputed( this.damping ) ||\n           isComputed( this.stiffness );\n  },\n\n  updateVelocity: function(dt)\n  {\n    // velocity += ((stiffness * (position - rest)) - (damping * velocity)) * elapsed.seconds;\n    // position += velocity * elapsed.seconds;\n\n    var calc = this.calculator;\n\n    this.temp1 = calc.copy( this.temp1, this.damping );\n    this.temp1 = calc.mul( this.temp1, this.velocity );\n\n    this.temp0 = calc.copy( this.temp0, this.position );\n    this.temp0 = calc.sub( this.temp0, this.resolveRest() );\n    this.temp0 = calc.mul( this.temp0, this.stiffness );\n    this.temp0 = calc.sub( this.temp0, this.temp1 );\n\n    this.velocity = calc.adds( this.velocity, this.temp0, dt );\n  }\n\n});\n\n\nvar nextTimeline = (function()\n{\n  var id = 0;\n\n  return function() {\n    return ++id;\n  };\n\n})();\n\nfunction Movie(name)\n{\n  this.name = name;\n  this.currentTime = 0;\n  this.currentTimelines = [];\n  this.sequenceDelay = 0;\n  this.sequenceEasing = Easings.linear;\n  this.introduce = false;\n  this.timelines = new FastMap();\n  this.autoEnd = false;\n}\n\nClass.define( Movie,\n{\n\n  setAutoEnd: function(autoEnd)\n  {\n    this.autoEnd = autoEnd;\n\n    return this;\n  },\n\n  sequence: function(delay, easing)\n  {\n    this.sequenceDelay = $time( delay );\n    this.sequenceEasing = $easing( easing, Easings.linear );\n\n    return this;\n  },\n\n  intro: function(subjects)\n  {\n    this.currentTimelines = this.getTimelines( subjects );\n    this.introduce = true;\n\n    return this;\n  },\n\n  with: function(subjects)\n  {\n    this.currentTimelines = this.getTimelines( subjects );\n\n    return this;\n  },\n\n  add: function(subjects)\n  {\n    var additional = this.getTimelines( subjects );\n\n    this.currentTimelines.push.apply( this.currentTimelines, additional );\n\n    return this;\n  },\n\n  getTimeline: function(animator)\n  {\n    var timelineId = animator.$timelineId;\n    var timeline = this.timelines.get( timelineId );\n\n    if ( !isDefined( timeline ) )\n    {\n      timelineId = nextTimeline();\n      timeline = new MovieTimeline( animator );\n      animator.$timelineId = timelineId;\n\n      this.timelines.put( timelineId, timeline );\n    }\n\n    return timeline;\n  },\n\n  getTimelines: function(subjects)\n  {\n    var animators = [];\n\n    if ( isArray( subjects ) )\n    {\n      for (var i = 0; i < subjects.length; i++)\n      {\n        var animator = anim8( subjects[ i ] );\n\n        if ( animator !== false )\n        {\n          animators.push( this.getTimeline( animator ) );\n        }\n      }\n    }\n    else\n    {\n      var animator = anim8( subjects );\n\n      if ( animator !== false )\n      {\n        animators.push( this.getTimeline( animator ) );\n      }\n    }\n\n    return animators;\n  },\n\n  at: function(time)\n  {\n    var at = $time( time, false );\n\n    if ( at === false )\n    {\n      throw 'Invalid time in Movie.at: ' + time;\n    }\n\n    this.currentTime = at;\n\n    return this;\n  },\n\n  seek: function(time)\n  {\n    var by = $time( time, false );\n\n    if ( by === false )\n    {\n      throw 'Invalid time in Movie.seek: ' + time;\n    }\n\n    return this.at( this.currentTime + by );\n  },\n\n  end: function()\n  {\n    return this.at( this.duration() );\n  },\n\n  play: function(animation, options, all)\n  {\n    var parsed = $animation( animation, options );\n    var intro = this.introduce;\n\n    return this.eachCurrentTimeline(function(timeline, time)\n    {\n      timeline.playAttrimators( parsed.newAttrimators(), all, time, intro );\n    });\n  },\n\n  queue: function(animation, options, all)\n  {\n    var parsed = $animation( animation, options );\n\n    return this.eachCurrentTimeline(function(timeline, time)\n    {\n      timeline.queueAttrimators( parsed.newAttrimators(), all, time );\n    });\n  },\n\n  transition: function(transition, animation, options, all)\n  {\n    var transition = $transition( transition );\n    var parsed = $animation( animation, options );\n\n    return this.eachCurrentTimeline(function(timeline, time)\n    {\n      timeline.transitionAttrimators( parsed.newAttrimators(), all, time, transition );\n    });\n  },\n\n  eachCurrentTimeline: function(onTimeline)\n  {\n    var timelines = this.currentTimelines;\n    var n = timelines.length - 1;\n    var time = this.currentTime;\n\n    if ( this.sequenceDelay > 0 )\n    {\n      var timeGap = n * this.sequenceDelay;\n      var easing = this.sequenceEasing;\n\n      for (var i = 0; i <= n; i++)\n      {\n        onTimeline( timelines[ i ], time + easing( i / n ) * timeGap );\n      }\n    }\n    else\n    {\n      for (var i = 0; i <= n; i++)\n      {\n        onTimeline( timelines[ i ], time );\n      }\n    }\n\n    this.sequenceDelay = 0;\n    this.introduce = false;\n\n    if ( this.autoEnd )\n    {\n      this.end();\n    }\n\n    return this;\n  },\n\n  duration: function()\n  {\n    var timelines = this.timelines.values;\n    var maxTime = 0;\n\n    for (var i = 0; i < timelines.length; i++)\n    {\n      maxTime = Math.max( maxTime, timelines[ i ].attrimators.timeRemaining() );\n    }\n\n    return maxTime;\n  }\n});\n\neventize( Movie.prototype );\n\n\nfunction MoviePlayer(movie)\n{\n  this.speed = 1.0;\n  this.time = 0;\n  this.currentTime = 0;\n  this.playing = false;\n  this.movie = movie;\n  this.duration = movie.duration();\n  this.run = this.runner( movie, this );\n}\n\nClass.define( MoviePlayer,\n{\n  reverse: function()\n  {\n    this.speed = -this.speed;\n\n    return this;\n  },\n  backward: function()\n  {\n    this.speed = -Math.abs( this.speed );\n\n    return this;\n  },\n  forward: function()\n  {\n    this.speed = Math.abs( this.speed );\n\n    return this;\n  },\n  start: function(applyNow, avoidApplyTrigger)\n  {\n    this.time = 0;\n\n    if ( applyNow )\n    {\n      this.apply( this.time, avoidApplyTrigger );\n    }\n\n    return this;\n  },\n  end: function(applyNow, avoidApplyTrigger)\n  {\n    this.time = this.duration;\n\n    if ( applyNow )\n    {\n      this.apply( this.time, avoidApplyTrigger );\n    }\n\n    return this;\n  },\n  play: function()\n  {\n    if ( !this.playing )\n    {\n      this.currentTime = now();\n      this.playing = true;\n\n      requestRun( this.run );\n    }\n\n    return this;\n  },\n  pause: function()\n  {\n    this.playing = false;\n\n    return this;\n  },\n  goto: function(time, applyNow, avoidApplyTrigger)\n  {\n    this.time = $time( time );\n\n    if ( applyNow )\n    {\n      this.apply( this.time, avoidApplyTrigger );\n    }\n\n    return this;\n  },\n  apply: function(applyTime, avoidApplyTrigger)\n  {\n    var time = coalesce( applyTime, this.time );\n    var timelines = this.movie.timelines.values;\n    var active = [];\n\n    for (var i = 0; i < timelines.length; i++)\n    {\n      var timeline = timelines[ i ];\n\n      if ( time >= timeline.start )\n      {\n        active.push( timeline );\n      }\n    }\n\n    for (var i = 0; i < active.length; i++)\n    {\n      active[ i ].preupdate( time );\n    }\n\n    for (var i = 0; i < active.length; i++)\n    {\n      active[ i ].update( time );\n    }\n\n    for (var i = 0; i < active.length; i++)\n    {\n      active[ i ].apply();\n    }\n\n    if ( !avoidApplyTrigger )\n    {\n      this.trigger( 'apply', [this, time] );\n    }\n\n    return this;\n  },\n  evaluatePlaying: function()\n  {\n    if ( this.playing )\n    {\n      if ( this.time < 0 )\n      {\n        this.time = 0;\n        this.playing = false;\n        this.trigger( 'start', [this] );\n      }\n      else if ( this.time > this.duration )\n      {\n        this.time = this.duration;\n        this.playing = false;\n        this.trigger( 'end', [this] );\n      }\n    }\n\n    return this;\n  },\n  runner: function(movie, player)\n  {\n    return function run()\n    {\n      var currentTime = now();\n      var elapsed = currentTime - player.currentTime;\n\n      player.time += elapsed * player.speed;\n      player.currentTime = currentTime;\n      player.apply();\n      player.evaluatePlaying();\n\n      if ( player.playing )\n      {\n        requestRun( player.run );\n      }\n    };\n  }\n});\n\neventize( MoviePlayer.prototype );\n\n\nfunction MovieTimeline(animator)\n{\n  this.animator = animator;\n  this.attrimators = new AttrimatorMap();\n  this.start = 0;\n}\n\nClass.define( MovieTimeline,\n{\n\n  playAttrimators: function(attrimatorMap, all, time, intro)\n  {\n    if ( this.attrimators.size() )\n    {\n      this.attrimators.playMapAt( attrimatorMap, all, time );\n    }\n    else\n    {\n      this.attrimators.putMap( attrimatorMap );\n      this.attrimators.delay( time );\n\n      if ( !intro )\n      {\n        this.start = time;\n      }\n    }\n  },\n\n  queueAttrimators: function(attrimatorMap, all, time)\n  {\n    if ( all )\n    {\n      this.attrimators.stopNotPresentAt( attrimatorMap, time );\n    }\n\n    this.attrimators.queueMap( attrimatorMap );\n  },\n\n  transitionAttrimators: function(attrimatorMap, all, time, transition)\n  {\n    if ( all )\n    {\n      this.attrimators.stopNotPresentAt( attrimatorMap, time + transition.time );\n    }\n\n    this.attrimators.transitionMap(\n      transition,\n      attrimatorMap,\n      function getValue(attr) {\n        var attrimator = this.attrimators.get( attr );\n        var attribute = this.animator.getAttribute( attr );\n\n        return attrimator ? attrimator.valueAtSearch( time, attribute.cloneDefault() ) : undefined;\n      },\n      function getAttribute(attr) {\n        return this.animator.getAttribute( attr );\n      },\n      function placeAttrimator(attrimator) {\n        this.attrimators.playAttrimatorAt( attrimator, time );\n      },\n      function getValueAt(attrimator, relativeTime, out) {\n        return attrimator.valueAtSearch( time + relativeTime, out );\n      },\n      function stopAttrimator(attrimator, relativeTime) {\n        attrimator.stopAt( time + relativeTime );\n      },\n      this\n    );\n  },\n\n  preupdate: function(time)\n  {\n    var animator = this.animator;\n    var attrimators = this.attrimators.values;\n\n    for (var i = 0; i < attrimators.length; i++)\n    {\n      var attrimator = attrimators[ i ];\n      var attr = attrimator.attribute;\n      var existing = animator.attrimators.get( attr );\n      var attrimatorAt = attrimator.attrimatorAt( time );\n\n      if ( existing !== attrimatorAt )\n      {\n        if ( attrimatorAt )\n        {\n          animator.placeAttrimator( attrimatorAt );\n        }\n        else\n        {\n          animator.attrimators.remove( attr );\n        }\n      }\n    }\n\n    this.animator.preupdate( time );\n  },\n\n  update: function(time)\n  {\n    var animator = this.animator;\n    var attrimators = this.attrimators.values;\n\n    for (var i = 0; i < attrimators.length; i++)\n    {\n      var attrimator = attrimators[ i ];\n      var attr = attrimator.attribute;\n      var attribute = animator.getAttribute( attr );\n      var calculator = attribute.calculator;\n      var currentValue = animator.frame[ attr ];\n\n      if ( calculator.isValid( currentValue ) )\n      {\n        var valueAt = attrimator.valueAtSearch( time, currentValue );\n\n        if ( valueAt !== false )\n        {\n          animator.frame[ attr ] = valueAt;\n          animator.updated[ attr ] = true;\n        }\n      }\n    }\n  },\n\n  apply: function()\n  {\n    this.animator.apply();\n  }\n\n});\n\n\nvar Builders = {};\n\n/**\n * Register the builder.\n */\nBuilders['values'] = new BuilderDeltas();\n\n/**\n * A builder which generates attrimators which tween from the current value to\n * the given values.\n *\n * **Examples:**\n *\n *     animator.play({\n *      ... other builders ...\n *      and: {\n *       ... more builders ...\n *      }\n *     });\n *\n *\n * @property {BuilderAnd} and\n * @for anim8.builder\n */\nBuilders['and'] = new BuilderAnd();\n\n/**\n * Register the builder.\n */\nBuilders['final'] = new BuilderFinal();\n\n/**\n * Register the builder.\n */\nBuilders['initial'] = new BuilderInitial();\n\n/**\n * Register the builder.\n */\nBuilders['point'] = new BuilderPoint();\n\n/**\n * Registers the builder.\n */\nBuilders['keyframe'] = new BuilderKeyframe();\n\n/**\n * Register the builder.\n */\nBuilders['move'] = new BuilderMove();\n\n/**\n * A builder which generates attrimators which follow a given path.\n *\n * **Examples:**\n *\n *     animator.play({\n *      path: {\n *       opacity: {\n *        type: 'quadratic',\n *        p0: 0,\n *        p1: 0.4,\n *        p2: 1.0\n *       }\n *      }\n *     });\n *\n *\n * @property {BuilderPath} path\n * @for anim8.builder\n */\nBuilders['path'] = new BuilderPath();\n\n/**\n * Register the builder.\n */\nBuilders['physics'] = new BuilderPhysics();\n\n/**\n * A builder which generates attrimators which tween from the current value to\n * the given values.\n *\n * **Examples:**\n *\n *     animator.play({\n *      ... other builders ...\n *      queue: {\n *       ... more builders to play after the others ...\n *      }\n *     });\n *\n *\n * @property {BuilderQueue} queue\n * @for anim8.builder\n */\nBuilders['queue'] = new BuilderQueue();\n\n/**\n * Register the builder.\n */\nBuilders['springs'] = new BuilderSpring();\n\n/**\n * Register the builder.\n */\nBuilders['travel'] = new BuilderTravel();\n\n/**\n * Register the builder.\n */\nBuilders['tweenFrom'] = new BuilderTweenFrom();\n\n/**\n * A builder which generates attrimators which tween from the current value to\n * the given values.\n *\n * **Examples:**\n *\n *     animator.play({\n *      tweenTo: {\n *       opacity: 1.0,       // absolute value\n *       left: '+40'         // 40 more units from current value\n *      }\n *     });\n *\n *\n * @property {BuilderTweenTo} tweenTo\n * @for anim8.builder\n */\nBuilders['tweenTo'] = new BuilderTweenTo();\n\n\n/**\n * A collection of calculators. A calculator is responsible for performing\n * mathematical operations for a specific animatable data type.\n *\n * @class anim8.calculator\n */\nvar Calculators = {};\n\n/**\n * A calculator for numbers.\n *\n * @property {CalculatorNumber} number\n * @for anim8.Calculators\n */\nCalculators['number'] = new CalculatorNumber();\n\n/**\n * A calculator for 2d points; objects with x & y Number components.\n *\n * @property {Calculator2d} 2d\n * @for anim8.Calculators\n */\nCalculators['2d'] = new Calculator2d();\n\n/**\n * A calculator for 3d points; objects with x, y, & z Number components.\n *\n * @property {Calculator3d} 3d\n * @for anim8.Calculators\n */\nCalculators['3d'] = new Calculator3d();\n\n/**\n * A calculator for quaternions; objects with x, y, z, & angle Number components.\n *\n * @property {CalculatorQuaternion} quaternion\n * @for anim8.Calculators\n */\nCalculators['quaternion'] = new CalculatorQuaternion();\n\n/**\n * A calculator for opaque colors; objects with r, g, & b Number components.\n *\n * @property {CalculatorRGB} rgb\n * @for anim8.Calculators\n */\nCalculators['rgb'] = new CalculatorRGB();\n\n/**\n * A calculator for colors; objects with r, g, b, & a Number components.\n *\n * @property {CalculatorRGBA} rgba\n * @for anim8.Calculators\n */\nCalculators['rgba'] = new CalculatorRGBA();\n\n/**\n * A calculator for strings.\n *\n * @property {CalculatorString} string\n * @for anim8.Calculators\n */\nCalculators['string'] = new CalculatorString();\n\n/**\n * The default calculator.\n *\n * @property {CalculatorNumber} default\n * @for anim8.Calculators\n */\nCalculators['default'] = Calculators['number'];\n\n\nvar Factories = {};\n\n/**\n * Registers the object factory.\n */\nFactories['object'] = new FactoryObject();\n\n/**\n * Registers the default factory.\n */\nFactories['default'] = Factories['object'];\n\n\nvar Paths = {};\n\n/**\n * Parses an object for a point path.\n *\n * @param {Object} path\n * @return {PathCombo}\n */\nPaths['point'] = function(path)\n{\n  var calc = $calculator( path.calculator );\n  var defaultValue = calc.parse( path.defaultValue, calc.ZERO );\n\n  return new PathPoint(\n    path.name,\n    calc,\n    calc.parse( path.point, defaultValue )\n  );\n};\n\n/**\n * Parses an object for a combo path.\n *\n * @param {Object} path\n * @return {PathCombo}\n */\nPaths['combo'] = function(path)\n{\n  var paths = path.paths;\n\n  for (var i = 0; i < paths.length; i++)\n  {\n    paths[ i ] = $path( paths[ i ] );\n  }\n\n  return new PathCombo(\n    path.name,\n    paths,\n    path.uniform,\n    path.granularity\n  );\n};\n\n\n/**\n * Parses an object for a compiled path.\n *\n * @param {Object} path\n * @return {PathCompiled}\n */\nPaths['compiled'] = function(path)\n{\n  var parent = $path( path.path );\n\n  return new PathCompiled(\n    path.name,\n    parent,\n    path.n || path.pointCount\n  );\n};\n\n/**\n * Parses an object for a cubic path.\n *\n * @param {Object} path\n * @return {PathCubic}\n */\nPaths['cubic'] = function(path)\n{\n  var calc = $calculator( path.calculator );\n  var defaultValue = calc.parse( path.defaultValue, calc.ZERO );\n\n  return new PathCubic(\n    path.name,\n    calc,\n    calc.parse( path.p0, defaultValue ),\n    calc.parse( path.p1, defaultValue ),\n    calc.parse( path.p2, defaultValue ),\n    calc.parse( path.p3, defaultValue )\n  );\n};\n\n/**\n * Parses an object for a delta path.\n *\n * @param {Object} path\n * @return {PathDelta}\n */\nPaths['delta'] = function(path)\n{\n  var calc = $calculator( path.calculator );\n\n  if (!path.deltas)\n  {\n    path.deltas = [];\n\n    for (var i = 0; i < path.points.length; i++)\n    {\n      path.deltas[ i ] = i / ( path.points.length - 1 );\n    }\n  }\n\n  return new PathDelta(\n    path.name,\n    calc,\n    calc.parseArray( path.points, path.points, path.defaultValue ),\n    path.deltas\n  );\n};\n\n/**\n * Parses an object for a series path.\n *\n * @param {Object} path\n * @return {PathSeries}\n */\nPaths['series'] = function(path)\n{\n  var calc = $calculator( path.calculator );\n\n  if (!path.series)\n  {\n    path.series = [];\n\n    for (var i = 0; i < path.points.length; i++)\n    {\n      path.series[ i ] = i / ( path.points.length - 1 );\n    }\n  }\n\n  return new PathSeries(\n    path.name,\n    calc,\n    calc.parseArray( path.points, path.points, path.defaultValue ),\n    path.series\n  );\n};\n\n/**\n * Parses an object for a jump path.\n *\n * @param {Object} path\n * @return {PathJump}\n */\nPaths['jump'] = function(path)\n{\n  var calc = $calculator( path.calculator );\n\n  return new PathJump(\n    path.name,\n    calc,\n    calc.parseArray( path.points, path.points, path.defaultValue )\n  );\n};\n\n/**\n * Parses an object for a keyframe path.\n *\n * @param {Object} path\n * @return {PathKeyframe}\n */\nPaths['keyframe'] = function(path)\n{\n  var calc = $calculator( path.calculator );\n\n  if (!path.deltas)\n  {\n    path.deltas = [];\n\n    for (var i = 0; i < path.points.length; i++)\n    {\n      path.deltas[ i ] = i / ( path.points.length - 1 );\n    }\n  }\n\n  var defaultEasing = $easing( path.easings, null );\n\n  if ( !isDefined( path.easings ) || !isArray( path.easings ) || defaultEasing !== null )\n  {\n    path.easings = [];\n\n    for (var i = 0; i < path.points.length; i++)\n    {\n      path.easings[ i ] = defaultEasing;\n    }\n  }\n\n  for (var i = 0; i < path.easings.length; i++)\n  {\n    path.easings[ i ] = $easing( path.easings[ i ] );\n  }\n\n  return new PathKeyframe(\n    path.name,\n    calc,\n    calc.parseArray( path.points, path.points, path.defaultValue ),\n    path.deltas,\n    path.easings\n  );\n};\n\n\n/**\n * Parses an object for a quadratic path.\n *\n * @param {Object} path\n * @return {PathQuadratic}\n */\nPaths['quadratic'] = function(path)\n{\n  var calc = $calculator( path.calculator );\n  var defaultValue = calc.parse( path.defaultValue, calc.ZERO );\n\n  return new PathQuadratic(\n    path.name,\n    calc,\n    calc.parse( path.p0, defaultValue ),\n    calc.parse( path.p1, defaultValue ),\n    calc.parse( path.p2, defaultValue )\n  );\n};\n\n/**\n * Parses an object for a tween path.\n *\n * @param {Object} path\n * @return {Tween}\n */\nPaths['tween'] = function(path)\n{\n  var calc = $calculator( path.calculator );\n  var defaultValue = calc.parse( path.defaultValue, calc.ZERO );\n\n  return new Tween(\n    path.name,\n    calc,\n    calc.parse( path.start, defaultValue ),\n    calc.parse( path.end, defaultValue )\n  );\n};\n\n/**\n * Parses an object for a sub path.\n *\n * @param {Object} path\n * @return {PathSub}\n */\nPaths['sub'] = function(path)\n{\n  var parent = $path( path.path );\n\n  return new PathSub(\n    path.name,\n    parent,\n    coalesce( path.start, 0 ),\n    coalesce( path.end, 1 )\n  );\n};\n\n/**\n * Parses an object for a quadratic corner path.\n *\n * @param {Object} path\n * @return {PathQuadraticCorner}\n */\nPaths['quadratic-corner'] = function(path)\n{\n  var calc = $calculator( path.calculator );\n\n  return new PathQuadraticCorner(\n    path.name,\n    calc,\n    calc.parseArray( path.points, path.points, path.defaultValue ),\n    path.midpoint,\n    path.loop\n  );\n};\n\n/**\n * Parses an object for a linear path.\n *\n * @param {Object} path\n * @return {PathLinear}\n */\nPaths['linear'] = function(path)\n{\n  var calc = $calculator( path.calculator );\n\n  return new PathLinear(\n    path.name,\n    calc,\n    calc.parseArray( path.points, path.points, path.defaultValue )\n  );\n};\n\n\n/**\n * Parses an object for a uniform path.\n *\n * @param {Object} path\n * @return {PathUniform}\n */\nPaths['uniform'] = function(path)\n{\n  var parent = $path( path.path );\n\n  return new PathUniform(\n    path.name,\n    parent,\n    path.n || path.pointCount\n  );\n};\n\n/**\n * Parses an object for a hermite path.\n *\n * @param {Object} path\n * @return {PathHermite}\n */\nPaths['hermite'] = function(path)\n{\n  var calc = $calculator( path.calculator );\n  var defaultValue = calc.parse( path.defaultValue, calc.ZERO );\n\n  return new PathHermite(\n    path.name,\n    calc,\n    calc.parse( path.start, defaultValue ),\n    calc.parse( path.startTangent, defaultValue ),\n    calc.parse( path.end, defaultValue ),\n    calc.parse( path.endTangent, defaultValue )\n  );\n};\n\n/**\n * Parses an object for a bezier path.\n *\n * @param {Object} path\n * @return {PathBezier}\n */\nPaths['bezier'] = function(path)\n{\n  var calc = $calculator( path.calculator );\n\n  return new PathBezier(\n    path.name,\n    calc,\n    calc.parseArray( path.points, path.points, path.defaultValue ),\n    path.weights\n  );\n};\n\n/**\n * Parses an object for a parametric cubic curve path.\n *\n * @param {Object} path\n * @return {PathParametric}\n */\nPaths['parametric'] = function(path)\n{\n  var calc = $calculator( path.calculator );\n\n  return new PathParametric(\n    path.name,\n    calc,\n    calc.parseArray( path.points, path.points, path.defaultValue ),\n    path.loop,\n    path.matrix,\n    path.weight\n  );\n};\n\n/**\n * Parses an object for a parametric cubic curve path.\n *\n * @param {Object} path\n * @return {PathParametric}\n */\nPaths['catmull-rom'] = function(path)\n{\n  var calc = $calculator( path.calculator );\n\n  return new PathCatmullRom(\n    path.name,\n    calc,\n    calc.parseArray( path.points, path.points, path.defaultValue ),\n    path.loop\n  );\n};\n\n/**\n * Parses an object for a basis spline path.\n *\n * @param {Object} path\n * @return {PathBasisSpline}\n */\nPaths['basis-spline'] = function(path)\n{\n  var calc = $calculator( path.calculator );\n\n  return new PathBasisSpline(\n    path.name,\n    calc,\n    calc.parseArray( path.points, path.points, path.defaultValue ),\n    path.loop\n  );\n};\n\n\nvar Springs = {};\n\n/**\n * Register the spring builder.\n *\n * @param {Object}\n * @return {SpringDistance}\n */\nSprings['distance'] = function(spring)\n{\n  return new SpringDistance(\n    spring.attribute,\n    spring.calculator,\n    coalesce( spring.position, true ),\n    coalesce( spring.rest, true ),\n    spring.distance,\n    spring.damping,\n    spring.stiffness,\n    spring.velocity,\n    spring.gravity,\n    spring.finishOnRest\n  );\n};\n\n/**\n * Register the spring builder.\n *\n * @param {Object}\n * @return {SpringLinear}\n */\nSprings['linear'] = function(spring)\n{\n  return new SpringLinear(\n    spring.attribute,\n    spring.calculator,\n    coalesce( spring.position, true ),\n    coalesce( spring.rest, true ),\n    spring.damping,\n    spring.stiffness,\n    spring.velocity,\n    spring.gravity,\n    spring.finishOnRest\n  );\n};\n\n\n/**\n * Returns an instance of {{#crossLink \"Animation\"}}{{/crossLink}} based on the\n * given input & options. If the input is a string the animation with that name\n * is returned. If the input is a string with an animation name and an option\n * string the animation with the given name modified by any additional options\n * is returned. Commas can be used to queue animation & option pairs one after\n * another. Ampersands can be used to play animations at the same time. If the\n * input is an object an anonymous animation is created. If no animation could\n * be determined then false is returned.\n *\n * **Examples:**\n *\n *     animation('wiggle');\n *     animation('wiggle ~1s 4s z40ms x5 !1.2');\n *     animation('wiggle', {...options...});\n *     animation('wiggle, tada ~50ms, fadeOut 2s');\n *     animation('wiggle & tada !3, fadeOut');\n *     animation({...definition...});\n *\n * If the given input is a string you can cache it. An example would be\n * 'wiggle ~1s 2s x3' - if `cache` is true and you call this method again it won't\n * need to be parsed again.\n *\n * **See:** {{#crossLink \"Core/options:method\"}}{{/crossLink}}\n *\n * @method animation\n * @for Core\n * @param {Animation|String|Object} animation\n * @param {String|Object} [options]\n * @param {Boolean} [cache=false]\n * @return {Animation|False}\n * @throws {String} The animation string has an invalid animation name or the\n *    animation fails to create attrimators from the animation definition.\n */\nfunction $animation(animation, options, cache, forObject)\n{\n  var options = $options( options, cache );\n  var hasOptions = !isEmpty( options );\n\n  if ( animation instanceof Animation )\n  {\n    if ( hasOptions )\n    {\n      var attrimators = animation.newAttrimators();\n\n      animation.merge( options, attrimators );\n\n      return new Animation( false, animation.input, options, attrimators);\n    }\n\n    return animation;\n  }\n  if ( isString( animation ) )\n  {\n    var key = animation.toLowerCase();\n\n    if ( key in Animations && !hasOptions )\n    {\n      return Animations[ key ];\n    }\n\n    var attrimators = $attrimatorsFor( animation, options, cache );\n\n    if ( key in Animations && !hasOptions )\n    {\n      return Animations[ key ];\n    }\n\n    return new Animation( false, {}, options, attrimators );\n  }\n  if ( isObject( animation ) )\n  {\n    var attrimators = $attrimatorsFor( animation, options, cache, forObject );\n\n    return new Animation( false, animation, options, attrimators );\n  }\n\n  return false;\n}\n\n\n\n/**\n * Generates an AttrimatorMap for the given animation and options. If the\n * animation given is an instance of {{#crossLink \"Animation\"}}{{/crossLink}}\n * then a copy of that animations attrimators is returned, and if options are\n * specified then they are merged into the generated attrimators. If the\n * animation given is an object it's properties are iterated and for each builder\n * with a matching name attrimators are generated. If the animation given is a\n * string of a cached or saved animation then it's handled as if an instance of\n * {{#crossLink \"Animation\"}}{{/crossLink}} was given. If the animation given\n * is a string which isn't saved or cached it goes through the following parsing\n * logic.\n *\n * - Split up the string into sections with `,` which queues animations.\n * - Split up each of the sections with `&` which enables animations to play\n *   simultaneously.\n * - For each of those sections, take the first word as the name of the\n *   animation and any remaining text as the options for that animation.\n *\n * If no attrimators could be parsed, an empty attrimator map is returned. If\n * the animation given is a string that specifies animations that don't exist\n * an error is thrown.\n *\n * **Examples:**\n *\n *     anim8.attrimatorsFor('wiggle');\n *     anim8.attrimatorsFor('wiggle ~1s 4s z40ms x5 !1.2');\n *     anim8.attrimatorsFor('wiggle', {...options...});\n *     anim8.attrimatorsFor('wiggle, tada ~50ms, fadeOut 2s');\n *     anim8.attrimatorsFor('wiggle & tada !3, fadeOut');\n *     anim8.attrimatorsFor({...definition...});\n *\n * If the given input is a string you can cache it. An example would be\n * 'wiggle ~1s 2s x3' - if `cache` is true and you call this method again it won't\n * need to be parsed again.\n *\n * **See:** {{#crossLink \"Core/options:method\"}}{{/crossLink}}\n *\n * @method anim8.attrimatorsFor\n * @for Core\n * @param {Object|String} animation\n * @param {Object|String} [options]\n * @param {Boolean} [cache=false]\n * @return {AttrimatorMap}\n */\nfunction $attrimatorsFor( animation, options, cache, forObject )\n{\n  var parsedOptions = $options( options, cache );\n  var hasOptions = !isEmpty( parsedOptions );\n  var attrimators = new AttrimatorMap();\n\n  if ( animation instanceof Animation )\n  {\n    attrimators.putMap( animation.newAttrimators() );\n\n    if ( hasOptions )\n    {\n      animation.merge( parsedOptions, attrimators );\n    }\n  }\n  else if ( isObject( animation ) )\n  {\n    var helper = new BuilderHelper( animation, parsedOptions, {}, forObject );\n\n    for (var builderName in animation)\n    {\n      var builder = $builder( builderName );\n\n      if ( builder !== false )\n      {\n        builder.parse( animation, parsedOptions, attrimators, helper );\n      }\n    }\n  }\n  else if ( isString( animation ) )\n  {\n    var key = animation.toLowerCase();\n    var saved = Animations[ key ];\n    var cacheIt = coalesce( cache, Defaults.cache );\n\n    if ( saved )\n    {\n      attrimators.putMap( saved.newAttrimators() );\n\n      if ( hasOptions )\n      {\n        saved.merge( parsedOptions, attrimators );\n      }\n    }\n    else\n    {\n      var animationsQueued = animation.split( /\\s*,\\s*/ );\n\n      for (var k = 0; k < animationsQueued.length; k++)\n      {\n        var animationsMerged = animationsQueued[ k ].split( /\\s*&\\s*/ );\n        var base = new AttrimatorMap();\n\n        for (var j = 0; j < animationsMerged.length; j++)\n        {\n          var animationString = trim( animationsMerged[ j ].toLowerCase() );\n          var animationSplit = animationString.split( /\\s+/ );\n          var parsedAnimation = Animations[ animationSplit[ 0 ] ];\n\n          if ( parsedAnimation )\n          {\n            var additionalOptions = $options( animationSplit.slice( 1 ), cache );\n            var hasAdditionalOptions = !isEmpty( additionalOptions );\n            var parsedAttrimators = parsedAnimation.newAttrimators();\n\n            if ( hasOptions && hasAdditionalOptions )\n            {\n              parsedAnimation.merge( extend( {}, parsedOptions, additionalOptions ), parsedAttrimators );\n            }\n            else if ( hasAdditionalOptions )\n            {\n              parsedAnimation.merge( additionalOptions, parsedAttrimators );\n            }\n            else if ( hasOptions )\n            {\n              parsedAnimation.merge( parsedOptions, parsedAttrimators );\n            }\n\n            base.putMap( parsedAttrimators );\n          }\n          else\n          {\n            throw animationString + ' is not a valid animation in \"' + animationsQueued[ k ] + '\"';\n          }\n        }\n\n        attrimators.queueMap( base );\n      }\n\n      if ( cacheIt && !hasOptions )\n      {\n        Animations[ key ] = new Animation( animation, {}, {}, attrimators );\n      }\n    }\n  }\n\n  return attrimators;\n}\n\n\n/**\n * A collection of {{#crossLink \"Builder\"}}builders{{/crossLink}} which takes\n * animation definitions (an Object passed to {{#crossLink \"Core/anim8.animation:method\"}}{{/crossLink}})\n * and generates {{#crossLink \"Attrimator\"}}Attrimators{{/crossLink}}.\n *\n * @class anim8.builder\n */\n\n/**\n * Returns a builder based on the input. If the input is an instance of Builder\n * it's returned immediately. If the input is a string the builder with that name\n * is returned. If no builder could be determined then false is returned.\n *\n * **See:** {{#crossLink \"anim8.builder\"}}{{/crossLink}}\n *\n * @method anim8.builder\n * @for Core\n * @param {Builder|String} builderInput\n * @return {Builder|false}\n */\nfunction $builder(builderInput)\n{\n  if ( builderInput instanceof Builder )\n  {\n    return builderInput;\n  }\n  if ( isString( builderInput ) && builderInput in Builders )\n  {\n    return Builders[ builderInput ];\n  }\n\n  return false;\n}\n\n\n/**\n* Returns a calculator based on the input. If the input is an instance of\n* {{#crossLink \"Calculator\"}}{{/crossLink}} it is immediately returned. If the\n* input is a string the calculator with that name is returned. If no calculator\n* could be determined the default calculator is returned.\n*\n* @method anim8.calculator\n* @for Core\n* @param {Calculator|String} calculatorInput\n* @return {Calculator}\n*/\nfunction $calculator(calculatorInput)\n{\n if ( calculatorInput instanceof Calculator )\n {\n   return calculatorInput;\n }\n if ( isString( calculatorInput ) && calculatorInput in Calculators )\n {\n   return Calculators[ calculatorInput ];\n }\n\n return Calculators['default'];\n}\n\n\n\n/**\n * Parses delay from a string or number. If the input is not a valid time then\n * {{#crossLink \"anim8.defaults/delay:property\"}}anim8.defaults.delay{{/crossLink}}\n * is returned.\n *\n * **See:** {{#crossLink \"Core/anim8.time:method\"}}anim8.time{{/crossLink}}\n *\n * @method anim8.delay\n * @param {String|Number} time\n */\nfunction $delay(time)\n{\n  return $time( time, Defaults.delay );\n}\n\n\n\n/**\n * Parses an array of delta values and normalizes them between the range of\n * 0 and 1. Optionally the array can be cloned.\n *\n * @method anim8.deltas\n * @param {Number[]} deltas\n * @param {Boolean} clone\n */\nfunction $deltas(deltas, clone)\n{\n  var max = deltas[ 0 ];\n  var min = deltas[ 0 ];\n\n  for (var i = 1; i < deltas.length; i++)\n  {\n    max = Math.max( max, deltas[ i ] );\n    min = Math.min( min, deltas[ i ] );\n  }\n\n  var target = clone ? [] : deltas;\n  var gap = max - min;\n  var invertGap = 1.0 / gap;\n\n  for (var i = 0; i < deltas.length; i++)\n  {\n    target[ i ] = (deltas[ i ] - min) * invertGap;\n  }\n\n  return target;\n}\n\n\n/**\n * Parses duration from a string or number. If the input is not a valid time then\n * {{#crossLink \"anim8.defaults/duration:property\"}}anim8.defaults.duration{{/crossLink}}\n * is returned.\n *\n * **See:** {{#crossLink \"Core/anim8.time:method\"}}anim8.time{{/crossLink}}\n *\n * @method anim8.duration\n * @param {String|Number} time\n */\nfunction $duration(time)\n{\n  return $time( time, Defaults.duration );\n}\n\n\n/**\n * Returns an easing based on the given input. If the input is a function it's\n * assumed to be an easing function and is returned immediately. If the input is\n * a string the easing with that name is returned. If the input is a string in\n * the format 'easing-easingType' then an easing is returned that is a\n * combination of the easing with the given name and the easingType with the\n * given name. If the given input is an array with 4 elements it's assumed to be\n * a bezier path and one is created and returned. If no input is given the\n * default easing is returned. If an easing cannot be determined then an error\n * is thrown.\n *\n * **Examples:**\n *\n *     anim8.easing();               // anim8.defaults.easing\n *     anim8.easing( 'linear' );     // anim8.easing.linear\n *     anim8.easing( 'reverse' );    // anim8.easingType.reverse( anim8.defaults.easing )\n *     anim8.easing( 'ease-yoyo' );  // anim8.easingType.yoyo( anim8.easing.ease )\n *     anim8.easing( [0,0,1,1] );    // anim8.easing.bezier( 0, 0, 1, 1 )\n *     anim8.easing( 5, false );     // false\n *     anim8.easing( 'invalid', 1 ); // 1\n *     anim8.easing( [0,0,1], 1 );   // 1\n *\n * @method anim8.easing\n * @for Core\n * @param {Function|String|Array} easing\n * @param {E} [returnOnInvalid]\n * @return {Function|E}\n */\nfunction $easing(easing, returnOnInvalid)\n{\n  if ( isFunction( easing ) )\n  {\n    return easing;\n  }\n  if ( isString( easing ) )\n  {\n    var result = null;\n    var scale = 1;\n\n    var scaleIndex = easing.indexOf('*');\n\n    if ( scaleIndex !== -1 )\n    {\n      scale = parseFloat( easing.substring( scaleIndex + 1 ) );\n      easing = easing.substring( 0, scaleIndex );\n    }\n\n    if ( easing in Easings )\n    {\n      result = Easings[ easing ];\n    }\n    else if ( easing in EasingTypes )\n    {\n      result = EasingTypes[ easing ]( $easing( Defaults.easing ) );\n    }\n    else if ( easing.indexOf('-') !== -1 )\n    {\n      var pair = easing.split('-');\n      var e = pair[0];\n      var t = pair[1];\n\n      if ( pair.length >= 2 && e in Easings && t in EasingTypes )\n      {\n        result = EasingTypes[ t ]( Easings[ e ] );\n      }\n    }\n\n    if ( result !== null && isFinite( scale ) && scale !== 1 )\n    {\n      result = Easings.scale( scale, result );\n    }\n\n    if ( result !== null )\n    {\n      return result;\n    }\n  }\n  if ( isArray( easing ) && easing.length === 4 && isNumber( easing[0] ) && isNumber( easing[1] ) && isNumber( easing[2] ) && isNumber( easing[3] ) )\n  {\n    return Easings.bezier.apply( null, easing );\n  }\n  if ( !isDefined( easing ) )\n  {\n    return $easing( Defaults.easing );\n  }\n\n  if ( isDefined( returnOnInvalid ) )\n  {\n    return returnOnInvalid;\n  }\n\n  throw easing + ' is not a valid easing';\n}\n\n\n/**\n * Returns an easing type based on the input. If the input is a function that\n * function is immediately returned. If the input is a string the easing type\n * with that name is returned. If no easing type could be determined an error is\n * thrown.\n *\n * @param {Function|String} easingType\n * @param [Boolean] optional\n * @return {Function|false}\n */\nfunction $easingType(easingType, optional)\n{\n  if ( isFunction( easingType ) )\n  {\n    return easingType;\n  }\n  if ( isString( easingType ) && easingType in EasingTypes )\n  {\n    return EasingTypes[ easingType ];\n  }\n\n  if ( optional )\n  {\n    return false;\n  }\n\n  throw easingType + ' is not a valid easing type';\n}\n\n\n/**\n * Returns a factory given the input and returns the default if none is found.\n *\n * @method factory\n * @for Core\n * @param {String|Factory} [factory]\n * @return {Factory}\n */\nfunction $factory(factoryInput, forObject)\n{\n  if ( factoryInput instanceof Factory )\n  {\n    return factoryInput;\n  }\n  if ( isString( factoryInput ) && factoryInput in Factories )\n  {\n    return Factories[ factoryInput ];\n  }\n  if ( forObject )\n  {\n    if ( forObject instanceof Factory )\n    {\n      return forObject;\n    }\n\n    if ( forObject instanceof Sequence )\n    {\n      forObject = forObject.animators;\n    }\n\n    if ( forObject instanceof Animators )\n    {\n      forObject = forObject.$[0];\n    }\n\n    if ( forObject instanceof Animator && forObject.factory )\n    {\n      return forObject.factory;\n    }\n  }\n\n  return Factories['default'];\n}\n\n\n/**\n * Returns a factory for the given subject and optionally throws an error if no\n * factory exists.\n *\n * @method factoryFor\n * @for Core\n * @param {Any} subject\n * @param {Boolean} [optional]\n * @return {Factory}\n */\nfunction $factoryFor(subject, optional)\n{\n  var highestPriorityFactory = false;\n\n  for (var factoryName in Factories)\n  {\n    var factory = Factories[ factoryName ];\n\n    if ( factory.is( subject ) && (highestPriorityFactory === false || highestPriorityFactory.priority < factory.priority) )\n    {\n      highestPriorityFactory = factory;\n    }\n  }\n\n  if ( highestPriorityFactory )\n  {\n    return highestPriorityFactory;\n  }\n\n  if ( optional )\n  {\n    return false;\n  }\n\n  throw 'No factory exists for subject ' + subject;\n}\n\n\n/**\n * Parses a number from the given input and if the input isn't a valid number\n * then returnOnInvalid is returned.\n *\n * **Examples:**\n *\n *     anim8.number( 5 );       // 5\n *     anim8.number( '5' );     // 5\n *     anim8.number( '5e4' );   // 50000\n *     anim8.number( 'x' );     // undefined\n *     anim8.number( 'x', 23 ); // 23\n *\n * @method anim8.number\n * @param {String|Number} value\n * @param {E} returnOnInvalid\n * @return {Number|E}\n */\nfunction $number(value, returnOnInvalid)\n{\n  var parsed = parseFloat( value );\n\n  return isNaN( parsed ) ? returnOnInvalid : parsed;\n}\n\n\n\n/**\n * Parses offset from a string or number. If the input is not a valid time then\n * {{#crossLink \"anim8.defaults/offset:property\"}}anim8.defaults.offset{{/crossLink}}\n * is returned.\n *\n * **See:** {{#crossLink \"Core/anim8.time:method\"}}anim8.time{{/crossLink}}\n *\n * @method anim8.offset\n * @param {String|Number} time\n */\nfunction $offset(time)\n{\n  return $time( time, Defaults.offset );\n}\n\n\nvar Options = {};\n\n/**\n * Parses a value into an options object. If the given input is a string it's\n * expected to be in a similar format to:\n *\n *     [duration] x[repeat] z[sleep] ~[delay] @[offset] ![scale] [[easing][-easingType]]\n *\n * This is also a registry of options, you can add your own options that\n * can be used later with syntax like:\n *\n *     anim8.options['myOptions'] = anim8.options('1.5s x2 !2');\n *\n * So you can use 'myOptions' as the options input.\n *\n * You can also specify relative values & scaling values. If you have the\n * following options:\n *\n *     +2s x*2 ~-1s\n *\n * It will result in adding 2 seconds to the duration, repeating it twice as\n * much, and subtracting one second from the delay.\n *\n * For more information on acceptable values in options:\n *\n * **See:** {{#crossLink \"Core/anim8.duration:method\"}}{{/crossLink}},\n *          {{#crossLink \"Core/anim8.repeat:method\"}}{{/crossLink}},\n *          {{#crossLink \"Core/anim8.sleep:method\"}}{{/crossLink}},\n *          {{#crossLink \"Core/anim8.delay:method\"}}{{/crossLink}},\n *          {{#crossLink \"Core/anim8.scale:method\"}}{{/crossLink}}, and\n *          {{#crossLink \"Core/anim8.easing:method\"}}{{/crossLink}}\n *\n * @method anim8.options\n * @for Core\n * @param {Object|String|Array} options\n * @param {Boolean} [cache]\n * @return {Object}\n */\nfunction $options(options, cache)\n{\n  var originalInput = options;\n  var cacheIt = coalesce( cache, Defaults.cacheOptions );\n\n  if ( isString( options ) )\n  {\n    if ( options in Options )\n    {\n      return Options[ options ];\n    }\n\n    options = options.toLowerCase().split(/\\s+/);\n  }\n\n  if ( isArray( options ) )\n  {\n    var parsed = {};\n\n    for (var i = 0; i < options.length; i++)\n    {\n      var part = options[i];\n      var first = part.charAt( 0 );\n      var paramSplit = part.indexOf( '=' );\n\n      // Parameters\n      if ( paramSplit !== -1 )\n      {\n        var paramName = part.substring( 0, paramSplit );\n        var paramValue = part.substring( paramSplit + 1 );\n\n        if ( !parsed.parameters )\n        {\n          parsed.parameters = {};\n        }\n\n        parsed.parameters[ paramName ] = paramValue;\n      }\n      // Repeats\n      else if ( first === 'x' )\n      {\n        parseOptionProperty( part.substring(1), parsed, $repeat, 'repeat', 'repeatAdd', 'repeatScale' );\n      }\n      // Sleeping\n      else if ( first === 'z' )\n      {\n        parseOptionProperty( part.substring(1), parsed, $time, 'sleep', 'sleepAdd', 'sleepScale' );\n      }\n      // Delay\n      else if ( first === '~' )\n      {\n        parseOptionProperty( part.substring(1), parsed, $time, 'delay', 'delayAdd', 'delayScale' );\n      }\n      // Scaling\n      else if ( first === '!' )\n      {\n        parseOptionProperty( part.substring(1), parsed, $number, 'scale', 'scaleAdd', 'scaleScale' );\n      }\n      // Offset\n      else if ( first === '@' )\n      {\n        parseOptionProperty( part.substring(1), parsed, $time, 'offset', 'offsetAdd', 'offsetScale' );\n      }\n      else\n      {\n        // Easing?\n        var easing = $easing( part, false );\n\n        if ( easing !== false )\n        {\n          parsed.easing = easing;\n        }\n\n        // Duration?\n        var duration = parseOptionProperty( part, parsed, $time, 'duration', 'durationAdd', 'durationScale' );\n\n        if ( duration === false )\n        {\n          // If not a duration, might be an alternative repeat? (doesn't start with x)\n          parseOptionProperty( part, parsed, $repeat, 'repeat', 'repeatAdd', 'repeatScale' );\n        }\n      }\n    }\n\n    if ( isString( originalInput ) && cacheIt )\n    {\n      Options[ originalInput ] = parsed;\n    }\n\n    return parsed;\n  }\n\n  if ( isObject( options ) )\n  {\n    return options;\n  }\n\n  return Defaults.noOptions;\n}\n\nfunction parseOptionProperty(input, out, parseFunction, property, propertyAdd, propertyScale)\n{\n  var first = input.charAt( 0 );\n\n  if ( first === '*' )\n  {\n    parsed = $number( input.substring( 1 ), false );\n\n    if ( parsed !== false )\n    {\n      out[ propertyScale ] = parsed;\n    }\n  }\n  else\n  {\n    if ( first === '+' || first === '-' )\n    {\n      property = propertyAdd;\n      input = input.substring( 1 );\n    }\n\n    var parsed = parseFunction( input, false );\n\n    if ( parsed !== false )\n    {\n      out[ property ] = parsed;\n    }\n  }\n\n  return parsed;\n}\n\n\n/**\n * Parses a path given the input and returns an instance of anim8.Path or throws\n * an error if the path could not be parsed. If the input is an object and has\n * a type property with a value that maps to a path type the path's parsing\n * function is invoked with the object.\n *\n * @method anim8.path\n * @for Core\n * @param  {anim8.Path|String|Object} pathInput\n * @return {anim8.Path}\n * @throws {String} If the input is not a valid path.\n */\nfunction $path(pathInput)\n{\n  if ( pathInput instanceof Path )\n  {\n    return pathInput;\n  }\n  if ( isString( pathInput ) && pathInput in Paths )\n  {\n    return Paths[ pathInput ];\n  }\n  if ( isObject( pathInput ) && pathInput.type in Paths )\n  {\n    return Paths[ pathInput.type ]( pathInput );\n  }\n\n  throw pathInput + ' is not a valid path';\n}\n\n\n\n/**\n * Parses repeats from a string or number. If a valid repeat is not given then\n * `returnOnInvalid` is returned, if that is not given then\n * {{#crossLink \"anim8.defaults/repeat:property\"}}anim8.defaults.repeat{{/crossLink}}\n * is returned.\n *\n * **Examples:**\n *\n *     anim8.repeat( 5 );            // 5\n *     anim8.repeat( 'inf' );        // Infinity\n *     anim8.repeat( 'infinity' );   // Infinity\n *     anim8.repeat( 'infinite' );   // Infinity\n *     anim8.repeat( 'once' );       // 1\n *     anim8.repeat( 'twice' );      // 2\n *     anim8.repeat( 'thrice' );     // 3\n *     anim8.repeat( 'dozen' );      // 12\n *     anim8.repeat( 'random' );     // 4\n *     anim8.repeat( 'invalid', 6 ); // 6\n *     anim8.repeat( false, 7 );     // 7\n *     anim8.repeat();               // anim8.defaults.repeat\n *\n * @method anim8.repeat\n * @param {String|Number} time\n * @param {E} [returnOnInvalid]\n * @return {Number|E}\n */\nvar $repeat = (function()\n{\n  var conversions = {\n    inf:        Number.POSITIVE_INFINITY,\n    infinity:   Number.POSITIVE_INFINITY,\n    infinite:   Number.POSITIVE_INFINITY,\n    once:       1,\n    twice:      2,\n    thrice:     3,\n    dozen:      12,\n    random:     4 // chosen by fair dice roll. guaranteed to be random.\n  };\n\n  return function(repeat, returnOnInvalid)\n  {\n    if ( isNumber( repeat ) )\n    {\n      return repeat;\n    }\n    if ( isString( repeat ) )\n    {\n      repeat = repeat.toLowerCase();\n\n      if ( repeat in conversions )\n      {\n        return conversions[ repeat ];\n      }\n      else\n      {\n        var parsed = parseInt( repeat );\n\n        if ( !isNaN(parsed) )\n        {\n          return parsed;\n        }\n      }\n    }\n\n    return coalesce( returnOnInvalid, Defaults.repeat );\n  };\n\n})();\n\n\n/**\n * Parses scale from a string or number.\n *\n * **See:** {{#crossLink \"Core/anim8.number:method\"}}anim8.number{{/crossLink}}\n *\n * @method anim8.scale\n * @param {String|Number} scale\n * @return {Number}\n */\nfunction $scale(scale)\n{\n  return $number( scale, Defaults.scale );\n}\n\n\n\n/**\n * Parses sleep from a string or number. If the input is not a valid time then\n * {{#crossLink \"anim8.defaults/sleep:property\"}}anim8.defaults.sleep{{/crossLink}}\n * is returned.\n *\n * **See:** {{#crossLink \"Core/anim8.time:method\"}}anim8.time{{/crossLink}}\n *\n * @method anim8.sleep\n * @param {String|Number} time\n */\nfunction $sleep(time)\n{\n  return $time( time, Defaults.sleep );\n}\n\n/**\n * Returns a spring if the provided argument is a spring, the name of a spring,\n * or an object with a spring type to be created. If none of these conditions\n * are true then an error is thrown.\n *\n * @method anim8.spring\n * @for Core\n * @param {Spring|String|Object} springInput\n * @return {Spring}\n */\nfunction $spring(springInput)\n{\n  if ( springInput instanceof Spring )\n  {\n    return springInput;\n  }\n  if ( isString( springInput ) && springInput in Springs )\n  {\n    return Springs[ springInput ];\n  }\n  if ( isObject( springInput ) && springInput.type in Springs )\n  {\n    return Springs[ springInput.type ]( springInput );\n  }\n\n  throw springInput + ' is not a valid spring';\n}\n\n\n/**\n * Parses milliseconds from a string or number. If a number is given it's\n * assumed to be milliseconds and is returned immediately. If a string is given\n * a unit is looked for to determine how to scale the number into milliseconds.\n * If the given time is invalid and returnOnInvalid is not given then zero is\n * returned.\n *\n * **Examples:**\n *\n *     anim8.time( 45 );       // 45\n *     anim8.time( 45.9 );     // 45\n *     anim8.time( -4.1 );     // -5\n *     anim8.time( '5ms' );    // 5\n *     anim8.time( '23' );     // 23\n *     anim8.time( '5c' );     // 500\n *     anim8.time( '5cs' );    // 500\n *     anim8.time( '5jiffy' ); // 833\n *     anim8.time( '5third' ); // 833\n *     anim8.time( '10s' );    // 10000\n *     anim8.time( '10sec' );  // 10000\n *     anim8.time( '1.5m' );   // 90000\n *     anim8.time( '1.5min' ); // 90000\n *     anim8.time( '0.4h' );   // 144000\n *     anim8.time( '0.4hr' );  // 144000\n *\n * @method anim8.time\n * @param {String|Number} time\n * @param {Any} [returnOnInvalid]\n */\nvar $time = (function()\n{\n  var regex = /^(-?\\d*(\\.\\d+)|-?\\d+)(ms|s|c|cs|third|jiffy|sec|m|min|h|hr)?$/;\n\n  var conversions = {\n    ms:     1,\n    c:      100,\n    cs:     100,\n    jiffy:  1000 / 60,\n    third:  1000 / 60,\n    s:      1000,\n    sec:    1000,\n    m:      1000 * 60,\n    min:    1000 * 60,\n    h:      1000 * 60 * 60,\n    hr:     1000 * 60 * 60\n  };\n\n  return function(time, returnOnInvalid)\n  {\n    if ( isNumber( time ) )\n    {\n      // raw numbers are considered milliseconds\n      return Math.floor( time );\n    }\n    if ( isString( time ) )\n    {\n      var parsed = regex.exec( time );\n\n      if ( parsed )\n      {\n        var time = parseFloat( parsed[1] );\n        var unit = parsed[3];\n\n        if ( unit in conversions )\n        {\n          time *= conversions[ unit ];\n        }\n\n        return Math.floor( time );\n      }\n    }\n\n    return coalesce( returnOnInvalid, 0 );\n  };\n\n})();\n\n\nvar Transitions = {};\n\n/**\n * Parses a value into a transition object. If the given input is a string it's\n * expected to be in a similar format to:\n *\n *     [time] [easing[-easingType]] >[outro] <[intro] /[granularity] ^[lookup]\n *\n * This is also a registry of transitions, you can add your own transitions that\n * can be used later with syntax like:\n *\n *     anim8.transition['myTransition'] = anim8.transition('50ms 0.05 linear');\n *\n * So you can use 'myTransition' as the transition input.\n *\n *     animator.transition('myTransition', 'myAnimation');\n *\n * @method anim8.transition\n * @for Core\n * @param {Object|String|Array} options\n * @param {Boolean} [cache]\n * @return {Object}\n */\nfunction $transition(transition, cache)\n{\n  // 1. If it's a string, convert it into an array.\n  // 2. If it's an array, parse it and convert it into an object.\n  // 3. If it's an object, fill in any missing values with the defaults.\n\n  var originalInput = transition;\n\n  if ( isString( transition ) )\n  {\n    if ( transition in Transitions )\n    {\n      return Transitions[ transition ];\n    }\n\n    transition = transition.toLowerCase().split(/\\s+/);\n  }\n\n  if ( isArray( transition ) )\n  {\n    var transitionArray = transition;\n\n    transition = {};\n\n    for (var i = 0; i < transitionArray.length; i++)\n    {\n      var part = transitionArray[i];\n      var first = part.charAt( 0 );\n\n      // Introduction Time (into next event)\n      if ( first === '<' )\n      {\n        var intro = $time( part.substring(1), false );\n\n        if ( !isNaN( intro ) )\n        {\n          transition.intro = intro;\n        }\n      }\n      // Outroduction Time (out of current event)\n      else if ( first === '>' )\n      {\n        var outro = $time( part.substring(1), false );\n\n        if ( !isNaN( outro ) )\n        {\n          transition.outro = outro;\n        }\n      }\n      // Granularity (for velocity conscious transitions)\n      else if ( first === '/' )\n      {\n        var granularity = $number( part.substring(1), false );\n\n        if ( granularity !== false )\n        {\n          transition.granularity = granularity;\n        }\n      }\n      // Lookup (for velocity conscious transitions)\n      else if ( first === '^' )\n      {\n        var lookup = $time( part.substring(1), false );\n\n        if ( lookup !== false )\n        {\n          transition.lookup = lookup;\n        }\n      }\n      else\n      {\n        // Easing\n        var easing = $easing( part, false );\n\n        if ( easing !== false )\n        {\n          transition.easing = easing;\n        }\n\n        // Time\n        var time = $time( part, false );\n\n        if ( time !== false )\n        {\n          transition.time = time;\n        }\n      }\n    }\n  }\n\n  if ( isObject( transition ) )\n  {\n    transition.time        = $time( transition.time, Defaults.transitionTime );\n    transition.outro       = $time( transition.outro, Defaults.transitionOutro );\n    transition.intro       = $time( transition.intro, Defaults.transitionIntro );\n    transition.easing      = $easing( coalesce( transition.easing, Defaults.transitionEasing ) );\n    transition.granularity = $number( transition.granularity, Defaults.transitionGranularity );\n    transition.lookup      = $time( transition.lookup, Defaults.transitionLookup );\n\n    if ( isString( originalInput ) && coalesce( cache, Defaults.cacheTransitions ) )\n    {\n      Transitions[ originalInput ] = transition;\n    }\n\n    return transition;\n  }\n\n  return Defaults.noTransition;\n}\n\n\n  // Add events to the animation cycle: begin, end, finished, starting\n  eventize( anim8 );\n\n  // anim8.js\n  anim8.anim8s = anim8s;\n  anim8.fn = Animator.prototype;\n  anim8s.fn = Animators.prototype;\n  anim8.isRunning = isRunning;\n  anim8.isLive = isLive;\n  anim8.setLive = setLive;\n  anim8.animating = animating;\n  anim8.requestRun = requestRun;\n  anim8.activateAnimator = activateAnimator;\n  anim8.pushAnimator = pushAnimator;\n  anim8.activate = activate;\n  anim8.run = run;\n  anim8.pause = pause;\n  anim8.resume = resume;\n  anim8.stop = stop;\n  anim8.end = end;\n  anim8.finish = finish;\n  anim8.nopeat = nopeat;\n\n  // Core\n  anim8.noop = noop;\n  anim8.isDefined = isDefined;\n  anim8.isFunction = isFunction;\n  anim8.isNumber = isNumber;\n  anim8.isBoolean = isBoolean;\n  anim8.isString = isString;\n  anim8.isArray = isArray;\n  anim8.isObject = isObject;\n  anim8.isEmpty = isEmpty;\n  anim8.now = now;\n  anim8.trim = trim;\n  anim8.toArray = toArray;\n  anim8.copy = copy;\n  anim8.extend = extend;\n  anim8.coalesce = coalesce;\n  anim8.constant = constant;\n  anim8.resolve = resolve;\n  anim8.id = id;\n  anim8.Class = Class;\n  anim8.Defaults = Defaults;\n\n  // Math\n  anim8.clamp = clamp;\n  anim8.clamper = clamper;\n  anim8.gcd = gcd;\n  anim8.choose = choose;\n  anim8.toDegrees = toDegrees;\n  anim8.toRadians = toRadians;\n  anim8.modder = modder;\n\n  // Registries\n  anim8.Animations = Animations;\n  anim8.Calculators = Calculators;\n  anim8.Factories = Factories;\n  anim8.Builders = Builders;\n  anim8.Paths = Paths;\n  anim8.Springs = Springs;\n  anim8.Easings = Easings;\n  anim8.EasingTypes = EasingTypes;\n  anim8.Options = Options;\n  anim8.Transitions = Transitions;\n\n  // Parsing\n  anim8.animation = $animation;\n  anim8.attrimatorsFor = $attrimatorsFor;\n  anim8.calculator = $calculator;\n  anim8.delay = $delay;\n  anim8.duration = $duration;\n  anim8.easing = $easing;\n  anim8.easingType = $easingType;\n  anim8.factory = $factory;\n  anim8.factoryFor = $factoryFor;\n  anim8.number = $number;\n  anim8.offset = $offset;\n  anim8.options = $options;\n  anim8.builder = $builder;\n  anim8.path = $path;\n  anim8.repeat = $repeat;\n  anim8.scale = $scale;\n  anim8.sleep = $sleep;\n  anim8.spring = $spring;\n  anim8.time = $time;\n  anim8.transition = $transition;\n  anim8.deltas = $deltas;\n\n  // Modules\n  // - color.js\n  anim8.Color = Color;\n  // - computed.js\n  anim8.computed = computed;\n  anim8.isComputed = isComputed;\n  anim8.resolveComputed = resolveComputed;\n  // - dynamic.js\n  anim8.composite = composite;\n  anim8.partial = partial;\n  anim8.spread = spread;\n  // - eventize.js\n  anim8.eventize = eventize;\n  // - save.js\n  anim8.save = save;\n  anim8.saveGroup = saveGroup;\n  anim8.SaveOptions = SaveOptions;\n  // - translate.js\n  anim8.translate = translate;\n  // - param.js\n  anim8.param = param;\n  anim8.paramFactory = paramFactory;\n  anim8.paramCalculator = paramCalculator;\n  anim8.Parameters = Parameters;\n\n  // Classes\n  anim8.Aninmation = Animation;\n  anim8.Animator = Animator;\n  anim8.Animators = Animators;\n  anim8.Attrimator = Attrimator;\n  anim8.AttrimatorMap = AttrimatorMap;\n  anim8.Calculator = Calculator;\n  anim8.Defer = Defer;\n  anim8.DeferAnimator = DeferAnimator;\n  anim8.Event = Event;\n  anim8.EventState = EventState;\n  anim8.Factory = Factory;\n  anim8.FastMap = FastMap;\n  anim8.Oncer = Oncer;\n  anim8.Builder = Builder;\n  anim8.Path = Path;\n  anim8.Physics = Physics;\n  anim8.Sequence = Sequence;\n  anim8.Spring = Spring;\n\n  // Movie\n  anim8.Movie = Movie;\n  anim8.MoviePlayer = MoviePlayer;\n  anim8.MovieTimeline = MovieTimeline;\n\n  // Calculators\n  anim8.Calculator2d = Calculator2d;\n  anim8.Calculator3d = Calculator3d;\n  anim8.CalculatorNumber = CalculatorNumber;\n  anim8.CalculatorQuaternion = CalculatorQuaternion;\n  anim8.CalculatorRGB = CalculatorRGB;\n  anim8.CalculatorRGBA = CalculatorRGBA;\n  anim8.CalculatorString = CalculatorString;\n\n  // Factories\n  anim8.object = object;\n  anim8.FactoryObject = FactoryObject;\n\n  // Builders\n  anim8.BuilderAnd = BuilderAnd;\n  anim8.BuilderDeltas = BuilderDeltas;\n  anim8.BuilderFinal = BuilderFinal;\n  anim8.BuilderInitial = BuilderInitial;\n  anim8.BuilderKeyframe = BuilderKeyframe;\n  anim8.BuilderMove = BuilderMove;\n  anim8.BuilderPath = BuilderPath;\n  anim8.BuilderPhysics = BuilderPhysics;\n  anim8.BuilderQueue = BuilderQueue;\n  anim8.BuilderSpring = BuilderSpring;\n  anim8.BuilderTravel = BuilderTravel;\n  anim8.BuilderTweenFrom = BuilderTweenFrom;\n  anim8.BuilderTweenTo = BuilderTweenTo;\n\n  // Paths\n  anim8.PathBasisSpline = PathBasisSpline;\n  anim8.PathBezier = PathBezier;\n  anim8.PathCatmullRom = PathCatmullRom;\n  anim8.PathCombo = PathCombo;\n  anim8.PathCompiled = PathCompiled;\n  anim8.PathCubic = PathCubic;\n  anim8.PathDelta = PathDelta;\n  anim8.PathHermite = PathHermite;\n  anim8.PathJump = PathJump;\n  anim8.PathKeyframe = PathKeyframe;\n  anim8.PathLinear = PathLinear;\n  anim8.PathParametric = PathParametric;\n  anim8.PathQuadratic = PathQuadratic;\n  anim8.PathQuadraticCorner = PathQuadraticCorner;\n  anim8.PathSub = PathSub;\n  anim8.PathUniform = PathUniform;\n  anim8.PathTween = Tween;\n  anim8.PathPoint = PathPoint;\n  anim8.PathSeries = PathSeries;\n\n  // Springs\n  anim8.SpringDistance = SpringDistance;\n  anim8.SpringLinear = SpringLinear;\n\n  return anim8;\n\n}));\n"]}