<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib/anim8js-dom-core.js - anim8js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="anim8js" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/anim8.html">anim8</a></li>
                                <li><a href="../classes/anim8.Animation.html">anim8.Animation</a></li>
                                <li><a href="../classes/anim8.Animator.html">anim8.Animator</a></li>
                                <li><a href="../classes/anim8.Animators.html">anim8.Animators</a></li>
                                <li><a href="../classes/anim8.Attrimator.html">anim8.Attrimator</a></li>
                                <li><a href="../classes/anim8.AttrimatorMap.html">anim8.AttrimatorMap</a></li>
                                <li><a href="../classes/anim8.defaults.html">anim8.defaults</a></li>
                                <li><a href="../classes/anim8.DeferAnimator.html">anim8.DeferAnimator</a></li>
                                <li><a href="../classes/anim8.delegate.html">anim8.delegate</a></li>
                                <li><a href="../classes/anim8.eventize.html">anim8.eventize</a></li>
                                <li><a href="../classes/anim8.Path.html">anim8.Path</a></li>
                                <li><a href="../classes/anim8.Tween.html">anim8.Tween</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/anim8.html">anim8</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: lib/anim8js-dom-core.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">

/**
 * A factory for HTML Elements
 */
anim8.FactoryDom = function()
{
  this.cached = {};
  this.ids = 0;
  this.elementAttribute = &#x27;anim8&#x27;;
  this.priority = 5;
  this.attributes = {};
};

anim8.override( anim8.FactoryDom.prototype = new anim8.Factory(),
{
  
  /**
   * Determines whether the given subject is valid for this factory to create Animators for.
   * 
   * @param  {any} subject
   * @return {Boolean}
   */
  is: function(subject)
  {
    return anim8.isElement( subject );
  },

  /**
   * Returns an animator given a subject.
   * 
   * @param  {HTMLElement} subject
   * @return {anim8.Animator}
   */
  animatorFor: function(subject)
  {
    var animatorId = subject.getAttribute( this.elementAttribute );
    
    if (!(animatorId in this.cached)) 
    {
      var animator = new anim8.AnimatorDom( subject );
      
      subject.setAttribute( this.elementAttribute, animatorId = animator.id = ++this.ids );
      
      animator.factory = this;
      
      this.cached[animatorId] = animator;
    }

    return this.cached[ animatorId ];
  },

  /**
   * Destroys the animator by unlinking the animator from the subject.
   * 
   * @param  {anim8.Animator} animator
   */
  destroy: function(animator)
  {
    delete this.cached[ animator.id ];
  },

  /**
   * Returns the attribute descriptor for the given attribute.
   * 
   * @param  {String} attr
   * @return {Object}
   */
  attribute: function(attr)
  {
    var attribute = this.attributes[ attr ];

    if ( !attribute )
    {
      attribute = this.attributes[ attr ] = anim8.dom.attribute( attr );

      var calculatorName = attribute.calculator;
      var calculator = anim8.calculator( calculatorName );
      var defaultValue = calculator.parse( attribute.defaultValue, calculator.ZERO );
      var propertyName = anim8.coalesce( attribute.property, attr );
      var property = anim8.dom.property( propertyName );
      var defaultUnit = attribute.defaultUnit || &#x27;&#x27;;

      attribute.calculatorName = calculatorName;
      attribute.calculator = calculator;
      attribute.defaultValue = defaultValue;
      attribute.name = attr;
      attribute.propertyName = propertyName;
      attribute.property = property;
      attribute.defaultUnit = defaultUnit;
      attribute.parse = function(value) {
        return this.calculator.parse( value, this.defaultValue );
      };
      attribute.cloneDefault = function() {
        return this.calculator.clone( this.defaultValue );
      };
    }

    return attribute;
  }

});

/**
 * Registers the DOM factory.
 */
anim8.factory[&#x27;default&#x27;] = anim8.factory[&#x27;dom&#x27;] = new anim8.FactoryDom();

/* TODO don&#x27;t apply styles if they&#x27;re impercivable (convert value to pixels of applicable) */

/**
 * All DOM related functions.
 */
anim8.dom = {};

/**
 * Returns a property for the given name.
 * 
 * @param  {String|Object}
 * @return {Object}
 */
anim8.dom.property = function(prop) 
{
  if ( anim8.isObject( prop ) &amp;&amp; anim8.isFunction( prop.get ) &amp;&amp; anim8.isFunction( prop.set ) ) 
  {
    return prop;
  }
  if ( anim8.isString( prop ) &amp;&amp; prop in anim8.dom.property )
  {
    return anim8.dom.property[ prop ];
  }
  
  throw prop + &#x27; is not a valid property&#x27;;
}

/**
 * Computes the desired style of the given element and returns it as a string. 
 * The style given must be in hyphenated format like so: 
 * anim8.dom.style( element, &#x27;font-size&#x27; ) = &#x27;12px&#x27;
 *
 * @param {HTMLElement} e
 * @param {String} style
 * @return {String}
 */
anim8.dom.style = (function()
{
  var hyphenated = {};

  var hyphenize = function(str) 
  {
    if ( str in hyphenated )
    {
      return hyphenated[ str ];
    }

    var key = str;

    str = str.replace(/[a-z][A-Z]/g, function(str, letter)
    {
     return str[0] + &#x27;-&#x27; + str[1].toLowerCase();
    });
    
    str = str.replace(/^Webkit/, &#x27;-webkit&#x27;);
    str = str.replace(/^Moz/, &#x27;-moz&#x27;);
    str = str.replace(/^Ms/, &#x27;-ms&#x27;);
    str = str.replace(/^O/, &#x27;-o&#x27;);
    str = str.replace(/^Khtml/, &#x27;-khtml&#x27;);
    
    return hyphenated[ key ] = str;
  };
  
  return function(e, style) 
  {
    if (e.currentStyle)
    {
      return e.currentStyle[ style ];
    } 
    else if (document.defaultView &amp;&amp; document.defaultView.getComputedStyle) 
    {
      return document.defaultView.getComputedStyle( e, null ).getPropertyValue( hyphenize( style ) );
    } 
    else 
    {
      return e.style[ style ]; 
    }
  };
  
})();

/**
 * Given an array of styles this will return the first one that is present on elements in the current browser.
 *
 * @param {Array} prefixes
 * @return {String|false}
 */
anim8.dom.prefix = (function() 
{
  var a = document.createElement(&#x27;a&#x27;);
  
  return function(prefixes) 
  {
    for (var i = 0; i &lt; prefixes.length; i++) 
    {
      if ( anim8.isDefined( a.style[ prefixes[ i ] ] ) ) 
      {
        return prefixes[i];
      }
    }
    return false;
  };
  
})();

/**
 * Parses the string for a value and a unit.
 *
 * @param {String} value
 * @return {Object|false}
 */
anim8.dom.parseValue = (function()
{
  var regex = /(-?\d*(\.\d+)|-?\d+)(px|em|%|vw|ex|cm|mm|in|pt|pc|deg|rad)?/;
  
  return function(x)
  {
    var parsed = regex.exec( x );
    
    if (parsed) 
    {      
      return {
        value: parseFloat( parsed[1] ),
        unit: parsed[3]
      }
    }
    
    return false;
  };
})();


/**
 * Converts one unit to another for a given element.
 *
 * For Example: anim8.dom.convert( element, &#x27;100px&#x27;, &#x27;%&#x27;, &#x27;parentWidth&#x27; )
 *    returns how much percent 100px relativeTo parentWidth of the given element
 *
 * @param {HTMLElement} e
 * @param {String} from
 * @param {String} toUnit
 * @param {String} relativeTo
 * @return {Number|false}
 */
anim8.dom.convert = (function()
{
  /**
   * Calculators how many pixels a given value &amp; unit is.
   * 
   * For Example: anim8.toPixels( 100, &#x27;in&#x27; ) 
   *    returns how many pixels are in 1 inch, with up to 2 decimal points of accuracy.
   */
  var toPixels = function(baseValue, baseUnit, defaultRate)
  {
    if ( document.body )
    {
      var div = document.createElement(&#x27;div&#x27;);
      document.body.appendChild( div );
      div.style.width = baseValue + baseUnit;
      var pixels = (div.offsetWidth / baseValue);
      document.body.removeChild( div );
      return pixels || defaultRate;
    }
    
    return defaultRate;
  };

  var getFontSize = function(e, notUnit)
  {
    var fontSize = anim8.dom.style( e, &#x27;fontSize&#x27; );
    var parsed = anim8.dom.parseValue( fontSize );
    
    if ( !parsed || parsed.unit === notUnit )
    {
      return 12;
    }
    
    if ( parsed.unit === &#x27;px&#x27; ) 
    {
      return parsed.value;
    }
    
    return getConverterScale( e, conversions[ parsed.unit ].px, relativeTo );
  };

  var variables = {};
  
  variables.parentWidth = function(e)
  {
    return e.parentNode.scrollWidth;
  };
  variables.parentHeight = function(e)
  {
    return e.parentNode.scrollHeight;
  };
  variables.width = function(e)
  {
    return e.offsetWidth;
  };
  variables.height = function(e)
  {
    return e.offsetHeight;
  };
  variables.fontSize = function(e)
  {
    return getFontSize( e, &#x27;%&#x27; );
  };
  variables.parentFontSize = function(e)
  {
    return getFontSize( e.parentNode, &#x27;%&#x27; );
  };
  variables.htmlFontSize = function(e)
  {
    var htmlElement = document.getElementsByTagName(&quot;html&quot;)[0];
    
    return getFontSize( htmlElement, &#x27;%&#x27; );
  };
  
  var conversions = {};
  
  conversions.pt  = { px: toPixels(100, &#x27;pt&#x27;) };
  conversions.in  = { px: toPixels(100, &#x27;in&#x27;) };
  conversions.cm  = { px: toPixels(1000, &#x27;cm&#x27;) };
  conversions.mm  = { px: toPixels(100000, &#x27;mm&#x27;) };
  conversions.vw  = { px: toPixels(1000, &#x27;vw&#x27;) };
  conversions.deg = { rad: Math.PI / 180.0};

  conversions.em = 
  {
    px: function(e, relativeTo) 
    {
      return getFontSize( e, &#x27;em&#x27; );
    }
  };
  
  conversions.rem = 
  {
    px: function(e, relativeTo) 
    {
      var htmlElement = document.getElementsByTagName(&quot;html&quot;)[0];
      
      return getFontSize( htmlElement, &#x27;rem&#x27; );
    }
  };
  
  conversions[&#x27;%&#x27;] = 
  {
    px: function(e, relativeTo) 
    {
      if ( anim8.isNumber( relativeTo ) )
      {
        return relativeTo;
      }
      if ( relativeTo in variables )
      {
        return variables[ relativeTo ]( e ) / 100.0;
      }
      
      return 1.0;
    }
  };
  
  // Populate conversions going other way.
  for (var unit in conversions)
  {
    for (var to in conversions[ unit ])
    {
      if ( !(to in conversions) )
      {
        conversions[ to ] = {};
      }
      
      if ( !(unit in conversions[ to ]) )
      {
        var given = conversions[ unit ][ to ];
        
        if ( anim8.isNumber( given ) )
        {
          conversions[ to ][ unit ] = 1.0 / given;  
        }
        if ( anim8.isFunction( given ) )
        {
          conversions[ to ][ unit ] = (function(converter) 
          {
            return function(e, relativeTo) 
            {
              return 1.0 / converter( e, relativeTo );
            };
          })( given );
        }
      }
    }
  }
  
  // Given an element, convert, and relativeTo - return the number we need to multiply by.
  var getConverterScale = function(e, converter, relativeTo)
  {
    if ( anim8.isNumber( converter ) )
    {
      return converter;
    }
    else if ( anim8.isFunction( converter ) )
    {
      return converter( e, relativeTo );
    }
    
    return 1.0;
  };
  
  return function(e, from, toUnit, relativeTo)
  {
    if ( anim8.isNumber( from ) )
    {
      return from;
    }
    
    var parsed = anim8.dom.parseValue( from );
    
    if ( !parsed )
    {
      return false;
    }
    
    var value = parsed.value;
    var fromUnit = parsed.unit;
    
    if ( !fromUnit || fromUnit === toUnit )
    {
      return value;
    }
    
    // First see if we have a direct conversion available...
    if ( fromUnit in conversions &amp;&amp; toUnit in conversions[ fromUnit ] )
    {
      var converter = conversions[ fromUnit ][ toUnit ];
      
      value *= getConverterScale( e, converter, relativeTo );
    }
    // Otherwise convert it to px, then to the desired unit
    else if ( fromUnit in conversions &amp;&amp; conversions[ fromUnit ].px &amp;&amp; toUnit in conversions.px )
    {
      var converter1 = conversions[ fromUnit ].px;
      var converter2 = conversions.px[ toUnit ];
      
      value *= getConverterScale( e, converter1, relativeTo );
      value *= getConverterScale( e, converter2, relativeTo );
    }
    
    return value;
  };
  
})();



    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
