<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib/anim8js-parser.js - anim8js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="anim8js" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/anim8.html">anim8</a></li>
                                <li><a href="../classes/anim8.Animation.html">anim8.Animation</a></li>
                                <li><a href="../classes/anim8.Animator.html">anim8.Animator</a></li>
                                <li><a href="../classes/anim8.Animators.html">anim8.Animators</a></li>
                                <li><a href="../classes/anim8.Attrimator.html">anim8.Attrimator</a></li>
                                <li><a href="../classes/anim8.AttrimatorMap.html">anim8.AttrimatorMap</a></li>
                                <li><a href="../classes/anim8.defaults.html">anim8.defaults</a></li>
                                <li><a href="../classes/anim8.DeferAnimator.html">anim8.DeferAnimator</a></li>
                                <li><a href="../classes/anim8.delegate.html">anim8.delegate</a></li>
                                <li><a href="../classes/anim8.eventize.html">anim8.eventize</a></li>
                                <li><a href="../classes/anim8.Path.html">anim8.Path</a></li>
                                <li><a href="../classes/anim8.Tween.html">anim8.Tween</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/anim8.html">anim8</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: lib/anim8js-parser.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">

/**
 * Returns a parser based on the input. If the input is a function that function is immediately returned.
 * If the input is a string the parser with that name is returned. If no parser could be determined then
 * false is returned.
 * 
 * @param {Function|String} parser
 * @return {anim8.Parser|false}
 */
anim8.parser = function(parser)
{
  if ( parser instanceof anim8.Parser )
  {
    return parser;
  }
  if ( anim8.isString( parser ) &amp;&amp; parser in anim8.parser )
  {
    return anim8.parser[ parser ];
  }
  
  return false;
};

/**
 * Instantiates a new Parser.
 */
anim8.Parser = function()
{
  
};

anim8.Parser.prototype = 
{
  
  /**
   * Parses the animation object (and optionally an option object) and pushes
   * all generated attrimatorMap to the given array.
   * 
   * @param {Object} animation
   * @param {Object} options
   * @param {anim8.AttrimatorMap} attrimatorMap
   * @param {anim8.ParserHelper} helper
   */
  parse: function( animation, options, attrimatorMap, helper )
  {
    throw &#x27;Parser.parse not implemented&#x27;;
  },
  
  /**
   * Merges the options with the given event instances. This is when an existing 
   * animation is provided but the user wants to override the animation&#x27;s options.
   *
   * Because event properties can be specified in several places there&#x27;s a priority
   * to which one takes precedence. The properties specified in the animation object
   * itself are highest priority, followed by the new options, then by the old
   * options, and finally by the existing property on the event instance.
   *
   * @param {Object} animation
   * @param {Object} newOptions
   * @param {Object} oldOptions
   * @param {anim8.AttrimatorMap} attrimatorMap
   * @param {anim8.ParserHelper} helper
   */
  merge: function( animation, newOptions, oldOptions, attrimatorMap, helper )
  { 
    var factory = anim8.factory( animation.factory );
    var attrimators = attrimatorMap.values;

    for (var i = attrimators.length - 1; i &gt;= 0; i--)
    {
      var e = attrimators[ i ];
      var attr = e.attribute;
      
      if ( e.getParser() !== this )
      {
        continue;
      }

      e.easing    = helper.mergeEasing( attr, e.easing );
      e.repeat    = helper.mergeRepeat( attr, e.repeat );
      e.delay     = helper.mergeDelay( attr, e.delay );
      e.sleep     = helper.mergeSleep( attr, e.sleep );
      e.duration  = helper.mergeDuration( attr, e.duration );
      e.scale     = helper.mergeScale( attr, e.scale );
      e.scaleBase = helper.mergeScaleBase( attr, e.scaleBase, factory );
    }
  }
};


/**
 * Instantiates a new instance of Parser Helper.
 * 
 * @param {Object} input
 * @param {Object} oldOptions
 * @param {Object} newOptions
 */
anim8.ParserHelper = function( input, oldOptions, newOptions )
{
  this.input = input;
  this.oldOptions = oldOptions || {};
  this.newOptions = newOptions || {};

  this.prepareSpecifics( &#x27;easings&#x27; );
  this.prepareSpecifics( &#x27;repeats&#x27; );
  this.prepareSpecifics( &#x27;delays&#x27; );
  this.prepareSpecifics( &#x27;sleeps&#x27; );
  this.prepareSpecifics( &#x27;durations&#x27; );
  this.prepareSpecifics( &#x27;scales&#x27; );
  this.prepareSpecifics( &#x27;scaleBases&#x27; );
};

anim8.ParserHelper.prototype = 
{

  /**
   * If an object with the given name doesn&#x27;t exist on the input it&#x27;s created.
   * 
   * @param  {String} specifics
   */
  prepareSpecifics: function(specifics)
  {
    if ( !anim8.isObject( this.input[ specifics ] ) )
    {
      this.input[ specifics ] = {};
    }
  },

  /* PARSING */

  /**
   * Parses an easing from the input.
   * 
   * @param  {String} attr
   * @return {String|Function|Array}
   */
  parseEasing: function(attr)
  {
    return this.parseFirst( attr, &#x27;easing&#x27;, &#x27;easings&#x27; );
  },

  /**
   * Parses repeats from the input.
   * 
   * @param  {String} attr
   * @return {Number}
   */
  parseRepeat: function(attr)
  {
    return this.parseNumber( attr, anim8.repeat, anim8.repeat, &#x27;repeat&#x27;, &#x27;repeatAdd&#x27;, &#x27;repeatScale&#x27;, &#x27;repeats&#x27; );
  },

  /**
   * Parses delay from the input.
   * 
   * @param  {String} attr
   * @return {Number}
   */
  parseDelay: function(attr)
  {
    return this.parseNumber( attr, anim8.delay, anim8.time, &#x27;delay&#x27;, &#x27;delayAdd&#x27;, &#x27;delayScale&#x27;, &#x27;delays&#x27; );
  },

  /**
   * Parses sleep from the input.
   * 
   * @param  {String} attr
   * @return {Number}
   */
  parseSleep: function(attr)
  {
    return this.parseNumber( attr, anim8.sleep, anim8.time, &#x27;sleep&#x27;, &#x27;sleepAdd&#x27;, &#x27;sleepScale&#x27;, &#x27;sleeps&#x27; );
  },

  /**
   * Parses duration from the input.
   * 
   * @param  {String} attr
   * @return {Number}
   */
  parseDuration: function(attr)
  {
    return this.parseNumber( attr, anim8.duration, anim8.time, &#x27;duration&#x27;, &#x27;durationAdd&#x27;, &#x27;durationScale&#x27;, &#x27;durations&#x27; );
  },

  /**
   * Parses scale from the input.
   * 
   * @param  {String} attr
   * @return {Number}
   */
  parseScale: function(attr)
  {
    return this.parseNumber( attr, anim8.scale, anim8.number, &#x27;scale&#x27;, &#x27;scaleAdd&#x27;, &#x27;scaleScale&#x27;, &#x27;scales&#x27; );
  },

  /**
   * Parses scale base from the input.
   * 
   * @param  {String} attr
   * @return {any}
   */
  parseScaleBase: function(attr)
  {
    return this.parseFirst( attr, &#x27;scaleBase&#x27;, &#x27;scaleBases&#x27; );
  },

  /**
   * Parses a value from the input given the attribute, option, and specific.
   * 
   * @param {String} attr
   * @param {String} option
   * @param {String} specifics
   * @return {any}
   */
  parseFirst: function(attr, option, specifics)
  {
    return anim8.coalesce( this.input[ specifics ][ attr ], this.oldOptions[ option ] );
  },

  /**
   * Parses an event from the input given a path &amp; parser for the event.
   * 
   * @param {String} attr
   * @param {anim8.Path} path
   * @param {anim8.Parser} parser
   * @param {Boolean} hasInitialState
   * @return {anim8.Event}
   */
  parseEvent: function(attr, path, parser, hasInitialState)
  {
    var duration   = this.parseDuration( attr );
    var easing     = this.parseEasing( attr );
    var delay      = this.parseDelay( attr );
    var sleep      = this.parseSleep( attr );
    var repeat     = this.parseRepeat( attr );
    var scale      = this.parseScale( attr );
    var scaleBase  = this.parseScaleBase( attr );
    var event      = new anim8.Event( attr, path, duration, easing, delay, sleep, repeat, scale, scaleBase, hasInitialState, parser );

    return event;
  },

  /**
   * Parses a number from the input given parse functions.
   * 
   * @param {String} attr
   * @param {Function} parseFunction
   * @param {Function} parseOptionFunction
   * @param {String} option
   * @param {String} optionAdd
   * @param {String} optionScale
   * @param {String} specifics
   * @return {Number}
   */
  parseNumber: function(attr, parseFunction, parseOptionFunction, option, optionAdd, optionScale, specifics)
  {
    var baseRaw = anim8.coalesce( this.input[ specifics ][ attr ], this.oldOptions[ option ] );
    var base = parseFunction( baseRaw );
    var add = parseOptionFunction( this.oldOptions[ optionAdd ], 0 );
    var scale = anim8.coalesce( this.oldOptions[ optionScale ], 1 );

    return (add === 0 &amp;&amp; scale === 1) ? baseRaw : (base + add) * scale;
  },

  /* MERGING */

  /**
   * Merges easing based on the input, new options, and the current easing.
   * 
   * @param {String} attr
   * @param {Function} current
   * @return {Function}
   */
  mergeEasing: function(attr, current)
  {
    return this.mergeFirst( attr, current, anim8.easing, &#x27;easing&#x27;, &#x27;easings&#x27; );
  },

  /**
   * Merges repeats based on the input, new options, and the current repeat.
   * 
   * @param {String} attr
   * @param {Number} current
   * @return {Number}
   */
  mergeRepeat: function(attr, current)
  {
    return this.mergeNumber( attr, current, anim8.repeat, &#x27;repeat&#x27;, &#x27;repeatAdd&#x27;, &#x27;repeatScale&#x27;, &#x27;repeats&#x27; );
  },

  /**
   * Merges delay based on the input, new options, and the current delay.
   * 
   * @param {String} attr
   * @param {Number} current
   * @return {Number}
   */
  mergeDelay: function(attr, current)
  {
    return this.mergeNumber( attr, current, anim8.time, &#x27;delay&#x27;, &#x27;delayAdd&#x27;, &#x27;delayScale&#x27;, &#x27;delays&#x27; );
  },

  /**
   * Merges sleep based on the input, new options, and the current sleep.
   * 
   * @param {String} attr
   * @param {Number} current
   * @return {Number}
   */
  mergeSleep: function(attr, current)
  {
    return this.mergeNumber( attr, current, anim8.time, &#x27;sleep&#x27;, &#x27;sleepAdd&#x27;, &#x27;sleepScale&#x27;, &#x27;scales&#x27; );
  },

  /**
   * Merges duration based on the input, new options, and the current duration.
   * 
   * @param {String} attr
   * @param {Number} current
   * @return {Number}
   */
  mergeDuration: function(attr, current)
  {
    return this.mergeNumber( attr, current, anim8.time, &#x27;duration&#x27;, &#x27;durationAdd&#x27;, &#x27;durationScale&#x27;, &#x27;durations&#x27; );
  },

  /**
   * Merges scale based on the input, new options, and the current scale.
   * 
   * @param {String} attr
   * @param {Number} current
   * @return {Number}
   */
  mergeScale: function(attr, current)
  {
    return this.mergeNumber( attr, current, anim8.number, &#x27;scale&#x27;, &#x27;scaleAdd&#x27;, &#x27;scaleScale&#x27;, &#x27;scales&#x27; );
  },

  /**
   * Merges scale base based on the input, new options, and the current scale 
   * base.
   * 
   * @param {String} attr
   * @param {T} current
   * @param {anim8.Factory} factory
   * @return {T}
   */
  mergeScaleBase: function(attr, current, factory)
  {
    var calc = factory.attribute( attr ).calculator;
    var parseFunction = function(value, defaultValue) {
      return calc.parse( value, defaultValue );
    };

    return this.mergeFirst( attr, current, parseFunction, &#x27;scaleBase&#x27;, &#x27;scaleBases&#x27; );
  },

  /**
   * Returns the first available option from input, new options, old options,
   * and the current value.
   * 
   * @param {String} attr
   * @param {T} current
   * @param {Function} parseOptionFunction
   * @param {String} option
   * @param {String} specifics
   * @return {T}
   */
  mergeFirst: function(attr, current, parseOptionFunction, option, specifics)
  {
    return parseOptionFunction( anim8.coalesce( this.input[ specifics ][ attr ], this.newOptions[ option ], this.oldOptions[ option ] ), current );
  },

  /**
   * Merges a number by returning the first occurrence from input, new options,
   * old options, and the current value.
   * 
   * @param {String} attr
   * @param {Number} current
   * @param {Function} parseOptionFunction
   * @param {String} option
   * @param {String} optionAdd
   * @param {String} optionScale
   * @param {String} specifics
   * @return {Number}
   */
  mergeNumber: function(attr, current, parseOptionFunction, option, optionAdd, optionScale, specifics)
  {
    var baseRaw = anim8.coalesce( this.input[ specifics ][ attr ], this.newOptions[ option ], this.oldOptions[ option ] );
    var base = parseOptionFunction( baseRaw, current );
    var add = parseOptionFunction( anim8.coalesce( this.newOptions[ optionAdd ], this.oldOptions[ optionAdd ] ), 0 );
    var scale = anim8.coalesce( this.newOptions[ optionScale ], this.oldOptions[ optionScale ], 1 );

    return (base + add) * scale;
  }

};
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
