<!DOCTYPE html>
<html>
  <head>
    <style>
    #container {
      width: 90%;
      height: 300px;
      position: relative;
      left: 5%;
      top: 5%;
      border: 1px solid #ddd;
      display: inline-block;
      margin-bottom: 2%;
    }
    #container2 {
      position: relative;
      top: 5%;
      left: 5%;
      width: 90%;
      border: 1px solid #ddd;
      display: inline-block;
    }
    #container2 img {
      width: 29%;
      margin: 2%;
    }
    #box {
      width: 40px;
      height: 40px;
      border: 2px solid #00F;
      position: absolute;
      background-color: #66F;
    }
    #box2 {
      width: 40px;
      height: 40px;
      border: 2px solid #0F0;
      position: absolute;
      background-color: #6F6;
    }
    #box3 {
      width: 40px;
      height: 40px;
      left: 100px;
      border: 2px solid #F00;
      position: absolute;
      background-color: #F66;
    }
    #box4 {
      width: 40px;
      height: 40px;
      top: 100px;
      border: 2px solid #FF0;
      position: absolute;
      background-color: #FF6;
    }
    #box5 {
      width: 40px;
      height: 40px;
      right: 50px;
      bottom: 50px;
      border: 2px solid #F0F;
      position: absolute;
      background-color: #F6F;
    }
    #box6 {
      width: 40px;
      height: 40px;
      left: 30px;
      bottom: 30px;
      border: 2px solid #000;
      position: absolute;
      background-color: #666;
    }
    #box7 {
      width: 40px;
      height: 40px;
      right: 5px;
      top: 5px;
      border: 2px solid #F80;
      position: absolute;
      background-color: #FA6;
      box-sizing: border-box;
    }
    #box8 {
      width: 40px;
      height: 40px;
      left: 40%;
      bottom: 5px;
      border: 5px solid #DDD;
      position: absolute;
      background-color: #AAA;
    }
    
    
    </style>
  </head>
  <body>
    
    <div id="container">
      <div id="box"></div>
      <div id="box2"></div>
      <div id="box3"></div>
      <div id="box4"></div>
      <div id="box5"></div>
      <div id="box6"></div>
      <div id="box7"></div>
      <div id="box8"></div>
    </div>
    
    <!--
    <div id="container2">
      <img id="img1" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/392/redwood-ukulele-top.jpg">
      <img id="img2" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/392/redwood-ukulele-top.jpg">
      <img id="img3" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/392/redwood-ukulele-top.jpg">
      <img id="img4" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/392/redwood-ukulele-top.jpg">
      <img id="img5" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/392/redwood-ukulele-top.jpg">
      <img id="img6" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/392/redwood-ukulele-top.jpg">
      <img id="img7" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/392/redwood-ukulele-top.jpg">
    </div>
      -->

    <script src="bezier-easing.js"></script>
			
    <script src="lib/anim8js-core.js"></script>
    <script src="lib/anim8js-easing.js"></script>
    <script src="lib/anim8js-color.js"></script>
    <script src="lib/anim8js-path.js"></script>
    <script src="lib/anim8js-dom.js"></script>
		
    <script>
      
      
      
      /*
      
      anim8.keyframe.define('bounce', {
        '0,0.2,0.53,0.8,1.0': {
          translate3d: {}
        },
        '0.4,0.43': {
          translate3d: {y:-30}
        },
        '0.7': {
          translate3d: {y:-15}
        },
        '0.9': {
          translate3d: {y:-4}
        }
      }, 1000, 1, [0.215, 0.610, 0.355, 1.000]);
      
      anim8.keyframe.define('rubberBand', {
          '0.0,1.0': {
            scale3d: {x:1, y:1, z:1}
          },
          '0.3': {
            scale3d: {x:1.25, y:0.75, z:1}
          },
          '0.4': {
            scale3d: {x:0.75, y:1.25, z:1}
          },
          '0.5': {
            scale3d: {x:1.15, y:0.85, z:1}
          },
          '0.65': {
            scale3d: {x:0.95, y:1.05, z:1}
          },
          '0.75': {
            scale3d: {x:1.05, y:0.95, z:1}
          }
      });
      */
      
      /* TODO remove after testing complete 
      anim8.keyframe(window.box, {
        '0.0': {
          rotate: 0,
          scale: 1.0
        },
        '0.5': {
          rotate: 90,
          scale: 2.0
        },
        '1.0': {
          rotate: 360,
          scale: 1.0
        }
      }, 1000, 50);
      
      anim8.keyframe(window.box2, {
        '0.0': {
          distance: 50,
          angle: 0,
          left: 130,
          top: 130
        },
        '1.0': {
          distance: 50,
          angle: 360,
          left: 130,
          top: 130
        }
      }, 2000, 45);
      
      anim8.keyframe(window.box3, {
        '0.0': {
          opacity: 1.0
        },
        '0.8': {
          opacity: 0.0
        },
        '1.0': {
          opacity: 0.8
        }
      }, 1000, 10);
      
      anim8.keyframe(window.box4, {
        '0.0': {
          margin: 0
        },
        '0.8': {
          margin: 10
        },
        '1.0': {
          margin: 40
        }
      }, 1000, 10);
      
      anim8.keyframe(window.box5, 'bounce', undefined, 10);
      anim8.keyframe(window.box6, 'rubberBand', undefined, 10);      
      
      anim8.keyframe(window.box7, {
        '0.0,1.0': {
          borderWidth: 1
        },
        '0.5': {
          borderWidth: 10
        }
      }, 1000, 20);
      
      anim8.keyframe(window.box8, {
        '0.0,1.0': {
          blur: 0
        },
        '0.5': {
          blur: 5
        }
      }, 1000, 20);
      
      anim8.keyframe(window.img1, {
        '0.0,1.0': {
          grayscale: 0
        },
        '0.5': {
          grayscale: 100
        }
      }, 1000, 20);
      
      anim8.keyframe(window.img2, {
        '0.0,1.0': {
          sepia: 0
        },
        '0.5': {
          sepia: 100
        }
      }, 1000, 20);
      
      anim8.keyframe(window.img3, {
        '0.0,1.0': {
          saturate: 0
        },
        '0.5': {
          saturate: 100
        }
      }, 1000, 20);
      
      anim8.keyframe(window.img4, {
        '0.0,1.0': {
          hueRotate: 0
        },
        '0.5': {
          hueRotate: 360
        }
      }, 1000, 20);
      
      anim8.keyframe(window.img5, {
        '0.0,1.0': {
          invert: 0
        },
        '0.5': {
          invert: 100
        }
      }, 1000, 20);
      
      anim8.keyframe(window.img6, {
        '0.0,1.0': {
          brightness: 0
        },
        '0.5': {
          brightness: 100
        }
      }, 1000, 20);
      
      anim8.keyframe(window.img7, {
        '0.0,1.0': {
          contrast: 0
        },
        '0.5': {
          contrast: 100
        }
      }, 1000, 20);
      
      */
      
      
      // ====== ATTRIBUTES ======
      // width, minWidth, maxWidth
      // height, minHeiht, maxHeight
      // angle, distance
      // centerX | left | right | translateX
      // centerY | top | bottom | translateY
      // scale, scaleX, scaleY
      // scale3d, translate3d, rotate3d
      // originX, originY
      // opacity
      // zIndex
      // margin, marginTop, marginRight, marginBottom, marginLeft
      // padding, paddingTop, paddingRight, paddingBottom, paddingLeft
      // borderWidth, borderTopWidth, borderRightWidth, borderBottomWidth, borderLeftWidth
      // outlineWidth
      // borderRadius, borderTopLeftRadius, borderTopRightRadius, borderBottomLeftRadius, borderBottomRightRadius
      // textIndent
      // borderSpacing
      // outlineWidth
      // fontSize
      // lineHeight
      // ===== COLOR ======
      // backgroundColor, color, borderTopColor, borderRightColor, borderBottomColor, borderLeftColor, outlineColor
      
      // Get animator based on object passed in
      
      // Paths, Keyframes, 
      
      /**
      function isElement(o){
        return (
          typeof HTMLElement === "object" ? o instanceof HTMLElement : //DOM2
          o && typeof o === "object" && o !== null && o.nodeType === 1 && typeof o.nodeName==="string"
        );
      }
       */
      
      anim8.calculator = function(x) {
        if ( anim8.isFunction(x) ) {
          return x;
        }
        else if ( anim8.isString(x) && x in anim8.calculator ) {
          return anim8.calculator[x];
        }
        return anim8.calculator.default;
      };
      anim8.calculator.number = function(a, b, delta) {
        return (b - a) * delta + a;
      };
      anim8.calculator.point2d = function(a, b, delta) {
        return {
          x: (b.x - a.x) * delta + a.x,
          y: (b.y - a.y) * delta + a.y
        };
      };
      anim8.calculator.point3d = function(a, b, delta) {
        return {
          x: (b.x - a.x) * delta + a.x,
          y: (b.y - a.y) * delta + a.y,
          z: (b.z - a.z) * delta + a.z
        };
      };
      anim8.calculator.color = function(a, b, delta) {
        return {
          r: (b.r - a.r) * delta + a.r,
          g: (b.g - a.g) * delta + a.g,
          b: (b.b - a.b) * delta + a.b,
          a: (b.a - a.a) * delta + a.a
        };
      };
      anim8.calculator.default = anim8.calculator.number;
      
      anim8.EventState = {
        CREATED: 0,
        DELAYED: 1,
        ANIMATING: 2, 
        ANIMATING_REVERSE: 2 | 4,
        SLEEPING: 8,
        PAUSED: 16,
        FINISHED: 32
      };
      
      anim8.Event = function(attribute, path, duration, easing, delay, sleep, pong, repeat) {
        this.attribute = attribute;
        this.path = path;
        this.duration = duration || 1000;
        this.easing = easing || anim8.easings.default;
        this.delay = delay || 0;
        this.sleep = sleep || 0;
        this.repeat = repeat || 1;
        this.pong = pong || false;
        this.state = anim8.EventState.CREATED;
        this.time = 0;
        this.pauseTime = 0;
        this.pauseState = 0;
      };
      
      anim8.Event.prototype = {
        update: function(now, frame) {
          var updated = false;
          
          if (this.state === anim8.EventState.CREATED) {
            this.time = now;
            if (this.delay) {
              this.state = anim8.EventState.DELAYED;
            } else {
              this.state = anim8.EventState.ANIMATING;
            }
          }
          
          var elapsed = (now - this.time);
          if (this.isDelayed()) {
            if (elapsed > this.delay) {
              elapsed = this.rewind( elapsed, this.delay, anim8.EventState.ANIMATING );
            }
          }
          
          if (this.isAnimating()) {
            
            this.catchup();
            
            var reversed = (this.state === anim8.EventState.ANIMATING_REVERSE);
            var delta = elapsed / this.duration;
            
            if (delta >= 1) {
              // If time is up for this slice and pong is true and we're not in reverse... reverse it!
              if (!reversed && this.pong) {
                elasped = this.rewind( elapsed, this.duration, anim8.EventState.ANIMATING_REVERSE );
                reversed = true;
                delta -= 1;
              } else {

                if (--this.repeat === 0) {
                  this.finish(frame);
                  return true;
                } else {
                  if (this.sleep) {
                    elapsed = this.rewind( elapsed, this.duration, anim8.EventState.SLEEPING ); 
                    delta = 1;
                  } else {
                    elapsed = this.rewind( elapsed, this.duration, anim8.EventState.ANIMATING );
                    delta -= 1;
                  }
                }
                
              }
            }
      
                  
            var deltaEased = this.easing( reversed ? 1 - delta : delta );
            frame[this.attribute] = this.path.compute( deltaEased );
            
            updated = true;            
          }
          
          if (this.isSleeping()) {
            if (elapsed > this.sleep) {
              elapsed = this.rewind( elapsed, this.sleep, anim8.EventState.ANIMATING );
            }
          }
          
          return updated;
        },
        rewind: function(elapsed, duration, newState) {
          this.time += duration;
          this.state = newState;
          return elapsed - duration;
        },
        finish: function(frame) {
          frame[this.attribute] = this.getEnd();
          this.state = anim8.EventState.FINISHED;
        },
        getEnd: function() {
          return this.path.compute( this.easing( this.pong ? 0 : 1 ) );
        },
        catchup: function() {
          // TODO
        },
        timeRemaining: function() {
          // TODO
        },
        pause: function() {
          if (this.state !== anim8.EventState.PAUSED) {
            this.pauseTime = anim8.now();
            this.pauseState = this.state;
            this.state = anim8.EventState.PAUSED; 
          }
        },
        resume: function() {
          if (this.state === anim8.EventState.PAUSED) {
            this.time += anim8.now() - this.pauseTime;
            this.state = this.pauseState; 
          }
        },
        isAnimating: function() {
          return (this.state & anim8.EventState.ANIMATING) !== 0;
        },
        isFinished: function() {
          return (this.state === anim8.EventState.FINISHED);
        },
        isDelayed: function() {
          return (this.state === anim8.EventState.DELAYED);
        },
        isPaused: function() {
          return (this.state === anim8.EventState.PAUSED);
        },
        isSleeping: function() {
          return (this.state === anim8.EventState.SLEEPING);
        },
        hasStates: function(states) {
          return (this.state & states) !== 0;
        },
        stateText: function() {
          switch(this.state) {
            case anim8.EventState.CREATED:            return "created";
            case anim8.EventState.DELAYED:            return "delayed";
            case anim8.EventState.ANIMATING:          return "animating";
            case anim8.EventState.ANIMATING_REVERSE:  return "gnitamina";
            case anim8.EventState.SLEEPING:           return "sleeping";
            case anim8.EventState.FINISHED:           return "finished";
          }
        }
      };
      
      anim8.animation = {};
      
      anim8.parser = {};
      anim8.parser.keyframe = function( animation, options, events ) 
      {
        var kframes = animation.keyframe;
        
        var durations = animation.durations || {};
        var easings = animation.easings || {};
        var delays = animation.delays || {};
        var sleeps = animation.sleeps || {};
        var pongs = animation.pongs || {};
        var repeats = animation.repeats || {};
        
        var sort = false;
        
        // split up comma delimited times
        for (var time in kframes)
        {
          if (time.indexOf(',') !== -1)
          {
            var times = time.split(',');
            
            for (var i = 0; i < times.length; i++)
            {
              kframes[times[i]] = kframes[time];
            }
            
            delete kframes[time];
            
            sort = true;
          }
        }
        
        var times = [];
        
        // validate times
        var lastTime = 0.0;
        var maxTime = 0.0;
        
        for (var time in kframes)
        {
          var t = parseFloat(time);
          
          if (isNaN(t))
          {
            delete kframes[time];
          }
          else
          {
            if (t < lastTime)
            {
              sort = true;
            }
            
            times.push({
              order: t,
              key: time,
              value: kframes[time]
            });
            
            lastTime = t;
            
            maxTime = Math.max( maxTime, t );
          }
        }
        
        // sort if necessary
        if (sort)
        {
          times.sort(function(a, b) {
            return a.order - b.order;
          });
          
          kframes = {};
          
          for (var i = 0; i < times.length; i++)
          {
            kframes[times[i].key] = times[i].value;
          }
        }
        
        // split up into deltas and values
        var deltas = {};
        var values = {};
        var calculators = {};
        
        for (var i = 0; i < times.length; i++)
        {
          var frame = times[i];
          
          for (var attr in frame.value)
          { 
            if (!(attr in deltas))
            {
              deltas[attr] = [];
              values[attr] = [];
              
              if (attr in anim8.attribute)
              {
                calculators[attr] = anim8.calculator( anim8.attribute[attr].calculator );
              }
              else
              {
                calculators[attr] = anim8.calculator.default;
              }
            }
            
            deltas[attr].push( frame.order / maxTime );
            values[attr].push( frame.value[attr] );
          }
        }
        
        // create events & paths
        for (var attr in deltas)
        {
          var duration    = anim8.coalesce( durations[attr], options.duration, anim8.defaults.duration );
          var easing      = anim8.coalesce( easings[attr], options.easing, anim8.defaults.easing );
          var delay       = anim8.coalesce( delays[attr], options.delay, anim8.defaults.delay );
          var sleep       = anim8.coalesce( sleeps[attr], options.sleep, anim8.defaults.sleep );
          var pong        = anim8.coalesce( pongs[attr], options.pong, anim8.defaults.pong );
          var repeat      = anim8.coalesce( repeats[attr], options.repeat, anim8.defaults.repeat );
          
          var path        = new anim8.Path( attr, values[attr], deltas[attr], calculators[attr] );
          var event       = new anim8.Event( attr, path, duration, easing, delay, sleep, pong, repeat );
          
          events.push( event );
        }
      };
      
      anim8.defaults = {
        duration: 1000,
        easing: function(d){return d},
        delay: 0,
        sleep: 0,
        pong: false,
        repeat: 1
      };
      
      /**
       
       anim8.play( box2, {
          keyframe: {
            '0.0': {
              rotate: 0,
              scale: 1.0
            },
            '0.5': {
              rotate: 90,
              scale: 2.0
            },
            '1.0': {
              rotate: 360,
              scale: 1.0
            }
          }
       });
       
       */
      
      anim8.parseEvents = function(animation, options)
      {
        var events = [];
        
        for (var parser in animation) 
        {
          if (parser in anim8.parser) 
          {
            anim8.parser[ parser ]( animation, options, events );
          }
        }
        
        return events;
      };
      
      anim8.save = function(nm, animation, options) 
      {
        anim8.animation[ nm ] = anim8.parseEvents( animation, options );
      };
      
      anim8.play = function(e, animation, options) 
      {
        var events = [];
        
        if ( !anim8.isObject( options ) )
        {
          options = {};
        }
        
        if ( anim8.isString( animation ) ) 
        {
          events = anim8.animation[ animation ];
        } 
        else if ( anim8.isObject( animation ) )
        {
          events = anim8.parseEvents( animation, options );
        }
        else
        {
          return false;
        }
        
        var animator = new anim8.Animator( e, events, options );
        
        // Mark attributes as animating and grab properties
        for (var i = 0; i < events.length; i++)
        {
          var attr = events[i].attribute;
          var prop = attr;
          
          animator.animating[ attr ] = false;
          
          if (attr in anim8.attribute)
          {
            var attribute = anim8.attribute[ attr ];
            animator.attributes[ attr ] = attribute; 
            prop = anim8.coalesce( attribute.property, attribute );
          }
          else
          {
            animator.attributes[attr] = anim8.attribute.default;
          }
          
          if (!(prop in animator.properties))
          {
            if (prop in anim8.property)
            {
              animator.properties[ prop ] = anim8.property[ prop ];
            }
            else
            {
              animator.properties[ prop ] = anim8.property.default( prop );
            }  
          }
        }
        
        // add animator and potentiall start it
        anim8.add( animator );
        
        return animator;
      };
      
      anim8.running = false;
      anim8.animating = [];
      anim8.pending = [];
      
      anim8.add = function(animator)
      {
        anim8.pending.push( animator );
        
        if (!anim8.running) 
        {
          anim8.running = true;
          requestAnimationFrame( anim8.run );
        }
      }
      
      anim8.run = function() 
      {
        var now = anim8.now();
        
        // initialize any pending and promote them to animating
        for (var i = 0; i < anim8.pending.length; i++)
        {
          var animator = anim8.pending[i];
          
          animator.initialize();
          anim8.animating.push( animator );
        }
        
        anim8.pending.length = 0;
        
        // update animating based on the current time
        for (var i = 0; i < anim8.animating.length; i++)
        {
          var animator = anim8.animating[i];
          
          animator.update( now );
        }
        
        // apply the attributes calculated and if the animator is done remove it
        for (var i = anim8.animating.length - 1; i >= 0; i--)
        {
          var animator = anim8.animating[i];
          
          animator.apply();
          
          if ( animator.finished )
          {
            anim8.animating.splice( i, 1 );
          }
        }
        
        // if there are animators still remaining call me again!
        if ( anim8.animating.length )
        {
          requestAnimationFrame( anim8.run );
        } 
        else 
        {
          anim8.running = false;
        }
      };

      
      anim8.Animator = function(e, events, options) {
        this.e = e;
        this.events = events;
        this.options = options;
        this.animating = {};
        this.attributes = {};
        this.initial = {};
        this.frame = {};
        this.properties = {};
        this.units = {};
        this.options = options;
        this.finished = false;
      };
      anim8.Animator.prototype = {
        initialize: function() {
          for (var attr in this.attributes) {
            var attribute = this.attributes[attr];
            this.frame[attr] = attribute.defaultValue;
            this.units[attr] = attribute.defaultUnit;
            this.initial[attr] = attribute.defaultValue;
          }
        },
        update: function(now) {
          
          this.finished = true;
          for (var i = 0; i < this.events.length; i++) {
            var e = this.events[i];
            
            e.update( now, this.frame );
            
            if (!e.isFinished()) {
              this.finished = false;
            }
          }
        },
        apply: function() {
          for (var prop in this.properties) {
            this.properties[prop].set( this.e, this );
          }
        }
      };
      
      anim8.for = function(subject) {
        var as = anim8.animating;
        for (var i = 0; i < as.length; i++) {
          var a = as[i];
          if (a === subject || (a.isEqualNode && a.isEqualNode(subject))) {
            return a;
          }
        }
        return false;
      };
      
      /* TEST * /
      var ep = new anim8.Path('test', [10, 40, -20, 60], [0.0, 0.2, 0.8, 1.0]);
      var ev = new anim8.Event('x', ep, 1000, function(d){return d});
      
      for (var i = 0; i < 42; i++) {
        var frame = {x:0};
        ev.update(i * 25, frame);
        console.log(frame.x, ev.stateText());
      }
      
      var ep1 = new anim8.Path('test', [5, 15], [0, 1]);
      var ev1 = new anim8.Event('x', ep1, 400, function(d){return d}, 100, 50, true, 5);
      var t1 = 0;
      var frame = {x: 0};
      
      while (!ev1.isFinished()) {
        t1 += 10;
        var updated = ev1.update(t1, frame);
        console.log(frame.x, updated, ev1.stateText());
      }
      /**/
      
      
      // Easing
      // Property { name, get(), set() }
      // Path { compute(), points } 
      // Attribute { name, property }
      // Event { element, property, attribute, previous, current, duration, easing, delay, sleep, pong, repeat, path, unit }
      // EventSet { element, input, paths }
      // Element { element, events, properties }
      
      // Based on
      
      
      // Property - every attribute has an property which converts it to/from a property value. Every Property as a depedency map on other properties that must be fetched or provided before things are set.
      // Every attribute has a property, default value, default unit
      
      
      /** OPACITY
      IE 8 
        -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";
      IE 5-7
        filter: alpha(opacity=50);
      Netscape 
        -moz-opacity: 0.5;
      Safari 1.x
        -khtml-opacity: 0.5;
      Good browsers
        opacity: 0.5;
       */
      
      /** TRANSFORM
      
       */
      
    /** MIN HEIGHT/WIDTH
    IE < 7
      height: expression( this.scrollHeight < 501 ? "500px" : "auto" );
      overflow:auto;
      overflow-x:hidden;
      OR
      height:auto !important; 
      height: 500px; 
    OTHER
      min-height: value
     */
    
    /** MAX HEIGHT/WIDTH
    IE < 7
      height: expression( this.scrollHeight > 499 ? "500px" : "auto" );
      overflow:auto;
      overflow-x:hidden;
    OTHER
      max-height: value
     */
       
       // https://gist.githubusercontent.com/gre/1926947/raw/KeySpline.js
    
       anim8.save( 'bounceRotate', {
        keyframe: {
          '0.0': {
            rotate: 0,
            scale: {x:1.0, y:1.0}
          },
          '0.5': {
            rotate: 90,
            scale: {x:2.0, y:2.0}
          },
          '1.0': {
            rotate: 360,
            scale: {x:1.0, y:1.0}
          }
        }
      }, {
        repeat: 40
      });
    
      anim8.play( window.box2, 'bounceRotate' );    
    
    </script>
    
  </body>
</html>
  